---
title:  "[Retry, k8s] 13. ì„œë¹„ìŠ¤ API - NodePort" 

categories:
  - KUBERNETES
tags:
  - [kubernetes]

toc: true
toc_sticky: true

date: 2023-03-01
last_modified_at: 2023-03-01
---
# [Retry, k8s] 13. ì„œë¹„ìŠ¤ API - NodePort
---

<style>
table {
    font-size: 12pt;
}
table th:first-of-type {
    width: 5%;
}
table th:nth-of-type(2) {
    width: 15%;
}
table th:nth-of-type(3) {
    width: 50%;
}
table th:nth-of-type(4) {
    width: 30%;
}
</style>

<br>

## ğŸ”” NodePort ì„œë¹„ìŠ¤

+ **ëª¨ë“  ì¿ ë²„ë„¤í‹°ìŠ¤ ë…¸ë“œì˜ IP ì£¼ì†Œ:í¬íŠ¸ì—ì„œ ìˆ˜ì‹ í•œíŠ¸ë˜í”½ì„ ì»¨í…Œì´ë„ˆì— ì „ì†¡í•˜ëŠ” í˜•íƒœë¡œ ì™¸ë¶€ì™€ í†µì‹ í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ì„œë¹„ìŠ¤**

+ ExternalIP ì„œë¹„ìŠ¤ì—ì„œ ì „ì²´ ë…¸ë“œì˜ íŠ¸ë˜í”½ì„ ìˆ˜ì‹ í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •ê²ƒê³¼ ë¹„ìŠ·í•˜ì§€ë§Œ, Listení•  ë•Œ 0.0.0.0:í¬íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ëª¨ë“  IPì£¼ì†Œë¡œ ë°”ì¸ë“œí•˜ëŠ” í˜•íƒœ


![5](https://user-images.githubusercontent.com/42735894/228791268-04157876-e1c9-4c3a-8a26-4ecf82c66eca.png){: width="70%" height="70%"}{: .align-center}

<br>

### ğŸ“œ NodePort ìƒì„±

|ì„¤ì •|ê°œìš”|
|:---:|---|
|spec.ports[].port|ClusterIPì—ì„œ ìˆ˜ì‹ í•  í¬íŠ¸ ë²ˆí˜¸|
|spec.ports[].targetPort|ëª©ì ì§€ ì»¨í…Œì´ë„ˆ í¬íŠ¸ ë²ˆí˜¸|
|spec.ports[].nodePort|ëª¨ë“  ì¿ ë²„ë„¤í‹°ìŠ¤ ë…¸ë“œ IPì£¼ì†Œì—ì„œ ìˆ˜ì‹ í•  í¬íŠ¸ ë²ˆí˜¸|

```bash
cat <<EOF > sample-nodeport.yaml
apiVersion: v1
kind: Service
metadata:
  name: sample-nodeport
spec:
  type: NodePort
  ports:
  - name: "http-port"
    protocol: "TCP"
    port: 8080
    targetPort: 80
    nodePort: 30080
  selector:
    app: sample-app
EOF
```

```bash
$ kubectl get service
NAME              TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE
kubernetes        ClusterIP   10.96.0.1       <none>        443/TCP          62m
sample-nodeport   NodePort    10.107.49.235   <none>        8080:30080/TCP   16s


$ kubectl run --image=amsy810/tools:v2.0 --restart=Never --rm -i testpod --command -- dig sample-nodeport.default.svc.cluster.local

(ìƒëµ)

;; QUESTION SECTION:
;sample-nodeport.default.svc.cluster.local. IN A

;; ANSWER SECTION:
sample-nodeport.default.svc.cluster.local. 30 IN A 10.107.49.235


$ curl -s http://192.168.219.100:30080
Host=192.168.219.101  Path=/  From=sample-deployment-7f47966499-82lld  ClientIP=10.38.0.0  XFF=

$ curl -s http://192.168.219.101:30080
Host=192.168.219.101  Path=/  From=sample-deployment-7f47966499-llctj  ClientIP=10.38.0.0  XFF=

$ curl -s http://192.168.219.102:30080
Host=192.168.219.101  Path=/  From=sample-deployment-7f47966499-k7vk7  ClientIP=10.38.0.0  XFF=
```

<br>

### ğŸ“œ NodePort ì£¼ì˜ì 


+ NodePortì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” í¬íŠ¸ ë²”ìœ„ëŠ” 30000~32767ì´ë©°, ë²”ìœ„ ì™¸ì˜ í¬íŠ¸ë¥¼ ì§€ì •í•˜ë ¤ê³  í•˜ë©´ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤.

+ ì¿ ë²„ë„¤í‹°ìŠ¤ ë§ˆìŠ¤í„° ì„¤ì •ì„ ìì²´ì ìœ¼ë¡œ ë°”ê¿€ ìˆ˜ ìˆëŠ” ê²½ìš°ì—ëŠ” ì´ ë²”ìœ„ë¥¼ ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆí•  ìˆ˜ ìˆë‹¤.


#### (1) ë²”ìœ„ ì´ì™¸ì˜ í¬íŠ¸ ë²ˆí˜¸ë¥¼ NodePortë¡œ ì„¤ì •í•  ìˆ˜ ì—†ë‹¤.

```bash 
cat <<EOF > sample-nodeport-fail.yaml
apiVersion: v1
kind: Service
metadata:
  name: sample-nodeport-Families
spec:
  type: NodePort
  ports:
  - name: "http-port"
    protocol: "TCP"
    prot: 8080
    targetPort: 80
    nodePort: 8888
  selector:
    app: sample-app
EOF
```

```bash
$ kubectl apply -f sample-nodeport-fail.yaml
The Service "sample-nodeport-Families" is invalid: spec.ports[0].nodePort: Invalid value: 8888: provided port is not in the valid range. The range of valid ports is 30000-32767
```


#### (2) ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ í¬íŠ¸ ë²ˆí˜¸ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.

```bash
cat <<EOF > sample-nodeport-fail2.yaml
apiVersion: v1
kind: Service
metadata:
  name: sample-nodeport
spec:
  type: NodePort
  ports:
  - name: "http-port"
    protocol: "TCP"
    port: 8080
    targetPort: 80
    nodePort: 30080
  selector:
    app: sample-app
EOF
```

```bash
$ kubectl apply -f sample-nodeport-fail2.yaml
The Service "sample-nodeport-fail2" is invalid: spec.ports[0].nodePort: Invalid value: 30080: provided port is already allocated
```