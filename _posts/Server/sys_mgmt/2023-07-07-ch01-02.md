---
title:  "[ì‹œìŠ¤í…œ ê´€ë¦¬] 02. ì›¹ ì„œë²„ì˜ ë¡œê·¸(Log)" 

categories:
  - SYS_MGMT
tags:
  - [sys_mgmt, linux]

toc: true
toc_sticky: true

date: 2021-05-02
last_modified_at: 2021-05-02
---
<br>

# ğŸ”” ì›¹ ì„œë²„ì˜ ë¡œê·¸(Log)
---

<style>
table {
    font-size: 12pt;
}
table th:first-of-type {
    width: 5%;
}
table th:nth-of-type(2) {
    width: 20%;
}
table th:nth-of-type(3) {
    width: 50%;
}
table th:nth-of-type(4) {
    width: 30%;
} 
big { 
    font-size: 25px 
}
small { 
    font-size: 18px 
}
</style>

<br>

<big> **â–  ì•¡ì„¸ìŠ¤(Access) ë¡œê·¸** </big> <br>

ìš”ì²­ë°›ì€ í˜ì´ì§€ê°€ ì •ìƒìœ¼ë¡œ ì‘ë‹µë˜ì—ˆì„ ë•Œë„ ì•¡ì„¸ìŠ¤ ë¡œê·¸ì— ê¸°ë¡í•˜ê³  HTTP ìƒíƒœ ì½”ë“œë¡œ 'Not Found(404)'ì™€ ê°™ì€ ì˜¤ë¥˜ ìƒíƒœë¥¼ íšŒì‹ í–ˆì„ ë•Œë„ ì•¡ì„¸ìŠ¤ ë¡œê·¸ì— ì¶œë ¥ë©ë‹ˆë‹¤. (ë‹¨, ì›¹ ì„œë²„ì—ì„œ ìš”ì²­ë°›ì€ í˜ì´ì§€ë¥¼ ì°¾ì§€ ëª»í•œ ì›ì¸ì€ ë¡œê·¸ì— í¬í•¨ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.)

<br>

<big> **â–  ì˜¤ë¥˜(Error) ë¡œê·¸** </big> <br>

ì˜¤ë¥˜ ë¡œê·¸ëŠ” HTTP ì˜¤ë¥˜ ìƒíƒœë¥¼ ì‘ë‹µí–ˆë‹¤ëŠ” ì •ë³´ê°€ ì•„ë‹ˆë¼, ì›¹ ì„œë²„ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí•œ ê²½ìš°ì— ì¶œë ¥ë©ë‹ˆë‹¤. (404(Not Found)ë¥¼ ì‘ë‹µí•œ ë¡œê·¸ ì •ë³´ëŠ” ì•¡ì„¸ìŠ¤ ë¡œê·¸ì— ì¶œë ¥ë˜ê³ , ì´ë•Œ ì˜¤ë¥˜ê°€ ë°œìƒí•œ ì›ì¸ì— í•´ë‹¹í•˜ëŠ” ë‚´ìš©ì´ ì˜¤ë¥˜ ë¡œê·¸ë¡œ ì¶œë ¥ë©ë‹ˆë‹¤.)

<br>

<big> **â–  HTTP ìƒíƒœ ì½”ë“œ ëª©ë¡** </big> <br>

![dadad](https://github.com/revenge1005/WEB-Server-3-Tier-Architecture/assets/42735894/e4220576-2840-407e-8816-369f740dff02){: width="90%" height="90%"}{: .align-center}

<br>

<big> **â–  apache log ê´€ë ¨ ì„¤ì • (/etc/httpd/conf/httpd.conf)** </big> <br>

```bash

~(ìƒëµ)~

# (1)
ErrorLog "logs/error_log"

# (2)
LogLevel warn

<IfModule log_config_module>

    # (3)
    LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
    LogFormat "%h %l %u %t \"%r\" %>s %b" common

    <IfModule logio_module>
      LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\" %I %O" combinedio
    </IfModule>

    # (4)
    CustomLog "logs/access_log" combined
</IfModule>

~(ìƒëµ)~
```

| ì˜µì…˜ | ë‚´ìš© |
| :-----: | :------- |
| ErrorLog | ì‹¤ì œ ë¡œê·¸ íŒŒì¼ì˜ ê²½ë¡œëŠ” "ServerRoot"ì˜ ì„¤ì • + ì—¬ê¸°ì„œ ì„¤ì •í•œ ê²½ë¡œê°€ ë¨ (/etc/httpd/logs/error_log) |
| LogLevel | ì˜¤ë¥˜ ë¡œê·¸ë¡œ ì¶”ë ¥í•  ë¡œê·¸ ë ˆë²¨ì„ ì§€ì • (emerg, alert, crit, error, warn, notice, info, debug) |
| CustomLog | ì‹¤ì œ ë¡œê·¸ íŒŒì¼ì˜ ê²½ë¡œëŠ” "ServerRoot"ì˜ ì„¤ì • + ì—¬ê¸°ì„œ ì„¤ì •í•œ ê²½ë¡œê°€ ë¨ (/etc/httpd/logs/access_log), í¬ë§·ì€ combined ì‚¬ìš©, combinedëŠ” LogFormatì— ì§€ì •ë˜ì–´ ìˆë‹¤. |
| LogFormat |%h : ì›ê²© í˜¸ìŠ¤íŠ¸ëª… , %l : ì›ê²© ë¡œê·¸ëª… , %u : ì›ê²© ì‚¬ìš©ì , %t : ìš”ì²­ì„ ë°›ì•„ë“¤ì¸ ì‹œê°„ , <br> %r : ìš”ì²­ì˜ ì²«í–‰ , %>s : ë§ˆì§€ë§‰ status , %b : ì‘ë‹µ ë°”ì´íŠ¸ ìˆ˜ , <br> %{Referer}i : Referer ì •ë³´ , %{User-Agent}i : User-Agent ì •ë³´ |

<br>

<big> **â–  nginx log ê´€ë ¨ ì„¤ì • (/etc/nginx/nginx.conf)** </big> <br>

```bash

user nginx;
worker_processes auto;
# (1)
error_log /var/log/nginx/error.log notice;
pid /run/nginx.pid;

include /usr/share/nginx/modules/*.conf;

events {
    worker_connections 1024;
}

http {
    # (2)
    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';
    # (3)
    access_log  /var/log/nginx/access.log  main;

...

```

| ì˜µì…˜ | ë‚´ìš© |
| :-----: | :------- |
| error_log | notice ì´ìƒì˜ ì˜¤ë¥˜ ì •ë³´ë¥¼ /var/log/nginx/error.logë¡œ ì¶œë ¥ | 
| access_log | í¬ë§· mainì˜ ì •ì˜ì— ë”°ë¼ /var/log/nginx/access.logë¡œ ì¶œë ¥, í¬ë§· mainì€ log_formatì— ì •ì˜ë˜ì–´ ìˆë‹¤. |
| log_format | ìì„¸í•œ ë‚´ìš©ì€ (https://nginx.org/en/docs/http/ngx_http_core_module.html#variables) |

<br>

<big> **â–  webalizer - ì›¹ ì„œë²„ì˜ ì•¡ì„¸ìŠ¤ ë¡œê·¸ ë¶„ì„** </big> <br>

<br>

<small> **â–¶ webalizer ì„¤ì¹˜** </small> <br>

```bash
# centos ê¸°ì¤€, Enterprise Linux 8 (CentOS 8, RHEL 8, Rocky Linux 8, AlmaLinux 8)ì´í•˜ì—ì„œë§Œ ê°€ëŠ¥
$ yum -y install webalizer

# ubuntu ê¸°ì¤€
$ apt -y install webalizer
```

<br>

<small> **â–¶ webalizer ì„¤ì • íŒŒì¼ ì‘ì„± - Ubuntu ê¸°ì¤€** </small> <br>

```bash
$ vim /etc/webalizer/webalizer.conf
...

# ë¡œê·¸ íŒŒì¼ ê²½ë¡œ ìˆ˜ì •
LogFile /var/log/apache2/access.log

# OutputDirëŠ” ì¶œë ¥ íŒŒì¼ì„ ì €ì¥í•  ìœ„ì¹˜ - ë¶„ì„ ê²°ê³¼ ì¶œë ¥
OutputDir /var/www/webalizer
```

<br>

<small> **â–¶ webalizerë¡œ ì•¡ì„¸ìŠ¤ ë¡œê·¸ ë¶„ì„** </small> <br>

```bash
$ webalizer -c /etc/webalizer/webalizer.conf
```

<br>

<small> **â–¶ webalizer ì¶œë ¥ ë””ë ‰í„°ë¦¬ë¡œì˜ ì•¡ì„¸ìŠ¤ í—ˆìš© - Ubuntu ê¸°ì¤€** </small> <br>

```bash
$ cat <<EOF > /etc/apache2/conf-available/webalizer.conf
Alias /webalizer /var/www/webalizer

<Location /webalizer>
    Order deny,allow
    Deny from all
    Allow from 127.0.0.1
    Allow from 192.168.219.1
</Location>
EOF


$ a2enconf webalizer


$ systemctl restart apache2
```

<br>

<small> **â–¶ webalizer ì•¡ì„¸ìŠ¤ ë¶„ì„ ê²°ê³¼ í™•ì¸ (http://server_addr/webalizer/)** </small> <br>

![01eqeqw](https://github.com/revenge1005/kubernetes_build_ansible_playbook/assets/42735894/f8e3aa3b-38ca-466d-8f6c-80ab56b3b364){: width="90%" height="90%"}{: .align-center}

![3123](https://github.com/revenge1005/kubernetes_build_ansible_playbook/assets/42735894/444eba4c-158f-4744-901b-52b929d09350){: width="90%" height="90%"}{: .align-center}

<br>

<small> **â–¶ crontabì„ í†µí•´ webalizerë¥¼ ìë™ìœ¼ë¡œ ë§¤ì¼ ì‹¤í–‰** </small> <br>

```bash
$ cat <<EOF >> /etc/crontab

## webalizer
0 4 * * * root /usr/bin/webalizer -c /etc/webalizer/webalizer.conf
EOF
```