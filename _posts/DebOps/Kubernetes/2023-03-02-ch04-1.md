---
title:  "[Retry, k8s] 10. 서비스 API - ClusterIP" 

categories:
  - KUBERNETES
tags:
  - [kubernetes]

toc: true
toc_sticky: true

date: 2023-03-01
last_modified_at: 2023-03-01
---
# [Retry, k8s] 10. 서비스 API - ClusterIP
---

<style>
table {
    font-size: 12pt;
}
table th:first-of-type {
    width: 5%;
}
table th:nth-of-type(2) {
    width: 15%;
}
table th:nth-of-type(3) {
    width: 50%;
}
table th:nth-of-type(4) {
    width: 30%;
}
</style>

<br>

## 🔔 서비스 API 개요

> 클러스터상의 컨테이너에 대한 엔드포인트를 제공하거나 레이블과 일치하는 컨테이너의 디스커버리에 사용되는 리소스

<br>

### 📜 쿠버네티스 클러스터 네트워크와 서비스

> 쿠버네티스는 CNI 플러그인을 사용하여 파드 간 네트워킹을 구현하고, 서비스와 인그레스 리소스를 사용하여 파드와 외부의 통신을 추상화한다.


#### (1) 컨테이너 간의 통신

+ 파드는 하나 이상의 컨테이너로 구성된 논리적 단위로, 같은 파드 내의 컨테이너는 동일한 IP 주소와 포트를 공유하고 localhost를 통해 통신할 수 있다.


#### (2) 파드 간의 통신

+ CNI 플러그인은 컨테이너 런타임에 의해 호출되어 파드가 생성/삭제될 때 네트워크 인터페이스를 추가/제거하고, 라우팅 규칙과 IP 주소 할당, 네트워크 정책을 적용하는 역할을 한다.

+ 모든 파드는 고유한 IP 주소를 가지며, 다른 파드와 NAT 없이 통신할 수 있다.

+ 모든 노드는 모든 파드와 NAT 없이 통신할 수 있다.


#### (3) 파드와 서비스 간 통신

+ 서비스 리소스는 일정한 IP 주소와 포트를 가지고, 동일한 기능을 제공하는 파드들의 집합을 추상화한 개념

+ 서비스 리소스는 파드의 IP 주소가 변경되더라도 동일한 IP 주소와 포트를 유지하기 때문에 클라이언트가 파드의 위치를 신경쓰지 않고 통신할 수 있다.

+ kube-proxy는 각 노드에서 실행되는 구성요소로, 서비스 IP 주소와 포트에 대한 요청을 파드의 IP 주소와 포트로 프록시하는 역할을 수행한다.


#### (4) 외부와 서비스 간 통신

+ 인그레스 리소스는 외부에서 클러스터 내부의 서비스로 접근하기 위한 규칙들을 정의한 개념

+ 인그레스 컨트롤러는 인그레스 리소스에 정의된 규칙들을 실제로 구현하는 구성요소로, 로드밸런서나 리버스 프록시 역할을 수행한다.

+ 인그레스 컨트롤러가 파드에 접근하기 위해서는 CNI 플러그인과 호환되어야 한다.