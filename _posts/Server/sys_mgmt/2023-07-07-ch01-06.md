---
title:  "[ì‹œìŠ¤í…œ ê´€ë¦¬] 06. ë¡œê·¸ ê°ì‹œë²•" 

categories:
  - SYS_MGMT
tags:
  - [sys_mgmt, linux]

toc: true
toc_sticky: true

date: 2023-07-07
last_modified_at: 2023-07-07
---
<br>

# ğŸ”” ë¡œê·¸ ê°ì‹œë²•
---

<style>
table {
    font-size: 12pt;
}
table th:first-of-type {
    width: 5%;
}
table th:nth-of-type(2) {
    width: 20%;
}
table th:nth-of-type(3) {
    width: 50%;
}
table th:nth-of-type(4) {
    width: 30%;
} 
big { 
    font-size: 25px 
}
small { 
    font-size: 18px 
}
</style>

<br>

<big> **â–  ì‹œê°ìœ¼ë¡œ ë²”ìœ„ë¥¼ ì¢íŒë‹¤.** </big> <br>

1. ë¡œê·¸ í™•ì¸ ì‹œ, ì¥ì• ê°€ ë°œìƒí•œ ì‹œê° ë¶€ê·¼ì˜ ë©”ì‹œì§€ë¥¼ í™•ì¸í•œë‹¤.

2. cat, less ëª…ë ¹ ëŒ€ì‹  tail ë˜ëŠ” headë¥¼ ì‚¬ìš©í•˜ì—¬ íŒŒì¼ì˜ ì¼ë¶€ë§Œ ì¶œë ¥í•˜ì—¬ ì‹œìŠ¤í…œ ë¶€í•˜ë¥¼ ì¤„ì¼ ìˆ˜ ìˆê³ , niceë‚˜ ioniceì™€ ê°™ì€ ë‚®ì€ ìš°ì„ ìˆœìœ„ë¡œ ì‹¤í–‰í•˜ë©´ ë¶€í•˜ë¥¼ ë” ë‚®ì¶œ ìˆ˜ ìˆë‹¤.

3. ë¡œê·¸ë¥¼ í™•ì¸í•  ë•Œ ëª¨ë“  ë©”ì‹œì§€ê°€ ì¥ì•  ì›ì¸ì€ ì•„ë‹ˆë¼ëŠ” ì ì„ ì£¼ì˜í•´ì•¼ í•œë‹¤.

4. ì¥ì•  ì „í›„ë¡œ ê³„ì† ë‚˜ì˜¤ëŠ” ë©”ì‹œì§€ëŠ” ë…¸ì´ì¦ˆ(ì¥ì• ì™€ ì§ì ‘ ê´€ê³„ê°€ ì—†ëŠ” ë©”ì‹œì§€)ì¼ ìˆ˜ ìˆë‹¤.

5. ë…¸ì´ì¦ˆë¥¼ ì œì™¸í•˜ê³  ì¶”ì¶œ ëŒ€ìƒì„ í™•ì¸í•˜ê¸° ìœ„í•´ì„œëŠ” grepì˜ -v ì˜µì…˜(ê²€ìƒ‰ íŒ¨í„´ê³¼ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ” ë¼ì¸ì„ ì¶œë ¥)ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

```bash
# ì˜ˆì‹œìš© /var/log/messages ë‚´ìš©
Jun 4 20:00:01 Server dhclient: DHCPREQUEST on eth0 to 192.168.1.1
Jun 4 20:01:10 Server kernel: Error - Connection timeout
Jun 4 20:02:22 Server app: Application started
Jun 4 20:02:45 Server dhclient: DHCPACK from 192.168.1.1
Jun 4 20:03:05 Server app: Error - Database connection failed
Jun 4 20:03:40 Server dhclient: bound to 192.168.1.100 -- renewal in 500 seconds.
Jun 4 20:04:15 Server app: Error - Invalid input data
Jun 4 20:04:58 Server dhclient: DHCPREQUEST on eth0 to 192.168.1.1
Jun 4 20:05:25 Server kernel: Error - Disk I/O error
```

```bash
# ì˜ˆì‹œ 1)
$ tail -n 1000 /var/log/messages | grep "Jun 4 20:0[0-5]"
# ë˜ëŠ”
$ nice -n 19 ionice -c3 tail -n 1000 /var/log/messages | grep "Jun 4 20:0[0-5]"

Jun 4 20:02:22 Server app: Application started
Jun 4 20:02:45 Server dhclient: DHCPACK from 192.168.1.1
Jun 4 20:03:05 Server app: Error - Database connection failed
Jun 4 20:03:40 Server dhclient: bound to 192.168.1.100 -- renewal in 500 seconds.
Jun 4 20:04:15 Server app: Error - Invalid input data
```

```bash
# ì˜ˆì‹œ 2)
$ tail -n 1000 /var/log/messages | grep "Jun 4 20:0[0-5]" | grep -v "dhclient"

Jun 4 20:02:22 Server app: Application started
Jun 4 20:03:05 Server app: Error - Database connection failed
Jun 4 20:04:15 Server app: Error - Invalid input data
```

<br>

<big> **â–  í‚¤ì›Œë“œë¡œ ë²”ìœ„ë¥¼ ì¢íŒë‹¤.** </big> <br>

1. ì‹œê°ìœ¼ë¡œë§Œ ë²”ìœ„ë¥¼ ì¢íˆëŠ” ê²ƒì€ ëŒ€ëŸ‰ì˜ ë¡œê·¸ê°€ ì¶œë ¥ëœ ê²½ìš°ì—ëŠ” íš¨ê³¼ì ì´ì§€ ì•Šì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ, í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ë²”ìœ„ë¥¼ ì¢íŒë‹¤.

2. ì¥ì•  ì›ì¸ì„ ì¶”ì¸¡í•  ìˆ˜ ìˆë‹¤ë©´, í•´ë‹¹ ì¥ì•  ë°œìƒ ì‹œ ì¶œë ¥ë˜ëŠ” ë¬¸ìì—´ì„ ë¯¸ë¦¬ ì•Œì•„ë‘ê³ , ì´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ê²€ìƒ‰í•˜ëŠ” ê²ƒì´ ë¹ ë¥¼ ìˆ˜ ìˆì§€ë§Œ ê²€ìƒ‰ ë¬¸ìì—´ì´ êµ¬ì²´ì ì´ë©´ ë‹¤ë¥¸ ë©”ì‹œì§€ê¹Œì§€ í•„í„°ë§ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì´ ë°©ë²•ì€ ì‚¬ì „ ì—°ìŠµ ì •ë„ë¡œë§Œ ì´ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

3. ë¯¸ì§€ì˜ ì˜¤ë¥˜ ë°œìƒ ì‹œ ìì£¼ ì¶œë ¥ë˜ëŠ” ë¡œê·¸ ë ˆë²¨ ë¬¸ìì—´ì„ í‚¤ì›Œë“œë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤. ì¼ë°˜ì ì¸ ë¡œê·¸ ë ˆë²¨ ë¬¸ìì—´ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

    | ë¡œê·¸ ë ˆë²¨ | ì˜ë¯¸ |
    | :-----: | :------- |
    | Fatal, Critical | ì¹˜ëª…ì ì¸ ì˜¤ë¥˜ ì¥ì•  |
    | Error | ì¹˜ëª…ì ì¸ ì˜¤ë¥˜ ì •ë³´ ë˜ëŠ” ì˜¤ë¥˜ ì •ë³´ |
    | Warning | ê²½ê³  ì •ë³´ |
    | Info, Note, Notice | ì¼ë°˜ì ì¸ (ì¡°ì‘) ì •ë³´ |
    | Debug, Trace | ë””ë²„ê·¸ ì •ë³´ |

4. ë¡œê·¸ ë ˆë²¨ ë¬¸ìì—´ì€ ì†Œí”„íŠ¸ì›¨ì–´ë³„ë¡œ ì•½ê°„ì”© ë‹¤ë¥´ë¯€ë¡œ, ë¡œê·¸ ë ˆë²¨ì˜ ì‚¬ì–‘ì„ íŒŒì•…í•˜ê±°ë‚˜ ì°¾ê¸° ì‰¬ìš´ íŒ¨í„´ì„ ì§€ì •í•´ì•¼ í•œë‹¤. (ì˜ˆì‹œ: warn(ì•½ì í‘œê¸°), warning(ì†Œë¬¸ì í‘œê¸°))

5. ê²€ìƒ‰ì—ì„œ ì‰½ê²Œ ì°¾ì„ ìˆ˜ ìˆë„ë¡ grepì˜ -i ì˜µì…˜(ëŒ€ì†Œë¬¸ìë¥¼ êµ¬ë³„í•˜ì§€ ì•Šê³  ê²€ìƒ‰)ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

```bash
# ì˜ˆì‹œìš© /var/log/httpd/error_log ë‚´ìš©
[Jun 4 20:05:10] [error] [client 192.168.1.100] server reached MaxClients, shutting down
[Jun 4 20:06:15] [warn] [client 192.168.1.101] Request header is too large
[Jun 4 20:06:30] [info] [client 192.168.1.102] Successfully connected to database
[Jun 4 20:07:05] [error] [client 192.168.1.103] File not found: /var/www/html/page.html
[Jun 4 20:08:20] [warn] [client 192.168.1.104] Connection timeout to server
```

```bash
# ì˜ˆì‹œ 1)
$ tail -n 1000 /var/log/httpd/error_log | grep "server reached MaxClients"

[Jun 4 20:05:10] [error] [client 192.168.1.100] server reached MaxClients, shutting down
```

```bash
# ì˜ˆì‹œ 2)
$ tail -n 1000 /var/log/httpd/error_log | grep -i "warn"

[Jun 4 20:06:15] [warn] [client 192.168.1.101] Request header is too large
[Jun 4 20:08:20] [warn] [client 192.168.1.104] Connection timeout to server
```

<br>

<big> **â–  ë©”ì‹œì§€ ì–‘ì„ ì£¼ëª©í•œë‹¤.** </big> <br>

1. ì„œë¹„ìŠ¤ì— ë¬¸ì œê°€ ìƒê²¼ì§€ë§Œ ì˜¤ë¥˜ ë©”ì‹œì§€ì— ì•„ë¬´ê²ƒë„ ì¶œë ¥ë˜ì§€ ì•ŠëŠ” ê²½ìš°, ìš”ì²­ ëŒ€ë¹„ ì‹œìŠ¤í…œ ì²˜ë¦¬ ì„±ëŠ¥ì´ ë¶€ì¡±í•œ ê²ƒì´ ì›ì¸ì¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë©”ì‹œì§€ ì–‘ì„ ë¹„êµí•˜ì—¬ í™•ì¸í•´ì•¼ í•œë‹¤.

2. ì‹œê°ë³„ë¡œ ì•¡ì„¸ìŠ¤ ë¡œê·¸ë¥¼ ì§‘ê³„í•˜ë©´ ì•¡ì„¸ìŠ¤ ì¦ê°ì„ ì•Œ ìˆ˜ ìˆìœ¼ë©°, uniq -cì˜ ê²°ê³¼ë¥¼ ê°€ì‹œí™”í•˜ëŠ” ë„êµ¬ì¸ Cactië‚˜ Muninê³¼ ê°™ì€ ê°ì‹œ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ì‰½ê²Œ ì‹œê°í™”í•  ìˆ˜ ìˆë‹¤.

3. ì•¡ì„¸ìŠ¤í•œ ì†ŒìŠ¤ IP ì£¼ì†Œë³„ë¡œ ì§‘ê³„í•˜ë©´ ì–´ë–¤ IP ì£¼ì†Œì—ì„œ ì•¡ì„¸ìŠ¤ê°€ ë§ì•˜ëŠ”ì§€ ì•Œ ìˆ˜ ìˆìœ¼ë©°, íŠ¹ì • IP ì£¼ì†Œì˜ ì ‘ì†ì´ ê·¹ë‹¨ì ìœ¼ë¡œ ë§ì„ ê²½ìš°, ë¶€ì • ì•¡ì„¸ìŠ¤ë‚˜ ê²€ìƒ‰ ì—”ì§„ ë¡œë´‡ì— ì˜í•œ ìŠ¤ìº”ì¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì£¼ì˜í•´ì•¼ í•œë‹¤.

4. ë©”ì‹œì§€ ì–‘ì„ ë¹„êµí•˜ëŠ” ëŒ€ìƒì€ ì‹ ì¤‘í•´ì•¼ í•˜ëŠ”ë°, í• ì¸íŒë§¤ ë“±ìœ¼ë¡œ ì¸í•´ í•˜ë£¨ ì¤‘ ì•¡ì„¸ìŠ¤ê°€ ë§ì€ ê²½ìš°, ìˆ˜ ë¶„ ì „ì˜ ë©”ì‹œì§€ì–‘ê³¼ ë¹„êµí•˜ë”ë¼ë„ ì•¡ì„¸ìŠ¤ ì¦ê°€ë¼ê³  íŒë‹¨í•  ìˆ˜ ì—†ìœ¼ë©° ì‚¬í˜ ì „, ì¼ì£¼ì¼ ì „ê³¼ ê°™ì´ ì¼ë°˜ì ì¸ ì•¡ì„¸ìŠ¤ ìƒí™©ê³¼ ë¹„êµí•˜ì—¬ íŒë‹¨í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤.

5. ì„œë¹„ìŠ¤ ì‚¬ìš©ìê°€ ì¦ê°€í•˜ë©´ì„œ ì•¡ì„¸ìŠ¤ê°€ ë§ì•„ì§€ëŠ” ê²½ìš°, ì„œë²„ íŠœë‹ì´ë‚˜ ìŠ¤í™ì—…ìœ¼ë¡œ ëŒ€ì²˜í•´ì•¼ í•œë‹¤.


```bash
# ì˜ˆì‹œ 1)
$ tail -10000 access_log | grep "05/jun/2014" | cut -d ':' -f 2,3 | sort | uniq -c

    383 09:35
   3253 09:36
   1120 09:37
   1196 09:38
    933 09:39
    355 09:40
    348 09:41
    219 09:42
    370 09:43
    218 09:44
    313 09:45 
```

```bash
# ì˜ˆì‹œ 2)
$ tail -10000 access_log | grep "05/jun/2014:09:36" | awk '{print $1}' | sort -n | uniq -c | sort

    6 198.51.10.1
    8 198.51.10.2
   34 198.51.10.3
   40 198.51.10.4 
  130 198.51.10.5 
 3000 198.51.10.6 
```

<br>

<big> **â–  í˜„ì¥ì—ì„œ ì¥ì•  ì›ì¸ì„ íŒë³„í•˜ëŠ” ì˜ˆì‹œ** </big> <br>

1. MySQL ì„œë²„ê°€ ê°‘ìê¸° ì •ì§€í•˜ëŠ” ì¥ì• ê°€ ë°œìƒí–ˆë‹¤ê³  ê°€ì •í–ˆì„ ë•Œ, ê°€ì¥ ë¨¼ì € í™•ì¸í•  ê²ƒì€ MySQLì˜ "ì˜¤ë¥˜ ë¡œê·¸"ì´ë‹¤.

```bash
# ì˜ˆì‹œ 1) /var/lib/mysql/test.com.err 
01 140612 20:42:09 mysqld_safe Number of processes running now: 0                      ## mysqld_safeê°€ mysqld í”„ë¡œì„¸ìŠ¤ ê°œìˆ˜ê°€ 0ì„ì„ í™•ì¸
02 140612 20:42:09 mysqld_safe mysqld restarted                                        ## mysqlë¥¼ ì¬ì‹œì‘ (ì´ë¯¸ ì´ ì‹œì ì— ì¢…ë£Œë˜ì–´ ìˆìŒ)
03 140612 20:42:15 [Note] Plugin 'FEDERATED' is disabled.
04 140612 20:42:15 InnoDB: The InnoDB memory heap is disabled
05 140612 20:42:15 InnoDB: Mutexes and rw_locks use GCC atomic builtins
06 140612 20:42:15 InnoDB: Compressed tables use zlib 1.2.7
07 140612 20:42:15 InnoDB: Using Linux native AIO
08 140612 20:42:15 InnoDB: Initializing buffer pool, size = 256.0M
09 InnoDB: mmap(274726912 bytes) failed; errno 12
10 140612 20:42:15 InnoDB: Completed initialization of buffer pool
11 140612 20:42:15 InnoDB: Fatal error: cannot allocate memory for the buffer pool 2   ## "Fatal error". buffer poolìš© ë©”ëª¨ë¦¬ í™•ë³´ì— ì‹¤íŒ¨
12 140612 20:42:15 [ERROR] Plugin 'InnoDB' init "function returned error."
13 140612 20:42:15 [ERROR] Plugin 'InnoDB' registration as a STORAGE ENGINE failed.    ## InnoDB ë“±ë¡ ì‹¤íŒ¨
14 140612 20:42:15 [ERROR] Unknown/unsupported storage engine: InnoDB
15 140612 20:42:15 [ERROR] Aborting                                                    ## ë¹„ì •ìƒ ì¢…ë£Œ
16 140612 20:42:15 [Note] /usr/libexec/mysqld: Shutdown complete                       ## mysqld ì •ì§€
17 140612 20:42:15 mysqld_safe mysqld from pid file /var/run/mysqld/mysqld.pid ended
```

2. ì—¬ê¸°ì„œëŠ” MySQLì´ ì •ì§€í•œ ê²ƒì´ ë¬¸ì œì´ë¯€ë¡œ ê´€ë ¨ì´ ìˆì„ ë§Œí•œ ë¡œê·¸ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ë´ì•¼í•˜ë©°, ERRORë‚˜ FATALê³¼ ê°™ì€ ë¬¸ìì—´ë„ ê·¸ëƒ¥ ë„˜ê¸°ì§€ ë§ê³  í™•ì¸í•´ì•¼ í•œë‹¤. 

3. ì´ë¯¸ 01ì¤„ì˜ ë¡œê·¸ ì¶œë ¥ ë‹¨ê³„ì—ì„œ mysqldê°€ ì¢…ë£Œë˜ì–´ ìˆìœ¼ë¯€ë¡œ MySQLì˜ ë¡œê·¸ë¥¼ í™•ì¸í•˜ëŠ” ê²ƒë§Œìœ¼ë¡œëŠ” ê·¼ë³¸ì ì¸ ì›ì¸ì´ ëª…í™•í•˜ì§€ ì•Šì€ ìƒíƒœì´ë‹¤.

4. 02ì¤„ì—ì„œëŠ” ë©”ëª¨ë¦¬ë¥¼ í™•ë³´í•  ìˆ˜ ì—†ì–´ ì‹¤íŒ¨í–ˆë‹¤ëŠ” ê±¸ ì•Œë ¤ì¤€ë‹¤.

5. ì§€ê¸ˆë¶€í„°ëŠ” ì˜ˆì¸¡ì´ì§€ë§Œ ì–´ì©Œë©´ ì²˜ìŒìœ¼ë¡œ í”„ë¡œì„¸ìŠ¤ê°€ ì¢…ë£Œí•œ ì›ì¸ë„ ë©”ëª¨ë¦¬ì™€ ê´€ë ¨ì´ ìˆì„ ìˆ˜ ìˆë‹¤. ë”°ë¼ì„œ MySQL ë¡œê·¸ì—ì„œ í™•ì¸ëœ ì‹œê°ë³´ë‹¤ ì´ì „ ì‹œì ì˜ ì‹œìŠ¤í…œ ë¡œê·¸(/var/log/messages)ë¥¼ í™•ì¸í•œë‹¤.

```bash
# ì˜ˆì‹œ 2) /var/og/messages
01 Jun 12 20:42:05 www kernel: [29204168.349016] httpd invoked oom-killer: gfp_mask=0x201da, order=0, oom_ score_adj=0
02 Jun 12 20:42:05 www kernel: [29204168.349033] httpd cpuset=/ mems_allowed=0
03 Jun 12 20:42:05 www kernel: [29204168.349077] Call Trace:
04 Jun 12 20:42:05 www kernel: [29204168.349090] [<ffffffff8143eb2b>] dump_stack+0x19/0x1b
05 Jun 12 20:42:05 www kernel: [29204168.349108] [<ffffffff814449ba>] 7 error_exit+0x2a/0x60
06 Jun 12 28:42:85 www kernel: [29284168.349126] [<ffffffff814444bb>] ? retint_ restore_args+ax5/0x6
07 Jun 12 20:42:05 www kernel: [29204168.349137] [<ffffffff811191e>] oom_kill_process+8x1a9/0x310
08 Jun 12 20:42:05 www kernel: [29284168.349153] [<ffffffff81208495>] 7 security_ capable_noaudit+0x15/0x20
09 Jun 12 20:42:05 www kernel: [29204168.349161] [<ffffff81119939>] out_of_memory+0x429/0x460
10 ...
11 Jun score 12 78 or 20:42:05 www kernel: [29204168. 573052] out of memory: Kill process 19632 (mysqld) score 78 or sacrifice child
12 Jun 12 28:42:05 www kernel: [29284168.573068] Killed process 19632 (mysqld) totalvm:1542800kB, anon-rss:132188kB, file-rss:ekB ## mysqld ê°•ì œ ì¢…ë£Œ
```

6. ì‹œìŠ¤í…œ ë¡œê·¸ì—ì„œ OOM Killer(Out Of Memory Killer)ì— ì˜í•´ mysqldê°€ ê°•ì œë¡œ ì¢…ë£Œë˜ì—ˆìŒì„ í™•ì¸í•œë‹¤.
