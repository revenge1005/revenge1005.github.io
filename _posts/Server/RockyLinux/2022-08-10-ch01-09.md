---
title:  "[Rocky] 09. DNS - 보조 서버 구성" 

categories:
  - ROCKY
tags:
  - [rocky, linux]

toc: true
toc_sticky: true

date: 2022-08-10
last_modified_at: 2022-08-10
---
<br>

# 🔔 DNS 보조 서버를 구성
---

<style>
table {
    font-size: 12pt;
}
table th:first-of-type {
    width: 5%;
}
table th:nth-of-type(2) {
    width: 15%;
}
table th:nth-of-type(3) {
    width: 50%;
}
table th:nth-of-type(4) {
    width: 30%;
}
big {
    font-size: 15pt;
}
</style>

<br>

<big> **■ DNS 마스터 서버 호스트에서 구성** </big>

```bash

$ vi /etc/named.conf

....
....

options {
        listen-on port 53 { any; };
        listen-on-v6 { any; };
        directory       "/var/named";
        dump-file       "/var/named/data/cache_dump.db";
        statistics-file "/var/named/data/named_stats.txt";
        memstatistics-file "/var/named/data/named_mem_stats.txt";
        secroots-file   "/var/named/data/named.secroots";
        recursing-file  "/var/named/data/named.recursing";
        allow-query     { localhost; internal-network; };
        # 영역 파일을 전송할 수 있도록 보조 서버 추가
        allow-transfer  { localhost; 192.168.100.85; };

....
....
```

```bash
$ vi /var/named/test.srv.wan
$TTL 86400
@   IN  SOA     ns1.test.srv. root.test.srv. (
        # update serial if update zone file
        2021072303  ;Serial
        3600        ;Refresh
        1800        ;Retry
        604800      ;Expire
        86400       ;Minimum TTL
)
        IN  NS      ns1.test.srv.
        # 보조 서버 추가
        IN  NS      ns2.test.srv.
        IN  MX 10   dlp.test.srv.

ns1     IN  A       192.168.219.101
ns2     IN  A       192.168.219.101
www     IN  A       192.168.219.102


$ systemctl restart named
```

<br>

<big> **■ DNS 보조 서버 호스트에서 구성** </big>

```bash
$ vi /etc/named.conf

zone "srv.world" IN {
        type slave;
        masters { 192.168.219.101; };
        file "slaves/test.srv.wan";
        notify no;
};

$ systemctl restart named

$ ls /var/named/slaves
srv.world.wan   # zone file transfered
```
<br>

# 🔔 전달자 DNS Server 구성
---

> 전달자는 네임 서버가 직접 해석을 수행 하지 않고 지정된 다른 네임서버의 응답을 받아 클라이언트의 질의를 처리하는 방식

+ cache name server 역할을 수행 함

+ /etc/named.conf에서 환경 설정

    + forward only/first ;

    + forwarders { 전달할 대상 서버; };


> 조건부 전달자 - 특정 도메인에 대해서만 전달자 역할을 수행함

+ /etc/named.rfc1912.zones 파일에서 설정

    ```bash
    zone "test.com" IN {
        type forward;
        forward only
        forwarders { 168.126.63.1; };
    }
    ```

+ forward

    + only : 전달자에게만 질의

    + first : 전달자를 우선으로 질의

    + 전달자에 쿼리 실패 시 root hint 질의

