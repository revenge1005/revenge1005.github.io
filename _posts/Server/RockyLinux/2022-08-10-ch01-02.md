---
title:  "[Rocky] 02. NTP ì„œë²„ êµ¬ì„±" 

categories:
  - ROCKY
tags:
  - [rocky, linux]

toc: true
toc_sticky: true

date: 2022-08-10
last_modified_at: 2022-08-10
---
<br>

# ğŸ”” íƒ€ì„ ì„œë²„(Time Server) í•„ìš”í•œ ì´ìœ 
---

<style>
table {
    font-size: 12pt;
}
table th:first-of-type {
    width: 5%;
}
table th:nth-of-type(2) {
    width: 15%;
}
table th:nth-of-type(3) {
    width: 50%;
}
table th:nth-of-type(4) {
    width: 30%;
}
big {
    font-size: 15pt;
}
</style>

> ì „ì‚°ì‹¤ì—ì„œëŠ” ìˆ˜ë§ì€ ì¥ë¹„ë“¤ì´ ìš´ì˜ë˜ê³  ìˆìœ¼ë©° ê° ì‹œìŠ¤í…œë“¤ì€ ì‹œìŠ¤í…œ ì‹œê°„ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ì´ë•Œ ì‹œê°„ì´ ëª¨ë‘ ì¼ì¹˜í•´ì•¼ ê° ì‹œìŠ¤í…œì—ì„œ ìƒì„±ë˜ëŠ” ë°ì´í„°, ë¡œê·¸, ë³´ì•ˆ ë“±ì— ê´€ë ¨ëœ ê²ƒë“¤ì´ ì‹œê°„ì— ëŒ€í•´ ì¼ê´€ì„±ì„ ê°€ì§€ê²Œ ë©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì‹œê°„ì´ ì§€ë‚¨ì— ë”°ë¼ ìš´ì˜ë˜ëŠ” ì‹œìŠ¤í…œë“¤ì˜ ì‹œìŠ¤í…œ ì‹œê°„ì´ ë¶ˆì¼ì¹˜í•˜ê²Œ ë˜ë¯€ë¡œ ë™ì¼í•œ ì‹œê°„ì„ ê°€ê¸° ìœ„í•´ ì‹œê°„ ë™ê¸°í™”ë¥¼ í•  í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤2. ì´ë•Œ ì‚¬ìš©ë˜ëŠ” ì„œë²„ê°€ NTP(Network Time Protocol) ì„œë²„ì…ë‹ˆë‹¤.

<br>

# ğŸ”” NTP(Network Time Protocol)
---

> ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ì‹œìŠ¤í…œ ì‹œê°„ì„ ë™ê¸°í™” ì‹œí‚¤ëŠ” í†µì‹  í”„ë¡œí† ì½œ ë˜ëŠ” ì„œë¹„ìŠ¤

+ NTPëŠ” ì‹œê°„ë§Œì„ ì²˜ë¦¬í•˜ëŠ” ì›ì ì„œë²„ê°€ ìˆìœ¼ë©° ì´ë¥¼ "Stratum 0"ì´ë¼ê³  ë¶€ë¦…ë‹ˆë‹¤.

+ ê·¸ë¦¬ê³  NTP ì„œë²„ì™€ ì§ì ‘ ì—°ê²°ëœ NTP ì„œë²„ë¥¼ "Stratum 1"ì´ë¼ê³  ë¶€ë¦…ë‹ˆë‹¤.

+ "Stratum 1", "Stratum 2", "Stratum 3" ì´ëŸ° í˜•ì‹ìœ¼ë¡œ NTPëŠ” ê³„ì¸µì ì¸ ì‹œìŠ¤í…œì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

+ ì „ì‚°ì‹¤ì— NTP ì„œë²„ë¡œ ì‚¬ìš©í•  ì‹œìŠ¤í…œì„ ë‘ê³  Stratum ì„œë²„ì™€ ì‹œê°„ì„ ë™ê¸°í™” ì„¤ì •ì„ í•˜ê³  ì „ì‚°ì‹¤ ë‚´ì— ìˆëŠ” ëª¨ë“  ì‹œìŠ¤í…œì— NTP ì„œë¹„ìŠ¤ë¥¼ í†µí•´ ì‹œê°„ ë™ê¸°í™”ë¥¼ ì‹œí‚¤ëŠ” ê²ƒì´ ì¼ë°˜ì ì…ë‹ˆë‹¤.

+ ì´ë ‡ê²Œ í•˜ê¸° ìœ„í•´ì„œëŠ” NTP ì„œë²„/í´ë¼ì´ì–¸íŠ¸ êµ¬ì„±ì´ í•„ìš”í•©ë‹ˆë‹¤.

<br>

<big> **â–  Stratum Server** </big>

|ë„ë©”ì¸|IP ì£¼ì†Œ|ë¹„ê³ |
|:---:|:---:|:---:|
|time.kriss.re.kr|210.98.16.100|Stratum 1, í•œêµ­í‘œì¤€ê³¼í•™ì—°êµ¬ì›|
|time2.kriss.re.kr|210.98.16.101|Stratum 1, í•œêµ­í‘œì¤€ê³¼í•™ì—°êµ¬ì›|
|ntp.postech.ac.kr|141.223.182.106|Stratum 1, í¬í•­ê³µëŒ€|
|ntp.xbsd.pe.kr|58.73.137.250|Stratum 1, xbsd|
|gps.bora.net|210.120.246.46|Stratum 1, LGU+|
|ntp.kornet.net|168.126.3.6|Stratum 1, KT|
|ntp1.cs.pusan.ac.kr|-|Stratum 1, ë¶€ì‚°ëŒ€í•™êµ|
|ntp2.cs.pusan.ac.kr|-|Stratum 1, ë¶€ì‚°ëŒ€í•™êµ|
|ntp.ewha.or.kr|175.119.224.116 / 114.207.245.175 |Stratum 2, ì´í™”ì—¬ëŒ€|
|maths.kaist.ac.kr |143.248.25.208 |Stratum 2, ì¹´ì´ìŠ¤íŠ¸|
|time.bora.net |203.248.240.103 |Stratum 2, LGU+|
|time.korserve.net |211.51.221.196 / 211.51.221.130 |Stratum 2, korserve|
|rokkorclub.net |210.118.170.59 |Stratum 2, rokkorclub|
|time.wonkwang.ac.kr |203.249.48.182 |Stratum 2, ì›ê´‘ëŒ€í•™êµ|
|ntp1.epidc.co.kr |211.115.194.21 |Stratum 2, epidc|
|ntp2.epidc.co.kr |211.115.194.22 |Stratum 2, epidc|
|time.nuri.net |- |Stratum 2, ì•„ì´ë„¤íŠ¸í˜¸ìŠ¤íŒ…|
|cse.inha.ac.kr |165.246.43.176 |Stratum 2, ì¸í•˜ëŒ€í•™êµ|
|radi.inha.ac.kr |165.246.43.195 |Stratum 2, ì¸í•˜ëŒ€í•™êµ|


<br>

# ğŸ”” NTP ì„œë²„ êµ¬ì„±
---

<br>

<big> **â–  chrony ì„¤ì¹˜ ë° êµ¬ì„±** </big>

```bash
$ dnf -y install chrony


$ vi /etc/chrony.conf


# 3ë²ˆì§¸ ì¤„ : ë™ê¸°í™”í•  ì„œë²„ë¥¼ ë³€ê²½í•˜ì„¸ìš” (ìì‹ ì˜ ì‹œê°„ëŒ€ì— ë§ëŠ” NTP ì„œë²„ë¡œ ë°”ê¾¸ì„¸ìš”)
# NTP ì„œë²„ ìì²´ë„ ë‹¤ë¥¸ NTP ì„œë²„ì™€ ì‹œê°„ì„ ë™ê¸°í™”í•  í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤
#pool 2.centos.pool.ntp.org iburst
pool time.kriss.re.kr iburst
pool 0.asia.pool.ntp.org iburst
pool 1.asia.pool.ntp.org iburst
pool 2.asia.pool.ntp.org iburst
pool 3.asia.pool.ntp.org iburst

# 24ë²ˆì§¸ ì¤„ : NTP í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ì‹œê°„ ë™ê¸°í™” ìš”ì²­ì„ ë°›ì„ ìˆ˜ ìˆë„ë¡ í—ˆìš©í•  ë„¤íŠ¸ì›Œí¬ ë²”ìœ„ë¥¼ ì¶”ê°€í•˜ì„¸ìš”
# ìì‹ ì˜ ë¡œì»¬ ë„¤íŠ¸ì›Œí¬ì„ ì§€ì •, ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ localhostë§Œ í—ˆìš©ë©ë‹ˆë‹¤
allow 192.168.219.0/24


$ systemctl enable --now chronyd
```

<br>

<big> **â–  ë°©í™”ë²½ì´ ì‹¤í–‰ ì¤‘ì´ë©´ NTP ì„œë¹„ìŠ¤ë¥¼ í—ˆìš© (NTPëŠ” [123/UDP]ë¥¼ ì‚¬ìš©)** </big>

```bash
$ firewall-cmd --add-service=ntp

$ firewall-cmd --runtime-to-permanent
```

<br>

<big> **â–  ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸** </big>

```bash
$ chronyc -a makestep

$ chronyc sources
MS Name/IP address         Stratum Poll Reach LastRx Last sample
===============================================================================
^+ send.mx.cdnetworks.com        2   6   377     8   -659us[ -659us] +/-   29ms
^* 121.162.54.1                  3   6   377     9   +858us[+1178us] +/-   32ms
^+ 121.174.142.81                3   6   377     9  -1312us[ -995us] +/-   56ms
^- 106.247.248.106               2   6   377     9  -1474us[-1474us] +/-   47ms
```

<br>

# ğŸ”” NTP í´ë¼ì´ì–¸íŠ¸ êµ¬ì„±
---

<br>

<big> **â–  chrony ì„¤ì¹˜ ë° êµ¬ì„±** </big>

+ NTP í´ë¼ì´ì–¸íŠ¸ì˜ ì„¤ì •ì€ NTP ì„œë²„ì™€ ë™ì¼í•˜ì§€ë§Œ, NTP í´ë¼ì´ì–¸íŠ¸ëŠ” ë‹¤ë¥¸ í˜¸ìŠ¤íŠ¸ë¡œë¶€í„° ì‹œê°„ ë™ê¸°í™” ìš”ì²­ì„ ë°›ì„ í•„ìš”ê°€ ì—†ìœ¼ë¯€ë¡œ [allow ***] ì¤„ì„ ì§€ì •í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.

```bash
$ dnf -y install chrony

$ vi /etc/chrony.conf

# 3ë²ˆì§¸ ì¤„ : ìì‹ ì˜ NTP ì„œë²„ë‚˜ ìì‹ ì˜ ì‹œê°„ëŒ€ì— ìˆëŠ” ë‹¤ë¥¸ NTP ì„œë²„ë¡œ ë³€ê²½í•˜ì„¸ìš”.
#pool 2.centos.pool.ntp.org iburst
pool rocky.ntp.test.com iburst

$ systemctl enable --now chronyd

$ chronyc -a makestep

$ chronyc sources
MS Name/IP address         Stratum Poll Reach LastRx Last sample
===============================================================================
^? ntp.test.com                  0   7     0     -     +0ns[   +0ns] +/-    0ns
```

<br>

<big> **â–  NTPStatì„ ì„¤ì¹˜í•˜ë©´ ì‹œê°„ ë™ê¸°í™” ìƒíƒœë¥¼ í‘œì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.** </big>

```bash
$ dnf -y install ntpstat

$ ntpstat
```

<br>