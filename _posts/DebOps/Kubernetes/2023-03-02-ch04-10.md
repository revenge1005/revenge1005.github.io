---
title:  "[Retry, k8s] 19. 서비스 API - 인그레스(Ingress)" 

categories:
  - KUBERNETES
tags:
  - [kubernetes]

toc: true
toc_sticky: true

date: 2023-03-01
last_modified_at: 2023-03-01
---
# [Retry, k8s] 19. 서비스 API - 인그레스(Ingress)
---

<style>
table {
    font-size: 12pt;
}
table th:first-of-type {
    width: 5%;
}
table th:nth-of-type(2) {
    width: 15%;
}
table th:nth-of-type(3) {
    width: 50%;
}
table th:nth-of-type(4) {
    width: 30%;
}
</style>

**네트워크 트래픽은 외부로부터 내부로 유입되는 트래픽을 인그레스(Ingress), 내부에서 외부로 나가는 트래픽을 이그레스(Egress)로 구분한다. <br><br>**
**시작하기 전 "MetalLB 내용" <https://revenge1005.github.io/kubernetes/ch04-05/#-metallb> 확인...**
{: .notice--warning}

<br>

## 🔔 인그레스(Ingress)

> k8s의 인그레스는 인그레스 API 오브젝트와 인그레스 컨트롤러로 구성된다.


+ 인그레스 API 오브젝트는 인그레스 API 오브젝트는 클러스터 외부에서 내부 서비스로 접근하기 위한 원하는 상태를 기술하는 것이고, 실제로 수행하는 것은 인그레스 컨트롤러라고 부르는 클러스터 내부에서 동작하는 파드로 파드이지만, 클러스터 외부에서 들어오는 요청을 인그레스에 정의된 규칙들을 기반으로 서비스 파드로 전달한다.


+ 기존 NodePort 등의 서비스는 Layer 4까지의 요청만을 처리하므로 네트워크 요청에 대한 세부적인 처리 로직을 구현하기 어렵다.


+ 하지만 인그레스는 Layer 7까지의 요청을 처리할 수 있으며, 외부로부터 들어오는 요청에 대한 로드 밸런싱, TLS/SSL 인증처리,  특정 HTTP 경로나 도메인의 라우팅 등을 자세하게 정의할 수 있다.


<br>

## 🔔 인그레스(Ingress) 종류


### (1) 클러스터 외부 로드 밸런서를 사용한 인그레스 (GKE 인그레스)


+ GKE 처럼 클러스터 외부 로드 밸런서를 사용한 인그레스의 경우 인그레스 리소스 생성만으로 로드 밸런서의 가상 IP가 할당되고, 로드 밸런서가 NodePort를 통해 트래픽을 전송한다.


![2323232](https://user-images.githubusercontent.com/42735894/229482058-38865643-cc4b-41b1-b1f0-05500231c7ab.png){: width="90%" height="90%"}{: .align-center}<br>

### (2) 클러스터 내부 인그레스용 파드를 배포하는 인그레스 (Nginx 인그레스)


+ "클러스터 내부 인그레스용 파드를 배포하는 인그레스 패턴"은 인그레스용 파드에 대해 LoadBalancer 서비스를 생성하고, 인그레스용 파드가 L7 수준의 처리를 수행한 후 파드 IP 주소로 트래픽을 전송한다. 


![323232](https://user-images.githubusercontent.com/42735894/229482063-5cfbdff5-dbe8-43d2-850f-e4cc62ed4824.png){: width="90%" height="90%"}{: .align-center}<br>


<br>

## 🔔 Nginx 인그레스(Ingress) 설치전 주의사항


<https://kubernetes.github.io/ingress-nginx/deploy/baremetal/>


> **베어메탈 환경에서는 클라우드 환경과 달리 네트워크 로드 밸런서가 제공되지 않기 때문에 nginx ingress controller를 설치하는 방법이 다르다.**


+ 베어메탈 환경에서 nginx ingress controller를 설치하는 방법은 크게 두 가지가 있는데, 하나는 MetalLB라는 소프트웨어 네트워크 로드 밸런서를 사용하는 방법이고, 다른 하나는 NodePort, LoadBalancer 또는 HostNetwork와 같은 서비스 타입을 사용하는 방법이다.


+ 여기서는 **MetalLB를 사용하는 것으로 진행**한다.


<br>

## 🔔 Nginx 인그레스(Ingress) 설치

<br>

<https://github.com/kubernetes/ingress-nginx/blob/main/README.md#readme>


<https://kubernetes.github.io/ingress-nginx/deploy/>

<br>

### (1) Nginx 인그레스(Ingress) 설치 (MetalLB를 선행 설치해야 함)

```bash
kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.7.0/deploy/static/provider/cloud/deploy.yaml
```

### (2) 설치 확인

```bash
kubectl get all -n ingress-nginx
```

### (3) 테스트

```bash

```