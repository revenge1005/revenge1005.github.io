---
title:  "[Retry, k8s] 23. ì»¨í”¼ê·¸ & ìŠ¤í† ë¦¬ì§€ API - ë³¼ë¥¨" 

categories:
  - KUBERNETES
tags:
  - [kubernetes]

toc: true
toc_sticky: true

date: 2023-09-02
last_modified_at: 2023-09-02
---
<br>

# ğŸ”” ë³¼ë¥¨(Volume), ì˜êµ¬ ë³¼ë¥¨(Persistent Volume), ì˜êµ¬ ë³¼ë¥¨ í´ë ˆì„(PV Claim)ì˜ ì°¨ì´
---

<style>
table {
    font-size: 12pt;
}
table th:first-of-type {
    width: 5%;
}
table th:nth-of-type(2) {
    width: 15%;
}
table th:nth-of-type(3) {
    width: 50%;
}
table th:nth-of-type(4) {
    width: 30%;
}
</style>

**ì‹œì‘í•˜ê¸° ì „ ì„ í–‰ ì‘ì—… ë° í™•ì¸í•´ì•¼í•  ë‚´ìš©** <br> - **<https://revenge1005.github.io/kubernetes/ch03-6-1/>** <br> - **<https://revenge1005.github.io/kubernetes/ch03-6-2/>** <br> - **<https://revenge1005.github.io/kubernetes/ch03-6-3/>**
{: .notice--warning}

<br>

## (1) ë³¼ë¥¨

+ ë¯¸ë¦¬ ì¤€ë¹„ëœ ì‚¬ìš© ê°€ëŠ¥í•œ ë³¼ë¥¨(í˜¸ìŠ¤íŠ¸ë³¼ë¥¨/nfs/iSCSi/Ceph) ë“±ì„ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ì— ì§ì ‘ ì§€ì •í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê²ƒì´ë‹¤.

+ ì‚¬ìš©ìê°€ ì„¤ì •ëœ ë³¼ë¥¨ì„ ì‚¬ìš©í•  ìˆ˜ ìˆì§€ë§Œ, ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ ì‹ ê·œ ë³¼ë¥¨ì„ ìƒì„±í•˜ê±°ë‚˜ ê¸°ì¡´ ë³¼ë¥¨ì„ ì‚­ì œí•˜ëŠ” ì‘ì—…ì€ í•  ìˆ˜ ì—†ë‹¤.

+ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ì—ì„œ ë³¼ë¥¨ ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•˜ëŠ” ê²ƒë„ ë¶ˆê°€ëŠ¥í•˜ë‹¤.

<br>

## (2) ì˜êµ¬ ë³¼ë¥¨

+ **ì˜êµ¬ ë³¼ë¥¨ì€ ì™¸ë¶€ ì˜êµ¬ ìŠ¤í† ë¦¬ì§€ ì‹œìŠ¤í…œê³¼ ì—°ê³„í•˜ì—¬ ì‹ ê·œ ë³¼ë¥¨ì„ ìƒì„±í•˜ê±°ë‚˜ ê¸°ì¡´ ë³¼ë¥¨ì„ ì‚­ì œí•˜ëŠ” ë“±ì˜ ì‘ì—…ì´ ê°€ëŠ¥**í•˜ë‹¤.

+ êµ¬ì²´ì ìœ¼ë¡œëŠ” ë§¤ë‹ˆí˜ìŠ¤íŠ¸ì—ì„œ ì˜êµ¬ ë³¼ë¥¨ ë¦¬ì†ŒìŠ¤ë¥¼ ë³„ë„ë„ë¡œ ìƒì„±í•˜ëŠ” í˜•íƒœë‹¤.

+ ì˜êµ¬ ë³¼ë¥¨ê³¼ ë³¼ë¥¨ì€ ê°™ì€ í”ŒëŸ¬ê·¸ì¸ì„ ì œê³µí•œë‹¤.

+ ì˜êµ¬ ë³¼ë¥¨ í”Œë¡œê·¸ì¸ì—ì„œëŠ” ë³¼ë¥¨ ìƒì„± ë° ì‚­ì œ ê°™ì€ ë¼ì´í”„ì‚¬ì´í´ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆì§€ë§Œ, ë³¼ë¥¨ í”ŒëŸ¬ê·¸ì¸ì˜ ê²½ìš°ì—ëŠ” ê¸°ì¡´ì— ìˆëŠ” ë³¼ë¥¨ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

<br>

## (3) ì˜êµ¬ ë³¼ë¥¨ í´ë ˆì„

+ **ìƒì„±ëœ ì˜êµ¬ ë³¼ë¥¨ ë¦¬ì†ŒìŠ¤ë¥¼ í• ë‹¹í•˜ëŠ” ë¦¬ì†ŒìŠ¤**

+ ì˜êµ¬ ë³¼ë¥¨ì€ í´ëŸ¬ìŠ¤í„°ì— ë³¼ë¥¨ì„ ë“±ë¡ë§Œ í•˜ê¸° ë•Œë¬¸ì— ì‹¤ì œ íŒŒë“œì—ì„œ ì‚¬ìš©í•˜ë ¤ë©´ ì˜êµ¬ ë³¼ë¥¨ í´ë ˆì„ì„ ì •ì˜í•˜ê³  ì‚¬ìš©í•´ì•¼ í•œë‹¤.

+ ë™ì  í”„ë¡œë¹„ì €ë‹ ê¸°ëŠ¥ì„ ì‚¬ìš©í•œ ê²½ìš°ì—ëŠ” ì˜êµ¬ ë³¼ë¥¨ í´ë ˆì„ì´ ì‚¬ìš©ëœ ì‹œì ì— ì˜êµ¬ ë³¼ë¥¨ì„ ë™ì ìœ¼ë¡œ ìƒì„±í•  ìˆ˜ ìˆì–´ ìˆœì„œê°€ ë°”ë€Œì—ˆë‹¤ê³  ëŠë‚„ ìˆ˜ë„ ìˆë‹¤.

<br>

---

<br>

## (4) ë³¼ë¥¨

> k8sì—ì„œëŠ” ë³¼ë¥¨ì„ ì¶”ìƒí™”í•˜ì—¬ íŒŒë“œì™€ ëŠìŠ¨í•˜ê²Œ ê²°í•©ëœ ë¦¬ì†ŒìŠ¤ë¡œ ì •ì˜í•˜ê³  ìˆë‹¤.

<br>

### ğŸ“œ emptyDir

+ íŒŒë“œê°€ ë…¸ë“œì— í• ë‹¹ë  ë•Œ ìƒì„±ë˜ëŠ” íŒŒë“œìš© ì„ì‹œ ë””ìŠ¤í¬ ì˜ì—­ìœ¼ë¡œ, íŒŒë“œê°€ ë…¸ë“œì—ì„œ ì œê±°(ë˜ëŠ” ì¢…ë£Œ)ë˜ë©´ ì‚­ì œëœë‹¤.

+ emptyDirì€ ì²˜ìŒì— ë¹„ì–´ ìˆìœ¼ë©°, íŒŒë“œ ë‚´ì˜ ëª¨ë“  ì»¨í…Œì´ë„ˆê°€ emptyDir ë³¼ë¥¨ì— ìˆëŠ” ë™ì¼í•œ íŒŒì¼ì„ ì½ê³  ì“¸ ìˆ˜ ìˆë‹¤.

+ í˜¸ìŠ¤íŠ¸ ë³¼ë¥¨(ì»¨í…Œì´ë„ˆìš© ì„ì‹œ ë””ìŠ¤í¬ ì˜ì—­)ì„ ì»¨í…Œì´ë„ˆ ë³¼ë¥¨ì— ë§¤í•‘í•˜ì§€ë§Œ, í˜¸ìŠ¤íŠ¸ì˜ ì„ì˜ ì˜ì—­ì„ ë§ˆìš´íŠ¸í•˜ê±°ë‚˜ í˜¸ìŠ¤íŠ¸ì— ìˆëŠ” íŒŒì¼ì„ ì°¸ì¡°í•  ìˆ˜ëŠ” ì—†ë‹¤.

![2222](https://user-images.githubusercontent.com/42735894/230768073-f71be9e9-64f1-44c9-bea4-fb15b0de0510.png){: width="90%" height="90%"}{: .align-center}



#### ã€emptyDir ë³¼ë¥¨ì„ ë§ˆìš´íŠ¸í•˜ëŠ” íŒŒë“œ ì˜ˆì œã€‘

```bash
$ cat <<EOF > sample-emptydir.yaml
apiVersion: v1
kind: Pod
metadata:
  name: sample-emptydir
spec:
  containers:
  - image: nginx:1.16
    name: nginx-container
    volumeMounts:
    - mountPath: /cache
      name: cache-volume
  volumes:
  - name: cache-volume
    emptyDir: {}
EOF


$ kubectl exec -it sample-emptydir -- df -h | grep /cache
/dev/mapper/ubuntu--vg-ubuntu--lv  9.8G  6.7G  2.6G  73% /cache
```



#### ã€ìš©ëŸ‰ ì œí•œì„ë‘” emptyDir ë³¼ë¥¨ì„ ë§ˆìš´íŠ¸í•˜ëŠ” íŒŒë“œ ì˜ˆì œã€‘

+ emptyDirì„ ì‚¬ìš©í•œ ë³¼ë¥¨ì— **"emptyDir.sizeLimit"ë¡œ ë¦¬ì†ŒìŠ¤ ì œí•œ**ì„ í•  ìˆ˜ ìˆë‹¤.

```bash
$ cat <<EOF > sample-emptydir-limit.yaml
apiVersion: v1
kind: Pod
metadata:
  name: sample-emptydir-limit
spec:
  containers:
  - image: nginx:1.16
    name: nginx-container
    volumeMounts:
    - mountPath: /cache
      name: cache-volume
  volumes:
  - name: cache-volume
    emptyDir:
      sizeLimit: 128Mi
EOF


# 150MB íŒŒì¼ì„ ìƒì„±
$ kubectl exec -it sample-emptydir-limit -- dd if=/dev/zero of=/cache/dummy bs=1M count=150


# í• ë‹¹ëœ ì˜ì—­ì— ëŒ€í•´ ìš©ëŸ‰ì´ ì´ˆê³¼ë¡œ Evict(ì¶•ì¶œ)ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
$ kubectl get pod --watch
NAME                    READY   STATUS    RESTARTS   AGE
sample-emptydir-limit   1/1     Running   0          3m
sample-emptydir-limit   1/1     Evicted   0          3m41s


$ kubectl describe pod sample-emptydir-limit

~(ìƒëµ)~

Events:
  Type     Reason     Age    From               Message
  ----     ------     ----   ----               -------
  Warning  Evicted    5m37s  kubelet            Usage of EmptyDir volume "cache-volume" exceeds the limit "128Mi".
  Normal   Killing    5m37s  kubelet            Stopping container nginx-container
```



#### ã€ê³ ì† ë©”ëª¨ë¦¬ ì˜ì—­ì„ ì‚¬ìš©í•œ emptyDir ë³¼ë¥¨ì„ ë§ˆìš´íŠ¸í•˜ëŠ” íŒŒë“œ ì˜ˆì œã€‘

+ emptydirì€ í˜¸ìŠ¤íŠ¸ìƒì˜ ë””ìŠ¤í¬ ì˜ì—­ë¿ë§Œ ì•„ë‹ˆë¼ ê³ ì† tmpfs ë©”ëª¨ë¦¬ ì˜ì—­ì„ ì‚¬ìš©í•  ìˆ˜ë„ ìˆë‹¤.

+ ë©”ëª¨ë¦¬ ì˜ì—­ì„ ì‚¬ìš©í•˜ë ¤ë©´ **"emptyDir.medium"ì— Memoryë¥¼ ì§€ì •**í•œë‹¤.

```bash
$ cat <<EOF > sample-emptydir-memory.yaml
apiVersion: v1
kind: Pod
metadata:
  name: sample-emptydir-memory
spec:
  containers:
  - image: nginx:1.16
    name: nginx-container
    volumeMounts:
    - mountPath: /cache
      name: cache-volume
  volumes:
  - name: cache-volume
    emptyDir:
      medium: Memory
      sizeLimit: 128Mi
EOF


# ì¿ ë²„ë„¤í‹°ìŠ¤ ë…¸ë“œì˜ tmpfs ì˜ì—­ì´ í• ë‹¹ëœ ê²ƒì„ í™•ì¸
$ kubectl exec -it sample-emptydir-memory -- df -h | grep /cache
tmpfs                              128M     0  128M   0% /cache
```



#### ã€ë©”ëª¨ë¦¬ ë¦¬ì†ŒìŠ¤ ì œí•œê³¼ emptyDirì„ ê°™ì´ ì‚¬ìš©í•œ ì˜ˆì œã€‘

+ emptyDir ë©”ëª¨ë¦¬ ì˜ì—­ì—ì„œ ì‚¬ìš©í•˜ëŠ” ìš©ëŸ‰ì€ ì»¨í…Œì´ë„ˆì— ëŒ€í•œ ë©”ëª¨ë¦¬ ì‚¬ìš© ìƒí•œ ì„¤ì • "resource.limits.memory"ì—ë„ ì˜í–¥ì„ ì¤€ë‹¤.

+ ì´ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ëŠ” 128Miê¹Œì§€ tmpfs ì˜ì—­ì„ ì‚¬ìš©í•  ìˆ˜ìˆëŠ” ì ì€ ê°™ì§€ë§Œ, ì»¨í…Œì´ë„ˆê°€ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë©”ëª¨ë¦¬ ìƒí•œì´ ì„¤ì •ë˜ì–´ ìˆë‹¤.

+ emptyDirë„ ì´ ì œí•œì´ ì˜ˆì™¸ê°€ ì•„ë‹ˆë¼ì„œ 70MB íŒŒì¼ì„ ì‘ì„±í•˜ëŠ” ë‹¨ê³„ì—ì„œ OOM(Out of Memory)ì— ì˜í•´ íŒŒë“œê°€ ì •ì§€ë˜ëŠ” ì ì— ì£¼ì˜.

```bash
$ cat <<EOF > sample-emptydir-memory-with-memory-limits.yaml
apiVersion: v1
kind: Pod
metadata:
  name: sample-emptydir-memory-with-memory-limits
spec:
  containers:
  - image: nginx:1.16
    name: nginx-container
    resources:
      limits:
        memory: 64Mi
    volumeMounts:
    - mountPath: /cache
      name: cache-volume
  volumes:
  - name: cache-volume
    emptyDir:
      medium: Memory
      sizeLimit: 128Mi
EOF


# 70MB íŒŒì¼ì„ /cache/dummyì— ìƒì„±
$ kubectl exec -it sample-emptydir-memory-with-memory-limits -- dd if=/dev/zero of=/cache/dummy bs=1M
command terminated with exit code 137


# íŒŒë“œ ìƒíƒœ ëª¨ë‹ˆí„°ë§(ë³„ë„ í„°ë¯¸ë„ì—ì„œ íŒŒì¼ ìƒì„± ì „ì— ì‹¤í–‰)
$ kubectl get pod --watch
NAME                                        READY   STATUS    RESTARTS      AGE
sample-emptydir-memory-with-memory-limits   1/1     Running   1             48s
sample-emptydir-memory-with-memory-limits   0/1     OOMKilled 0             20s
```

<br>

### ğŸ“œ hostPath

+ ì¿ ë²„ë„¤í‹°ìŠ¤ ë…¸ë“œìƒì˜ íŒŒì¼ ì‹œìŠ¤í…œì—ì„œ íŒŒì¼ì´ë‚˜ ë””ë ‰í„°ë¦¬ë¥¼ íŒŒë“œì— ë§ˆìš´íŠ¸í•˜ëŠ” ë³¼ë¥¨ ìœ í˜•

+ typeì€ "Directory/DirectroyOrCreate/File/Socket/BlockDevice ë“±"ì„ ì„ íƒí•  ìˆ˜ ìˆìœ¼ê³ , DirectroyOrCreateì™€ Directoryì˜ ì°¨ì´ëŠ” ë””ë ‰í„°ë¦¬ê°€ ì¡´ì¬í•˜ì§€ ì•Šì„ ê²½ìš° ìƒì„±í•˜ê³  ê¸°ë™í•˜ëŠ”ì§€ ì—¬ë¶€ì— ìˆë‹¤.

+ ë³´ì•ˆìƒì˜ ì´ìœ ë¡œ ì•ˆì „í•˜ì§€ ì•Šì€ ì»¨í…Œì´ë„ˆê°€ ì—…ë¡œë“œë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²ƒì„ ê¶Œì¥í•œë‹¤.

![23123123](https://user-images.githubusercontent.com/42735894/230770547-4f03e918-d44a-41dd-9eda-170d6c973b5b.png){: width="90%" height="90%"}{: .align-center}



#### ã€hostPath ë³¼ë¥¨ì„ ë§ˆìš´íŠ¸í•˜ëŠ” íŒŒë“œ ì˜ˆì œã€‘

```bash
$ cat <<EOF > sample-hostpath.yaml
apiVersion: v1
kind: Pod
metadata:
  name: sample-hostpath
spec:
  containers:
  - image: nginx:1.16
    name: nginx-container
    volumeMounts:
    - mountPath: /srv
      name: hostpath-sample
  volumes:
  - name: hostpath-sample
    hostPath:
      path: /etc
      type: DirectoryOrCreate
EOF


# í˜¸ìŠ¤íŠ¸ OS ì´ë¯¸ì§€ í™•ì¸ - (í˜¸ìŠ¤íŠ¸ì˜ /etcê°€ ìƒì„±í•œ íŒŒë“œì˜ /srvì— ë§ˆìš´íŠ¸ëœ ê²ƒì„ í™•ì¸)
$ kubectl exec -it sample-hostpath -- cat /srv/os-release | grep PRETTY_NAME
PRETTY_NAME="Ubuntu 22.04.2 LTS"


# ì»¨í…Œì´ë„ˆ OS ì´ë¯¸ì§€ í™•ì¸
$ kubectl exec -it sample-hostpath -- cat /etc/os-release | grep PRETTY_NAME
PRETTY_NAME="Debian GNU/Linux 10 (buster)"
```

<br>

### ğŸ“œ downwardAPI

+ íŒŒë“œ ì •ë³´ ë“±ì„ íŒŒì¼ë¡œ ë°°ì¹˜í•˜ê¸° ìœ„í•œ í”ŒëŸ¬ê·¸ì¸

+ í™˜ê²½ ë³€ìˆ˜ fieldRefì™€ resourceFieldRefì˜ ì‚¬ìš© ë°©ë²•ê³¼ ê°™ë‹¤.

```bash
$ cat <<EOF > sample-downward-api.yaml
apiVersion: v1
kind: Pod
metadata:
  name: sample-downward-api
spec:
  containers:
  - name: nginx-container
    image: nginx:1.16
    volumeMounts:
    - name: downward-api-volume
      mountPath: /srv
  volumes:
  - name: downward-api-volume
    downwardAPI:
      items:
      - path: "podname"
        fieldRef:
          fieldPath: metadata.name
      - path: "cpu-request"
        resourceFieldRef:
          containerName: nginx-container
          resource: requests.cpu
EOF


# sample-downward-api íŒŒë“œì˜ /srv ì•„ë˜ íŒŒì¼ í™•ì¸
$ kubectl exec -it sample-downward-api -- ls /srv
cpu-request  podname
```

<br>

### ğŸ“œ projected

+ ì‹œí¬ë¦¿/ì»¨í”¼ê·¸ë§µ/downwardAPI/serviceAccountTokenì˜ ë³¼ë¥¨ ë§ˆìš´íŠ¸ë¥¼ í•˜ë‚˜ì˜ ë””ë ‰í„°ë¦¬ì— í†µí•©í•˜ëŠ” í”ŒëŸ¬ê·¸ì¸

+ ì‹œí¬ë¦¿ ì¸ì¦ ì •ë³´ì™€ ì»¨í”¼ê·¸ë§µ ì„¤ì • íŒŒì¼ í•˜ë‚˜ì˜ ë””ë ‰í„°ë¦¬ì— ë°°ì¹˜í•˜ê³  ì‹¶ì„ ê²½ìš° ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```bash
$ cat <<EOF > sample-projected.yaml
apiVersion: v1
kind: Pod
metadata:
  name: sample-projected
spec:
  containers:
  - name: nginx-container
    image: nginx:1.16
    volumeMounts:
    - name: projected-volume
      mountPath: /srv
  volumes:
  - name: projected-volume
    projected:
      sources:
      - secret:
          name: sample-db-auth
          items:
          - key: username
            path: secret/username.txt
      - configMap:
          name: sample-configmap
          items:
          - key: nginx.conf
            path: configmap/nginx.conf
      - downwardAPI:
          items:
          - path: "podname"
            fieldRef:
              fieldPath: metadata.name
EOF


# /srv ë””ë ‰í„°ë¦¬ í™•ì¸
$ kubectl exec -it sample-projected -- ls /srv
configmap  podname  secret


# /srv/configmap ë””ë ‰í„°ë¦¬ í™•ì¸
$ kubectl exec -it sample-projected -- ls /srv/configmap
nginx.conf


# /srv/secret ë””ë ‰í„°ë¦¬ í™•ì¸
$ kubectl exec -it sample-projected -- ls /srv/secret
username.txt
```

<br>