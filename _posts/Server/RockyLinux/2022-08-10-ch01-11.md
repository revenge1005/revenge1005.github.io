---
title:  "[Rocky] 11. DHCP μ„λ²„ κµ¬μ„±" 

categories:
  - ROCKY
tags:
  - [rocky, linux]

toc: true
toc_sticky: true

date: 2022-08-10
last_modified_at: 2022-08-10
---
<br>

# π”” DHCPλ€?
---

<style>
table {
    font-size: 12pt;
}
table th:first-of-type {
    width: 5%;
}
table th:nth-of-type(2) {
    width: 15%;
}
table th:nth-of-type(3) {
    width: 50%;
}
table th:nth-of-type(4) {
    width: 30%;
}
big {
    font-size: 15pt;
}
</style>

<br>

> DHCPλ€ Dynamic Host Configuration Protocolμ μ•½μλ΅, λ„¤νΈμ›ν¬μ—μ„ IP μ£Όμ†λ¥Ό μλ™μΌλ΅ ν• λ‹Ήν•΄μ£Όλ” ν”„λ΅ν† μ½λ΅ μ΄λ¥Ό ν†µν•΄ λ„¤νΈμ›ν¬ μ¥μΉλ“¤μ€ IP μ£Όμ†λ¥Ό μλ™μΌλ΅ μ„¤μ •ν•μ§€ μ•μ•„λ„ μλ™μΌλ΅ IP μ£Όμ†λ¥Ό νλ“ν•  μ μμµλ‹λ‹¤.

<br>

+ IP μ£Όμ†λ” κ³ μ •μ μΌλ΅ ν• λ‹Ήλμ–΄μ•Ό ν•μ§€λ§, μλ™μΌλ΅ IP μ£Όμ†λ¥Ό ν• λ‹Ήν•κ² λλ©΄ λ„¤νΈμ›ν¬ κ΄€λ¦¬κ°€ λ³µμ΅ν•΄μ§ μ μμµλ‹λ‹¤.


  + μλ¥Ό λ“¤λ©΄, λ„¤νΈμ›ν¬ μ¥μΉλ¥Ό μ¶”κ°€ν•κ±°λ‚ IP μ£Όμ†λ¥Ό λ³€κ²½ν•΄μ•Ό ν•  λ• λ§λ‹¤ λ¨λ“  μ¥μΉλ“¤μ IP μ£Όμ†λ¥Ό μλ™μΌλ΅ μ„¤μ •ν•΄μ•Ό ν•λ” λ²κ±°λ΅μ›€μ΄ λ°μƒν•κ² λλ”λ° μ΄λ¥Ό ν•΄κ²°ν•κΈ° μ„ν•΄ DHCPκ°€ λ“±μ¥ν•μ€μµλ‹λ‹¤.


<br>

![2222](https://user-images.githubusercontent.com/42735894/233041663-313c3e04-d616-463e-b0aa-bcc352a649e8.png){: width="90%" height="90%"}{: .align-center}

<br>

<big> **β–  IP μ£Όμ† μ „λ‹¬ λ°©μ‹** </big>

![33333](https://user-images.githubusercontent.com/42735894/233041678-db30fcd5-2684-40b0-9ef9-dfdc2cec84bb.png){: width="90%" height="90%"}{: .align-center}

<br>


+ **DHCP Discover :** ν΄λΌμ΄μ–ΈνΈκ°€ μ„λΈλ„·μ— DHCP μ„λ²„λ¥Ό μ°Ύλ” λ©”μ‹μ§€λ¥Ό λ³΄λ‚΄λ” λ‹¨κ³„


+ **DHCP Offer :**  DHCP μ„λ²„κ°€ ν΄λΌμ΄μ–ΈνΈμ—κ² μμ‹ μ IP μ£Όμ†μ™€ ν΄λΌμ΄μ–ΈνΈκ°€ μ‚¬μ©ν•  IP μ£Όμ†, DNS μ •λ³΄, IP μ£Όμ†μ μ„λ€ μ‹κ°„ λ“±μ„ μ „λ‹¬ν•λ” λ‹¨κ³„


+ **DHCP Request :** ν΄λΌμ΄μ–ΈνΈκ°€ DHCP μ„λ²„μ—κ² IP μ£Όμ†λ¥Ό μ‚¬μ©ν•λ‹¤κ³  ν†µλ³΄ν•λ” λ‹¨κ³„


+ **DHCP Ack :** DHCP μ„λ²„κ°€ ν΄λΌμ΄μ–ΈνΈμ—κ² IP μ£Όμ†μ μ‚¬μ©μ„ ν™•μ •ν•κ³  λ„¤νΈμ›ν¬λ¥Ό μ΄μ©ν•λ„λ΅ ν•λ” λ‹¨κ³„


<br>

<big> **β–  DHCP λ©”μ‹μ§€ μΆ…λ¥** </big>

| λ©”μ‹μ§€ μΆ…λ¥ | μ„¤λ… |
|:----------:|:----|
| DISCOVER (ν΄λΌμ΄μ–ΈνΈ) | μ„λ²„λ¥Ό μ°Ύλ” λΈλ΅λ“μΊμ¤νΈ λ©”μ‹μ§€ |
| OFFER (μ„λ²„) | ν΄λΌμ΄μ–ΈνΈμ—κ² λ™μ  ν• λ‹Ή ν•  IPλ¥Ό μ μ•ν•λ” λ©”μ‹μ§€ |
| REQUEST (ν΄λΌμ΄μ–ΈνΈ) | μ„ νƒλ μ„λ²„λ¥Ό μ•λ¦¬λ” λ©”μ‹μ§€ |
| DECLINE (ν΄λΌμ΄μ–ΈνΈ) | IP μ¶©λμ΄ ν™•μΈλλ©΄ ν• λ‹Ήκ³Όμ •μ„ μ·¨μ†ν•κΈ° μ„ν•΄ μ „λ‹¬ν•λ” λ©”μ‹μ§€ |
| ACK (μ„λ²„) | IP ν• λ‹Ήκ³Όμ •μ μ •μƒμ μΈ μΆ…λ£λ¥Ό μ•λ¦¬λ” λ©”μ‹μ§€ |
| NAK (μ„λ²„) | IP μ¶©λ κ°μ§€ λ“±μ μ΄μ λ΅ ν• λ‹Ήκ³Όμ •μ„ μ·¨μ†ν•κΈ° μ„ν•΄ μ „λ‹¬ν•λ” λ©”μ‹μ§€ |
| RELEASE (ν΄λΌμ΄μ–ΈνΈ) | ν• λ‹Ήλ IP ν•΄μ  μ”μ²­ |
| INFORM (ν΄λΌμ΄μ–ΈνΈ) | ν„μ¬ binding λ μ •λ³΄ μ΄μ™Έμ μ¶”κ°€ μ •λ³΄λ¥Ό μ”μ²­ν•λ” λ©”μ‹μ§€ |
| FORCERENEW (μ„λ²„) | binding ν΄λΌμ΄μ–ΈνΈμ μ •λ³΄λ¥Ό μ‚­μ ν•κ³  μ¬ μ”μ²­μ„ ν•κ² λ§λ“λ” λ©”μ‹μ§€ |

<br>

# π”” DHCP μ„λ²„ κµ¬μ„±
---

<br>

<big> **β–  DHCPλ¥Ό μ„¤μΉ λ° κµ¬μ„±** </big>

```bash
$ dnf -y install dhcp-server


$ vi /etc/dhcp/dhcpd.conf


# λ„λ©”μΈ μ΄λ¦„ μ§€μ •
option domain-name "srv.world";

# DNS μ„λ²„μ νΈμ¤νΈ μ΄λ¦„ λλ” IP μ£Όμ† μ§€μ •
option domain-name-servers 168.126.63.1, 8.8.8.8;

# κΈ°λ³Έ μ„λ€ μ‹κ°„
default-lease-time 600;

# μµλ€ μ„λ€ μ‹κ°„
max-lease-time 7200;

# DHCP μ„λ²„ μ¤‘μ—μ„ ν•΄λ‹Ή μ„¤μ •μ΄ λμ–΄ μλ” μ„λ²„κ°€ λ” λ†’μ€ μ°μ„ μμ„λ¥Ό κ°€μ§€κ² λλ” μ„¤μ •
authoritative;

# λ„¤νΈμ›ν¬ μ£Όμ† λ° μ„λΈλ„· λ§μ¤ν¬ μ§€μ •
subnet 192.168.219.0 netmask 255.255.255.0 {
    # μ„λ€ IP μ£Όμ† λ²”μ„ μ§€μ •
    range 192.168.219.200 192.168.219.230;
    # λΈλ΅λ“μΊμ¤νΈ μ£Όμ† μ§€μ •
    option broadcast-address 192.168.219.255;
    # κ²μ΄νΈμ›¨μ΄ μ§€μ •
    option routers 192.168.219.2;
}


$ systemctl enable --now dhcpd

# λ°©ν™”λ²½ μ„¤μ •
$ firewall-cmd --add-service=dhcp; firewall-cmd --runtime-to-permanent
```

<br>

<big> **β–  Log ν™•μΈ - μ„λ²„μ IP ν• λ‹Ή κ³Όμ • ν™•μΈ** </big>

```bash
$ tail -f /var/log/messages
Apr 19 19:35:33 localhost systemd[1]: Started DHCPv4 Server Daemon.
Apr 19 19:36:51 localhost dhcpd[27860]: DHCPDISCOVER from 00:0c:29:f9:50:e2 via ens160
Apr 19 19:36:52 localhost dhcpd[27860]: DHCPOFFER on 192.168.219.200 to 00:0c:29:f9:50:e2 via ens160
Apr 19 19:36:52 localhost dhcpd[27860]: DHCPREQUEST for 192.168.219.200 (192.168.219.101) from 00:0c:29:f9:50:e2 via ens160
Apr 19 19:36:52 localhost dhcpd[27860]: DHCPACK on 192.168.219.200 to 00:0c:29:f9:50:e2 via ens160
```

<br>

<big> **β–  μ„λ€λ IPμ™€ ν΄λΌμ΄μ–ΈνΈ μ •λ³΄ ν™•μΈ - /var/lib/dhcpd/dhcpd.leases** </big>

```bash
$ cat /var/lib/dhcpd/dhcpd.leases

~(μƒλµ)~

lease 192.168.219.200 {
  starts 3 2023/04/19 10:36:52;
  ends 3 2023/04/19 10:46:52;
  cltt 3 2023/04/19 10:36:52;
  binding state active;
  next binding state free;
  rewind binding state free;
  hardware ethernet 00:0c:29:f9:50:e2;
  uid "\001\000\014)\371P\342";
}
```

<br>