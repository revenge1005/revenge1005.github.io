---
title:  "[Retry, k8s] 11. ì„œë¹„ìŠ¤ API - ClusterIP" 

categories:
  - KUBERNETES
tags:
  - [kubernetes]

toc: true
toc_sticky: true

date: 2023-03-01
last_modified_at: 2023-03-01
---
# [Retry, k8s] 11. ì„œë¹„ìŠ¤ API - ClusterIP
---

<style>
table {
    font-size: 12pt;
}
table th:first-of-type {
    width: 5%;
}
table th:nth-of-type(2) {
    width: 15%;
}
table th:nth-of-type(3) {
    width: 50%;
}
table th:nth-of-type(4) {
    width: 30%;
}
</style>

<br>

## ğŸ”” ClientIP ì„œë¹„ìŠ¤

+ **ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì—ì„œë§Œ í†µì‹  ê°€ëŠ¥í•œ íƒ€ì…ìœ¼ë¡œ, Internal Networkì— ìƒì„±ë˜ëŠ” ê°€ìƒ IPê°€ í• ë‹¹ëœë‹¤.**

+ ClusterIPì™€ í†µì‹ ì€ ê° ë…¸ë“œìƒì—ì„œ ì‹¤í–‰ ì¤‘ì¸ ì‹œìŠ¤í…œ êµ¬ì„± ìš”ì†Œ kube-proxyê°€ íŒŒë“œë¡œ ì „ì†¡ì„ ì‹¤ì‹œí•œë‹¤.(ë‹¨, Proxy-modeì— ë”°ë¼ ë‹¤ë¦„)


![3](https://user-images.githubusercontent.com/42735894/228765359-b599d0d8-4bf2-4a28-b066-31e4b118101c.png){: width="70%" height="70%"}{: .align-center}


<br>

### ğŸ“œ ClusterIP ì„œë¹„ìŠ¤ ìƒì„±

|ì„¤ì •|ê°œìš”|
|:---:|---|
|spec.ports[].port|ClusterIPì—ì„œ ìˆ˜ì‹ í•  í¬íŠ¸ ë²ˆí˜¸|
|spec.ports[].targetPort|ëª©ì ì§€ ì»¨í…Œì´ë„ˆ í¬íŠ¸ ë²ˆí˜¸|

```bash
cat <<EOF > sample-clusterip.yaml
apiVersion: v1
kind: Service
metadata:
  name: sample-clusterip
spec:
  type: ClusterIP
  ports:
  - name: "http-port"
    protocol: "TCP"
    port: 8080
    targetPort: 80
  selector:
    app: sample-app
EOF
```

```bash
# ì¼ì‹œì ìœ¼ë¡œ íŒŒë“œë¥¼ ê¸°ë™í•˜ì—¬ ClusterIPë¡œ ì „ì†¡ë˜ëŠ” íŠ¸ë˜í”½ì´ ë¶„ì‚°ë˜ëŠ” ê²ƒì„ í™•ì¸
$ kubectl run --image=amsy810/tools:v2.0 --restart=Never --rm -i testpod --command -- curl -s http://sample-clusterip:8080
Host=sample-clusterip  Path=/  From=sample-deployment-7f47966499-82lld  ClientIP=10.32.0.1  XFF=
pod "testpod" deleted

$ kubectl run --image=amsy810/tools:v2.0 --restart=Never --rm -i testpod --command -- curl -s http://sample-clusterip:8080
Host=sample-clusterip  Path=/  From=sample-deployment-7f47966499-llctj  ClientIP=10.32.0.1  XFF=
pod "testpod" deleted
```


<br>

### ğŸ“œ ClusterIP ê°€ìƒ IP ì •ì  ì§€ì •

```bash
cat <<EOF > sample-clusterip-vip.yaml
apiVersion: v1
kind: Service
metadata:
  name: sample-clusterip-vip
spec:
  type: ClusterIP
  clusterIP: 10.99.202.36
  ports:
  - name: "http-port"
    protocol: "TCP"
    port: 8080
    targetPort: 80
  selector:
    app: sample-app
EOF
```
