---
title:  "[Rocky] 07. Samba ì„œë²„ êµ¬ì„±" 

categories:
  - ROCKY
tags:
  - [rocky, linux]

toc: true
toc_sticky: true

date: 2023-05-23
last_modified_at: 2023-05-23
---
<br>

# ğŸ”” ê³µìœ  í´ë” (ìµëª… í¬í•¨)
---

<style>
table {
    font-size: 12pt;
}
table th:first-of-type {
    width: 5%;
}
table th:nth-of-type(2) {
    width: 15%;
}
table th:nth-of-type(3) {
    width: 50%;
}
table th:nth-of-type(4) {
    width: 30%;
}
big {
    font-size: 15pt;
}
</style>

<br>

<big> **â–  samba ì„¤ì¹˜** </big>

```bash
$ dnf -y install samba
```

<br>

<big> **â–  samba êµ¬ì„±** </big>

```bash
$ mkdir /home/share

$ chmod 777 /home/share

$ vi /etc/samba/smb.conf

[global]
        # ë¬¸ìì…‹ ì„¤ì •
        unix charset = UTF-8
        workgroup = SAMBA
        security = user
        # ì•¡ì„¸ìŠ¤ë¥¼ í—ˆìš©í•˜ëŠ” IP ì£¼ì†Œ
        hosts allow = 192.168.219.0/24
        # ì‚¬ìš©ì ë¡œê·¸ì¸ ì‹œ ë¹„ë°€ë²ˆí˜¸ê°€ ì˜ëª»ë˜ì—ˆì„ ê²½ìš° ë¡œê·¸ì¸ì´ ê±°ë¶€ë˜ë©°, 
        # ì‚¬ìš©ì ì´ë¦„ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ìš° ê²ŒìŠ¤íŠ¸ ë¡œê·¸ì¸ìœ¼ë¡œ ì²˜ë¦¬ë˜ì–´ ê²ŒìŠ¤íŠ¸ ê³„ì •ìœ¼ë¡œ ë§¤í•‘ëœë‹¤.
        map to guest = Bad User

...


[Share]
        # ê³µìœ  ë””ë ‰í„°ë¦¬ ì§€ì •
        path = /home/share
        # ì“°ê¸° í—ˆìš©
        writable = yes
        # ê²ŒìŠ¤íŠ¸ ì‚¬ìš©ì í—ˆìš©
        guest ok = yes
        # ê²ŒìŠ¤íŠ¸ ì‚¬ìš©ìë¡œ ëª¨ë‘ í‘œì‹œ
        guest only = yes
        # íŒŒì¼ì„ ë§Œë“¤ ë•Œ ì‚¬ìš© ê¶Œí•œ [ì‚¬ìš© ê¶Œí•œ] ì„¤ì •
        force create mode = 777
        # í´ë”ë¥¼ ë§Œë“¤ ë•Œ [ì‚¬ìš© ê¶Œí•œ] ì„¤ì •
        force directory mode = 777 

$ systemctl enable --now smb
```

<br>

<big> **â–  SELinuxê°€ ì‹¤í–‰ë˜ê³  ì˜ˆì œì™€ ê°™ì´ /homeë„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° SELinux ì •ì±…ì„ ë³€ê²½** </big>

```bash
$ setsebool -P samba_enable_home_dirs on

$ restorecon -R /home/share
```

<br>

<big> **â–  ë°©í™”ë²½ì´ ì‹¤í–‰ ì¤‘ì¸ ê²½ìš° Samba ì„œë¹„ìŠ¤ë¥¼ í—ˆìš©** </big>

```bash
$ firewall-cmd --add-service=samba
success

$ firewall-cmd --runtime-to-permanent
success
```

<br>

<big> **â–  í™•ì¸** </big>

![01](https://user-images.githubusercontent.com/42735894/232580498-d10f4281-3093-429a-b8e6-5e1e5c4cc90e.png){: width="80%" height="80%"}{: .align-center}

![02](https://user-images.githubusercontent.com/42735894/232580507-bcba7875-fa76-402a-9069-6b3f257c16b5.PNG){: width="80%" height="80%"}{: .align-center}

![03](https://user-images.githubusercontent.com/42735894/232580512-bd2bbfbb-293c-49e6-9e05-f992e1f71fc2.PNG){: width="80%" height="80%"}{: .align-center}

<br>

# ğŸ”” ì œí•œëœ ê³µìœ  í´ë”
---

<br>

<big> **â–  samba êµ¬ì„±** </big>

```bash
$ groupadd smbgroup01
$ mkdir /home/share01
$ chgrp smbgroup01 /home/share01
$ chmod 770 /home/share01

$ vi /etc/samba/smb.conf

[global]
        # ë¬¸ìì…‹ ì„¤ì •
        unix charset = UTF-8
        workgroup = SAMBA
        security = user
        # ì•¡ì„¸ìŠ¤ë¥¼ í—ˆìš©í•˜ëŠ” IP ì£¼ì†Œ
        hosts allow = 192.168.219.0/24

...


[Share01]
        # ê³µìœ  ë””ë ‰í„°ë¦¬ ì§€ì •
        path = /home/share01
        # ì“°ê¸° í—ˆìš©
        writable = yes
        # ê²ŒìŠ¤íŠ¸ ì‚¬ìš©ì í—ˆìš© ì•ˆ í•¨
        guest ok = no
        # [smbgroup01] ê·¸ë£¹ë§Œ í—ˆìš©
        valid users = @smbgroup01
        # ìƒˆ íŒŒì¼/ë””ë ‰í† ë¦¬ì— ëŒ€í•œ ê·¸ë£¹ì„ [smbgroup01]ë¡œ ì„¤ì •
        force group = smbgroup01
        # íŒŒì¼ ìƒì„±ì‹œ ê¶Œí•œ ì„¤ì • [770]
        force create mode = 770
        # í´ë” ìƒì„±ì‹œ ê¶Œí•œ ì„¤ì • [770]
        force directory mode = 770
        # ìƒìœ„ í´ë”ì—ì„œ ê¶Œí•œ ìƒì†
        inherit permissions = yes 

$ systemctl enable --now smb


$ useradd test3
$ smbpasswd -a test3
New SMB password:     # password ì„¤ì •
Retype new SMB password:
Added user test3.
$ usermod -aG smbgroup01 test3
```

<br>

<big> **â–  SELinuxê°€ ì‹¤í–‰ë˜ê³  ì˜ˆì œì™€ ê°™ì´ /homeë„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° SELinux ì •ì±…ì„ ë³€ê²½** </big>

```bash
$ setsebool -P samba_enable_home_dirs on

$ restorecon -R /home/share
```

<br>

<big> **â–  ë°©í™”ë²½ì´ ì‹¤í–‰ ì¤‘ì¸ ê²½ìš° Samba ì„œë¹„ìŠ¤ë¥¼ í—ˆìš©** </big>

```bash
$ firewall-cmd --add-service=samba
success

$ firewall-cmd --runtime-to-permanent
success
```

<br>

<big> **â–  í™•ì¸** </big>

![01](https://user-images.githubusercontent.com/42735894/232580498-d10f4281-3093-429a-b8e6-5e1e5c4cc90e.png){: width="80%" height="80%"}{: .align-center}

![04](https://user-images.githubusercontent.com/42735894/232582200-72021067-424c-48e8-b488-e5a03b6ffc54.PNG){: width="80%" height="80%"}{: .align-center}

![05](https://user-images.githubusercontent.com/42735894/232582205-f0014d71-07c2-4c31-a172-db13b46c802b.PNG){: width="80%" height="80%"}{: .align-center}

![06](https://user-images.githubusercontent.com/42735894/232582209-1ac903ca-f454-4432-82aa-efe0dd9b47ed.PNG){: width="80%" height="80%"}{: .align-center}

<br><br>

# ğŸ”” Rocky Linux í´ë¼ì´ì–¸íŠ¸
---

```bash
$ dnf -y install samba-client cifs-utils


# [smbclient] ëª…ë ¹ ì•¡ì„¸ìŠ¤ ì‚¬ìš©
# smbclient (share name) -U (user name)
$ smbclient '\\dlp.test.srv\Share01' -U test3
Password for [SAMBA\test3]:
Try "help" to get a list of possible commands.
smb: \> ls
  .                                   D        0  Tue Apr 18 03:54:35 2023
  ..                                  D        0  Tue Apr 18 03:43:44 2023
  Testdir                             D        0  Tue Apr 18 03:54:18 2023
  File.txt                            N        0  Tue Apr 18 03:54:35 2023

                17811456 blocks of size 1024. 16089172 blocks available


# íŒŒì¼ ë‹¤ìš´ë¡œë“œ
$ smb: \> mget File.txt
Get file File.txt? y
getting file \File.txt of size 0 as File.txt (0.0 KiloBytes/sec) (average 0.0 KiloBytes/sec)
smb: \> !ls
anaconda-ks.cfg  File.txt
smb: \> exit

# ë§ˆìš´íŠ¸
# [vers=(SMB protocol version)]
$ mount -t cifs -o vers=3.0,username=test3 '\\dlp.test.srv\Share01' /mnt
Password for test3@\\dlp.test.srv\Share01:

# ì¸ì¦ì´ í•„ìš”í•˜ì§€ ì•Šì€ ê²½ìš°
$ mount -t cifs -o vers=3,username=none,password=none '\\dlp.test.srv\Share' /mnt

$ df -hT
Filesystem             Type      Size  Used Avail Use% Mounted on
devtmpfs               devtmpfs  4.0M     0  4.0M   0% /dev
tmpfs                  tmpfs     369M     0  369M   0% /dev/shm
tmpfs                  tmpfs     148M  4.6M  143M   4% /run
/dev/mapper/rl-root    xfs        17G  1.7G   16G  10% /
/dev/nvme0n1p1         xfs      1014M  243M  772M  24% /boot
tmpfs                  tmpfs      74M     0   74M   0% /run/user/0
//dlp.test.srv/Share01 cifs       17G  1.7G   16G  10% /mnt
```