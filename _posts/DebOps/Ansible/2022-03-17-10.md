---
title:  "[Ansible] 08. Template"

categories:
  - ANSIBLE
tags:
  - [ansible]

toc: true
toc_sticky: true

date: 2022-03-17
last_modified_at: 2022-03-17
---
# [Ansible] 08. Template
---

<style>
table {
    font-size: 12pt;
}
table th:first-of-type {
    width: 5%;
}
table th:nth-of-type(2) {
    width: 15%;
}
table th:nth-of-type(3) {
    width: 50%;
}
table th:nth-of-type(4) {
    width: 30%;
}
</style>

## ğŸ”” ìì„¸í•œ ëª¨ë“ˆ ë‚´ìš©ì€ ì•„ë˜ ë¬¸ì„œë¥¼ ì°¸ê³ 

> **ëª¨ë“ˆ ë‚´ìš© :** <https://docs.ansible.com/ansible/latest/collections/ansible/builtin/index.html#modules><br><br>
**ì˜ˆì œ Github :** <https://github.com/revenge1005/Ansible_study>

<br>

## ğŸ”” Roles

- Ansibleì—ì„œëŠ” "Role"ì„ ì‚¬ìš©í•˜ì—¬ Ansible ì½”ë“œë¥¼ ë” ì‰½ê²Œ ì¬ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ì œê³µí•œë‹¤.

- Roleì€ ì¸í”„ë¼ë¥¼ í”„ë¡œë¹„ì €ë‹í•˜ê³ , ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë°°í¬í•˜ëŠ” ë“±ì˜ ëª¨ë“  ì‘ì—…ì— ëŒ€í•´ ë³€ìˆ˜, íŒŒì¼, í…œí”Œë¦¿ ë“±ì˜ ê¸°íƒ€ ë¦¬ì†ŒìŠ¤ë“¤ì„ í‘œì¤€í™”ëœ ë””ë ‰í† ë¦¬ êµ¬ì¡°ë¡œ íŒ¨í‚¤ì§•í•œë‹¤.

- ì¦‰, Roleì€ ì‰¬ìš´ ê³µìœ , íœ´ëŒ€ì„± ë° ì¬ì‚¬ìš©ì„ ìœ„í•´ íŠ¹ì • êµ¬ì¡°ë¡œ ë°°ì—´ëœ yaml ì‘ì—…íŒŒì¼ ë° ì§€ì› í•­ëª©ë“¤ì˜ ëª¨ìŒì´ë¼ê³  í•  ìˆ˜ ìˆë‹¤.

<br>

## ğŸ”” Rolesì˜ êµ¬ì„±ìš”ì†Œ

- Roleì€ í•˜ìœ„ ë””ë ‰í† ë¦¬ ë° íŒŒì¼ì˜ í‘œì¤€í™”ëœ êµ¬ì¡°ì— ì˜í•´ ì •ì˜ëœë‹¤.

- ìµœìƒìœ„ ë””ë ‰í† ë¦¬ëŠ” role ìì²´ì˜ ì´ë¦„ìœ¼ë¡œ ì •ì˜í•˜ë©°, ê·¸ ì•„ë˜ì˜ íŒŒì¼ë“¤ì€ tasks, handler ë“± roleì—ì„œ ê° íŒŒì¼ì˜ ëª©ì ì— ë”°ë¼ ì´ë¦„ì´ ì§€ì •ëœ í•˜ìœ„ ë””ë ‰í† ë¦¬ë¡œ êµ¬ì„±ëœë‹¤.

![152728225-0add9b6f-7727-43a0-befe-60c3b721af37](https://user-images.githubusercontent.com/42735894/223442653-ff81cb5e-4743-4e76-93f6-bf4e721ddd52.png){: width="100%" height="100%"}{: .align-center}

|êµ¬ë¶„|ì„¤ëª…|
|:---:|---|
|defaults|ì´ ë””ë ‰í„°ë¦¬ì˜ main.yml íŒŒì¼ì—ëŠ” roleì— ì‚¬ìš©ë  ë•Œ ë®ì–´ì“¸ ìˆ˜ ìˆëŠ” role ë³€ìˆ˜ì˜ ê¸°ë³¸ê°’ì„ ì„¤ì •<br><br>ì´ëŸ¬í•œ ë³€ìˆ˜ëŠ” ìš°ì„ ìˆœìœ„ê°€ ë‚®ìœ¼ë©° í”Œë ˆì´ë¶ì—ì„œ ë³€ê²½í•˜ê³  ì‚¬ìš©ìê°€ ì§€ì •í•  ìˆ˜ ìˆë‹¤.<br><br>ì´ëŸ¬í•œ ë³€ìˆ˜ëŠ” roleì„ ì‚¬ìš©í•˜ëŠ” í”Œë ˆì´ë¶ì„ ì‘ì„±í•˜ëŠ” ì‚¬ëŒì—ê²Œ í•  ì¼ì„ ì •í™•í•˜ê²Œ ì‚¬ìš©ì ì§€ì •í•˜ê±°ë‚˜ ì œì–´í•  ë°©ë²•ì„ ì œê³µí•˜ê¸° ìœ„í•œ ê²ƒìœ¼ë¡œ, default ë³€ìˆ˜ëŠ” í•´ë‹¹ ê°’ì„ ì¬ì •ì˜í•˜ë ¤ëŠ” ê²½ìš°ì—ë§Œ ì‚¬ìš©í•œë‹¤.|
|file|ì´ ë””ë ‰í„°ë¦¬ì—ì„œëŠ” ì •ì  íŒŒì¼ì„ ë‘ëŠ” ê³³|
|handlers|ì´ ë””ë ‰í„°ë¦¬ì˜ main.yml íŒŒì¼ì—ëŠ” roleì˜ í•¸ë“¤ëŸ¬ë¥¼ ì •ì˜|
|meta|ì´ ë””ë ‰í„°ë¦¬ì˜ main.yml íŒŒì¼ì—ëŠ” roleì˜ ë©”íƒ€ë°ì´í„° ì •ë³´ê°€ ì‘ì„±ë¨<br><br>ì œì‘ì, íšŒì‚¬, ë¼ì´ì„¼ìŠ¤ ì •ë³´ ë“± roleì— í•„ìš”í•œ dependency ì •ë³´ë“¤ì„ ê¸°ì…í•œë‹¤.|
|tasks|ì´ ë””ë ‰í„°ë¦¬ì˜ main.yml íŒŒì¼ì—ëŠ” roleì˜ taskë“¤ì„ ì •ì˜í•œ ë‚´ìš©ì´ í¬í•¨|
|templates|ì´ ë””ë ‰í„°ë¦¬ì—ëŠ” roleì—ì„œ ì°¸ì¡°í•˜ëŠ” jinia2 í…œí”Œë¦¿ì´ ë“¤ì–´ ìˆë‹¤.|
|tests|ì´ ë””ë ‰í„°ë¦¬ì—ëŠ” roleì„ í…ŒìŠ¤íŠ¸í•˜ëŠ”ë° ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì¸ë²¤í† ë¦¬ì™€ test.yml í”Œë ˆì´ë¶ì´ í¬í•¨|
|vars|ì´ ë””ë ‰í„°ë¦¬ì˜ main.yml íŒŒì¼ì€ roleì˜ ë³€ìˆ˜ ê°’ì„ ì •ì˜<br><br>ì¢…ì¢… ì´ëŸ¬í•œ ë³€ìˆ˜ëŠ” role ë‚´ì—ì„œ ë‚´ë¶€ ëª©ì ìœ¼ë¡œ ì‚¬ìš©ëœë‹¤.<br><br>ì´ëŸ¬í•œ ë³€ìˆ˜ëŠ” ìš°ì„  ìˆœìœ„ê°€ ë†’ìœ¼ë©°, í”Œë ˆì´ë¶ì—ì„œ ì‚¬ìš©ë  ë•Œ ë³€ê²½ë˜ì§€ ì•ŠëŠ”ë‹¤.<br><br>var ë³€ìˆ˜ì˜ ì˜ë„ëŠ” roleì˜ ë‚´ë¶€ ê¸°ëŠ¥ì— ì˜í•´ ì‚¬ìš©ë˜ëŠ” ë³€ìˆ˜ë¥¼ ì •ì˜í•˜ë„ë¡ í•˜ëŠ” ê²ƒì´ë‹¤.|

<br>

## ğŸ”” ansible role ì‚¬ìš©ë²•

```bash
---
- host: all
  roles:
    - role01
    - role02
```

- ì´ë ‡ê²Œ ì§€ì •í•œ role01, role02ì˜ ë””ë ‰í† ë¦¬ì—ì„œ tasks, heandlers, vars ë“± ëª¨ë“  ë‚´ìš©ë“¤ì„ ë¶ˆëŸ¬ì™€ì„œ í•´ë‹¹ roleì„ ì‹¤í–‰í•œë‹¤.

- â€‹roleì—ì„œ cp, script, template ë˜ëŠ” import_task, include_task ë“±ì€ ì ˆëŒ€ê²½ë¡œ/ìƒëŒ€ê²½ë¡œ, ì´ë¦„ì´ ì—†ëŠ” ê´€ë ¨ íŒŒì¼, í…œí”Œë¦¿ ë˜ëŠ” ì‘ì—… íŒŒì¼ì„ ì°¸ì¡°í•  ìˆ˜ ìˆë‹¤.

- ansibleì€ files, templates, tasks í•˜ìœ„ ë””ë ‰í† ë¦¬ì—ì„œ ì´ëŸ¬í•œ ê°ê°ì˜ í•­ëª©ë“¤ì„ ì°¾ëŠ”ë‹¤.

### (1) roleì´ í¬í•¨ëœ playbookì—ì„œ ì‹¤í–‰ ìˆœì„œ ì œì–´í•˜ê¸°

- roleì´ í¬í•¨ëœ playbookì—ì„œ ì‹¤í–‰ ìˆœì„œë¥¼ ì œì–´í•˜ê¸° ìœ„í•´ 2ê°€ì§€ ì§€ì‹œìë¥¼ ì‚¬ìš©í•œë‹¤.

    - pre_tasksì— ë‚˜ì—´ëœ ì‘ì—…ì€ ëª¨ë“  role, ì¼ë°˜ tasksê°€ ì‹¤í–‰ë˜ê¸° ì „ì— ì œì¼ ë¨¼ì € ì‹¤í–‰ëœë‹¤.

    - post_tasksëŠ” ì´ëŸ¬í•œ ì‘ì—…ì€ pre_tasks, tasks, rolesê°€ ëª¨ë‘ ì‹¤í–‰ëœ í›„ì— ë§ˆì§€ë§‰ì— ì‹¤í–‰ëœë‹¤.â€‹

### (2) playbookì— role í¬í•¨í•˜ê¸°

- **include_role :** roleì„ ë™ì ìœ¼ë¡œ í¬í•¨ (ansible 2.3 versionì—ì„œ ì¶”ê°€ëœ ê¸°ëŠ¥)

- **import_role :** roleì„ ë™ì ìœ¼ë¡œ í¬í•¨ (ansible 2.3 versionì—ì„œ ì¶”ê°€ëœ ê¸°ëŠ¥)

â€‹```bash
---
- name: execute a role as a task
  hosts: web.example.com
  tasks:
    - name: a normal task
      debug:
        msg: 'first task'
    - name: a task to include role2 here
      include_role: role2
```

<br>

## ğŸ”” Role í´ë” ìƒì„± ëª…ë ¹

```bash
$ ansible-galaxy init roles
- Role roles was created successfully

$ tree
.
â””â”€â”€ roles
    â”œâ”€â”€ defaults
    â”‚   â””â”€â”€ main.yml
    â”œâ”€â”€ files
    â”œâ”€â”€ handlers
    â”‚   â””â”€â”€ main.yml
    â”œâ”€â”€ meta
    â”‚   â””â”€â”€ main.yml
    â”œâ”€â”€ README.md
    â”œâ”€â”€ tasks
    â”‚   â””â”€â”€ main.yml
    â”œâ”€â”€ templates
    â”œâ”€â”€ tests
    â”‚   â”œâ”€â”€ inventory
    â”‚   â””â”€â”€ test.yml
    â””â”€â”€ vars
        â””â”€â”€ main.yml
```

<br>

## ğŸ”” Role ì˜ˆì‹œ (WEB ì„œë²„ êµ¬ì„±)

> ì•„ë˜ì™€ ê°™ì´ êµ¬ì„±í•˜ì˜€ê³ , ì˜ˆì œì˜ ìì„¸í•œ ë‚´ìš©ì€ Gitì—ì„œ í™•ì¸ <br><br><https://github.com/revenge1005/Ansible_study/tree/master/02.%20Ansible%20Tutorial%20-%202/Ansible%20Tutorial%202%20-%2009.%20Roles>

```bash
# tree
.
â”œâ”€â”€ ansible.cfg
â”œâ”€â”€ inventory
â”œâ”€â”€ playbook.yml
â””â”€â”€ roles
    â””â”€â”€ web_servers
        â”œâ”€â”€ README.md
        â”œâ”€â”€ defaults
        â”‚   â””â”€â”€ main.yml
        â”œâ”€â”€ files
        â”‚   â””â”€â”€ MyWebSite
        â”‚       â”œâ”€â”€ 1.png
        â”‚       â”œâ”€â”€ 2.png
        â”‚       â”œâ”€â”€ 3.png
        â”‚       â””â”€â”€ 4.png
        â”œâ”€â”€ handlers
        â”‚   â””â”€â”€ main.yml
        â”œâ”€â”€ meta
        â”‚   â””â”€â”€ main.yml
        â”œâ”€â”€ tasks
        â”‚   â””â”€â”€ main.yml
        â”œâ”€â”€ templates
        â”‚   â””â”€â”€ index.j2
        â”œâ”€â”€ tests
        â”‚   â”œâ”€â”€ inventory
        â”‚   â””â”€â”€ test.yml
        â””â”€â”€ vars
            â””â”€â”€ main.yml

11 directories, 16 files
```

![image](https://user-images.githubusercontent.com/42735894/223446052-177c0e3e-2bcf-44ce-9f0b-3cf6e756eb58.png){: width="100%" height="100%"}{: .align-center}
![image (1)](https://user-images.githubusercontent.com/42735894/223446059-165365f7-23bf-4d03-beda-3b9a9336728e.png){: width="100%" height="100%"}{: .align-center}

<br>

