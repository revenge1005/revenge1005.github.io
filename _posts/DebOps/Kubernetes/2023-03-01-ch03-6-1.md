---
title:  "[Retry, k8s] 06. μ¨ν”„λ λ―Έμ¤ ν™κ²½μ—μ„ SDSμ— μν• λ™μ  λ³Όλ¥¨ ν”„λ΅λΉ„μ €λ‹(CephFS) - (1)"

categories:
  - KUBERNETES
tags:
  - [kubernetes]

toc: true
toc_sticky: true

date: 2023-03-01
last_modified_at: 2023-03-01
---
# [Retry, k8s] 06. μ¨ν”„λ λ―Έμ¤ ν™κ²½μ—μ„ SDSμ— μν• λ™μ  λ³Όλ¥¨ ν”„λ΅λΉ„μ €λ‹(CephFS) - (1)
---

<style>
table {
    font-size: 12pt;
}
table th:first-of-type {
    width: 5%;
}
table th:nth-of-type(2) {
    width: 15%;
}
table th:nth-of-type(3) {
    width: 50%;
}
table th:nth-of-type(4) {
    width: 30%;
}
</style>

<br>

## π”” Cephλ€? 

> Cephλ” λ¶„μ‚° μ»΄ν“¨ν„° μ¤ν† λ¦¬μ§€ μƒμ— μ¤λΈμ νΈ μ¤ν† λ¦¬μ§€λ¥Ό κµ¬ν„ν• μ¤ν”μ†μ¤ μ¤ν† λ¦¬μ§€ ν”λ«νΌ(Software Defined Storage)
    
- Cephμ μ¥μ μ€ SPOF(Single Point of Failure)κ°€ μ—†λ” <u>μ™„μ „ν• λ¶„μ‚°μ²λ¦¬μ™€ EB(μ—‘μ‚¬λ°”μ΄νΈ) μμ¤€μ μ¤μΌ€μΌ μ•„μ›ƒ(Scale-out)μ΄ κ°€λ¥</u>ν•λ‹¤.

<br>

## π”” RADOS(Reliable Autonomic Distributed Object Store)

> Cephμ κΈ°λ°μ΄ λλ” λ¶„μ‚° μ¤ν† λ¦¬μ§€ μ‹μ¤ν…μΌλ΅ RADOSλ” λ¶„μ‚° ν™κ²½μ—μ„ κ°μ²΄λ¥Ό μ €μ¥ν•κ³  κ²€μƒ‰ν•κΈ° μ„ν• μ•μ •μ μ΄κ³  ν™•μ¥ κ°€λ¥ν• ν”λ«νΌμ„ μ κ³µν•λ„λ΅ μ„¤κ³„λμ—λ‹¤.

- λ¨λ“  λ°μ΄ν„°λ” RADOSλ¥Ό κ±°μ³ Objectλ΅ μ €μ¥λλ©°, CRUSH(Controlled Replication Under Scalable Hashing)λΌλ” μ•κ³ λ¦¬μ¦μ„ μ‚¬μ©ν•΄μ„ λ°μ΄ν„°λ¥Ό μ €μ¥ν•  OSDλ¥Ό λΉ λ¥΄κ³  μ •ν™•ν•κ² μ°Ύμ•„μ¤€λ‹¤.

- CRUSHλ” Ceph ν΄λ¬μ¤ν„°μ—μ„ μ¤λΈμ νΈμ μ„μΉλ¥Ό κ²°μ •ν•λ” μ•κ³ λ¦¬μ¦μΌλ΅ ν΄λ¬μ¤ν„°μ κµ¬μ΅°μ™€ κ·μΉ™μ„ λ°μν•μ—¬ μ¤λΈμ νΈμ IDλ¥Ό OSDμ IDλ΅ λ§¤ν•‘ν•λ‹¤.

<br>

## π”” Ceph μ•„ν‚¤ν…μ²


![arc-01](https://user-images.githubusercontent.com/42735894/228179743-3686567a-c390-48e3-9dc6-cfebaf985667.png){: width="100%" height="100%"}{: .align-center}


### (a) OSD(Object Storage Daemon, ceph-osd)

- Ceph ν΄λ¬μ¤ν„°μ κ° λ…Έλ“μ—μ„ μ‹¤ν–‰λκ³  λ°μ΄ν„°λ¥Ό μ €μ¥/κ²€μƒ‰/λ³µμ /λ¶€ν•λ¶„μ‚°ν•λ” μ—­ν• μ„ ν•λ‹¤.

- OSDλ” ν•λ‚μ λ””μ¤ν¬μ— ν•λ‚μ”© ν• λ‹Ήλλ©°, OSDλ§λ‹¤ κ³ μ ν• IDλ¥Ό κ°€μ§„λ‹¤.


### (b) Monitor(Ceph Monitor, ceph-mon)

- ν΄λ¬μ¤ν„°μ ν„μ¬ μƒνƒμ— λ€ν• map(Ceph ν΄λ¬μ¤ν„°μ μƒνƒ μ •λ³΄λ¥Ό μ €μ¥ν•λ” λ°μ΄ν„° κµ¬μ΅°)μ„ κ΄€λ¦¬ν•λ” μ—­ν• κ³Ό ν΄λ¬μ¤ν„°μ— μ•΅μ„Έμ¤ν•λ” ν΄λΌμ΄μ–ΈνΈ λ° OSDμ— λ€ν• μΈμ¦ λ° κ¶ν• λ¶€μ—¬λ¥Ό λ‹΄λ‹Ήν•λ‹¤.

- Monitorμ—λ” λ†’μ€ μΌκ΄€μ„±μ΄ ν•„μ”ν•λ©°, Ceph μ¤ν† λ¦¬μ§€ ν΄λ¬μ¤ν„°μ μƒνƒμ— λ€ν• ν•©μλ¥Ό λ³΄μ¥ν•κΈ° μ„ν•΄ Paxos μ•κ³ λ¦¬μ¦μ„ μ‚¬μ©ν•λ‹¤.


### (c) Manager(Ceph Manager, ceph-mgr)

- Managerλ” κµ¬μ„± κ΄€λ¦¬, μ„±λ¥ μ΅°μ • λ° μ μ§€ κ΄€λ¦¬ μ‘μ—…μ„ ν¬ν•¨ν•μ—¬ Ceph ν΄λ¬μ¤ν„°μ μ „μ²΄ μ‘μ—… κ΄€λ¦¬λ¥Ό λ‹΄λ‹Ήν•λ©°, λ¨λ‹ν„° λ° OSDμ™€ κ°™μ€ λ‹¤λ¥Έ κµ¬μ„± μ”μ†μ™€ μ΅°μ •ν•μ—¬ ν΄λ¬μ¤ν„°κ°€ μµκ³  ν¨μ¨λ΅ μ‘λ™ν•λ„λ΅ ν•λ‹¤.

- Managerλ” ν΄λ¬μ¤ν„° λ° ν•΄λ‹Ή κµ¬μ„± μ”μ†λ¥Ό κ΄€λ¦¬ν•κΈ° μ„ν• RESTful APIλ¥Ό μ κ³µν•λ‹¤.


### (d) MDS(Ceph Metadata Server, Ceph-mds)

- Ceph FileSystem μ„λΉ„μ¤μ—μ„ νμΌμ λ©”νƒ€λ°μ΄ν„°λ¥Ό μ €μ¥ν•κ³  κ΄€λ¦¬ν•λ” μ—­ν• μ„ ν•λ‹¤.

<br>

## π”” Ceph ν΄λΌμ΄μ–ΈνΈ

> Cephλ” μ¤λΈμ νΈ(Ceph Object Storage), λΈ”λ΅(Ceph Object Storage), νμΌ(Ceph FileSystem) λ λ²¨μ μ¤ν† λ¦¬μ§€ μΈν„°νμ΄μ¤λ¥Ό μ κ³µν•λ‹¤.

![e20cd0ae-bcc3-47e7-b23a-b6c98a8daba0](https://user-images.githubusercontent.com/42735894/228186751-115f97cb-b80f-471c-93c4-c544df488214.png){: width="50%" height="50%"}{: .align-center}


### (a) Ceph Object Gateway

- Ceph Object Gateway(RADOS Gateway, RADOSGW λλ” RGW)λ” λΌμ΄λΈλ¬λ¦¬(librados)λ¥Ό μ‚¬μ©ν•μ—¬ κµ¬μ¶•λ Object μ¤ν† λ¦¬μ§€ μΈν„°νμ΄μ¤μΌλ΅, λΌμ΄λΈλ¬λ¦¬λ¥Ό μ‚¬μ©ν•μ—¬ Ceph ν΄λ¬μ¤ν„°μ™€ ν†µμ‹ ν•κ³  OSD ν”„λ΅μ„Έμ¤μ— μ§μ ‘ λ°μ΄ν„°λ¥Ό μ“΄λ‹¤.

- RESTful APIκ°€ ν¬ν•¨λ κ²μ΄νΈμ›¨μ΄λ¥Ό μ κ³µν•κ³  Amazon S3λ‚ OpenStack Swiftμ™€ νΈν™λλ” μΈν„°νμ΄μ¤λ¥Ό κ°€μ§€κ³  μλ‹¤.

- radosgw λΌλ” λ°λ¬μ„ μ‚¬μ©ν•΄μ„ Ceph ν΄λ¬μ¤ν„°μ™€ ν†µμ‹ ν•κ³ , μ‚¬μ©μ κ΄€λ¦¬λ‚ λ°μ΄ν„° λ³µμ , λ§μ΄κ·Έλ μ΄μ… λ“±μ κΈ°λ¥λ„ μ κ³µν•λ‹¤.


### (b) RADOS Block Device

- Ceph Block Device(RADOS block device, RBD)λ” RBD μ΄λ―Έμ§€(κ°€μƒ λ””μ¤ν¬)λ¥Ό ν†µν•΄ Ceph ν΄λ¬μ¤ν„° λ‚΄μ— λΈ”λ΅ μ¤ν† λ¦¬μ§€λ¥Ό μ κ³µ, RBD μ΄λ―Έμ§€λ” ν΄λ¬μ¤ν„°μ μ„λ΅ λ‹¤λ¥Έ OSDμ— ν©μ–΄μ Έ μλ” κ°λ³„ objectλ΅λ¶€ν„° κµ¬μ„±λκ³  ν΄λ¬μ¤ν„° λ‚΄μ object κ°„μ— λ°μ΄ν„°λ¥Ό μ¤νΈλΌμ΄ν•‘ ν•  μ μλ‹¤.

- rbd λΌλ” μ ν‹Έλ¦¬ν‹°λ¥Ό μ‚¬μ©ν•΄μ„ Ceph ν΄λ¬μ¤ν„°μ— μλ” μ¤λΈμ νΈλ“¤μ„ RBD μ΄λ―Έμ§€(κ°€μƒ λ””μ¤ν¬)λ΅ μƒμ„±ν•κ³  κ΄€λ¦¬ν•  μ μκ³ , μ¤λƒ…μƒ·μ΄λ‚ λ³µμ , λ―Έλ¬λ§ λ“±μ κΈ°λ¥λ„ μ κ³µν•λ‹¤.


### (c) Ceph File System 

- Ceph File System(CephFS)μ€ Ceph ν΄λ¬μ¤ν„°μ— μλ” μ¤λΈμ νΈλ“¤μ„ POSIX νΈν™ νμΌ μ‹μ¤ν…μΌλ΅ λ§λ“¤μ–΄ μ΄λ¥Ό λ‹¤λ¥Έ μ»΄ν“¨ν„°μ—μ„ λ§μ΄νΈν•΄μ„ μ‚¬μ©ν•  μ μκ² ν•΄μ£Όκ³ , MDS(Ceph Metadata Server)λ¥Ό ν†µν•΄ νμΌμ μ •λ³΄λ‚ κ¶ν•μ„ κ΄€λ¦¬ν•λ‹¤.

- mount.ceph λΌλ” μ ν‹Έλ¦¬ν‹°λ¥Ό μ‚¬μ©ν•΄μ„ νμΌ μ‹μ¤ν…μ„ λ§μ΄νΈν•κ³  κ΄€λ¦¬ν•  μ μκ³ , λ©”νƒ€λ°μ΄ν„° μ„λ²„λ¥Ό ν†µν•΄ νμΌμ μ •λ³΄λ‚ κ¶ν•μ„ κ΄€λ¦¬ν•λ‹¤.


### (d) Placement Groups(PG)

![3](https://user-images.githubusercontent.com/42735894/228211891-5eb572cc-f521-4ab7-bfb0-1809a9b9c874.png){: width="50%" height="50%"}{: .align-center}

- Ceph ν΄λ¬μ¤ν„°μ—μ„ μ¤λΈμ νΈλ“¤μ„ λ…Όλ¦¬μ μΌλ΅ λ¬¶μ€ λ‹¨μ„λ΅ Poolμ ν•μ„ μ§‘ν•©μ΄λ‹¤.

- Cephλ” Poolμ„ μΌλ ¨μ PGλ΅ λ¶„ν• ν•κ³  CRUSH μ•κ³ λ¦¬μ¦μ€ ν΄λ¬μ¤ν„° λ§µκ³Ό ν΄λ¬μ¤ν„° μƒνƒλ¥Ό κ³ λ ¤ν•μ—¬ PGλ¥Ό ν΄λ¬μ¤ν„°μ OSDμ— κ³ λ¥΄κ² λ°°ν¬ν•λ‹¤.


### (e) Pool

![diag-6bb600843c8db7be2aa2133929c00615](https://user-images.githubusercontent.com/42735894/228219048-75109f1c-6a26-42a0-829a-b0f047b0f228.png){: width="50%" height="50%"}{: .align-center}

- PG μ μ§‘ν•©(Object μ μ§‘ν•©)μ΄λ©° Pool λ‹¨μ„λ΅ PG λ¥Ό κ΄€λ¦¬ν•κ³  λ°μ΄ν„°λ¥Ό μ €μ¥ν•λ‹¤.

- Poolμ€ Ceph ν΄λΌμ΄μ–ΈνΈκ°€ λ°μ΄ν„°λ¥Ό μ €μ¥ν•κ±°λ‚ μ ‘κ·Όν•  μ μλ” μΈν„°νμ΄μ¤λ¥Ό μ κ³µν•κ³ , λ³µμ  μλ‚ μΈμ½”λ”© λ°©μ‹ λ“±μ μ†μ„±μ„ μ„¤μ •ν•  μ μλ‹¤.


### (f) Pool Type

> Pool Typeμ€ λ³µμ (Replicated)μ™€ λ¶€νΈν™”(Erasure-coded)λ΅ κµ¬λ¶„λλ‹¤.

![5](https://user-images.githubusercontent.com/42735894/228223047-2b04229d-c939-449a-9718-7a4875c1d21b.png){: width="50%" height="50%"}{: .align-center}

- **γ€λ³µμ (Replicated)γ€‘ :** μ¤λΈμ νΈλ¥Ό μ—¬λ¬ OSDμ— λ³µμ‚¬ν•΄μ„ μ €μ¥ν•λ” λ°©μ‹μΌλ΅ λ°μ΄ν„° λ‚΄κµ¬μ„±κ³Ό κ°€μ©μ„±μ΄ λ†’μ§€λ§ μ €μ¥ κ³µκ°„ ν¨μ¨μ΄ λ‚®λ‹¤.

- **γ€λ¶€νΈν™”(Erasure-coded)γ€‘ :** μ¤λΈμ νΈλ¥Ό λ°μ΄ν„° μ΅°κ°κ³Ό ν¨λ¦¬ν‹° μ΅°κ°μΌλ΅ λ‚λ„μ–΄μ„ μ €μ¥ν•λ” λ°©μ‹μΌλ΅, μ €μ¥ κ³µκ°„ ν¨μ¨μ΄ λ†’μ§€λ§ μ„±λ¥κ³Ό λ³µμ΅λ„κ°€ λ‚®λ‹¤.

<br>