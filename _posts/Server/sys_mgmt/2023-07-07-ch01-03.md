---
title:  "[ì‹œìŠ¤í…œ ê´€ë¦¬] 03. MySQL ë¡œê¹…" 

categories:
  - SYS_MGMT
tags:
  - [sys_mgmt, linux]

toc: true
toc_sticky: true

date: 2023-07-07
last_modified_at: 2023-07-07
---
<br>

# ğŸ”” MySQL ë¡œê¸¸
---

<style>
table {
    font-size: 12pt;
}
table th:first-of-type {
    width: 5%;
}
table th:nth-of-type(2) {
    width: 20%;
}
table th:nth-of-type(3) {
    width: 50%;
}
table th:nth-of-type(4) {
    width: 30%;
} 
big { 
    font-size: 25px 
}
small { 
    font-size: 18px 
}
</style>

<br>

<big> **â–  MySQL ë¡œê·¸ ì¢…ë¥˜** </big> <br>

| ì¢…ë¥˜ | ë‚´ìš© |
| :-----: | :------- |
| ì˜¤ë¥˜ ê´€ë ¨ | ì˜¤ë¥˜ ë¡œê·¸, ì¼ë°˜ ì¿¼ë¦¬ ë¡œê·¸, ìŠ¬ë¡œ ì¿¼ë¦¬ ë¡œê·¸(ë¬¸ì œ í•´ê²°ì„ ìœ„í•œ MySQLì˜ ë™ì‘ ê´€ë ¨ ë¡œê·¸) |
| ë°±ì—… ê´€ë ¨ | ë°”ì´ë„ˆë¦¬ ë¡œê·¸(ë°ì´í„°ë² ì´ìŠ¤ ë‚´ìš©ì„ ë°±ì—…í•˜ê¸° ìœ„í•œ ë¡œê·¸) |

<br>

<big> **â–  í…ŒìŠ¤íŠ¸ìš© DB, Table ìƒì„±** </big> <br>

```bash
MariaDB [(none)]> CREATE DATABASE SAMPLEDB;
Query OK, 1 row affected (0.000 sec)


MariaDB [(none)]> USE SAMPLEDB;
Database changed


MariaDB [SAMPLEDB]> CREATE TABLE SAMPLETABLE (NAME TEXT);
Query OK, 0 rows affected (0.003 sec)


MariaDB [SAMPLEDB]> INSERT INTO SAMPLETABLE (NAME) VALUES("TARO");
Query OK, 1 row affected (0.001 sec)


MariaDB [SAMPLEDB]> SELECT * FROM SAMPLETABLE;
+------+
| NAME |
+------+
| TARO |
+------+
1 row in set (0.000 sec)
```

<br>

<big> **â–  ì˜¤ë¥˜ ë¡œê·¸** </big> <br>

ì˜¤ë¥˜ ë¡œê·¸ëŠ” ì‹œìŠ¤í…œ ë¡œê¹…ì´ë¼ê³ ë„ í•˜ë©°, mysqldì˜ ì‹œì‘, ì‹¤í–‰, ì •ì§€ ë¡œê¹… ë˜ëŠ” ë°œìƒí•œ ì˜¤ë¥˜ ì •ë³´ë¥¼ ë¡œê¹…í•œë‹¤. 

<br>

<small> **â–¶ ì˜¤ë¥˜ ë¡œê·¸ ì„¤ì •** </small> <br>

```bash
# https://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html
# 5.7.2 ë²„ì „ ì´ì „ -> log-warning
# 5.7.2 ë²„ì „ ì´í›„ -> log_error_verbosity
$ cat <<EOF >> /etc/my.cnf

[mysqld_safe]
log_error=/var/log/mariadb/mariadb.log
log_error_verbosity=1
EOF
```

| ì˜µì…˜ | ë‚´ìš© |
| :-----: | :------- |
| log_error | ì˜¤ë¥˜ ë¡œê·¸ ì¶œë ¥ ëŒ€ìƒ ì„¤ì •, ì˜¤ë¥˜ ë¡œê·¸ì˜ íŒŒì¼ëª…ì„ ì„¤ì •í•œë‹¤. |
| log_error_verbosity | ì˜¤ë¥˜ ë¡œê·¸ì— ì˜¤ë¥˜, ê²½ê³  ë° ì°¸ê³  ë©”ì‹œì§€ë¥¼ ê¸°ë¡ í•  ë•Œ ì„œë²„ì˜ ìì„¸í•œ ì •ë³´ë¥¼ ì œì–´ |

| log_error_verbosity Value | ë©”ì‹œì§€ ë‚´ìš© |
| :-----: | :------- |
| 1 | Errors only |
| 2 | Errors and warnings |
| 3 | Errors, warnings, and notes |

<br>

<big> **â–  ì¼ë°˜ ì¿¼ë¦¬ ë¡œê·¸** </big> <br>

ì¼ë°˜ ì¿¼ë¦¬ ë¡œê·¸ëŠ” ì¿¼ë¦¬ ë¡œê¹…ì´ë¼ê³ ë„ í•˜ë©°, mysqldê°€ í´ë¼ì´ì–¸íŠ¸ì™€ ì ‘ì†í–ˆì„ ë•Œì˜ ì •ë³´ ë° ì‹¤í–‰í•œ ì¿¼ë¦¬ ì •ë³´ë¥¼ ë¡œê¹…í•œë‹¤. 

<br>

<small> **â–¶ ì¼ë°˜ ì¿¼ë¦¬ ë¡œê·¸ ì„¤ì •** </small> <br>

```bash
# https://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html
$ cat <<EOF >> /etc/my.cnf

[mysqld]
# Query Log
general_log=1
general_log_file=/var/log/mariadb/sql.log
log_output=FILE
EOF


# mysqld ë‹¤ì‹œì‹œì‘
$ systemctl restart mysqld
```

| ì˜µì…˜ | ë‚´ìš© |
| :-----: | :------- |
| general_log | ì¼ë°˜ ì¿¼ë¦¬ ë¡œê·¸ê°€ í™œì„±í™”ë˜ì—ˆëŠ”ì§€ ì—¬ë¶€ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ê°’, ë¡œê·¸ë¥¼ ë¹„í™œì„±í™”í•˜ë ¤ë©´ 0(ë˜ëŠ” OFF)ì„ ì‚¬ìš©í•˜ê³ , ë¡œê·¸ë¥¼ í™œì„±í™”í•˜ë ¤ë©´ 1(ë˜ëŠ” ON)ì„ ì‚¬ìš© |
| general_log_file | ì¼ë°˜ ì¿¼ë¦¬ ë¡œê·¸ íŒŒì¼ì˜ ì´ë¦„ì„ ì„¤ì •, ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ 'í˜¸ìŠ¤íŠ¸ëª….log' íŒŒì¼ë¡œ ì €ì¥ë¨ |
| log_output | ì¼ë°˜ ì¿¼ë¦¬ ë¡œê·¸ì™€ ìŠ¬ë¡œ ì¿¼ë¦¬ ë¡œê·¸ì˜ ì¶œë ¥ ìœ„ì¹˜ë¥¼ ì„¤ì • <br> (TABLE: í…Œì´ë¸”ë¡œ ë¡œê·¸, FILE: íŒŒì¼ë¡œ ë¡œê·¸, NONE: í…Œì´ë¸”ì´ë‚˜ íŒŒì¼ë¡œ ë¡œê·¸í•˜ì§€ ì•ŠìŒ) |

<br>

<small> **â–¶ ì¼ë°˜ ì¿¼ë¦¬ ë¡œê·¸ í™•ì¸** </small> <br>

```bash
MariaDB [(none)]> USE SAMPLEDB;
Database changed

MariaDB [SAMPLEDB]> INSERT INTO SAMPLETABLE (NAME) VALUES("JIRO");
Query OK, 1 row affected (0.001 sec)

MariaDB [SAMPLEDB]> SELECT * FROM SAMPLETABLE;
+------+
| NAME |
+------+
| TARO |
| JIRO |
+------+
2 rows in set (0.000 sec)
```

```bash
# cat /var/log/mariadb/sql.log
/usr/libexec/mariadbd, Version: 10.5.16-MariaDB-log (MariaDB Server). started with:
Tcp port: 0  Unix socket: /var/lib/mysql/mysql.sock
Time                Id Command  Argument
230727 23:54:06      3 Connect  root@localhost on  using Socket
                     3 Query    select @@version_comment limit 1
230727 23:54:12      3 Query    SELECT DATABASE()
                     3 Init DB  SAMPLEDB
                     3 Query    show databases
                     3 Query    show tables
                     3 Field List       SAMPLETABLE
230727 23:54:22      3 Query    INSERT INTO SAMPLETABLE (NAME) VALUES("JIRO")
230727 23:54:29      3 Query    SELECT * FROM SAMPLETABLE
230727 23:54:32      3 Quit
```

<br>

<big> **â–  ìŠ¬ë¡œ ì¿¼ë¦¬ ë¡œê·¸** </big> <br>

ìŠ¬ë¡œ ì¿¼ë¦¬ ë¡œê·¸ëŠ” ìŠ¬ë¡œ ì¿¼ë¦¬(ë””ë²„ê·¸) ë¡œê¹…ì´ë¼ê³ ë„ í•˜ë©°, mysqldëŠ” long_query_timeìœ¼ë¡œ ì§€ì •í•œ ì‹œê°„(ì´ˆ)ë³´ë‹¤ ì‹œê°„ì„ í•„ìš”ë¡œ í•œ ì¿¼ë¦¬ ë˜ëŠ” ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì€ ì¿¼ë¦¬ë¥¼ ë¡œê¹…í•œë‹¤. 

<br>

<small> **â–¶ ìŠ¬ë¡œ ì¿¼ë¦¬ ë¡œê·¸ ì„¤ì •** </small> <br>

```bash
# https://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html
$ cat <<EOF >> /etc/my.cnf

# Slow Query log
slow_query_log=1
slow_query_log_file=/var/log/mariadb/slow.log
long_query_time=1
log_queries_not_using_indexes
log_slow_admin_statements
EOF


# mysqld ë‹¤ì‹œì‹œì‘
$ systemctl restart mysqld
```

| ì˜µì…˜ | ë‚´ìš© |
| :-----: | :------- |
| slow_query_log | ìŠ¬ë¡œ ì¿¼ë¦¬ ë¡œê·¸ì˜ ì¶œë ¥ ì—¬ë¶€ë¥¼ ì„¤ì • (1: ì¶œë ¥í•¨, 0: ì¶œë ¥í•˜ì§€ ì•ŠìŒ) |
| slow_query_log_file | ìŠ¬ë¡œ ì¿¼ë¦¬ ë¡œê·¸ì˜ íŒŒì¼ëª…ì„ ì„¤ì • (ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ general_logì— ë”°ë¥¸ë‹¤.) |
| long_query_time | ì¿¼ë¦¬ ì²˜ë¦¬ ì‹œê°„(ì´ˆ ë‹¨ìœ„)ì„ ì„¤ì •, ì´ˆë¥¼ ì´ˆê³¼í•˜ë©´ ìŠ¬ë¡œ ì¿¼ë¦¬ ë¡œê·¸ë¡œ ì¶œë ¥í•¨ (ê¸°ë³¸ê°’ 10ì´ˆ) |
| log_queries_not_using_indexes | ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì¿¼ë¦¬ë¥¼ ëª¨ë‘ ì¶œë ¥í•  ë•Œ ì§€ì •, ì´ ì„¤ì •ì„ ì§€ì •í•´ ë‘ë©´ ì•ì„œ ìƒì„±í•œ í…ŒìŠ¤íŠ¸ìš© í…Œì´ë¸”ì€ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•´ ë‘ì§€ ì•Šì•˜ìœ¼ë¯€ë¡œ í…ŒìŠ¤íŠ¸ìš© í…Œì´ë¸”ì„ ì¡°ì‘í•˜ëŠ” ëª¨ë“  ì¿¼ë¦¬ê°€ ì¶œë ¥ëœë‹¤. |
| log_slow_admin_statements | ê´€ë¦¬ìš© SQL ë¬¸(OPTIMIZE TABLE, ANALYZE TABLE, ALTER TABLE, ...) ì²˜ëŸ¼ ì²˜ë¦¬í•˜ëŠ”ë° ì‹œê°„ì´ ê±¸ë¦¬ëŠ” ì¿¼ë¦¬ë¥¼ ì¶œë ¥í•˜ê³ ì í•  ë•Œ ì§€ì • |

<br>

<small> **â–¶ ìŠ¬ë¡œ ì¿¼ë¦¬ ë¡œê·¸ í™•ì¸** </small> <br>

```bash
MariaDB [SAMPLEDB]> SELECT * FROM SAMPLETABLE;
+------+
| NAME |
+------+
| TARO |
| JIRO |
| TOTO |
+------+
3 rows in set (0.001 sec)
```

```bash
$ cat /var/log/mariadb/slow.log
/usr/libexec/mariadbd, Version: 10.5.16-MariaDB-log (MariaDB Server). started with:
Tcp port: 0  Unix socket: /var/lib/mysql/mysql.sock
Time                Id Command  Argument
# Time: 230728  0:10:12
# User@Host: root[root] @ localhost []
# Thread_id: 3  Schema: SAMPLEDB  QC_hit: No
# Query_time: 0.000792  Lock_time: 0.000617  Rows_sent: 3  Rows_examined: 3
# Rows_affected: 0  Bytes_sent: 115
use SAMPLEDB;
SET timestamp=1690470612;
SELECT * FROM SAMPLETABLE;
```

| log ë‚´ìš© | ì„¤ëª… |
| :-----: | :------- |
| User@Host | ì ‘ì† ì‚¬ìš©ìì™€ í˜¸ìŠ¤íŠ¸ëª…ì„ ì¶œë ¥ |
| Query_time | ì¿¼ë¦¬ ì‹¤í–‰ ì‹œê°„ |
| Lock_time | í…Œì´ë¸” ë˜ëŠ” ë°ì´í„°ë² ì´ìŠ¤ê°€ ì ê¸´ ì‹œê°„ |
| Rows_examined | ì²˜ë¦¬ ëŒ€ìƒì´ ëœ ì—´ìˆ˜ |

> ì—¬ê¸°ì„œ ì¶œë ¥ëœ ìŠ¬ë¡œ ì¿¼ë¦¬ ë¡œê·¸ ì •ë³´ëŠ” ì§€ì—°ì´ ë°œìƒí•´ì„œê°€ ì•„ë‹ˆë¼ log_queries_not_using_indexesë¥¼ ì„¤ì •í•´ì„œ ì¶œë ¥ëœ ê²ƒì´ë‹¤. <br><br> ì¿¼ë¦¬ ì§€ì—°ì´ ë°œìƒí•˜ëŠ” ë¡œê·¸ ì •ë³´ë¼ë©´ ì•ì— ì„¤ì •ì—ì„œëŠ” Query_timeì´ ì ì–´ë„ 10ì´ˆ ì´ìƒì´ì–´ì•¼ í•œë‹¤. ì´ë²ˆ ì¶œë ¥ì—ì„œëŠ” Query_time: 0.000792ì´ë¯€ë¡œ ì „í˜€ ë¬¸ì œê°€ ë˜ì§€ ì•ŠëŠ”ë‹¤. Query_timeì€ CPU ì²˜ë¦¬ ì‹œê°„ì´ ì•„ë‹ˆë¼ ì‹¤ì œë¡œ ì‘ë‹µí•  ë•Œê¹Œì§€ ê±¸ë¦¬ëŠ” ì‹œê°„ì´ë¯€ë¡œ, ì—¬ê¸°ì— ì¶œë ¥ëœ ì‹œê°„ì€ ì‚¬ìš©ìì—ê²Œ ì‘ë‹µí•œ ì‹œê°„ê³¼ ê°™ë‹¤. ì´ ê°’ì´ í¬ë‹¤ë©´ ë¡œê·¸ ì •ë³´ì—ì„œ ì‹¤í–‰í•œ SQLì„ ë¶„ì„í•´ì„œ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì§€ì—°ì´ ë°œìƒí•œ ê³³ì„ í™•ì •í•  ìˆ˜ ìˆê³  ì‘ë‹µ ì‹œê°„ì„ ê°œì„ ì‹œí‚¬ ìˆ˜ ìˆë‹¤.

<br>

<big> **â–  ë°”ì´ë„ˆë¦¬ ë¡œê·¸** </big> <br>

ë°”ì´ë„ˆë¦¬ ë¡œê·¸ëŠ” ë°”ì´ë„ˆë¦¬(ë°±ì—…) ë¡œê¹…ì´ë¼ê³ ë„ í•˜ë©°, mysqldì—ì„œ ë°ì´í„° ê°±ì‹ ì„ ì¼ìœ¼í‚¤ëŠ” ë¬¸ì¥(Statement)ì„ ë°”ì´ë„ˆë¦¬ ì •ë³´ë¡œ ë¡œê¹…í•˜ë©° ë¦¬í”Œë¦¬ì¼€ì´ì…˜ì—ë„ ì‚¬ìš©ëœë‹¤.


<br>

<small> **â–¶ ë°”ì´ë„ˆë¦¬ ë¡œê·¸ ì„¤ì •** </small> <br>

```bash
# https://dev.mysql.com/doc/refman/5.7/en/replication-options-binary-log.html
$ cat <<EOF >> /etc/my.cnf

# Slow Query log
log_bin=/var/log/mariadb/bin.log
log_bin_index=/var/log/mariadb/bin.list
max_binlog_size=1M
expire_logs_days=1
EOF


# mysqld ë‹¤ì‹œì‹œì‘
$ systemctl restart mysqld
```

| ì˜µì…˜ | ë‚´ìš© |
| :-----: | :------- |
| log_bin | ë°”ì´ë„ˆë¦¬ ë¡œê·¸ì˜ ì¶œë ¥ ì—¬ë¶€ë¥¼ ì„¤ì •, ë¡œê·¸ íŒŒì¼ëª…ì„ ì§€ì •í•˜ë©´ ì¶œë ¥ì´ í™œì„±í™”ë¨ |
| log_bin_index | ë°”ì´ë„ˆë¦¬ ë¡œê·¸ì˜ ì¸ë±ìŠ¤ íŒŒì¼ëª…ì„ ì„¤ì •, ë°”ì´ë„ˆë¦¬ ë¡œê·¸ íŒŒì¼ëª…ì„ ê´€ë¦¬í•˜ê¸° ìœ„í•œ íŒŒì¼ëª… |
| max_binlog_size | ë°”ì´ë„ˆë¦¬ ë¡œê·¸ì˜ ìµœëŒ€ íŒŒì¼ í¬ê¸°ë¥¼ ì§€ì •, ì§€ì •í•œ íŒŒì¼ í¬ê¸°ë¥¼ ì´ˆê³¼í•˜ë©´ íŒŒì¼ì„ ìë™ìœ¼ë¡œ ë³€ê²½í•˜ë©° ì„¤ì • ê°€ëŠ¥í•œ ê°’ì€ 4096B ì´ìƒ 1GB ì´í•˜ì´ë‹¤.|
| expire_logs_days | ë°”ì´ë„ˆë¦¬ ë¡œê·¸ì˜ ì €ì¥ ê¸°ê°„ì„ ì¼ìˆ˜ë¡œ ì§€ì •, ì¼ìˆ˜ë¥¼ ì´ˆê³¼í•˜ë©´ ì œê±° (ê¸°ë³¸ê°’ 0, 0: ì œê±°í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ì˜ë¯¸) |

<br>

<small> **â–¶ ë°”ì´ë„ˆë¦¬ ë¡œê·¸ í™•ì¸** </small> <br>

+ ë°”ì´ë„ˆë¦¬ ë¡œê·¸(/var/log/mariadb/bin.000001)ëŠ” ì´ë¦„ ê·¸ëŒ€ë¡œ ë°”ì´ë„ˆë¦¬ ì •ë³´ì´ë¯€ë¡œ, mysqlbinlog ëª…ë ¹ì„ í†µí•´ì„œ ë¡œê¹…ë˜ì–´ ìˆëŠ” ë‚´ìš©ì„ í™•ì¸í•œë‹¤. (mysqlbinlog ëª…ë ¹ì€ ë°”ì´ë„ˆë¦¬ ë¡œê·¸ë¥¼ í…ìŠ¤íŠ¸(ì¿¼ë¦¬ ë¡œê·¸)ë¡œ ë³€í™˜í•˜ëŠ” ìœ í‹¸ë¦¬í‹°)

```bash
$ mysqlbinlog /var/log/mariadb/bin.000001
```

```bash
MariaDB [SAMPLEDB]> INSERT INTO SAMPLETABLE (NAME) VALUES("SAKURA");
Query OK, 1 row affected (0.002 sec)

MariaDB [SAMPLEDB]> SELECT * FROM SAMPLETABLE;
+--------+
| NAME   |
+--------+
| TARO   |
| JIRO   |
| TOTO   |
| SAKURA |
+--------+
4 rows in set (0.001 sec)
```

+ "at 256"ì˜ 256ì´ ë¡¤ë°±ì—ì„œ ì‚¬ìš©í•  í¬ì§€ì…˜ ë²ˆí˜¸

```bash
$ mysqlbinlog /var/log/mariadb/bin.000001
/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=1*/;
/*!40019 SET @@session.max_insert_delayed_threads=0*/;
/*!50003 SET @OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0*/;
DELIMITER /*!*/;
# at 4
#230728  0:47:57 server id 1  end_log_pos 256 CRC32 0xefadb4d1  Start: binlog v 4, server v 10.5.16-MariaDB-log created 230728  0:47:57 at startup
# Warning: this binlog is either in use or was not closed properly.
ROLLBACK/*!*/;
BINLOG '
rZHCZA8BAAAA/AAAAAABAAABAAQAMTAuNS4xNi1NYXJpYURCLWxvZwAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAACtkcJkEzgNAAgAEgAEBAQEEgAA5AAEGggAAAAICAgCAAAACgoKAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAEEwQADQgICAoKCgHRtK3v
'/*!*/;
# at 256
#230728  0:47:57 server id 1  end_log_pos 285 CRC32 0xcfef43a4  Gtid list []
# at 285
#230728  0:47:57 server id 1  end_log_pos 322 CRC32 0xdc0aa6b7  Binlog checkpoint bin.000001
# at 322
#230728  0:53:44 server id 1  end_log_pos 364 CRC32 0xf2c32d83  GTID 0-1-1 trans
/*!100101 SET @@session.skip_parallel_replication=0*//*!*/;
/*!100001 SET @@session.gtid_domain_id=0*//*!*/;
/*!100001 SET @@session.server_id=1*//*!*/;
/*!100001 SET @@session.gtid_seq_no=1*//*!*/;
START TRANSACTION
/*!*/;
# at 364
#230728  0:53:44 server id 1  end_log_pos 482 CRC32 0x332ec7ab  Query   thread_id=4     exec_time=0     error_code=0
use `SAMPLEDB`/*!*/;
SET TIMESTAMP=1690473224/*!*/;
SET @@session.pseudo_thread_id=4/*!*/;
SET @@session.foreign_key_checks=1, @@session.sql_auto_is_null=0, @@session.unique_checks=1, @@session.autocommit=1, @@session.check_constraint_checks=1, @@session.sql_if_exists=0/*!*/;
SET @@session.sql_mode=1411383296/*!*/;
SET @@session.auto_increment_increment=1, @@session.auto_increment_offset=1/*!*/;
/*!\C utf8 *//*!*/;
SET @@session.character_set_client=33,@@session.collation_connection=33,@@session.collation_server=8/*!*/;
SET @@session.lc_time_names=0/*!*/;
SET @@session.collation_database=DEFAULT/*!*/;
INSERT INTO SAMPLETABLE (NAME) VALUES("SAKURA")
/*!*/;
# at 482
#230728  0:53:44 server id 1  end_log_pos 513 CRC32 0x9e60ac9c  Xid = 5
COMMIT/*!*/;
DELIMITER ;
# End of log file
ROLLBACK /* added by mysqlbinlog */;
/*!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE*/;
/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0*/;
```

<br>

<small> **â–¶ ë°”ì´ë„ˆë¦¬ ë¡œê·¸ë¥¼ ì´ìš©í•´ ë¡¤ë°±** </small> <br>

+ í’€ ë°±ì—… + ë°”ì´ë„ˆë¦¬ ë¡œê·¸ê°€ ìˆìœ¼ë©´ í’€ ë°±ì—…ì„ ìˆ˜í–‰í•œ ì‹œì ë¶€í„° ë°”ì´ë„ˆë¦¬ ë¡œê·¸ê°€ ì¡´ì¬í•˜ëŠ” ë²”ìœ„ ë‚´ì—ì„œ ì›í•˜ëŠ” ìƒíƒœê¹Œì§€ ë¡¤ë°±í•  ìˆ˜ ìˆë‹¤.

+ "mysqldump ëª…ë ¹"ì€ SQL í˜•ì‹ìœ¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë°±ì—…í•˜ëŠ” ëª…ë ¹ìœ¼ë¡œ ëª…ë ¹ ìì²´ëŠ” ì½˜ì†” SQL ë¬¸ì„ ì¶œë ¥í•˜ë¯€ë¡œ > ë¦¬ë‹¤ì´ë ‰íŠ¸ë¥¼ ì‚¬ìš©í•´ì„œ íŒŒì¼ë¡œ ì €ì¥í•œë‹¤.

```bash
# (1) mysqldump ëª…ë ¹ì„ ì´ìš©í•´ í’€ ë°±ì—…
$ mysqldump -u root --all-databases > /var/log/mariadb/all_backup.sql


# (2) í’€ ë°±ì—… ìƒíƒœ í™•ì¸
$ mysql -u root -e "show master status;"
+------------+----------+--------------+------------------+
| File       | Position | Binlog_Do_DB | Binlog_Ignore_DB |
+------------+----------+--------------+------------------+
| bin.000001 |      513 |              |                  |
+------------+----------+--------------+------------------+


# (3) ë°”ì´ë„ˆë¦¬ ë¡œê·¸ë¥¼ ê°±ì‹ 
MariaDB [SAMPLEDB]> INSERT INTO SAMPLETABLE (NAME) VALUES("rollback1");
Query OK, 1 row affected (0.001 sec)

MariaDB [SAMPLEDB]> INSERT INTO SAMPLETABLE (NAME) VALUES("rollback2");
Query OK, 1 row affected (0.001 sec)

MariaDB [SAMPLEDB]> INSERT INTO SAMPLETABLE (NAME) VALUES("rollback3");
Query OK, 1 row affected (0.001 sec)

MariaDB [SAMPLEDB]> INSERT INTO SAMPLETABLE (NAME) VALUES("rollback4");
Query OK, 1 row affected (0.001 sec)

MariaDB [SAMPLEDB]> SELECT * FROM SAMPLETABLE;
+-----------+
| NAME      |
+-----------+
| TARO      |
| JIRO      |
| TOTO      |
| SAKURA    |
| rollback1 |
| rollback2 |
| rollback3 |
| rollback4 |
+-----------+
8 rows in set (0.000 sec)


# (4) ë¡¤ ë°± ìˆ˜í–‰

# ëª¨ë“  ë°”ì´ë„ˆë¦¬ ë¡œê·¸ íŒŒì¼ì„ ë³µì‚¬(ë°±ì—…)
$ mkdir /var/log/mariadb/rollback
$ cp /var/log/mariadb/bin* /var/log/mariadb/rollback/

# rollback2 ì‚½ì… ìœ„ì¹˜ ê²€ìƒ‰
$ mysqldump /var/log/mariadb/rollback/bin.000001 
```