---
title:  "[Retry, k8s] 03. ì›Œí¬ë¡œë“œ API - ë ˆí”Œë¦¬ì¹´ì…‹/ë ˆí”Œë¦¬ì¼€ì´ì…˜ ì»¨íŠ¸ë¡¤ëŸ¬" 

categories:
  - KUBERNETES
tags:
  - [kubernetes]

toc: true
toc_sticky: true

date: 2023-09-22
last_modified_at: 2023-09-22
---
# [Retry, k8s] 03. ì›Œí¬ë¡œë“œ API - ë ˆí”Œë¦¬ì¹´ì…‹/ë ˆí”Œë¦¬ì¼€ì´ì…˜ ì»¨íŠ¸ë¡¤ëŸ¬
---

<style>
table {
    font-size: 12pt;
}
table th:first-of-type {
    width: 5%;
}
table th:nth-of-type(2) {
    width: 15%;
}
table th:nth-of-type(3) {
    width: 50%;
}
table th:nth-of-type(4) {
    width: 30%;
}
</style>

<br>

## ğŸ”” ë ˆí”Œë¦¬ì¹´ì…‹/ë ˆí”Œë¦¬ì¼€ì´ì…˜ ì»¨íŠ¸ë¡¤ëŸ¬

> ë ˆí”Œë¦¬ì¹´ì…‹/ë ˆí”Œë¦¬ì¼€ì´ì…˜ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” **íŒŒë“œì˜ ë ˆí”„ë¦¬ì¹´ë¥¼ ìƒì„±í•˜ê³  ì§€ì •í•œ íŒŒë“œ ìˆ˜ë¥¼ ìœ ì§€í•˜ëŠ” ë¦¬ì†ŒìŠ¤**ì´ë‹¤. (ë ˆí”Œë¦¬ì¹´ì…‹ì´ ìƒì„±í•˜ëŠ” íŒŒë“œëŠ” "ë ˆí”Œë¦¬ì¹´ì…‹ ì´ë¦„-ì„ì˜ì˜ ë¬¸ìì—´"ìœ¼ë¡œ ëª…ëª…ëœë‹¤.)

<br>

### ğŸ“œ ë ˆí”Œë¦¬ì¹´ì…‹ ìƒì„±

```bash
cat <<EOF > sample-rs.yaml
apiVersion: apps/v1
kind: ReplicaSet
metadata:
  name: sample-rs
spec:
  replicas: 3
  selector:
    matchLabels:
      app: sample-app
  template:
    metadata:
      labels:
        app: sample-app
    spec:
      containers:
        - name: nginx-container
          image: nginx:1.16
EOF
```

```bash
# ë¦¬í”Œë¦¬ì¹´ì…‹ í™•ì¸
$ kubectl get replicasets -o wide
NAME        DESIRED   CURRENT   READY   AGE   CONTAINERS        IMAGES       SELECTOR
sample-rs   3         3         3       17s   nginx-container   nginx:1.16   app=sample-app

# ë ˆí”Œë¦¬ì¹´ì…‹ì´ íŒŒë“œ ê´€ë¦¬ì— ì‚¬ìš©í•˜ëŠ” ë ˆì´ë¸”ì„ ì§€ì •í•˜ì—¬ íŒŒë“œ ëª©ë¡ í‘œì‹œ
$ kubectl get pod -l app=sample-app -o wide
NAME              READY   STATUS    RESTARTS   AGE     IP          NODE         NOMINATED NODE   READINESS GATES
sample-rs-24rgb   1/1     Running   0          3m10s   10.44.0.3   k8s-node01   <none>           <none>
sample-rs-lkqk5   1/1     Running   0          3m10s   10.44.0.2   k8s-node01   <none>           <none>
sample-rs-slw6w   1/1     Running   0          3m10s   10.36.0.3   k8s-node02   <none>           <none>
```

<br>

### ğŸ“œ íŒŒë“œ ì •ì§€ì™€ ìë™í™”ëœ ë³µêµ¬

> ë ˆí”Œë¦¬ì¹´ì…‹ì—ì„œëŠ” ë…¸ë“œë‚˜ íŒŒë“œì— ì¥ì• ê°€ ë°œìƒí–ˆì„ ë•Œ ì§€ì •í•œ íŒŒë“œ ìˆ˜ë¥¼ ìœ ì§€í•˜ê¸° ìœ„í•´ ë‹¤ë¥¸ ë…¸ë“œì—ì„œ íŒŒë“œë¥¼ ê¸°ë™ì‹œì¼œ ì£¼ê¸° ë•Œë¬¸ì— ì¥ì•  ì‹œì—ë„ ë§ì€ ì˜í–¥ì„ ë°›ì§€ ì•ŠëŠ”ë‹¤.

```bash
$ kubectl get pod -o wide
NAME              READY   STATUS    RESTARTS   AGE   IP          NODE         NOMINATED NODE   READINESS GATES
sample-rs-7bsjk   1/1     Running   0          15s   10.44.0.2   k8s-node01   <none>           <none>
sample-rs-8nc9h   1/1     Running   0          15s   10.36.0.1   k8s-node02   <none>           <none>
sample-rs-wrtm5   1/1     Running   0          15s   10.44.0.1   k8s-node01   <none>           <none>

# ë ˆí”Œë¦¬ì¹´ì…‹ì— ì˜í•´ ê´€ë¦¬ë˜ëŠ” íŒŒë“œë“¤ ëª¨ë‘ ì‚­ì œ
$ kubectl delete pod --all
pod "sample-rs-7bsjk" deleted
pod "sample-rs-8nc9h" deleted
pod "sample-rs-wrtm5" deleted

# ë‹¤ì‹œ ìƒì„±ëœ ê²ƒì„ í™•ì¸
$ kubectl get pod -o wide
NAME              READY   STATUS    RESTARTS   AGE   IP          NODE         NOMINATED NODE   READINESS GATES
sample-rs-5cj4p   1/1     Running   0          3s    10.36.0.2   k8s-node02   <none>           <none>
sample-rs-jwf5z   1/1     Running   0          3s    10.44.0.1   k8s-node01   <none>           <none>
sample-rs-qm8k7   1/1     Running   0          3s    10.36.0.1   k8s-node02   <none>           <none>

# ë ˆí”Œë¦¬ì¹´ì…‹ ìƒì„¸ ì •ë³´, ë ˆí”Œë¦¬ì¹´ì…‹ì˜ íŒŒë“œ ìˆ˜ ì¦ê° ì´ë ¥ í™•ì¸í•  ìˆ˜ ìˆìŒ
$ kubectl describe replicaset sample-rs
Name:         sample-rs
Namespace:    default
Selector:     app=sample-app
Labels:       <none>
Annotations:  <none>
Replicas:     3 current / 3 desired
Pods Status:  3 Running / 0 Waiting / 0 Succeeded / 0 Failed
Pod Template:
  Labels:  app=sample-app
  Containers:

<~ ìƒëµ ~>
```

<br>

### ğŸ“œ ë ˆí”Œë¦¬ì¹´ì…‹ê³¼ ë ˆì´ë¸”

> ë ˆí”Œë¦¬ì¹´ì…‹ì€ íŒŒë“œë¥¼ ëª¨ë‹ˆí„°ë§í•˜ì—¬ íŒŒë“œ ìˆ˜ë¥¼ ì¡°ì •í•˜ëŠ”ë°, ëª¨ë‹ˆí„°ë§ì€ íŠ¹ì • ë ˆì´ë¸”ì„ ê°€ì§„ íŒŒë“œ ìˆ˜ë¥¼ ê³„ì‚°í•˜ëŠ” í˜•íƒœë¡œ ì´ë£¨ì–´ ì§„ë‹¤. (ë ˆí”Œë¦¬ì¹´ ìˆ˜ê°€ ë¶€ì¡±í•œ/ë§ì€ ê²½ìš° ë§¤ë‹ˆí˜ìŠ¤íŠ¸ì— ê¸°ìˆ í•œ spec.templateë¡œ íŒŒë“œë¥¼ ìƒì„±/ì‚­ì œí•œë‹¤.)

```bash
# ë ˆí”Œë¦¬ì¹´ì…‹ì˜ ì…€ë ‰í„°ì™€ íŒŒë“œì˜ ë ˆì´ë¸”ì´ ì¼ì¹˜í•˜ì§€ ì•Šì„ ê²½ìš°, ì—ëŸ¬ê°€ ë°œìƒí•˜ì—¬ ìƒì„±í•  ìˆ˜ ì—†ê²Œë¨
cat <<EOF > sample-rs-fail.yaml
apiVersion: apps/v1
kind: ReplicaSet
metadata:
  name: sample-rs-fail
spec:
  replicas: 3
  selector:
    matchLabels:
      app: sample-app
  template:
    metadata:
      labels:
        app: sample-app-fail
    spec:
      containers:
        - name: nginx-container
          image: nginx:1.16
EOF

$ kubectl apply -f sample-rs-fail.yaml
The ReplicaSet "sample-rs-fail" is invalid: spec.template.metadata.labels: Invalid value: map[string]string{"app":"sample-app-fail"}: `selector` does not match template `labels`
```

```bash
# ë ˆí”Œë¦¬ì¹´ì…‹ì˜ ì…€ë ‰í„°ì™€ ì¼ì¹˜í•˜ëŠ” ë ˆì´ë¸”ì„ ê°€ì§„ íŒŒë“œë¥¼ ë”°ë¡œ ìƒì„±í–ˆì„ ê²½ìš°, ì´ˆê³¼ëœ ë ˆí”Œë¦¬ì¹´ ìˆ˜ë¥¼ ê°ì§€í•˜ì—¬ ì‚­ì œí•œë‹¤.
cat <<EOF > cat sample-rs-pod.yaml
apiVersion: v1
kind: Pod
metadata:
  name: sample-rs-pod
  labels:
    app: sample-app
spec:
  containers:
    - name: nginx-container
      image: nginx:1.16
EOF

$ kubectl apply -f sample-rs.yaml

$ kubectl apply -f sample-rs-pod.yaml

$ kubectl get pods -L app
NAME              READY   STATUS        RESTARTS   AGE   APP
sample-rs-5cj4p   1/1     Running       0          19m   sample-app
sample-rs-jwf5z   1/1     Running       0          19m   sample-app
sample-rs-pod     1/1     Terminating   0          2s    sample-app
sample-rs-qm8k7   1/1     Running       0          19m   sample-app
```

<br>

### ğŸ“œ ë ˆí”Œë¦¬ì¹´ì…‹ê³¼ ìŠ¤ì¼€ì¼ë§

#### (a) ìˆ˜ì •í•œ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ë¡œ kubectl apply ëª…ë ¹ì„ ìˆ˜í–‰

```bash
$ sed -i -e 's|replicas: 3|replicas: 4|' sample-rs.yaml

$ kubectl apply -f sample-rs.yaml
replicaset.apps/sample-rs configured

$ kubectl get replicasets
NAME        DESIRED   CURRENT   READY   AGE
sample-rs   4         4         4       32m
```

#### (b) kubectl scale ëª…ë ¹ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš°

```bash
$ kubectl scale replicaset sample-rs --replicas 5
replicaset.apps/sample-rs scaled

$ kubectl get replicasets
NAME        DESIRED   CURRENT   READY   AGE
sample-rs   5         5         5       34m
```

<br>