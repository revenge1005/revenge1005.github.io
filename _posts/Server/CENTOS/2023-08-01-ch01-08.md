---
title:  "[CentOS] 08. DNS ì„œë²„ êµ¬ì„±" 

categories:
  - CENTOS
tags:
  - [centos, linux]

toc: true
toc_sticky: true

date: 2023-05-23
last_modified_at: 2023-10-23
---
<br>

# ğŸ”” í™˜ê²½ì„¤ì • íŒŒì¼ (Bind)
---

<style>
table {
    font-size: 12pt;
}
table th:first-of-type {
    width: 5%;
}
table th:nth-of-type(2) {
    width: 15%;
}
table th:nth-of-type(3) {
    width: 50%;
}
table th:nth-of-type(4) {
    width: 30%;
}
big {
    font-size: 15pt;
}
</style>

<br>

<big> **â–  í™˜ê²½ì„¤ì • íŒŒì¼** </big>

| íŒ¨í‚¤ì§€ëª… | ì„¤ëª… |
| :---: | --- |
| bind | BIND ë°ëª¬ì˜ ê¸°ë³¸ íŒ¨í‚¤ì§€ |
| bind-utils | BIND ë°ëª¬ ìš´ì˜ì— ê´€ë ¨ëœ ë³´ì¡° ìœ í‹¸ë¦¬í‹° |
| bind-libs | BIND ë°ëª¬ì—ì„œ ì‚¬ìš©ë˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ |
| bind-chroot | BIND ë°ëª¬ì˜ ë³´ì•ˆ í–¥ìƒì„ ìœ„í•´ ì‚¬ìš©ë˜ëŠ” íŒ¨í‚¤ì§€ |
| caching-nameserver | BIND ë°ëª¬ì˜ í™˜ê²½ ì„¤ì •ì„ ìœ„í•œ íŒ¨í‚¤ì§€ (í˜„ì¬ BINDì— í†µí•©ë˜ì–´ ì„¤ì¹˜ë¨) |

<br>

<big> **â–  í™˜ê²½ì„¤ì • íŒŒì¼** </big>

| íŒŒì¼ëª… | ì„¤ëª… |
| :---: | --- |
| /etc/named.conf | BIND ë°ëª¬ì˜ ë™ì‘ì— ê´€ë ¨ëœ ì„¤ì • íŒŒì¼ |
| /etc/named.rfc1912.zones | ë„¤ì„ ì„œë²„ê°€ í•´ì„ì„ ì§€ì›í•  ìˆ˜ ìˆëŠ” zoneì„ ë“±ë¡í•˜ëŠ” íŒŒì¼ |
| /var/named/ì •ë°©í–¥ zoneíŒŒì¼ | íŠ¹ì • zoneì— ëŒ€í•œ ì •ë°©í–¥ í•´ì„ì„ ìœ„í•œ ë¦¬ì†ŒìŠ¤ ë ˆì½”ë“œê°€ ì„¤ì •ëœ Zone Database íŒŒì¼ |
| /var/named/ì—­ë°©í–¥ zone íŒŒì¼ | íŠ¹ì • zoneì— ëŒ€í•œ ì—­ë°©í–¥ í•´ì„ì„ ìœ„í•œ ë¦¬ì†ŒìŠ¤ ë ˆì½”ë“œê°€ ì„¤ì •ëœ Zone Database íŒŒì¼ -> ì„¤ì •ëœ ë¦¬ì†ŒìŠ¤ ë ˆì½”ë“œë¥¼ ê¸°ë°˜ìœ¼ë¡œ in-addr.arpa ë„ë©”ì¸ì„ êµ¬ì„± í•¨ |
| /var/named/named.ca | Root Hint ë™ì‘ì´ ìˆ˜í–‰ëœ ë•Œ ì°¸ì¡°í•˜ëŠ” Root DNSê°€ ë“±ë¡ëœ íŒŒì¼ |

<br>

# ğŸ”” BIND : ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ êµ¬ì„±
---

<br>

<big> **â–  bind ì„¤ì¹˜** </big>

```bash
$ dnf -y install bind*
```

<br>

<big> **â–  ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ì— ëŒ€í•œ ì„¤ì •** </big>

+ ë‹¤ìŒì€ ë¡œì»¬ ë„¤íŠ¸ì›Œí¬ê°€ [192.168.219.0/24]ì´ê³  ë„ë©”ì¸ ì´ë¦„ì´ [test.srv]ì¸ ê²½ìš°ì˜ ì˜ˆ

```bash
$ vi /etc/named.conf

...
...

# ë¡œì»¬ ë„¤íŠ¸ì›Œí¬ì— ëŒ€í•œ ACL í•­ëª© ì„¤ì •
acl internal-network {
        192.168.219.0/24;
};

options {
        # change ( listen all )
        listen-on port 53 { any; };
        # í•„ìš”í•œ ê²½ìš° ë³€ê²½(IPv6ë¥¼ ìˆ˜ì‹ í•˜ì§€ ì•Šì„ ê²½ìš° [none]ìœ¼ë¡œ ì„¤ì •)
        listen-on-v6 { any; };
        directory       "/var/named";
        dump-file       "/var/named/data/cache_dump.db";
        statistics-file "/var/named/data/named_stats.txt";
        memstatistics-file "/var/named/data/named_mem_stats.txt";
        secroots-file   "/var/named/data/named.secroots";
        recursing-file  "/var/named/data/named.recursing";
        # ìœ„ì˜ [ë¡œì»¬ ë„¤íŠ¸ì›Œí¬] ì„¹ì…˜ì— ë¡œì»¬ ë„¤íŠ¸ì›Œí¬ ì„¸íŠ¸ ì¶”ê°€
        # í˜¸ìŠ¤íŠ¸ì—ì„œ ì¿¼ë¦¬ë¥¼ ìˆ˜ì‹ í•  ìˆ˜ ìˆëŠ” ë„¤íŠ¸ì›Œí¬ ë²”ìœ„
        allow-query     { localhost; internal-network; };
        # zone íŒŒì¼ì„ í´ë¼ì´ì–¸íŠ¸ë¡œ ì „ì†¡í•  ìˆ˜ ìˆëŠ” ë„¤íŠ¸ì›Œí¬ ë²”ìœ„
        # secondary DNS ì„œë²„ê°€ ìˆëŠ” ê²½ìš° ì¶”ê°€
        allow-transfer  { localhost; };

        .....
        .....

        recursion yes;

        dnssec-enable yes;
        dnssec-validation yes;

        managed-keys-directory "/var/named/dynamic";

        pid-file "/run/named/named.pid";
        session-keyfile "/run/named/session.key";

        /* https://fedoraproject.org/wiki/Changes/CryptoPolicy */
        include "/etc/crypto-policies/back-ends/bind.config";
};

logging {
        channel default_debug {
                file "data/named.run";
                severity dynamic;
        };
};

zone "." IN {
        type hint;
        file "named.ca";
};

include "/etc/named.rfc1912.zones";
include "/etc/named.root.key";



$ vim /etc/named.rfc1912.zones

# ë„¤íŠ¸ì›Œí¬ ë° ë„ë©”ì¸ ì´ë¦„ì— ëŒ€í•œ Zone ì¶”ê°€
zone "test.srv" IN {
        type master;
        file "test.srv.lan";
        allow-update { none; };
};
zone "219.168.192.in-addr.arpa" IN {
        type master;
        file "219.168.192.db";
        allow-update { none; };
};
```

<br>

<big> **â–  Zone íŒŒì¼ êµ¬ì„±** </big>

+ ì„œë²„ê°€ ë„ë©”ì¸ ì´ë¦„ì—ì„œ IP ì£¼ì†Œë¥¼ í™•ì¸í•˜ëŠ” Zone íŒŒì¼ ì‘ì„±

```bash
$ vi /var/named/test.srv.lan

$TTL 86400
@   IN  SOA     dlp.test.srv. root.test.srv. (
        # ì¼ë ¨ ë²ˆí˜¸ì— ëŒ€í•´ì„œëŠ” ì•„ë¬´ ìˆ«ì ê°’ë„ ê´œì°®ì§€ë§Œ
        # ê¶Œì¥ ì‚¬í•­ì€ [YYYYMMDDnn](ì—…ë°ì´íŠ¸ ë‚ ì§œ + ë²ˆí˜¸)
        2022081001  ;Serial
        3600        ;Refresh
        1800        ;Retry
        604800      ;Expire
        86400       ;Minimum TTL
)
        # ë„¤ì„ ì„œë²„ ì •ì˜
        IN  NS      dlp.test.srv.
        # ë„¤ì„ ì„œë²„ì˜ IP ì£¼ì†Œ ì •ì˜
        IN  A       192.168.219.101
        # ë©”ì¼ êµí™˜ê¸° ì„œë²„ ì •ì˜
        IN  MX 10   dlp.test.srv.

# í˜¸ìŠ¤íŠ¸ ì´ë¦„ì˜ ê° IP ì£¼ì†Œ ì •ì˜
dlp     IN  A       192.168.219.101
www     IN  A       192.168.219.102
```

+ ì„œë²„ê°€ IP ì£¼ì†Œì—ì„œ ë„ë©”ì¸ ì´ë¦„ì„ í™•ì¸í•˜ëŠ” Zone íŒŒì¼ì„ ì‘ì„±

```bash
$ vi /var/named/219.168.192.db

$TTL 86400
@   IN  SOA     dlp.test.srv. root.test.srv. (
        2022081001  ;Serial
        3600        ;Refresh
        1800        ;Retry
        604800      ;Expire
        86400       ;Minimum TTL
)
        # ë„¤ì„ ì„œë²„ ì •ì˜
        IN  NS      dlp.test.srv.

# IP ì£¼ì†Œì˜ ê° í˜¸ìŠ¤íŠ¸ ì´ë¦„ ì •ì˜
101     IN  PTR     dlp.test.srv.
102     IN  PTR     www.test.srv.
```

<br>

<big> **â–  Start and Enable BIND.** </big>

```bash
$ systemctl enable --now named
```

<br>

<big> **â–  ë°©í™”ë²½ì´ ì‹¤í–‰ ì¤‘ì¸ ê²½ìš° Samba ì„œë¹„ìŠ¤ë¥¼ í—ˆìš©** </big>

```bash
$ firewall-cmd --add-service=dns
success

$ firewall-cmd --runtime-to-permanent
success
```

<br>

<big> **â–  í™•ì¸** </big>

```bash
# í•„ìš”í•œ ê²½ìš° ìì‹ ì˜ DNSë¥¼ ì°¸ì¡°í•˜ë„ë¡ DNS ì„¤ì •ì„ ë³€ê²½
$ nmcli connection modify ens160 ipv4.dns 192.168.219.101
$ nmcli connection down ens160; nmcli connection up ens160


$ dig dlp.test.srv

; <<>> DiG 9.16.23-RH <<>> dlp.test.srv
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 38942
;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1232
; COOKIE: 7b049a9250cd969e01000000643e434874e1d34106deb514 (good)
;; QUESTION SECTION:
;dlp.test.srv.                  IN      A

;; ANSWER SECTION:
dlp.test.srv.           86400   IN      A       192.168.219.101

;; Query time: 0 msec
;; SERVER: 192.168.219.101#53(192.168.219.101)
;; WHEN: Tue Apr 18 16:14:16 KST 2023
;; MSG SIZE  rcvd: 85


$ dig -x 192.168.219.101

; <<>> DiG 9.16.23-RH <<>> -x 192.168.219.101
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 48419
;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1232
; COOKIE: 1d8fff54d229d88401000000643e43596945866c743b16bd (good)
;; QUESTION SECTION:
;101.219.168.192.in-addr.arpa.  IN      PTR

;; ANSWER SECTION:
101.219.168.192.in-addr.arpa. 86400 IN  PTR     dlp.test.srv.

;; Query time: 0 msec
;; SERVER: 192.168.219.101#53(192.168.219.101)
;; WHEN: Tue Apr 18 16:14:33 KST 2023
;; MSG SIZE  rcvd: 111
```

<br>

# ğŸ”” BIND : ì™¸ë¶€ ë„¤íŠ¸ì›Œí¬ êµ¬ì„±
---

+ ì´í›„ ì„¤ì •ì€ ìœ„ ì˜ˆì œì™€ ê°™ë‹¤.

```bash
$ vi /etc/named.conf
.....
.....
options {
        # change ( listen all )
        listen-on port 53 { any; };
        # í•„ìš”í•œ ê²½ìš° ë³€ê²½(IPv6ë¥¼ ìˆ˜ì‹ í•˜ì§€ ì•Šì„ ê²½ìš° [none]ìœ¼ë¡œ ì„¤ì •)
        listen-on-v6 { any; };
        directory       "/var/named";
        dump-file       "/var/named/data/cache_dump.db";
        statistics-file "/var/named/data/named_stats.txt";
        memstatistics-file "/var/named/data/named_mem_stats.txt";
        secroots-file   "/var/named/data/named.secroots";
        recursing-file  "/var/named/data/named.recursing";
        # ë³€ê²½ : ëª¨ë“  í˜¸ìŠ¤íŠ¸ì—ì„œ ì¿¼ë¦¬ë¥¼ ìˆ˜ì‹ 
        allow-query     { any; };
        # Zone íŒŒì¼ì„ í´ë¼ì´ì–¸íŠ¸ë¡œ ì „ì†¡í•  ìˆ˜ ìˆëŠ” ë„¤íŠ¸ì›Œí¬ ë²”ìœ„
        # ë³´ì¡° DNS ì„œë²„ê°€ ìˆëŠ” ê²½ìš° ì¶”ê°€
        allow-transfer  { localhost; };

        .....
        .....

        # ë³€ê²½ : ì¬ê·€ ì¿¼ë¦¬ë¥¼ í—ˆìš©í•˜ì§€ ì•ŠìŒ
        # ì´ ì„œë²„ì—ë§Œ í•´ë‹¹ í•­ëª©ì´ ìˆëŠ” ì˜ì—­ì— ëŒ€í•œ ë‹µë³€
        recursion no;

        dnssec-enable yes;
        dnssec-validation yes;

        managed-keys-directory "/var/named/dynamic";

        pid-file "/run/named/named.pid";
        session-keyfile "/run/named/session.key";

        /* https://fedoraproject.org/wiki/Changes/CryptoPolicy */
        include "/etc/crypto-policies/back-ends/bind.config";
};

logging {
        channel default_debug {
                file "data/named.run";
                severity dynamic;
        };
};

zone "." IN {
        type hint;
        file "named.ca";
};

include "/etc/named.rfc1912.zones";
include "/etc/named.root.key";
```

<br>

# ğŸ”” DNS - View Statement
---

> íŠ¹ì • ì‚¬ìš©ì ë˜ëŠ” ê·¸ë£¹ì—ê²Œë§Œ íŠ¹ì •í•œ DNS ì •ë³´ë¥¼ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ìœ¼ë¡œ, ì˜ˆë¥¼ ë“¤ì–´, íšŒì‚¬ ë‚´ë¶€ì—ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥í•œ ë„ë©”ì¸ ì´ë¦„ì´ ìˆëŠ” ê²½ìš°, íšŒì‚¬ ë‚´ë¶€ IP ì£¼ì†Œ ë²”ìœ„ë¥¼ ê¸°ë°˜ìœ¼ë¡œ View Statementë¥¼ ì„¤ì •í•˜ì—¬ ë‚´ë¶€ ì‚¬ìš©ìì—ê²Œë§Œ í•´ë‹¹ ë„ë©”ì¸ ì´ë¦„ì„ ì œê³µí•  ìˆ˜ ìˆë‹¤.


```bash
$ vi /etc/named.conf
.....
.....
# ì¶”ê°€ - ë¡œì»¬ ë„¤íŠ¸ì›Œí¬ì— ëŒ€í•œ ACL í•­ëª© ì„¤ì •
acl internal-network {
        10.0.0.0/24;
};

options {
        # change ( listen all )
        listen-on port 53 { any; };
        # í•„ìš”í•œ ê²½ìš° ë³€ê²½(IPv6ë¥¼ ìˆ˜ì‹ í•˜ì§€ ì•Šì„ ê²½ìš° [none]ìœ¼ë¡œ ì„¤ì •
        listen-on-v6 { any; };
        directory       "/var/named";
        dump-file       "/var/named/data/cache_dump.db";
        statistics-file "/var/named/data/named_stats.txt";
        memstatistics-file "/var/named/data/named_mem_stats.txt";
        secroots-file   "/var/named/data/named.secroots";
        recursing-file  "/var/named/data/named.recursing";
        # ìœ„ì˜ [acl] ì„¹ì…˜ì— ì„¤ì •ëœ ë¡œì»¬ ë„¤íŠ¸ì›Œí¬ ì¶”ê°€
        # í˜¸ìŠ¤íŠ¸ì—ì„œ ì¿¼ë¦¬ë¥¼ ìˆ˜ì‹ í•  ìˆ˜ ìˆëŠ” ë„¤íŠ¸ì›Œí¬ ë²”ìœ„
        allow-query     { localhost; internal-network; };
        # Zone íŒŒì¼ì„ í´ë¼ì´ì–¸íŠ¸ì— ì „ì†¡í•  ìˆ˜ ìˆëŠ” ë„¤íŠ¸ì›Œí¬ ë²”ìœ„
        # ì¡´ì¬í•˜ëŠ” ê²½ìš° ë³´ì¡° DNS ì„œë²„ ì¶”ê°€
        allow-transfer  { localhost; };

        .....
        .....

        recursion yes;

        dnssec-enable yes;
        dnssec-validation yes;

        managed-keys-directory "/var/named/dynamic";

        pid-file "/run/named/named.pid";
        session-keyfile "/run/named/session.key";

        /* https://fedoraproject.org/wiki/Changes/CryptoPolicy */
        include "/etc/crypto-policies/back-ends/bind.config";
};

logging {
        channel default_debug {
                file "data/named.run";
                severity dynamic;
        };
};

# ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ ì˜ì—­ ì„¤ì •
view "internal" {
        match-clients {
                localhost;
                internal-network;
        };
        zone "." IN {
                type hint;
                file "named.ca";
        };
        zone "test.srv" IN {
                type master;
                file "test.srv.lan";
                allow-update { none; };
        };
        zone "219.168.192.in-addr.arpa" IN {
                type master;
                file "219.168.192.db";
                allow-update { none; };
        };
include "/etc/named.rfc1912.zones";
include "/etc/named.root.key";
};

# ì™¸ë¶€ ë„¤íŠ¸ì›Œí¬ ì˜ì—­ ì„¤ì •
view "external" {
        # ë‚´ë¶€ ì„¹ì…˜ì˜ [match-client]ì— ì •ì˜ëœ ëŒ€ìƒì„ ì œì™¸í•˜ê³  ëª¨ë‘ ì¼ì¹˜
        match-clients { any; };
        allow-query { any; };
        # ì¬ê·€ ì¿¼ë¦¬ë¥¼ í—ˆìš©í•˜ì§€ ì•ŠìŒ
        recursion no;
        zone "srv.world" IN {
                type master;
                file "srv.world.wan";
                allow-update { none; };
        };
        zone "80.0.16.172.in-addr.arpa" IN {
                type master;
                file "80.0.16.172.db";
                allow-update { none; };
        };
};
```