---
title:  "[Docker] 13. Docker Compose" 

categories:
  - DOCKER
tags:
  - [docker]

toc: true
toc_sticky: true

date: 2022-03-18
last_modified_at: 2022-03-18
---
# [Docker] 13. Docker Compose
---

<style>
table {
    font-size: 12pt;
}
table th:first-of-type {
    width: 5%;
}
table th:nth-of-type(2) {
    width: 15%;
}
table th:nth-of-type(3) {
    width: 50%;
}
table th:nth-of-type(4) {
    width: 30%;
}
</style>

<br>

## ğŸ”” Docker Compose ì´ë€?

> ì—¬ëŸ¬ ì»¨í…Œì´ë„ˆë¥¼ ëª¨ì•„ì„œ ê´€ë¦¬í•˜ê¸° ìœ„í•œ íˆ´ë¡œ, ã€Œdocker-compose.ymlã€ë¼ëŠ” íŒŒì¼ì— ì»¨í…Œì´ë„ˆì˜ êµ¬ì„± ì •ë³´ë¥¼ ì •ì˜í•¨ìœ¼ë¡œì¨ ë™ì¼ í˜¸ìŠ¤íŠ¸ìƒì˜ ì—¬ëŸ¬ ì»¨í…Œì´ë„ˆë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤. <br><br>
ì»¨í…Œì´ë„ˆì˜ êµ¬ì„± ì •ë³´ë¥¼ YAML í˜•ì‹ì˜ íŒŒì¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ì§€ì†ì  ë””í”Œë¡œì´ë‚˜ ì§€ì†ì  ì¸í‹°ê·¸ë ˆì´ì…˜ í”„ë¡œì„¸ìŠ¤ì— ìˆì–´ì„œ ìë™ í…ŒìŠ¤íŠ¸ë¥¼ í•  ë•Œì˜ í™˜ê²½ êµ¬ì¶•ì—ë„ ì´ìš© ê°€ëŠ¥í•˜ë‹¤.

<br>

## ğŸ”” Docker Compose ê°œìš”

> Compose ì •ì˜ íŒŒì¼ì—ëŠ” ê´€ë¦¬í•˜ê³  ì‹¶ì€ ì»¨í…Œì´ë„ˆì˜ ì„œë¹„ìŠ¤(services:), ë„¤íŠ¸ì›Œí¬(networks:), ë³¼ë¥¨(volumes:)ì„ ì •ì˜í•œë‹¤. <br><br>
ë˜í•œ **Compose ì •ì˜ íŒŒì¼ì€ ë²„ì „ì— ë”°ë¼ ê¸°ìˆ í•  ìˆ˜ ìˆëŠ” í•­ëª©ì´ ë‹¤ë¥´ë©°, Compose ì •ì˜ íŒŒì¼ì˜ ë²„ì „ì€ Docker Engineì˜ ë²„ì „ê³¼ ê´€ê³„ê°€ ìˆë‹¤.**

+ ë²„ì „ ì •ë³´ ë° ì‘ì„± ë°©ë²• : <https://docs.docker.com/compose/compose-file/compose-file-v3/>

```yaml
# ë²„ì „ì„ ì§€ì •
version: "3.9"

#ì„œë¹„ìŠ¤ ì •ì˜ 
services:
    webserver:
        image: ubuntu
        ports: 
            - "80:80"
        networks:
            - webnet

    redis: 
        image: redis 
        networks:
            - webnet

#ë„¤íŠ¸ì›Œí¬ ì •ì˜
networks:
    webnet:

# ë°ì´í„° ë³¼ë¥¨ ì •ì˜
volumes:
    data-volume:
```

### (1) ì´ë¯¸ì§€ ì§€ì •

> ì»¨í…Œì´ë„ˆì˜ ë°”íƒ•ì´ ë˜ëŠ” ë² ì´ìŠ¤ ì´ë¯¸ì§€ë¥¼ ì§€ì •

```yaml
services:
    webserver:
        image: ubuntu
```

```yaml
services:
    webserver:
        image: ubuntu:kinetic-20230217
```

- webserverë¼ëŠ” ì´ë¦„ì˜ ì»¨í…Œì´ë„ˆì˜ ë² ì´ìŠ¤ ì´ë¯¸ì§€ë¥¼ centos: 7ìœ¼ë¡œ ì§€ì •

- ì´ë¯¸ì§€ë¥¼ ë¡œì»¬ í™˜ê²½ì— ìˆìœ¼ë©´ ê·¸ê²ƒì„ ì‚¬ìš©í•˜ê³ , ì—†ìœ¼ë©´ ë„ì»¤ í—ˆë¸Œì—ì„œ ë‹¤ìš´ë¡œë“œ

- ì´ë¯¸ì§€ì˜ íƒœê·¸ë¥¼ ì§€ì •í•˜ì§€ ì•Šì€ ê²½ìš° ìµœì‹  ë²„ì „(latest)ì´ ë‹¤ìš´ë¡œë“œ 

<br>

### (2) ì´ë¯¸ì§€ ë¹Œë“œ

> Dockerfileë¡œ ì´ë¯¸ì§€ë¥¼ ê·¸ìˆ í•˜ê³  ê·¸ê²ƒì„ ìë™ìœ¼ë¡œ ë¹Œë“œí•˜ì—¬ ë² ì´ìŠ¤ë¡œ ì§€ì •í•  ë•Œ ì‚¬ìš©

```yaml
services:
    webserver:
        build: .
```

```yaml
services:
    webserver:
        build: 
            context: ./dir
            dockerfile: Dockerfile-alternate
            args:
                projetno: 1
                user: choi
```

- build : Dockerfileì˜ ê²½ë¡œ

- context : Dockerfileì´ ìˆëŠ” ë””ë ‰í„°ë¦¬ì˜ ê²½ë¡œ ë˜ëŠ” ë¦¬í¬ì§€í† ë¦¬ì˜ URLì„ ì§€ì •

- dockerfile : í•´ë‹¹ ë„ì»¤ íŒŒì¼ì˜ ì´ë¦„ì„ ì§€ì •

- args: Dockerfileì˜ ARG ëª…ë ¹ê³¼ ë¹„ìŠ·í•œ ëª…ë ¹ìœ¼ë¡œ, docker-compose ëª…ë ¹ì´ ì‹¤í–‰ë˜ëŠ” êµ¬ê°„ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë³€ìˆ˜


#### (a) ì˜ˆì‹œ

##### ë””ë ‰í„°ë¦¬ êµ¬ì„±

![image](https://user-images.githubusercontent.com/42735894/223957069-b6fc805d-b8a8-4850-8621-48a81ea70ba0.png){: width="80%" height="80%"}{: .align-center}

##### íŒŒì¼ ë‚´ìš©

```yaml
# docker-compose.yml
services:
    webserver:
        build: .
```
```Dockerfile
# Dockerfile
FROM ubuntu
```

##### ì»¨í…Œì´ë„ˆ ìƒì„±

```bash
$ docker-compose up --build Building webserver
Step 1/1 FROM ubuntu
---> 747cb2d60bbe
Successfully built 747cb2d60bbe
Successfully tagged sample_webserver:latest
Starting sample_webserver_1
Attaching to sample_webserver_1
```

<br>

### (3) ì»¨í…Œì´ë„ˆ ì•ˆì—ì„œ ì‘ë™í•˜ëŠ” ëª…ë ¹ - command, entrypoint

> Dockerfileì˜ ëª…ë ¹ê³¼ ê°™ìŒ, ë² ì´ìŠ¤ ì´ë¯¸ì§€ì— ì§€ì •ë˜ì–´ ìˆì„ ë•ŒëŠ” ê·¸ ëª…ë ¹ì„ ë®ì–´ì“´ë‹¤.

```yaml
services:
    webserver:
        image: centos:7
        command: /bin/bash -c "yum update && yum install net-tools"
```

```yaml
services:
    webserver:
        image: centos:7
        entrypoint: cat /etc/hosts
        # ë˜ëŠ”
        entrypoint: 
            - /bin/cat
            - /etc/hosts
```

<br>

### <s>(4) ì»¨í…Œì´ë„ˆ ê°„ ì—°ê²° - links</s>

> <s>ìµœì‹  ë²„ì „ ë¶€í„°ëŠ” linksë¥¼ ì‘ì„±í•˜ì§€ ì•Šì•„ë„, ì„œë¹„ìŠ¤ ì´ë¦„ìœ¼ë¡œ ë‹¤ë¥¸ ì»¨í…Œì´ë„ˆì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.</s>

<br>

### (5) ì»¨í…Œì´ë„ˆ ê°„ í†µì‹  - ports, expose

> 
