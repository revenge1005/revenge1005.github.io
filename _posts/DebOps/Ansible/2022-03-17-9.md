---
title:  "[Ansible] 08. Template"

categories:
  - ANSIBLE
tags:
  - [ansible]

toc: true
toc_sticky: true

date: 2022-03-17
last_modified_at: 2022-03-17
---
# [Ansible] 08. Template
---

<style>
table {
    font-size: 12pt;
}
table th:first-of-type {
    width: 5%;
}
table th:nth-of-type(2) {
    width: 15%;
}
table th:nth-of-type(3) {
    width: 50%;
}
table th:nth-of-type(4) {
    width: 30%;
}
</style>

## ğŸ”” ìì„¸í•œ ëª¨ë“ˆ ë‚´ìš©ì€ ì•„ë˜ ë¬¸ì„œë¥¼ ì°¸ê³ 

> **ëª¨ë“ˆ ë‚´ìš© :** <https://docs.ansible.com/ansible/latest/collections/ansible/builtin/index.html#modules><br><br>
**ì˜ˆì œ Github :** <https://github.com/revenge1005/Ansible_study>


<br>

## ğŸ”” Template

> Ansibleì—ì„œëŠ” **ê¸°ì¡´ íŒŒì¼ ë‚´ìš©ì„ ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” ì—¬ëŸ¬ ëª¨ë“ˆì„ ì œê³µí•˜ë©°, ëŒ€í‘œì ìœ¼ë¡œ lineinfile, blockinfile ë“±ì´ ìˆëŠ”ë° ì´ê²ƒë“¤ì€ ë‹¨ìˆœ ìˆ˜ì •í•˜ëŠ”ë°ëŠ” ì¢‹ì§€ë§Œ ì–´ë–¤ ê·œì¹™ì— ì˜í•´ ì²´ê³„ì ìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” íŒŒì¼ì—ì„œ ì“°ê¸°ì—ëŠ” ë¶€ì¡±**í–ˆê³ , ê·¸ë˜ì„œ Ansibleì€ íŒŒì¼ì„ ê´€ë¦¬í•˜ëŠ”ë° í…œí”Œë¦¿(Template)ì„ ì§€ì •í•˜ëŠ” ê²ƒì´ë‹¤.<br><br>
**í…œí”Œë¦¿ì€ íŒŒì¼ì´ ë°°í¬ë  ë•Œ Ansible Clientì— ëŒ€í•´ Ansible ë³€ìˆ˜ ë° íŒ©íŠ¸ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•´ ìë™ìœ¼ë¡œ ì§€ì •ë˜ëŠ” í…œí”Œë¦¿ íŒŒì¼ì„ ì‘ì„±í•  ìˆ˜ ìˆì–´ ì œì–´í•˜ê¸° ë” ì‰½ê³  ì˜¤ë¥˜ ë°œìƒë¥ ë„ ë‚®ë‹¤.**<br><br>
Ansibleì—ì„œëŠ” í…œí”Œë¦¿ íŒŒì¼ì„ **jinja2ë¼ëŠ” í…œí”Œë¦¿ ì‹œìŠ¤í…œì„ ì‚¬ìš©**í•˜ë©°, jinja2ëŠ” ìœ„ì—ì„œ ë§í•œ í…œí”Œë¦¿ì„ ì‚¬ìš©í•˜ëŠ”ë° ì“°ê¸°ë„ í•˜ì§€ë§Œ, Playbookì—ì„œ ì§€ì •í•œ ë³€ìˆ˜ë¥¼ ì°¸ì¡°í•˜ê³  ì—¬ëŸ¬ê°€ì§€ í™•ì¥ëœ ì‚¬ìš©ì„ ê°€ëŠ¥í•˜ê²Œ í•œë‹¤.

<br>

## ğŸ”” jinja2 í…œí”Œë¦¿ êµ¬ë¬¸ ì‚¬ìš©í•˜ê¸°

> jinja2 í…œí”Œë¦¿ì€ ë°ì´í„°, ë³€ìˆ˜, ì‹ ë“± ì—¬ëŸ¬ ìš”ì†Œë¡œ êµ¬ì„±ë˜ëŠ”ë°, ì´ëŸ¬í•œ ë³€ìˆ˜ì™€ ì‹ì€ jinja2 í…œí”Œë¦¿ì´ ëœë”ë§ë˜ë©´(jinja2 ë¬¸ë²•ì´ ë³€ì—­ë˜ì–´ ì‹¤í•´ë˜ë©´) í•´ë‹¹ ê°’ìœ¼ë¡œ ë³€ê²½ëœë‹¤.<br><br>
í…œí”Œë¦¿ì— ì‚¬ìš©í•˜ëŠ” ë³€ìˆ˜ëŠ” playbookì˜ vars ì„¹ì…˜ì—ì„œ ì§€ì •ê³¼ Ansible Clientì˜ íŒ©íŠ¸ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•  ìˆë‹¤. <br><br>
jinja2 í…œí”Œë¦¿ì´ ë“¤ì–´ìˆëŠ” íŒŒì¼ì—ëŠ” ë”°ë¡œ í™•ì¥ìëª…ì€ í•„ìš” ì—†ì§€ë§Œ, j2 ì´ëŸ°ì‹ìœ¼ë¡œ í™•ì¥ëª…ì„ ì œê³µí•˜ë©´ í…œí”Œë¦¿ì¸ì§€ ì‰½ê²Œ ì•Œ ìˆ˜ ìˆë‹¤.

```
# << ì‚¬ìš© ë°©ë²• >>

{% raw %}{{ }}{% endraw %} : ì‹/ë³€ìˆ˜ ê²°ê³¼ë¥¼ ìµœì¢… ì‚¬ìš©ìì—ê²Œ ì¶œë ¥

{% raw %}{% %}{% endraw %} : ì‹ ë˜ëŠ” ë…¼ë¦¬(ë°˜ë³µë¬¸ ë“±)ì— ì‚¬ìš©

{% raw %}{# #}{% endraw %} : ì£¼ì„
```


<br>

## ğŸ”” template ëª¨ë“ˆ ì •ë³´

> ê¸°ëŠ¥ì€ ansible hostì— ìˆëŠ” íŒŒì¼ì„ ansible clientì— ë°°í¬í•˜ëŠ” ê²ƒì´ì§€ë§Œ, ê°™ì€ ê¸°ëŠ¥ì„ í•˜ëŠ” ëª¨ë“ˆì´ ë§ìœ¼ë¯€ë¡œ ì¼ë°˜ì ìœ¼ë¡œ jinja2 í…œí”Œë¦¿ íŒŒì¼ì„ ë°°í¬í•˜ëŠ”ë° ì‚¬ìš©ëœë‹¤.<br><br>
Template ëª¨ë“ˆ : <https://docs.ansible.com/ansible/latest/collections/ansible/builtin/template_module.html#ansible-collections-ansible-builtin-template-module>

<br>

## ğŸ“œ í…œí”Œë¦¿ ì˜ˆì œ - 1 

### (1) í…œí”Œë¦¿ íŒŒì¼ ì‘ì„±

```bash
$ cat <<EOF > test01.j2
Welcome to {% raw %}{{ ansible_facts.hostname }}{% endraw %}.
Today's date is : {% raw %}{{ ansible_facts.date_time.date }}{% endraw %}
EOF
```

### (2) í…œí”Œë¦¿ íŒŒì¼ ì‘ì„±

```bash
cat <<EOF > template_playbook.yml
---
- name: jinja2 test
  hosts: all
  tasks:
    - name: jinja2 template
      template:
        src: ./test01.j2
        dest: /tmp/jinja-test-result
        owner: root
        group: root
        mode: 0644
EOF
```

![image (5)](https://user-images.githubusercontent.com/42735894/223420860-a7295d22-a10a-48c3-beec-e8db425ca63c.png){: width="100%" height="100%"}{: .align-center}
![image (6)](https://user-images.githubusercontent.com/42735894/223420857-d44b889e-c1b3-48d5-8230-8d0fe6c3e573.png){: width="100%" height="100%"}{: .align-center}

<br>

## ğŸ“œ í…œí”Œë¦¿ ì˜ˆì œ - 2

> ê´€ë¦¬ìê°€ templateìœ¼ë¡œ ë§Œë“  ê²°ê³¼íŒŒì¼ì— ëŒ€í•´ ìˆ˜ì •í•˜ì§€ ì•Šë„ë¡ ìš”êµ¬í•˜ê±°ë‚˜ íŠ¹ë³„í•œ ì£¼ì„ì„ ë‹¬ê³  ì‹¶ì„ë•Œ, ì—¬ëŸ¬ ë°©ë²•ì´ ìˆì§€ë§Œ ê°€ì¥ ê°„ë‹¨í•œ ë°©ë²•ì€ **ansible.cfgì˜ [defaults] ì„¹ì…˜ì— "ansible_managed=" ë¼ëŠ” ë¶€ë¶„ì„ ì¶”ê°€í•˜ëŠ” ê²ƒ**ì´ë‹¤.

### (1) ansible.cfg

```bash
$ cat ansible.cfg
[defaults]
inventory = inventory
private_key_file = ~/.ssh/id_ed25519
# ì•„ë˜ ë‚´ìš© ì¶”ê°€
ansible_managed = NOTICE : This file is ansible managed : {% raw %}{file}{% endraw %} modified on %Y-%m-d %H:%M:%S by {% raw %}{uid}{% endraw %} on {% raw %}{host}{% endraw %}
```

### (2) í…œí”Œë¦¿ íŒŒì¼ ì‘ì„±

```bash
cat <<EOF > test02.j2
{% raw %}{{ ansible_managed  }}{% endraw %}
Welcome to {% raw %}{{ ansible_facts.hostname }}{% endraw %}.
Today's date is : {% raw %}{{ ansible_facts.date_time.date }}{% endraw %}
EOF
```

### (3) Playbook - ì˜ˆì œ (1)ê³¼ ë™ì¼ (src: ./test02.j2 ë¡œ ë³€ê²½ë¨)

```
cat <<EOF > template_playbook.yml
---
- name: jinja2 test
  hosts: all
  tasks:
    - name: jinja2 template
      template:
        src: ./test02.j2
        dest: /tmp/jinja-test-result
        owner: root
        group: root
        mode: 0644
EOF
```

![image (7)](https://user-images.githubusercontent.com/42735894/223421885-08bb5d0b-0a5c-47be-9f68-74451d347004.png){: width="100%" height="100%"}{: .align-center}

<br>

## ğŸ“œ í…œí”Œë¦¿ ì˜ˆì œ - 3 (ë°˜ë³µë¬¸)

### (1) ì‚¬ìš©ë²•

```bash
{% raw %}{% for user in users %}{% endraw %}
    {% raw %}{{ user }}{% endraw %}
{% raw %}{% endfor %}{% endraw %}
```

### (2) ì˜ˆ1) ì§ì ‘ jinja2 í…œí”Œë¦¿ì— ë³€ìˆ˜ë¥¼ ì •ì˜í•˜ì—¬ ì‚¬ìš©

```bash
$ cat <<EOF > jinja2-template1.j2
{% raw %}{% set numbers = [1,2,3,4,5,6,7,8,9,10] %}{% endraw %}
{% raw %}{% for number in numbers %}{% endraw %}
The number is {% raw %}{{ number }}{% endraw %}
{% raw %}{% endfor %}{% endraw %}
EOF

$ cat <<EOF > jinja2-template1.yml
---
- hosts: all
  become: true
  tasks:
  - template:
      src: jinja2-template1.j2
      dest: /tmp/jinja2
      mode: 0644
EOF
```

### (3) ì˜ˆ2) í”Œë ˆì´ë¶ì—ì„œ ì§ì ‘ ì •ì˜í•œ ë³€ìˆ˜ ì‚¬ìš©

```bash
cat <<EOF > jinja2-template2.j2
{% raw %}{% for number in numbers %}{% endraw %}
The number is {% raw %}{{ number }}{% endraw %}
{% raw %}{% endfor %}{% endraw %}
EOF

cat <<EOF > jinja2-template2.yml
---
- hosts: all
  vars:
    numbers: 
      [1,2,3,4,5,6,7,8,9,10]
  become: true
  tasks:
  - template:
      src: jinja2-template2.j2
      dest: /tmp/jinja2
      mode: 0644
EOF
```