---
title:  "[Ubuntu] 08. DNS ì„œë²„ êµ¬ì„±" 

categories:
  - UBUNTU
tags:
  - [ubuntu, linux]

toc: true
toc_sticky: true

date: 2021-05-02
last_modified_at: 2021-05-02
---
<br>

# ğŸ”” í™˜ê²½ì„¤ì • íŒŒì¼ (Bind)
---

<style>
table {
    font-size: 12pt;
}
table th:first-of-type {
    width: 5%;
}
table th:nth-of-type(2) {
    width: 15%;
}
table th:nth-of-type(3) {
    width: 50%;
}
table th:nth-of-type(4) {
    width: 30%;
}
big {
    font-size: 15pt;
}
</style>

<br>

<big> **â–  íŒ¨í‚¤ì§€ ** </big>

| íŒ¨í‚¤ì§€ëª… | ì„¤ëª… |
| :---: | --- |
| bind | BIND ë°ëª¬ì˜ ê¸°ë³¸ íŒ¨í‚¤ì§€ |
| bind-utils | BIND ë°ëª¬ ìš´ì˜ì— ê´€ë ¨ëœ ë³´ì¡° ìœ í‹¸ë¦¬í‹° |
| bind-libs | BIND ë°ëª¬ì—ì„œ ì‚¬ìš©ë˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ |
| bind-chroot | BIND ë°ëª¬ì˜ ë³´ì•ˆ í–¥ìƒì„ ìœ„í•´ ì‚¬ìš©ë˜ëŠ” íŒ¨í‚¤ì§€ |
| caching-nameserver | BIND ë°ëª¬ì˜ í™˜ê²½ ì„¤ì •ì„ ìœ„í•œ íŒ¨í‚¤ì§€ (í˜„ì¬ BINDì— í†µí•©ë˜ì–´ ì„¤ì¹˜ë¨) |

<br>

# ğŸ”” BIND : ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ êµ¬ì„±
---

<br>

<big> **â–  bind ì„¤ì¹˜** </big>

```bash
$ apt -y install bind9 bind9utils
```

<br>

<big> **â–  ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ì— ëŒ€í•œ ì„¤ì •** </big>

+ ë‹¤ìŒì€ ë¡œì»¬ ë„¤íŠ¸ì›Œí¬ê°€ [192.168.219.0/24]ì´ê³  ë„ë©”ì¸ ì´ë¦„ì´ [test.srv]ì¸ ê²½ìš°ì˜ ì˜ˆ

```bash
$ cat /etc/bind/named.conf

include "/etc/bind/named.conf.options";
include "/etc/bind/named.conf.local";
include "/etc/bind/named.conf.default-zones";

# ì¶”ê°€
include "/etc/bind/named.conf.internal-zones";


$ cat /etc/bind/named.conf.options
acl internal-network {
        192.168.219.0/24;
};

options {
        directory "/var/cache/bind";

        ...
        ...
  
        # ìœ„ì˜ [ë¡œì»¬ ë„¤íŠ¸ì›Œí¬] ì„¹ì…˜ì— ë¡œì»¬ ë„¤íŠ¸ì›Œí¬ ì„¸íŠ¸ ì¶”ê°€
        # í˜¸ìŠ¤íŠ¸ì—ì„œ ì¿¼ë¦¬ë¥¼ ìˆ˜ì‹ í•  ìˆ˜ ìˆëŠ” ë„¤íŠ¸ì›Œí¬ ë²”ìœ„
        allow-query { localhost; internal-network; };

        # zone íŒŒì¼ì„ í´ë¼ì´ì–¸íŠ¸ë¡œ ì „ì†¡í•  ìˆ˜ ìˆëŠ” ë„¤íŠ¸ì›Œí¬ ë²”ìœ„
        # secondary DNS ì„œë²„ê°€ ìˆëŠ” ê²½ìš° ì¶”ê°€
        allow-transfer { localhost; };

        recursion yes;

        //========================================================================
        // If BIND logs error messages about the root key being expired,
        // you will need to update your keys.  See https://www.isc.org/bind-keys
        //========================================================================

        dnssec-validation auto;

        listen-on-v6 { any; };
};


$ cat /etc/bind/named.conf.internal-zones
# ë„¤íŠ¸ì›Œí¬ ë° ë„ë©”ì¸ ì´ë¦„ì— ëŒ€í•œ Zone ì¶”ê°€
zone "test.srv" IN {
        type master;
        file "/etc/bind/named/test.srv.lan";
        allow-update { none; };
};
zone "219.168.192.in-addr.arpa" IN {
        type master;
        file "/etc/bind/named/219.168.192.db";
        allow-update { none; };
};


$ cat /etc/default/named
# IPv6ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  IPv6 ê´€ë ¨ ë¡œê·¸ë„ í‘œì‹œí•˜ì§€ ì•ŠëŠ” ê²½ìš° ë³€ê²½ ê°€ëŠ¥
# IPv4ë§Œ ì‚¬ìš©í•˜ë„ë¡ BIND ì„¤ì •
OPTIONS="-u bind -4"
```

<br>

<big> **â–  Zone íŒŒì¼ êµ¬ì„±** </big>

+ ì„œë²„ê°€ ë„ë©”ì¸ ì´ë¦„ì—ì„œ IP ì£¼ì†Œë¥¼ í™•ì¸í•˜ëŠ” Zone íŒŒì¼ ì‘ì„±

```bash
$ mkdir named


$ cat /etc/bind/named/test.srv.lan

$TTL 86400
@   IN  SOA     dlp.test.srv. root.test.srv. (
        # ì¼ë ¨ ë²ˆí˜¸ì— ëŒ€í•´ì„œëŠ” ì•„ë¬´ ìˆ«ì ê°’ë„ ê´œì°®ì§€ë§Œ
        # ê¶Œì¥ ì‚¬í•­ì€ [YYYYMMDDnn](ì—…ë°ì´íŠ¸ ë‚ ì§œ + ë²ˆí˜¸)
        2022081001  ;Serial
        3600        ;Refresh
        1800        ;Retry
        604800      ;Expire
        86400       ;Minimum TTL
)
        # ë„¤ì„ ì„œë²„ ì •ì˜
        IN  NS      dlp.test.srv.
        # ë„¤ì„ ì„œë²„ì˜ IP ì£¼ì†Œ ì •ì˜
        IN  A       192.168.219.101
        # ë©”ì¼ êµí™˜ê¸° ì„œë²„ ì •ì˜
        IN  MX 10   dlp.test.srv.

# í˜¸ìŠ¤íŠ¸ ì´ë¦„ì˜ ê° IP ì£¼ì†Œ ì •ì˜
dlp     IN  A       192.168.219.101
www     IN  A       192.168.219.102
```

+ ì„œë²„ê°€ IP ì£¼ì†Œì—ì„œ ë„ë©”ì¸ ì´ë¦„ì„ í™•ì¸í•˜ëŠ” Zone íŒŒì¼ì„ ì‘ì„±

```bash
$ vim /etc/bind/named/219.168.192.db

$TTL 86400
@   IN  SOA     dlp.test.srv. root.test.srv. (
        2022081001  ;Serial
        3600        ;Refresh
        1800        ;Retry
        604800      ;Expire
        86400       ;Minimum TTL
)
        # ë„¤ì„ ì„œë²„ ì •ì˜
        IN  NS      dlp.test.srv.

# IP ì£¼ì†Œì˜ ê° í˜¸ìŠ¤íŠ¸ ì´ë¦„ ì •ì˜
101     IN  PTR     dlp.test.srv.
102     IN  PTR     www.test.srv.
```

<br>

<big> **â–  Start and Enable BIND.** </big>

```bash
$ systemctl restart named
```

<br>

<big> **â–  í™•ì¸** </big>

```bash
# í•„ìš”í•œ ê²½ìš° ìì‹ ì˜ DNSë¥¼ ì°¸ì¡°í•˜ë„ë¡ DNS ì„¤ì •ì„ ë³€ê²½
$ vi /etc/netplan/01-netcfg.yaml
# change to self IP address
    nameservers:
        addresses: [192.168.219.195]


$ netplan apply


$ dig dlp.test.srv.

; <<>> DiG 9.18.12-0ubuntu0.22.04.1-Ubuntu <<>> dlp.test.srv.
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 30196
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 65494
;; QUESTION SECTION:
;dlp.test.srv.                  IN      A

;; ANSWER SECTION:
dlp.test.srv.           86400   IN      A       192.168.219.101

;; Query time: 0 msec
;; SERVER: 127.0.0.53#53(127.0.0.53) (UDP)
;; WHEN: Mon Jun 12 17:48:55 KST 2023
;; MSG SIZE  rcvd: 57


$ dig -x 192.168.219.101

; <<>> DiG 9.18.12-0ubuntu0.22.04.1-Ubuntu <<>> -x 192.168.219.101
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 34538
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 65494
;; QUESTION SECTION:
;101.219.168.192.in-addr.arpa.  IN      PTR

;; ANSWER SECTION:
101.219.168.192.in-addr.arpa. 7189 IN   PTR     dlp.test.srv.

;; Query time: 0 msec
;; SERVER: 127.0.0.53#53(127.0.0.53) (UDP)
;; WHEN: Mon Jun 12 17:50:33 KST 2023
;; MSG SIZE  rcvd: 83
```

<br>

# ğŸ”” BIND : ì™¸ë¶€ ë„¤íŠ¸ì›Œí¬ êµ¬ì„±
---

+ ì´í›„ ì„¤ì •ì€ ìœ„ ì˜ˆì œì™€ ê°™ë‹¤.

```bash
$ vi /etc/bind/named.conf

include "/etc/bind/named.conf.options";
include "/etc/bind/named.conf.local";
include "/etc/bind/named.conf.default-zones";

# ì¶”ê°€
include "/etc/bind/named.conf.external-zones";


$ vim /etc/bind/named.conf.options
options {
        directory "/var/cache/bind";

.....
.....

        # ë³€ê²½ : ëª¨ë“  í˜¸ìŠ¤íŠ¸ì—ì„œ ì¿¼ë¦¬ë¥¼ ìˆ˜ì‹ 
        allow-query     { any; };
        # Zone íŒŒì¼ì„ í´ë¼ì´ì–¸íŠ¸ë¡œ ì „ì†¡í•  ìˆ˜ ìˆëŠ” ë„¤íŠ¸ì›Œí¬ ë²”ìœ„
        # ë³´ì¡° DNS ì„œë²„ê°€ ìˆëŠ” ê²½ìš° ì¶”ê°€
        allow-transfer  { localhost; };
        # ë³€ê²½ : ì¬ê·€ ì¿¼ë¦¬ë¥¼ í—ˆìš©í•˜ì§€ ì•ŠìŒ
        # ì´ ì„œë²„ì—ë§Œ í•´ë‹¹ í•­ëª©ì´ ìˆëŠ” ì˜ì—­ì— ëŒ€í•œ ë‹µë³€
        recursion no;

        //=======================================================================
        // If BIND logs error messages about the root key being expired,
        // you will need to update your keys.  See https://www.isc.org/bind-keys
        //=======================================================================

        dnssec-validation auto;

        listen-on-v6 { any; };
};
```

<br>

# ğŸ”” DNS - View Statement
---

> íŠ¹ì • ì‚¬ìš©ì ë˜ëŠ” ê·¸ë£¹ì—ê²Œë§Œ íŠ¹ì •í•œ DNS ì •ë³´ë¥¼ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ìœ¼ë¡œ, ì˜ˆë¥¼ ë“¤ì–´, íšŒì‚¬ ë‚´ë¶€ì—ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥í•œ ë„ë©”ì¸ ì´ë¦„ì´ ìˆëŠ” ê²½ìš°, íšŒì‚¬ ë‚´ë¶€ IP ì£¼ì†Œ ë²”ìœ„ë¥¼ ê¸°ë°˜ìœ¼ë¡œ View Statementë¥¼ ì„¤ì •í•˜ì—¬ ë‚´ë¶€ ì‚¬ìš©ìì—ê²Œë§Œ í•´ë‹¹ ë„ë©”ì¸ ì´ë¦„ì„ ì œê³µí•  ìˆ˜ ìˆë‹¤.

```bash
$ cat /etc/bind/named.conf

include "/etc/bind/named.conf.options";
include "/etc/bind/named.conf.local";
# comment out
# include "/etc/bind/named.conf.default-zones";

# ì¶”ê°€
include "/etc/bind/named.conf.internal-zones";
include "/etc/bind/named.conf.external-zones";


$ cat /etc/bind/named.conf.options
acl internal-network {
        192.168.219.0/24;
};

options {
        directory "/var/cache/bind";

        ...
        ...
  
        # ìœ„ì˜ [ë¡œì»¬ ë„¤íŠ¸ì›Œí¬] ì„¹ì…˜ì— ë¡œì»¬ ë„¤íŠ¸ì›Œí¬ ì„¸íŠ¸ ì¶”ê°€
        # í˜¸ìŠ¤íŠ¸ì—ì„œ ì¿¼ë¦¬ë¥¼ ìˆ˜ì‹ í•  ìˆ˜ ìˆëŠ” ë„¤íŠ¸ì›Œí¬ ë²”ìœ„
        allow-query { localhost; internal-network; };

        # zone íŒŒì¼ì„ í´ë¼ì´ì–¸íŠ¸ë¡œ ì „ì†¡í•  ìˆ˜ ìˆëŠ” ë„¤íŠ¸ì›Œí¬ ë²”ìœ„
        # secondary DNS ì„œë²„ê°€ ìˆëŠ” ê²½ìš° ì¶”ê°€
        allow-transfer { localhost; };

        recursion yes;

        //========================================================================
        // If BIND logs error messages about the root key being expired,
        // you will need to update your keys.  See https://www.isc.org/bind-keys
        //========================================================================

        dnssec-validation auto;

        listen-on-v6 { any; };
};


$ vi /etc/bind/named.conf.internal-zones
view "internal" {
        # ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ ì˜ì—­ ì„¤ì •
        match-clients {
                localhost;
                internal-network;
        };
        zone "test.srv" {
                type master;
                file "/etc/bind/test.srv.lan";
                allow-update { none; };
        };
        zone "219.168.192.in-addr.arpa" {
                type master;
                file "/etc/bind/219.168.192.db";
                allow-update { none; };
        };
        include "/etc/bind/named.conf.default-zones";
};


$ vi /etc/bind/named.conf.external-zones
view "external" {
        # ë‚´ë¶€ ì„¹ì…˜ì˜ [match-client]ì— ì •ì˜ëœ ëŒ€ìƒì„ ì œì™¸í•˜ê³  ëª¨ë‘ ì¼ì¹˜
        match-clients { any; };
        allow-query { any; };
        # ì¬ê·€ ì¿¼ë¦¬ë¥¼ í—ˆìš©í•˜ì§€ ì•ŠìŒ
        recursion no;
        zone "srv.world" {
                type master;
                file "/etc/bind/srv.world.wan";
                allow-update { none; };
        };
        zone "80.0.16.172.in-addr.arpa" {
                type master;
                file "/etc/bind/80.0.16.172.db";
                allow-update { none; };
        };
};
```