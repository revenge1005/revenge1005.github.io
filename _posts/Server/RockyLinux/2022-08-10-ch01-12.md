---
title:  "[Rocky] 12. NFS μ„λ²„ κµ¬μ„±" 

categories:
  - ROCKY
tags:
  - [rocky, linux]

toc: true
toc_sticky: true

date: 2023-05-23
last_modified_at: 2023-05-23
---
<br>

# π”” NFS μ„λ²„ κµ¬μ„±
---

<style>
table {
    font-size: 12pt;
}
table th:first-of-type {
    width: 5%;
}
table th:nth-of-type(2) {
    width: 15%;
}
table th:nth-of-type(3) {
    width: 50%;
}
table th:nth-of-type(4) {
    width: 30%;
}
big {
    font-size: 15pt;
}
</style>

<br>

<big> **β–  NFS κ΄€λ ¨ νμΌ** </big>

| νμΌλ… | μ„¤λ… |
|:-----:|:----|
| /etc/exports | NFS λ””λ ‰ν„°λ¦¬ κ³µμ μ— λ€ν• λ¦¬μ¤νΈλ¥Ό λ³΄κ΄€ν•λ” νμΌ (κ΄€λ¦¬μμ— μν•΄ κ΄€λ¦¬) |
| /var/lib/nfs/etab | ν„μ¬ NFS μ„λ²„ μ„λΉ„μ¤μ— μν•΄ κ³µμ λ μμ› λ¦¬μ¤νΈλ¥Ό λ³΄κ΄€ν•λ” νμΌ (μ‹μ¤ν…μ— μν•΄ κ΄€λ¦¬) |
| /var/lib/nfs/rmtab | μ›κ²©μ§€ ν΄λΌμ΄μ–ΈνΈμ— μν•΄ λ§μ΄νΈ λ NFS νμΌμ‹μ¤ν… μ •λ³΄λ¥Ό λ³΄κ΄€ν•λ” νμΌ (μ‹μ¤ν…μ— μν•΄ κ΄€λ¦¬) |

<br>

<big> **β–  /etc/exports νμΌ** </big>

```bash
# κ³µμ λ””λ ‰ν„°λ¦¬    ν΄λΌμ΄μ–ΈνΈIP λλ” νΈμ¤νΈμ΄λ¦„(κ³µμ μµμ…)

# 192.168.219.21 IPλ¥Ό κ°€μ§€λ” μ‹μ¤ν…μ— λ€ν•΄μ„λ§ κ³µμ λ¥Ό ν—μ©
/data01    192.168.219.21(rw,sync,no_root_squash)  

# 192.168.219.22 ~ 192.168.219.24μ— λ€ν•΄μ„λ§ κ³µμ λ¥Ό ν—μ©
/data02    192.168.219.2[2-5](rw,sync)

# 192.168.219 λ€μ—­μ„ μ‚¬μ©ν•λ” μ‹μ¤ν…μ— λ€ν•΄ κ³µμ λ¥Ό ν—μ©
/data03    192.168.219.0/24
```

<br>

| κ³µμ  μµμ…        | μ„¤λ…                                                             |
|:------------------:|------------------------------------------------------------------|
| rw               | ν΄λΌμ΄μ–ΈνΈμ—κ² μ½κΈ°/μ“°κΈ° κ¶ν•μ„ λ¶€μ—¬ν•μ—¬ νμΌ μ‹μ¤ν…μ„ κ³µμ ν•¨.         |
| ro               | ν΄λΌμ΄μ–ΈνΈμ—κ² μ½κΈ° μ „μ© κ¶ν•μ„ λ¶€μ—¬ν•μ—¬ νμΌ μ‹μ¤ν…μ„ κ³µμ ν•¨.        |
| nohide           | μƒμ„ λ””λ ‰ν† λ¦¬μ—μ„ μ¨κ²¨μ§„ νμΌ μ‹μ¤ν…λ„ κ³µμ ν•¨.                       |
| hide             | μƒμ„ λ””λ ‰ν† λ¦¬μ—μ„ μ¨κ²¨μ§„ νμΌ μ‹μ¤ν…μ„ κ³µμ ν•μ§€ μ•μ.               |
| sync             | λ³€κ²½ μ‚¬ν•­μ„ λ™κΈ°ν™”ν•μ—¬ ν΄λΌμ΄μ–ΈνΈμ—κ² λ°μν•¨.                      |
| async            | λ³€κ²½ μ‚¬ν•­μ„ λΉ„λ™κΈ°μ μΌλ΅ ν΄λΌμ΄μ–ΈνΈμ—κ² λ°μν•¨.                     |
| no_subtree_check | μ„λΈνΈλ¦¬ ν™•μΈμ„ λΉ„ν™μ„±ν™”ν•μ—¬ ν΄λΌμ΄μ–ΈνΈμ—κ² λ°μν•¨.                 |
| subtree_check    | μ„λΈνΈλ¦¬ ν™•μΈμ„ ν™μ„±ν™”ν•μ—¬ ν΄λΌμ΄μ–ΈνΈμ—κ² λ°μν•¨.                    |
| insecure         | λΉ„μΈμ¦ ν΄λΌμ΄μ–ΈνΈμ—κ²λ„ νμΌ μ‹μ¤ν…μ„ κ³µμ ν•¨.                         |
| secure           | μΈμ¦λ ν΄λΌμ΄μ–ΈνΈμ—κ²λ§ νμΌ μ‹μ¤ν…μ„ κ³µμ ν•¨.                        |
| all_squash       |  rootλ¥Ό ν¬ν•¨ν•μ—¬ λ¨λ“  μ‚¬μ©μμ™€ κ·Έλ£Ήμ κ¶ν•μ„ nobodyλ΅ λ§¤ν•‘ν•λ” μµμ…, μµλ… μ‚¬μ©μμ—κ²λ§ νμΌ μ‹μ¤ν…μ„ κ³µμ ν•κ³  μ‹¶μ„ λ• μ μ©ν•κ² μ‚¬μ© |
| no_all_squash    | μ‚¬μ©μμ™€ κ·Έλ£Ήμ κ¶ν•μ„ squashν•μ§€ μ•λ” μµμ…, ν΄λΌμ΄μ–ΈνΈμ μ‚¬μ©μμ™€ κ·Έλ£Ήμ κ¶ν•μ„ κ·Έλ€λ΅ μ μ§€ |
| root_squash      | ν΄λΌμ΄μ–ΈνΈμ root κ¶ν•μ„ λ¬΄μ‹ν•κ³  nobody κ¶ν•μ„ λ¶€μ—¬ν•λ” κ²ƒμΌλ΅ ν΄λΌμ΄μ–ΈνΈμ root μ‚¬μ©μκ°€ μ„λ²„μ νμΌ μ‹μ¤ν…μ— λ€ν• μ•΅μ„Έμ¤λ¥Ό μ ν• |
| no_root_squash   | ν΄λΌμ΄μ–ΈνΈμ root κ¶ν•μ„ μΈμ •ν•λ” μµμ…μΌλ΅ ν΄λΌμ΄μ–ΈνΈμ root μ‚¬μ©μκ°€ μ„λ²„μ νμΌ μ‹μ¤ν…μ— λ€ν• μ•΅μ„Έμ¤λ¥Ό μ ν•λ°›μ§€ μ•λ”λ‹¤. |
| anonuid          | μµλ… μ‚¬μ©μμ UIDλ¥Ό μ§€μ •ν•¨.                                       |
| anongid          | μµλ… μ‚¬μ©μμ GIDλ¥Ό μ§€μ •ν•¨.                                       |

<br>

<big> **β–  exportfs λ…λ Ή** </big>

> λ””λ ‰ν„°λ¦¬λ¥Ό κ³µμ ν•κΈ° μ„ν•΄ λλ” κ³µμ λ λ””λ ‰ν„°λ¦¬ μ •λ³΄λ¥Ό ν™•μΈν•κΈ° μ„ν•΄ μ‚¬μ©λλ” λ…λ Ή

```bash
$ exportfs [μµμ…] IPμ£Όμ†:κ³µμ _λ””λ ‰ν„°λ¦¬_κ²½λ΅
```

| μµμ… | μ„¤λ… |
|----------|------|
| -o rw | μ½κΈ°/μ“°κΈ° κ¶ν•μ„ κ°€μ§„ ν΄λΌμ΄μ–ΈνΈμ—κ² νμΌ μ‹μ¤ν…μ„ κ³µμ ν•¨. |
| -o ro | μ½κΈ° μ „μ©μΌλ΅ νμΌ μ‹μ¤ν…μ„ κ³µμ ν•¨. |
| -o sync | λ³€κ²½μ— λ€ν•΄ μ•μ •μ μΈ μ €μ¥ ν›„ μ”μ²­μ— λ€ν•΄ μ‘λ‹µ |
| -v | κ³µμ λ λ””λ ‰ν„°λ¦¬ μ •λ³΄λ¥Ό ν™•μΈ |

<br>

<big> **β–  NFS μ„λ²„ κµ¬μ„±** </big>

```bash
$ dnf -y install nfs-utils

$ vi /etc/exports

# [/home/nfsshare]λ¥Ό NFS κ³µμ  λ””λ ‰ν„°λ¦¬λ΅ μ„¤μ •
/home/nfsshare 192.168.219.0/24(rw,sync,no_root_squash)

$ mkdir /home/nfsshare

$ systemctl enable --now rpcbind nfs-server

# λ°©ν™”λ²½ μ„¤μ •
$ firewall-cmd --add-service=nfs

# NFSv3μ„ μ‚¬μ©ν•λ” κ²½μ°
$ firewall-cmd --add-service={nfs3,mountd,rpc-bind}

$ firewall-cmd --runtime-to-permanent
```

<br>

<big> **β–  NFS ν΄λΌλ¦¬μ–ΈνΈ κµ¬μ„±** </big>

```bash
$ dnf -y install nfs-utils


$ mount -t nfs 192.168.219.101:/home/nfsshare /mnt


$ df -hT /mnt
Filesystem                     Type      Size  Used Avail Use% Mounted on
192.168.219.101:/home/nfsshare nfs4       17G  1.7G   16G  10% /mnt


# NFSv3μΌλ΅ λ§μ΄νΈν•λ” κ²½μ° [-o vers=3] μµμ… μ¶”κ°€
$ mount -t nfs -o vers=3 192.168.219.101:/home/nfsshare /mnt


$ df -hT /mnt
Filesystem                     Type  Size  Used Avail Use% Mounted on
192.168.219.101:/home/nfsshare nfs    17G  1.7G   16G  10% /mnt


# μ‹μ¤ν…μ΄ μ‹μ‘λ  λ• μλ™μΌλ΅ λ§μ΄νΈν•λ ¤λ©΄ [/etc/fstab]μ—μ„ μ„¤μ •μ„ κµ¬μ„±
$ vi /etc/fstab

# μ¶”κ°€
192.168.219.101:/home/nfsshare /mnt               nfs     defaults        0 0


# λ„κµ¬λ‚ NFS κ³µμ μ— μ•΅μ„Έμ¤ν•  λ• λ™μ μΌλ΅ λ§μ΄νΈν•λ ¤λ©΄ AutoFSλ¥Ό κµ¬μ„±
# AutoFSλ” νμΌ μ‹μ¤ν…μ„ ν•„μ”μ— λ”°λΌ μλ™μΌλ΅ λ§μ΄νΈν•κ³  μΌμ • μ‹κ°„ λ™μ• μ‚¬μ©ν•μ§€ μ•μΌλ©΄ μλ™μΌλ΅ μ–Έλ§μ΄νΈν•λ” λ¦¬λ…μ¤ μ»¤λ„ λ¨λ“κ³Ό μ‚¬μ©μ κ³µκ°„ ν”„λ΅κ·Έλ¨
$ dnf -y install autofs


$  vi /etc/auto.master

# λμ— μ¶”κ°€
/-    /etc/auto.mount


$ vi /etc/auto.mount

# [mount point] [option] [location]
/mnt   -fstype=nfs,rw  192.168.219.101:/home/nfsshare


$ systemctl enable --now autofs


$ grep /mnt /proc/mounts
192.168.219.101:/home/nfsshare /mnt nfs rw,relatime,vers=3,rsize=131072,wsize=131072,namlen=255,hard,proto=tcp,timeo=600,retrans=2,sec=sys,mountaddr=192.168.219.101,mountvers=3,mountport=20048,mountproto=udp,local_lock=none,addr=192.168.219.101 0 0
/etc/auto.mount /mnt autofs rw,relatime,fd=17,pgrp=28460,timeout=300,minproto=5,maxproto=5,direct,pipe_ino=58970 0 0
192.168.219.101:/home/nfsshare /mnt nfs4 rw,relatime,vers=4.2,rsize=131072,wsize=131072,namlen=255,hard,proto=tcp,timeo=600,retrans=2,sec=sys,clientaddr=192.168.219.102,local_lock=none,addr=192.168.219.101 0 0
```