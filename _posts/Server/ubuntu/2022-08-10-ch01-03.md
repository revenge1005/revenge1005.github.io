---
title:  "[Ubuntu] 03. SSH ì„œë²„ - (1)" 

categories:
  - UBUNTU
tags:
  - [ubuntu, linux]

toc: true
toc_sticky: true

date: 2023-05-23
last_modified_at: 2023-05-23
---
<br>

# ğŸ”” SSHì—ì„œ ê°€ì¥ ì„¤ì • ë³€ê²½ì„ ë§ì´ í•˜ëŠ” í•­ëª©
---

<style>
table {
    font-size: 12pt;
}
table th:first-of-type {
    width: 5%;
}
table th:nth-of-type(2) {
    width: 15%;
}
table th:nth-of-type(3) {
    width: 50%;
}
table th:nth-of-type(4) {
    width: 30%;
}
big {
    font-size: 15pt;
}
</style>

<br>

<big> **â–  SSH í™˜ê²½ ì„¤ì •íŒŒì¼ ê²½ë¡œ : /etc/ssh/sshd_config** </big>

|ì„¤ì •|ë‚´ìš©|
|:---:|---|
|Port|SSH ê¸°ë³¸ í¬íŠ¸ì¸ 22ë²ˆì„ ë‹¤ë¥¸ ë²ˆí˜¸ë¡œ ë³€ê²½í•  ë•Œ ì£¼ë¡œ ì‚¬ìš©í•¨|
|PermitRootLogin|Root ê³„ì •ìœ¼ë¡œ SSH ì ‘ê·¼ì„ í—ˆìš©í• ì§€ ì—¬ë¶€, ê¸°ë³¸ì ìœ¼ë¡œ ì ‘ê·¼ ë¶ˆê°€í•¨|
|PasswordAuthentication|íŒ¨ìŠ¤ì›Œë“œë¥¼ ì´ìš©í•œ ì¸ì¦ì„ í—ˆìš©í• ì§€ì— ëŒ€í•œ ì—¬ë¶€, ê¸°ë³¸ì ìœ¼ë¡œ íŒ¨ìŠ¤ì›Œë“œë¡œ ì ‘ê·¼ì„|
|PubkeyAuthentication|í¼ë¸”ë¦­í‚¤ë¥¼ ì´ìš©í•œ ì¸ì¦ì„ í—ˆìš©í• ì§€ì— ëŒ€í•œ ì—¬ë¶€, ê¸°ë³¸ì ìœ¼ë¡œ í—ˆìš©í•¨|

<br>

<br>

# ğŸ”” íŒ¨ìŠ¤ì›Œë“œ ì¸ì¦
---

> Ubuntuë¥¼ ì„¤ì¹˜í•˜ë©´ OpenSSHëŠ” ì´ë¯¸ ê¸°ë³¸ì ìœ¼ë¡œ ì„¤ì¹˜ë˜ë¯€ë¡œ ìƒˆ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•  í•„ìš”ê°€ ì—†ìœ¼ë©° ê¸°ë³¸ì ìœ¼ë¡œ ì•”í˜¸ ì¸ì¦ì„ ì‚¬ìš©í•˜ì—¬ ë¡œê·¸ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ê¸°ë³¸ì ìœ¼ë¡œ ë£¨íŠ¸ ì‚¬ìš©ì ê³„ì •ì€ ë¡œê·¸ì¸ì´ í—ˆìš©ë˜ë¯€ë¡œ ì„¤ì •ì„ ë³€ê²½í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

<br>

<big> **â–  SSH ì„œë²„ - PermitRootLogin ì„¤ì •** </big>

```bash
$ vi /etc/ssh/sshd_config

# 43í–‰ : ë³€ê²½(ë£¨íŠ¸ ë¡œê·¸ì¸ ê¸ˆì§€)
PermitRootLogin no

$ systemctl restart sshd
```

<br>

<big> **â–  SSH í´ë¼ì´ì–¸íŠ¸ - Ubuntu** </big>

```bash
$ apt -y install openssh-client


$ ssh root@dlp.srv.test
The authenticity of host 'dlp.srv.test (192.168.219.195)' can't be established.
ED25519 key fingerprint is SHA256:orC+ofYzJicAIW049Mw23VZWbOQFpEfDB46QpLbZ4VA.
This key is not known by any other names
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added 'dlp.srv.test' (ED25519) to the list of known hosts.
root@dlp.srv.test's password:
Welcome to Ubuntu 22.04.2 LTS (GNU/Linux 5.15.0-73-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Mon Jun  5 04:29:12 PM KST 2023

  System load:  0.0               Processes:              200
  Usage of /:   46.9% of 9.75GB   Users logged in:        1
  Memory usage: 16%               IPv4 address for ens32: 192.168.219.195
  Swap usage:   0%


Expanded Security Maintenance for Applications is not enabled.

0 updates can be applied immediately.

Enable ESM Apps to receive additional future security updates.
See https://ubuntu.com/esm or run: sudo pro status


Last login: Mon Jun  5 16:09:21 2023 from 192.168.219.1
root@ubuntu:~#


$ ssh root@dlp.srv.test "cat /etc/passwd"
root@dlp.srv.test's password:
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
...
```

<br>

<big> **â–  SSH í´ë¼ì´ì–¸íŠ¸ - Windows** </big>

![2222222](https://github.com/revenge1005/Kubernetes-Study/assets/42735894/691c730b-946b-4465-9c4f-41249adb9905)

![33333](https://github.com/revenge1005/Kubernetes-Study/assets/42735894/2d691be1-c9e2-40ae-a6d9-9c23dafa3693)


<br><br>

# ğŸ”” SSH íŒŒì¼ ì „ì†¡
---

<br>

## (a) Ubuntu - SCP(Secure Copy)ë¥¼ ì‚¬ìš©í•˜ëŠ” ì˜ˆ

```bash
# ë¡œì»¬ í˜¸ìŠ¤íŠ¸ì˜ [test.txt]ë¥¼ ì›ê²© í˜¸ìŠ¤íŠ¸ [dlp.srv.test]ì— ë³µì‚¬
$ scp ./test.txt root@dlp.srv.test:~/
root@dlp.srv.test's password:
test.txt                                      100%   10MB  41.5MB/s   00:00
```

```bash
# ì›ê²© í˜¸ìŠ¤íŠ¸ [dlp.srv.test]ì˜ [~/tet.txt]ë¥¼ localhostì— ë³µì‚¬
$ scp root@dlp.srv.test:~/test.txt ./test.txt
root@dlp.srv.test's password:
test.txt                                      100%   10MB  91.0MB/s   00:00
```

<br>

## (b) Ubuntu - SFTP(SSH File Transfer Protocol)ë¥¼ ì‚¬ìš©í•˜ëŠ” ì˜ˆ

> SFTP ì„œë²„ ê¸°ëŠ¥ì€ ê¸°ë³¸ì ìœ¼ë¡œ í™œì„±í™”ë˜ì§€ë§Œ ê·¸ë ‡ì§€ ì•Šì€ ê²½ìš° [/etc/ssh/sshd_config]ì— [Subsystem sftp /usr/lib/openssh/sftp-server] ì¤„ì„ ì¶”ê°€í•˜ë„ë¡ í™œì„±í™”í•©ë‹ˆë‹¤.

```bash
# sftp [Option] [user@host]
$ sftp root@dlp.srv.test
root@dlp.srv.test's password:
Connected to dlp.srv.test.
sftp>

# ì›ê²© í˜¸ìŠ¤íŠ¸ì˜ í˜„ì¬ ë””ë ‰í† ë¦¬ í‘œì‹œ
sftp> pwd
Remote working directory: /root

# ë¡œì»¬ í˜¸ìŠ¤íŠ¸ì— í˜„ì¬ ë””ë ‰í† ë¦¬ í‘œì‹œ
sftp> !pwd
/root

# ì›ê²© í˜¸ìŠ¤íŠ¸ì˜ í˜„ì¬ ë””ë ‰í† ë¦¬ì— íŒŒì¼ í‘œì‹œ
sftp> ls -l
drwx------    3 root     root         4096 Jun  5 15:55 snap
-rw-r--r--    1 root     root     10485760 Jun  5 16:40 test.txt

# ë¡œì»¬ í˜¸ìŠ¤íŠ¸ì˜ í˜„ì¬ ë””ë ‰í„°ë¦¬ì— íŒŒì¼ í‘œì‹œ
sftp> !ls -l
total 24
-rw-r--r-- 1 root root  239 May  6 23:18 arith.awk
-rw-r--r-- 1 root root   74 May  6 22:21 a.sed
-rw-r--r-- 1 root root   28 May  6 22:24 c.sed
-rw-r--r-- 1 root root  244 May  6 23:12 disk_total.awk
-rw-r--r-- 1 root root   74 May  6 22:15 i.sed
drwx------ 3 root root 4096 May  3 13:12 snap

# ë””ë ‰í„°ë¦¬ ë³€ê²½
sftp> cd /var/log/
sftp> pwd
Remote working directory: /var/log

# ì›ê²© í˜¸ìŠ¤íŠ¸ì— íŒŒì¼ ì—…ë¡œë“œ
sftp>  put c.sed c-copy.sed
Uploading c.sed to /root/c-copy.sed
c.sed                                                                         100%   28    18.5KB/s   00:00

# ì›ê²© í˜¸ìŠ¤íŠ¸ì—ì„œ íŒŒì¼ ë‹¤ìš´ë¡œë“œ
sftp> get test.txt
Fetching /root/test.txt to test.txt
test.txt                                                                      100%   10MB 102.7MB/s   00:00


# ì›ê²© í˜¸ìŠ¤íŠ¸ì— ë””ë ‰í† ë¦¬ ìƒì„±
sftp> mkdir testdir
sftp> ls -l
-rw-r--r--    1 root     root           28 Jun  5 16:47 c-copy.sed
drwx------    3 root     root         4096 Jun  5 15:55 snap
-rw-r--r--    1 root     root     10485760 Jun  5 16:40 test.txt
drwxr-xr-x    2 root     root         4096 Jun  5 16:48 testdir

# ì›ê²© í˜¸ìŠ¤íŠ¸ì—ì„œ ë””ë ‰í† ë¦¬ ì‚­ì œ
sftp> rmdir testdir
sftp> ls -l
-rw-r--r--    1 root     root           28 Jun  5 16:47 c-copy.sed
drwx------    3 root     root         4096 Jun  5 15:55 snap
-rw-r--r--    1 root     root     10485760 Jun  5 16:40 test.txt

# ì›ê²© í˜¸ìŠ¤íŠ¸ì—ì„œ íŒŒì¼ ì‚­ì œ
sftp> rm c-copy.sed
Removing /root/c-copy.sed


# ![command]ë¥¼ ì‚¬ìš©í•˜ì—¬ ëª…ë ¹ ì‹¤í–‰
sftp> !cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
...

# exit
sftp> quit
221 Goodbye.
```

<br>

## (c) Windows - WinSCPì„ ì‚¬ìš©í•˜ëŠ” ì˜ˆ

> WinSCP ì„¤ì¹˜ : <https://winscp.net/eng/download.php>

![03](https://user-images.githubusercontent.com/42735894/232214981-002e4c99-ffc3-4ea2-9f99-3a3e3f16c43e.PNG)

![04](https://user-images.githubusercontent.com/42735894/232214989-5d24fcd2-91c5-4ca6-b81b-98a3e1e8fd6e.PNG)

<br><br>

# ğŸ”” SSH í‚¤ìŒ ì¸ì¦
---

<br>

## (a) Ubuntu

<br>

<big> **â–  ê° ì‚¬ìš©ìë³„ë¡œ Key-Pairë¥¼ ìƒì„±í•˜ì—¬ SSH Server Hostì—ì„œ ì¼ë°˜ ì‚¬ìš©ìì™€ ë¡œê·¸ì¸í•˜ê³  ë‹¤ìŒê³¼ ê°™ì´ ì‘ì—…í•©ë‹ˆë‹¤.** </big>

```bash
$ ssh-keygen
Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa):
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /root/.ssh/id_rsa
Your public key has been saved in /root/.ssh/id_rsa.pub
The key fingerprint is:
SHA256:H1fO+XsJHHHkveLtqn1CUdAzbFwBg/LTvmNXmHQ780A root@ubuntu
The key's randomart image is:
+---[RSA 3072]----+
|            .+Bo+|
|         . . .oX.|
|          o . *.+|
|           o BE.o|
|        S . =+*=.|
|         . o.=*=.|
|          . ..ooB|
|            .=.++|
|           .oo*o.|
+----[SHA256]-----+


$ ls -al ~/.ssh
total 16
drwx------ 2 root root 4096 Jun  5 16:52 .
drwx------ 5 root root 4096 Jun  5 16:49 ..
-rw------- 1 root root    0 Jun  5 15:55 authorized_keys
-rw------- 1 root root 2590 Jun  5 16:52 id_rsa
-rw-r--r-- 1 root root  565 Jun  5 16:52 id_rsa.pub


$ cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys
```

<br>

<big> **â–  ì„œë²„ì— ì‘ì„±ëœ ê°œì¸ í‚¤ë¥¼ í´ë¼ì´ì–¸íŠ¸ë¡œ ì „ì†¡í•œ í›„ í‚¤ ìŒ ì¸ì¦í™•ì¸ìœ¼ë¡œ ë¡œê·¸ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.** </big>

```bash
$ mkdir ~/.ssh

$ chmod 700 ~/.ssh

# ê°œì¸ í‚¤ë¥¼ ë¡œì»¬ ssh ë””ë ‰í† ë¦¬ë¡œ ì „ì†¡
$ scp root@dlp.srv.test:~/.ssh/id_rsa ~/.ssh
root@dlp.srv.test's password:
id_rsa                                                                        100% 2590   510.2KB/s   00:00

$ ssh root@dlp.srv.test
Welcome to Ubuntu 22.04.2 LTS (GNU/Linux 5.15.0-73-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Mon Jun  5 05:24:47 PM KST 2023

  System load:  0.0               Processes:              201
  Usage of /:   47.0% of 9.75GB   Users logged in:        1
  Memory usage: 17%               IPv4 address for ens32: 192.168.219.195
  Swap usage:   0%


Expanded Security Maintenance for Applications is not enabled.

0 updates can be applied immediately.

Enable ESM Apps to receive additional future security updates.
See https://ubuntu.com/esm or run: sudo pro status


Last login: Mon Jun  5 16:36:13 2023 from 192.168.219.1
```

<br>

<big> **â–  ssh-copy-id** </big>

+ ssh-copy-idì€ ì›ê²© ì„œë²„ì— ê³µê°œ í‚¤ë¥¼ ë³µì‚¬í•˜ê³  ì„¤ì •í•˜ëŠ” ëª…ë ¹ìœ¼ë¡œ ì´ ëª…ë ¹ì„ ì‚¬ìš©í•˜ë©´ ì›ê²© ì„œë²„ì— sshë¡œ ì ‘ì†í•  ë•Œ ì•”í˜¸ë¥¼ ì…ë ¥í•˜ì§€ ì•Šì•„ë„ ë©ë‹ˆë‹¤.

+ ì´ ëª…ë ¹ì€ ë¡œì»¬ ì»´í“¨í„°ì˜ ê³µê°œ í‚¤ë¥¼ ì›ê²© ì„œë²„ì˜ authorized_keys íŒŒì¼ì— ì¶”ê°€í•©ë‹ˆë‹¤.

```bash
# ssh-copy-id -i <ê³µê°œ í‚¤ íŒŒì¼> <ì‚¬ìš©ìëª…>@<ì„œë²„ ì£¼ì†Œ>
$ sh-copy-id -i ~/.ssh/id_rsa.pub 192.168.219.192
/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: "/root/.ssh/id_rsa.pub"
The authenticity of host '192.168.219.192 (192.168.219.192)' can't be established.
ED25519 key fingerprint is SHA256:Q76AX6tqnUYt6ARI6TaTQlVJid3Wc/myrGBN3Yddpqw.
This key is not known by any other names
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys
root@192.168.219.192's password:

Number of key(s) added: 1

Now try logging into the machine, with:   "ssh '192.168.219.192'"
and check to make sure that only the key(s) you wanted were added.


$ ssh 192.168.219.192
Welcome to Ubuntu 22.04.2 LTS (GNU/Linux 5.15.0-71-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Mon Jun  5 05:29:04 PM KST 2023

  System load:  0.00537109375     Processes:              204
  Usage of /:   48.3% of 9.75GB   Users logged in:        1
  Memory usage: 18%               IPv4 address for ens32: 192.168.219.192
  Swap usage:   0%

 * Strictly confined Kubernetes makes edge and IoT secure. Learn how MicroK8s
   just raised the bar for easy, resilient and secure K8s cluster deployment.

   https://ubuntu.com/engage/secure-kubernetes-at-the-edge

 * Introducing Expanded Security Maintenance for Applications.
   Receive updates to over 25,000 software packages with your
   Ubuntu Pro subscription. Free for personal use.

     https://ubuntu.com/pro

Expanded Security Maintenance for Applications is not enabled.

43 updates can be applied immediately.
To see these additional updates run: apt list --upgradable

Enable ESM Apps to receive additional future security updates.
See https://ubuntu.com/esm or run: sudo pro status


Last login: Mon Jun  5 16:38:07 2023 from 192.168.219.1
```

<br>

## (b) Windows í´ë¼ì´ì–¸íŠ¸ì—ì„œ SSH í‚¤ ìŒ ì¸ì¦

<br>

<big> **â–  ìœˆë„ìš°ì¦ˆ í´ë¼ì´ì–¸íŠ¸ì—ì„œ SSH ì„œë²„ì— ë¡œê·¸ì¸í•˜ëŠ” ì˜ˆì œë¡œ, ê·¸ ì „ì— Windows Clientì— ê°œì¸ í‚¤ë¥¼ ì „ì†¡í•œë‹¤.** </big>

<br>

<big> **â–  /etc/ssh/sshd_configì—ì„œ PubkeyAuthentication ì„¤ì •** </big>

```bash
$ cat /etc/ssh/sshd_config | grep Pubkey
PubkeyAuthentication yes
```

<br>

<big> **â–  [Puttygen.exe]ë¥¼ ì‹¤í–‰í•œ í›„ ë‹¤ìŒ ì°½ì—ì„œ [Load] ë²„íŠ¼ì„ í´ë¦­** </big>

![1](https://user-images.githubusercontent.com/42735894/232234483-0447c50f-cf28-4c31-bacb-98cef490db27.PNG){: width="100%" height="100%"}{: .align-center}

<br>

<big> **â–  [Save private key] ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì›í•˜ëŠ” íŒŒì¼ ì´ë¦„ìœ¼ë¡œ ì›í•˜ëŠ” í´ë”ì— ì €ì¥** </big>

![2](https://user-images.githubusercontent.com/42735894/232234484-eb47789a-bf86-4dc2-81c1-c4a3b764fd08.PNG){: width="100%" height="100%"}{: .align-center}

<br>

<big> **â–  ì„œë²„ì— SSH í‚¤ ë“±ë¡ - Puttygen.exeì—ì„œ Public Key for pasting ... ë¶€ë¶„ì„ ë³µì‚¬í•´ì„œ ".ssh/authorized_keys" íŒŒì¼ì— ì €ì¥** </big> 

![3](https://user-images.githubusercontent.com/42735894/232234522-c1df0dd9-9ead-40c1-a825-dcca21211231.PNG){: width="70%" height="70%"}{: .align-center}

```bash
$ vi .ssh/authorized_keys

$ cat .ssh/authorized_keys
ssh-rsa AAAAB3NzaC1yc2EAAAAD....
```

<br>

<big> **â–  Connection > Data > Login-detailsì—ì„œ SSH í‚¤ë¥¼ ì„¤ì •í•œ ê³„ì •ì„ ì…ë ¥** </big> 

![4](https://user-images.githubusercontent.com/42735894/232234665-700d2e56-b4b8-49f3-a03b-ed1c4850dbcb.PNG){: width="70%" height="70%"}{: .align-center}

<br>

<big> **â–  Connection > SSH > Authì—ì„œ Private key file for authenticationì˜ Browse ë²„íŠ¼ì„ í´ë¦­ í›„ Private keyë¥¼ ì„ íƒ** </big> 

![5](https://user-images.githubusercontent.com/42735894/232234798-fef0059d-1fe2-4b96-8b57-6ad2f57aa8fe.PNG){: width="100%" height="100%"}{: .align-center}

<br>

<big> **â–  Sessionìœ¼ë¡œ ëŒì•„ì™€ì„œ (ì˜µì…˜ì„ Saveë¥¼ í•˜ì‹­ì‡¼) ì ‘ì†** </big> 

![6](https://user-images.githubusercontent.com/42735894/232234830-5f78e7a3-af08-4332-a0e5-ba2db589586b.PNG){: width="70%" height="70%"}{: .align-center}

<br>

<big> **â–  ì•”í˜¸ ì—†ì´ SSH í‚¤ë¡œ ì ‘ì†ì´ ë˜ëŠ”ì§€ í™•ì¸** </big> 

![7](https://user-images.githubusercontent.com/42735894/232234932-30424381-7d81-4d37-b5cc-c49d874a08b8.PNG){: width="70%" height="70%"}{: .align-center}

<br>