---
title:  "[Rocky] 04. FTP ì„œë²„ êµ¬ì„±" 

categories:
  - ROCKY
tags:
  - [rocky, linux]

toc: true
toc_sticky: true

date: 2022-08-10
last_modified_at: 2022-08-10
---
<br>

# ğŸ”” vsftpd ì„¤ì • íŒŒì¼
---

<style>
table {
    font-size: 12pt;
}
table th:first-of-type {
    width: 5%;
}
table th:nth-of-type(2) {
    width: 15%;
}
table th:nth-of-type(3) {
    width: 50%;
}
table th:nth-of-type(4) {
    width: 30%;
}
big {
    font-size: 15pt;
}
</style>

<br>

| íŒŒì¼ëª…                      | ì„¤ëª…                                  |
| ---------------------------| --------------------------------------|
| /etc/vsftpd/vsftpd.conf     | vsftpd í™˜ê²½ ì„¤ì • íŒŒì¼                 |
| /etc/vsftpd/ftpusers        | ë¡œê·¸ì¸ ê¸ˆì§€ ê³„ì • ì„¤ì • íŒŒì¼            |
| /etc/vsftpd/user_list       | userlist_deny ì„¤ì •ì— ë”°ë¥¸ ê³„ì • í—ˆìš©ì—¬ë¶€ ì„¤ì • íŒŒì¼ |
| /usr/sbin/vsftpd            | vsftpd binary íŒŒì¼                     |
| /etc/xinetd.d/vsftpd        | xinetd mode í™˜ê²½ ì„¤ì • íŒŒì¼            |
| /etc/pam.d/vsftpd           | vsftpd PAM ì¸ì¦ íŒŒì¼                   |

<br>

# ğŸ”” vsftpd í™˜ê²½ ì„¤ì • (/etc/vsftpd/vsftpd.conf)
---

<br>

<big> **â–  ìµëª… ê³„ì • ì ‘ì† ì„¤ì •** </big>

| íŒŒì¼ëª… | ì„¤ ëª… |
| --- | --- |
| anonymous_enable=YES(or NO) | ìµëª… ì ‘ì† í—ˆìš© ì—¬ë¶€ |
| anon_mkdir_write_enable=YES(or NO) | ìµëª… ì‚¬ìš©ìì˜ ë””ë ‰í„°ë¦¬ ìƒì„± í—ˆìš© ì—¬ë¶€ |
| anon_upload_enable=NO(or YES) | ìµëª… ì‚¬ìš©ìì˜ ì—…ë¡œë“œ í—ˆìš© ì—¬ë¶€ |
| anon_other_write_enable=NO(or YES) | ìµëª… ì‚¬ìš©ìì˜ ë””ë ‰í„°ë¦¬ ìƒì„±/ì—…ë¡œë“œ ì´ì™¸ì˜ ì“°ê¸° ê¶Œí•œì´ í•„ìš”í•œ ì‚­ì œ, ì´ë¦„ë³€ê²½ ë“±ì˜ í—ˆìš© ì—¬ë¶€ |
| anon_world_readable_only=YES(or NO) | ìµëª… ì‚¬ìš©ì ê³„ì •(ftp) ì†Œìœ ì˜ ì½ê¸° ê¶Œí•œì˜ íŒŒì¼ë§Œ ë‹¤ìš´ë¡œë“œ í—ˆìš© ì—¬ë¶€ |
| no_anon_password=NO(or YES) | ìµëª… ì‚¬ìš©ì ì ‘ì† ì‹œ password ì—†ì´ ë¡œê·¸ì¸ì„ í—ˆìš© í•  ê²ƒì¸ì§€ ì—¬ë¶€ |
| anon_max_rate=0(ì „ì†¡ë¥ , B/s) | ìµëª… ì‚¬ìš©ìì˜ ë‹¤ìš´ë¡œë“œ ìµœëŒ€ ì „ì†¡ë¥ ì„ ì§€ì •(0=ë¬´ì œí•œ) |
| anon_umask=077(ê¶Œí•œì„¤ì •) | ìµëª… ì‚¬ìš©ìë¥¼ í†µí•´ ìƒì„±ë˜ëŠ” íŒŒì¼ ë° ë””ë ‰í„°ë¦¬ì˜ ê¸°ë³¸ ê¶Œí•œ |
| anon_root=/var/ftp/(í™ˆ ë””ë ‰í„°ë¦¬ ê²½ë¡œ) | ìµëª… ì‚¬ìš©ìì˜ í™ˆ ë””ë ‰í„°ë¦¬ ì§€ì • |
| ftp_username=ftp | ìµëª… ì‚¬ìš©ìì˜ ê³„ì • ì§€ì •(default=ftp) |

<br>

<big> **â–  ì¼ë°˜ ê³„ì • ì ‘ì† ì„¤ì •** </big>

| íŒŒì¼ | ì„¤ëª… |
| --- | --- |
| local_enable=YES(or NO) | ë¡œì»¬ ê³„ì • ì‚¬ìš©ì ì ‘ì† í—ˆìš© ì—¬ë¶€ |
| write_enable=YES(or NO) | ì“°ê¸° ê¶Œí•œ í—ˆìš© ì—¬ë¶€ |
| local_umask=022 | vsftpdë¥¼ í†µí•´ ìƒì„±ë˜ëŠ” íŒŒì¼ ë° ë””ë ‰í„°ë¦¬ì˜ ê¸°ë³¸ ê¶Œí•œ |
| dirlist_enable=YES(or NO) | LIST ëª…ë ¹ì˜ í—ˆìš© ì—¬ë¶€ |
| download_enable=YES(or NO) | ë‹¤ìš´ë¡œë“œ í—ˆìš© ì—¬ë¶€ |
| force_dot_files=NO(or YES) | ìˆ¨ê¹€íŒŒì¼ ì¶œë ¥ í—ˆìš© ì—¬ë¶€ |
| userlist_enable=NO(or YES) | userlist_listì˜ íŒŒì¼ì— ëª…ì‹œëœ ê³„ì •ë§Œ ì ‘ê·¼ í—ˆìš© ì—¬ë¶€ |
| userlist_file=/var/vsftpd/user_list(ê²½ë¡œ) | userlist íŒŒì¼ì˜ ê²½ë¡œ ì§€ì • |
| file_open_mode=0666 | ì—…ë¡œë“œ ëœ íŒŒì¼ì˜ ê¶Œí•œ ì§€ì • |
| deny_file={*.exe,*.mp3}(íŒŒì¼ëª…) | ì—…/ë‹¤ìš´ë¡œë“œë¥¼ ê¸ˆì§€í•  íŒŒì¼ ì§€ì • |
| hide_file={*.pdf,*.jpg}(íŒŒì¼ëª…) | ìˆ¨ê¹€ íŒŒì¼/ë””ë ‰í„°ë¦¬ë¥¼ ì§€ì •(ë‹¨, ê²½ë¡œë¥¼ ì•Œê³  ìˆìœ¼ë©´ ì§ì ‘ ë‹¤ìš´ë¡œë“œ ê°€ëŠ¥) |

<br>

<big> **â–  ì ‘ì† ì œí•œ ì„¤ì •** </big>

| íŒŒì¼                   | ì„¤ëª…                                                                 |
|------------------------|-----------------------------------------------------------------------|
| max_clients=50         | ìµœëŒ€ ì ‘ì† ì‚¬ìš©ì ìˆ˜ ì„¤ì •                                           |
| max_per_ip=2           | í•œ í˜¸ìŠ¤íŠ¸ë‹¹ ì ‘ì† í—ˆìš© íšŸìˆ˜ ì„¤ì •                                    |
| one_process_model=NO   | ì ‘ì†ë§ˆë‹¤ í•˜ë‚˜ì”©ì˜ í”„ë¡œì„¸ìŠ¤ë¡œ ë™ì‘ ì—¬ë¶€ ì„¤ì •                      |
| idle_session_timeout=120 | FTP ì—°ê²° ìœ ì§€ ì‹œê°„ ì„¤ì •(FTPëª…ë ¹ ì „ë‹¬ì˜ ì—¬ë¶€ë¡œ í™•ì¸)              |
| data_connection_time=300 | FTP ì—°ê²° ìœ ì§€ ì‹œê°„ ì„¤ì •(FTP dataì „ì†¡ ì—¬ë¶€ë¡œ í™•ì¸)                |
| connect_timeout=60     | FTP ì—°ê²° ìœ ì§€ ì‹œê°„ ì„¤ì •(ì ‘ì† ì—¬ë¶€ë¡œ í™•ì¸)                         |
| accept_timeout=60      | Passive Mode ì ‘ì† ì œí•œ ì‹œê°„ ì„¤ì •                                    |
| local_max_rate=0       | ìµœëŒ€ ì „ì†¡ë¥  ì„¤ì •(0 â†’ ë¬´ì œí•œ)                                      |
| ftp_banner=welcome     | ì„œë²„ì— ì ‘ì†í•  ë•Œ ë³´ì—¬ì¤„ ë°°ë„ˆ ë‚´ìš© ì„¤ì •                            |
| tcp_wrappers=YES       | tcp_wrapper ì ìš© ì—¬ë¶€                                             |

<br>

<big> **â–  ë³´ì•ˆ ì„¤ì •** </big>

| íŒŒì¼ëª…                    | ì„¤ëª…                                                                                   |
|--------------------------|----------------------------------------------------------------------------------------|
| chroot_local_user=YES     | ë¡œì»¬ ì‚¬ìš©ìì˜ í™ˆë””ë ‰í„°ë¦¬ì— chroot ì ìš© ì—¬ë¶€                                            |
| chroot_list_enable=YES    | ìƒìœ„ ê²½ë¡œ ì´ë™ì„ í—ˆìš©í•  ì‚¬ìš©ì ê³„ì • ë¦¬ìŠ¤íŠ¸ ì‚¬ìš© ì—¬ë¶€                                  |
| chroot_list_file=/etc/vsftpd/chroot_list | ìƒìœ„ ê²½ë¡œ ì´ë™ì„ í—ˆìš©í•  ì‚¬ìš©ì ê³„ì • ë¦¬ìŠ¤íŠ¸íŒŒì¼ ì§€ì •              |
| hide_ids=NO               | ë‹¤ë¥¸ ê³„ì •ì˜ ì†Œìœ ê¶Œì„ ftp ê³„ì • ì†Œìœ ê¶Œìœ¼ë¡œ ëŒ€ì²´í•  ê²ƒì¸ì§€ ì—¬ë¶€(NO=ëŒ€ì²´)                |
| ls_recuse_enable=YES      | ls -R ëª…ë ¹ í—ˆìš© ì—¬ë¶€                                                                   |
| connect_from_port_20=YES  | 20ë²ˆ portë¥¼ ì´ìš©í•œ ë°ì´í„° ì—°ê²° í—ˆìš© ì—¬ë¶€                                             |
| ascii_upload_enable=YES | ASCII í˜•íƒœë¡œ ì—…ë¡œë“œ í—ˆìš© ì—¬ë¶€                                                        |
| ascii_download_enable=YES | ASCII í˜•íƒœë¡œ ë‹¤ìš´ë¡œë“œ í—ˆìš© ì—¬ë¶€                                                        |
| pam_service_name=vsftpd   | PAMì¸ì¦ ëª¨ë“ˆ íŒŒì¼ ì§€ì •                                                                 |

<br>

<big> **â–  ì—°ê²° ì„¤ì •** </big>

| íŒŒì¼ëª… | ì„¤ ëª… |
|--------|--------|
| listen | vsftpdë¥¼ standalone Modeë¡œ ì‹¤í–‰ í•¨ |
| listen_port | vsftpdì˜ ì œì–´ ì—°ê²°í¬íŠ¸ ì§€ì • |
| pasv_enable | Passive Mode ì§€ì› ì—¬ë¶€ |
| pasv_min_port | Passive Mode ë™ì‘ì—ì„œ ì„ íƒí•  portì˜ ìµœì†Œë²”ìœ„ ì§€ì •(default=0) |
| pasv_max_port | Passive Mode ë™ì‘ì—ì„œ ì„ íƒí•  portì˜ ìµœëŒ€ë²”ìœ„ ì§€ì •(default=0) |
| ftp_data_port | Active Modeì—ì„œ ì‚¬ìš©í•  portë²ˆí˜¸ ì§€ì • |

<br>

<big> **â–  ì—°ê²° ì„¤ì •** </big>

| íŒŒì¼ëª… | ì„¤ ëª… |
| --- | --- |
| xferlog_enable=YES(or NO) | vsftpdì˜ ë¡œê·¸ë¥¼ ë¡œê·¸íŒŒì¼ì— ê¸°ë¡í•  ê²ƒì¸ì§€ ì—¬ë¶€ |
| xferlog_file=/var/log/vsftpd.log(ê²½ë¡œ) | vsftpdì˜ ë¡œê·¸íŒŒì¼ ì§€ì • |
| xferlog_std_format=NO(or YES) | íŒŒì¼ ì†¡/ìˆ˜ì‹  ë¡œê·¸ë¥¼ xferlogë¡œ ì €ì¥í•  ê²ƒì¸ì§€ì˜ ì—¬ë¶€ |

<br>

# ğŸ”” FTP(vsftpd) ì„œë²„ êµ¬ì„±
---

<br>

<big> **â–  vsftpd ì„¤ì¹˜** </big>

```bash
$ dnf -y install vsftpd
```

<br>

<big> **â–  vsftpd ì„¤ì •** </big>

```bash
$ vi /etc/vsftpd/vsftpd.conf

# 12ë²ˆ ë¼ì¸: [NO]ë¡œ ê°’ì´ ì„¤ì •ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸ (ìµëª… ì‚¬ìš© ê¸ˆì§€)
anonymous_enable=NO

# 82, 83ë²ˆ ë¼ì¸: ì£¼ì„ í•´ì œ (ì•„ìŠ¤í‚¤ ëª¨ë“œ í—ˆìš©)
ascii_upload_enable=YES
ascii_download_enable=YES

# 100, 101ë²ˆ ë¼ì¸: ì£¼ì„ í•´ì œ (chroot í™œì„±í™”)
chroot_local_user=YES
chroot_list_enable=YES

# 103ë²ˆ ë¼ì¸: ì£¼ì„ í•´ì œ (chroot ë¦¬ìŠ¤íŠ¸ íŒŒì¼)
chroot_list_file=/etc/vsftpd/chroot_list

# 109ë²ˆ ë¼ì¸: ì£¼ì„ í•´ì œ
ls_recurse_enable=YES

# 114ë²ˆ ë¼ì¸: IPv4ë§Œ listení•˜ëŠ” ê²½ìš° YESë¡œ ì„¤ì •
# IPv4ì™€ IPv6 ëª¨ë‘ listen í•˜ëŠ” ê²½ìš° NOë¡œ ì„¤ì •
listen=NO

# 123ë²ˆ ë¼ì¸: IPv6ì„ listení•˜ì§€ ì•ŠëŠ” ê²½ìš° NOë¡œ ì„¤ì •
# IPv4ì™€ IPv6 ëª¨ë‘ listen í•˜ëŠ” ê²½ìš° YESë¡œ ì„¤ì •
listen_ipv6=YES

# ë§ˆì§€ë§‰ì— ì¶”ê°€ 
# root ë””ë ‰í† ë¦¬ ì§€ì • 
# ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ ì‚¬ìš©ìì˜ í™ˆ ë””ë ‰í† ë¦¬ê°€ FTP í™ˆ ë””ë ‰í† ë¦¬ê°€ ë¨
local_root=public_html

# ë¡œì»¬ ì‹œê°„ ì‚¬ìš©
use_localtime=YES

# seccomp í•„í„°ë¥¼ ìœ„í•´ ë„ê¸° (ë¡œê·¸ì¸ì´ ì•ˆë˜ë©´ ì´ ë¼ì¸ ì¶”ê°€)
seccomp_sandbox=NO


$ vi /etc/vsftpd/chroot_list

# í™ˆ ë””ë ‰í„°ë¦¬ë¡œ ì´ë™í•  ìˆ˜ ìˆëŠ” ì‚¬ìš©ì ì¶”ê°€
rocky


$ systemctl enable --now vsftpd
```

<br>

<big> **â–  SELinuxê°€ í™œì„±í™”ëœ ê²½ìš° boolean ì„¤ì •ì„ ë³€ê²½** </big>

```bash
setsebool -P ftpd_full_access on
```

<br>

<big> **â–  Firewalldê°€ ì‹¤í–‰ ì¤‘ì¸ ê²½ìš° FTP ì„œë¹„ìŠ¤ í¬íŠ¸ë¥¼ í—ˆìš©** </big>

```bash
$ firewall-cmd --add-service=ftp
success


$ firewall-cmd --runtime-to-permanent
success
```

<br>

# ğŸ”” FTP í´ë¼ì´ì–¸íŠ¸ (Rocky Linux)
---

<br>

<big> **â–  FTP í´ë¼ì´ì–¸íŠ¸ ì„¤ì¹˜** </big>

```bash
$ dnf -y install lftp
```

<br>

<big> **â–  FTP ì ‘ê·¼** </big>

```bash
# lftp [option] [hostname]
$ lftp -u test dlp.test.srv
Password:     # login user password
lftp test@dlp.test.srv:~>

# FTP ì„œë²„ì˜ í˜„ì¬ ë””ë ‰í† ë¦¬ í‘œì‹œ
lftp test@dlp.test.srv:~> pwd
ftp://test@dlp.test.srv

# localhostì— í˜„ì¬ ë””ë ‰í† ë¦¬ í‘œì‹œ
lftp test@dlp.test.srv:~> !pwd
/root

# FTP ì„œë²„ì˜ í˜„ì¬ ë””ë ‰í† ë¦¬ì— ìˆëŠ” íŒŒì¼ í‘œì‹œ
lftp test@dlp.test.srv:~> ls
drwxr-xr-x    2 1000     1000           23 Jul 15 01:33 public_html
-rw-r--r--    1 1000     1000          399 Jul 15 16:32 test.py

# localhostì˜ í˜„ì¬ ë””ë ‰í† ë¦¬ì— ìˆëŠ” íŒŒì¼ í‘œì‹œ
lftp test@dlp.test.srv:~> !ls -l
total 12
-rw-rw-r-- 1 root root 10 Jul 15 14:30 redhat.txt
-rw-rw-r-- 1 root root 10 Jul 15 14:59 test2.txt
-rw-rw-r-- 1 root root 10 Jul 15 14:59 test.txt

# ë””ë ‰í† ë¦¬ ì´ë™
lftp test@dlp.test.srv:~> cd public_html
lftp test@dlp.test.srv:~/public_html> pwd
ftp://test@dlp.test.srv/%2Fhome/test/public_html

# FTP ì„œë²„ì— íŒŒì¼ ì—…ë¡œë“œ
# [-a]ëŠ” ascii ëª¨ë“œë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤(ë””í´íŠ¸ëŠ” ë°”ì´ë„ˆë¦¬ ëª¨ë“œì…ë‹ˆë‹¤)
lftp test@dlp.test.srv:~> put -a redhat.txt
22 bytes transferred
Total 2 files transferred
lftp test@dlp.test.srv:~> ls
drwxr-xr-x    2 1000     1000           23 Jul 15 01:33 public_html
-rw-r--r--    1 1000     1000           10 Jul 15 17:01 redhat.txt
-rw-r--r--    1 1000     1000          399 Jul 15 16:32 test.py
-rw-r--r--    1 1000     1000           10 Jul 15 17:01 test.txt

# ì¼ë¶€ íŒŒì¼ì„ FTP ì„œë²„ì— ì—…ë¡œë“œ
lftp test@dlp.test.srv:~> mput -a test.txt test2.txt
22 bytes transferred
Total 2 files transferred
lftp test@dlp.test.srv:~> ls
drwxr-xr-x    2 1000     1000           23 Jul 15 01:33 public_html
-rw-r--r--    1 1000     1000          399 Jul 15 16:32 test.py
-rw-r--r--    1 1000     1000           10 Jul 15 17:06 test.txt
-rw-r--r--    1 1000     1000           10 Jul 15 17:06 test2.txt

# [get/mget]ì„ ì‚¬ìš©í•  ë•Œ localhostì—ì„œ íŒŒì¼ì„ ë®ì–´ì“°ë„ë¡ ê¶Œí•œ ì„¤ì •
lftp test@dlp.test.srv:~> set xfer:clobber on 

# localhostì— íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œ
# [-a]ëŠ” ascii ëª¨ë“œë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤(ë””í´íŠ¸ëŠ” ë°”ì´ë„ˆë¦¬ ëª¨ë“œì…ë‹ˆë‹¤)
lftp test@dlp.test.srv:~> get -a test.py
416 bytes transferred
```

```bash
# ì¼ë¶€ íŒŒì¼ì„ localhostì— ë‹¤ìš´ë¡œë“œ
lftp test@dlp.test.srv:~> mget -a test.txt test2.txt
20 bytes transferred
Total 2 files transferred

# FTP ì„œë²„ì˜ í˜„ì¬ ë””ë ‰í† ë¦¬ì— ë””ë ‰í† ë¦¬ ìƒì„±
lftp test@dlp.test.srv:~> mkdir testdir
mkdir ok, `testdir' created
lftp test@dlp.test.srv:~> ls
drwxr-xr-x    2 1000     1000           23 Jul 15 01:33 public_html
-rw-r--r--    1 1000     1000          399 Jul 15 16:32 test.py
-rw-r--r--    1 1000     1000           10 Jul 15 17:06 test.txt
-rw-r--r--    1 1000     1000           10 Jul 15 17:06 test2.txt
drwxr-xr-x    2 1000     1000            6 Jul 15 17:16 testdir
226 Directory send OK.

# FTP ì„œë²„ì˜ í˜„ì¬ ë””ë ‰í† ë¦¬ì—ì„œ ë””ë ‰í† ë¦¬ ì œê±°
lftp test@dlp.test.srv:~> rmdir testdir
rmdir ok, `testdir' removed
lftp test@dlp.test.srv:~> ls
drwxr-xr-x    2 1000     1000           23 Jul 15 01:33 public_html
-rw-r--r--    1 1000     1000          399 Jul 15 16:32 test.py
-rw-r--r--    1 1000     1000           10 Jul 15 17:06 test.txt
-rw-r--r--    1 1000     1000           10 Jul 15 17:06 test2.txt

# FTP ì„œë²„ì—ì„œ íŒŒì¼ ì œê±°
lftp test@dlp.test.srv:~> rm test2.txt
rm ok, `test2.txt' removed
lftp test@dlp.test.srv:~> ls
drwxr-xr-x    2 1000     1000           23 Jul 15 01:33 public_html
-rw-r--r--    1 1000     1000          399 Jul 15 16:32 test.py
-rw-r--r--    1 1000     1000           10 Jul 15 17:06 test.txt

# FTP ì„œë²„ì—ì„œ ì¼ë¶€ íŒŒì¼ ì œê±°
lftp test@dlp.test.srv:~> mrm redhat.txt test.txt
rm ok, 2 files removed
lftp test@dlp.test.srv:~> ls
drwxr-xr-x    2 1000     1000           23 Jul 15 01:33 public_html

# ![command]ë¡œ ëª…ë ¹ ì‹¤í–‰
lftp test@dlp.test.srv:~> !cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/bin:/sbin/nologin
.....
.....
test:x:1001:1001::/home/test:/bin/bash

# exit
lftp test@dlp.test.srv:~> quit
221 Goodbye. 
```

