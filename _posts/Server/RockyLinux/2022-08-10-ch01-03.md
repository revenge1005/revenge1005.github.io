---
title:  "[Rocky] 02. SSH ì„œë²„ - (1)" 

categories:
  - ROCKY
tags:
  - [rocky, linux]

toc: true
toc_sticky: true

date: 2022-08-10
last_modified_at: 2022-08-10
---
<br>

# ğŸ”” SSHì—ì„œ ê°€ì¥ ì„¤ì • ë³€ê²½ì„ ë§ì´ í•˜ëŠ” í•­ëª©
---

<style>
table {
    font-size: 12pt;
}
table th:first-of-type {
    width: 5%;
}
table th:nth-of-type(2) {
    width: 15%;
}
table th:nth-of-type(3) {
    width: 50%;
}
table th:nth-of-type(4) {
    width: 30%;
}
big {
    font-size: 15pt;
}
</style>

<br>

<big> **â–  SSH í™˜ê²½ ì„¤ì •íŒŒì¼ ê²½ë¡œ : /etc/ssh/sshd_config** </big>

|ì„¤ì •|ë‚´ìš©|
|:---:|---|
|Port|SSH ê¸°ë³¸ í¬íŠ¸ì¸ 22ë²ˆì„ ë‹¤ë¥¸ ë²ˆí˜¸ë¡œ ë³€ê²½í•  ë•Œ ì£¼ë¡œ ì‚¬ìš©í•¨|
|PermitRootLogin|Root ê³„ì •ìœ¼ë¡œ SSH ì ‘ê·¼ì„ í—ˆìš©í• ì§€ ì—¬ë¶€, ê¸°ë³¸ì ìœ¼ë¡œ ì ‘ê·¼ ë¶ˆê°€í•¨|
|PasswordAuthentication|íŒ¨ìŠ¤ì›Œë“œë¥¼ ì´ìš©í•œ ì¸ì¦ì„ í—ˆìš©í• ì§€ì— ëŒ€í•œ ì—¬ë¶€, ê¸°ë³¸ì ìœ¼ë¡œ íŒ¨ìŠ¤ì›Œë“œë¡œ ì ‘ê·¼ì„|
|PubkeyAuthentication|í¼ë¸”ë¦­í‚¤ë¥¼ ì´ìš©í•œ ì¸ì¦ì„ í—ˆìš©í• ì§€ì— ëŒ€í•œ ì—¬ë¶€, ê¸°ë³¸ì ìœ¼ë¡œ í—ˆìš©í•¨|

<br>

# ğŸ”” íŒ¨ìŠ¤ì›Œë“œ ì¸ì¦
---

> Rocky Linuxë¥¼ ì„¤ì¹˜í•˜ë©´ OpenSSHëŠ” ì´ë¯¸ ê¸°ë³¸ì ìœ¼ë¡œ ì„¤ì¹˜ë˜ë¯€ë¡œ ìƒˆ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•  í•„ìš”ê°€ ì—†ìœ¼ë©° ê¸°ë³¸ì ìœ¼ë¡œ ì•”í˜¸ ì¸ì¦ì„ ì‚¬ìš©í•˜ì—¬ ë¡œê·¸ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ê¸°ë³¸ì ìœ¼ë¡œ ë£¨íŠ¸ ì‚¬ìš©ì ê³„ì •ì€ ë¡œê·¸ì¸ì´ í—ˆìš©ë˜ë¯€ë¡œ ì„¤ì •ì„ ë³€ê²½í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

<br>

<big> **â–  SSH ì„œë²„ - PermitRootLogin ì„¤ì •** </big>

```bash
$ vi /etc/ssh/sshd_config


# 43í–‰ : ë³€ê²½(ë£¨íŠ¸ ë¡œê·¸ì¸ ê¸ˆì§€)
PermitRootLogin no


$ systemctl restart sshd


# ë°©í™”ë²½ì´ ì‹¤í–‰ ì¤‘ì¸ ê²½ìš° SSH ì„œë¹„ìŠ¤ë¥¼ í—ˆìš©(SSHëŠ” [22/TCP]ë¥¼ ì‚¬ìš©)
$ firewall-cmd --add-service=ssh

$ firewall-cmd --runtime-to-permanent
```

<br>

<big> **â–  SSH í´ë¼ì´ì–¸íŠ¸ - Rocky Linux** </big>

```bash
$ dnf -y install openssh-clients


$ ssh test@192.168.219.102
The authenticity of host '192.168.219.102 (192.168.219.102)' can't be established.
ED25519 key fingerprint is SHA256:e6/oF5YcPGhSRPOa3So9QhoWYnHjUT78+zrewjVLWj0.
This key is not known by any other names
Are you sure you want to continue connecting (yes/no/[fingerprint])? ^C
[root@localhost ~]# ssh test@192.168.219.101
The authenticity of host '192.168.219.101 (192.168.219.101)' can't be established.
ED25519 key fingerprint is SHA256:e6/oF5YcPGhSRPOa3So9QhoWYnHjUT78+zrewjVLWj0.
This key is not known by any other names
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '192.168.219.101' (ED25519) to the list of known hosts.
test@192.168.219.101's password:
[test@localhost ~]$ pwd
/home/test


$ ssh test@192.168.219.101 "cat /etc/passwd"
test@192.168.219.101's password:
root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin
adm:x:3:4:adm:/var/adm:/sbin/nologin
lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin
sync:x:5:0:sync:/sbin:/bin/sync
shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown
...
```

<br>

<big> **â–  SSH í´ë¼ì´ì–¸íŠ¸ - Windows** </big>

![01-1](https://user-images.githubusercontent.com/42735894/232210005-f82705af-c678-4ce0-8103-04ea90a18164.PNG){: width="100%" height="100%"}{: .align-center}

![02](https://user-images.githubusercontent.com/42735894/232210003-d2224bcf-beb5-4ded-b4cd-0a69cae86b2e.PNG){: width="100%" height="100%"}{: .align-center}

<br><br>

# ğŸ”” SSH íŒŒì¼ ì „ì†¡
---

<br>

## (a) Rocky Linux - SCP(Secure Copy)ë¥¼ ì‚¬ìš©í•˜ëŠ” ì˜ˆ


```bash
# ë¡œì»¬ í˜¸ìŠ¤íŠ¸ì˜ [test.txt]ë¥¼ ì›ê²© í˜¸ìŠ¤íŠ¸ [node01.test.srv]ì— ë³µì‚¬
$ scp ./test.txt test@node01.test.srv:~/
test@node01.test.srv's password:
test.txt                                                                      100%   12    23.5KB/s   00:00
```

```bash
# ì›ê²© í˜¸ìŠ¤íŠ¸ [node01.test.srv]ì˜ [/home/rocky/tet.txt]ë¥¼ localhostì— ë³µì‚¬
$ scp test@node01.test.srv:/home/test/test.txt ./test.txt
test@node01.test.srv's password:
test.txt                                                                      100%   12    19.4KB/s   00:00
```

<br>

## (b) Rocky Linux - SFTP(SSH File Transfer Protocol)ë¥¼ ì‚¬ìš©í•˜ëŠ” ì˜ˆ

> SFTP ì„œë²„ ê¸°ëŠ¥ì€ ê¸°ë³¸ì ìœ¼ë¡œ í™œì„±í™”ë˜ì§€ë§Œ ê·¸ë ‡ì§€ ì•Šì€ ê²½ìš° [/etc/ssh/sshd_config]ì— [Subsystem sftp /usr/libexec/openssh/sftp-server] ì¤„ì„ ì¶”ê°€í•˜ë„ë¡ í™œì„±í™”í•©ë‹ˆë‹¤.

```bash
# sftp [Option] [user@host]
$ sftp test@node01.test.srv
test@node01.test.srv's password:
Connected to node01.test.srv.
sftp>

# ì›ê²© í˜¸ìŠ¤íŠ¸ì˜ í˜„ì¬ ë””ë ‰í† ë¦¬ í‘œì‹œ
sftp> pwd
Remote working directory: /home/test

# ë¡œì»¬ í˜¸ìŠ¤íŠ¸ì— í˜„ì¬ ë””ë ‰í† ë¦¬ í‘œì‹œ
sftp> !pwd
/root

# ì›ê²© í˜¸ìŠ¤íŠ¸ì˜ í˜„ì¬ ë””ë ‰í† ë¦¬ì— íŒŒì¼ í‘œì‹œ
sftp> ls -l
drwxr-xr-x    2 root     root            6 Apr 15 20:17 html
-rw-r--r--    1 test     test           12 Apr 15 20:08 test.txt

# ë¡œì»¬ í˜¸ìŠ¤íŠ¸ì˜ í˜„ì¬ ë””ë ‰í„°ë¦¬ì— íŒŒì¼ í‘œì‹œ
sftp> !ls -l
total 4
-rw-------. 1 root root 1009 Apr 13 00:14 anaconda-ks.cfg
-rw-r--r--. 1 root root    0 Apr 15 20:17 redhat.txt

# ë””ë ‰í„°ë¦¬ ë³€ê²½
sftp> cd html/
sftp> pwd
Remote working directory: /home/test/html

# ì›ê²© í˜¸ìŠ¤íŠ¸ì— íŒŒì¼ ì—…ë¡œë“œ
sftp> put redhat.txt redhat_copy.txt
Uploading redhat.txt to /home/test/html/redhat_copy.txt
redhat.txt                                                                    100%    0     0.0KB/s   00:00
sftp> ls -l
-rw-r--r--    1 test     test            0 Apr 15 20:22 redhat_copy.txt

# ì›ê²© í˜¸ìŠ¤íŠ¸ì—ì„œ íŒŒì¼ ë‹¤ìš´ë¡œë“œ
sftp> get redhat.txt
Fetching /home/test/html/redhat.txt to redhat.txt


# ì›ê²© í˜¸ìŠ¤íŠ¸ì— ë””ë ‰í† ë¦¬ ìƒì„±
sftp> mkdir testdir
sftp> ls -l
-rw-r--r--    1 test     test            0 Apr 15 20:24 redhat.txt
-rw-r--r--    1 test     test            0 Apr 15 20:22 redhat_copy.txt
drwxrwxr-x    2 test     test            6 Apr 15 20:28 testdir

# ì›ê²© í˜¸ìŠ¤íŠ¸ì—ì„œ ë””ë ‰í† ë¦¬ ì‚­ì œ
sftp> rmdir testdir
sftp> ls -l
-rw-r--r--    1 test     test            0 Apr 15 20:24 redhat.txt
-rw-r--r--    1 test     test            0 Apr 15 20:22 redhat_copy.txt

# ì›ê²© í˜¸ìŠ¤íŠ¸ì—ì„œ íŒŒì¼ ì‚­ì œ
sftp> rm redhat_copy.txt
Removing /home/test/html/redhat_copy.txt
sftp> ls -l
-rw-r--r--    1 test     test            0 Apr 15 20:24 redhat.txt

# ![command]ë¥¼ ì‚¬ìš©í•˜ì—¬ ëª…ë ¹ ì‹¤í–‰
sftp> !cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin
adm:x:3:4:adm:/var/adm:/sbin/nologin
lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin
...

# exit
sftp> quit
221 Goodbye.
```

<br>

## (c) Windows - WinSCPì„ ì‚¬ìš©í•˜ëŠ” ì˜ˆ

> WinSCP ì„¤ì¹˜ : <https://winscp.net/eng/download.php>

![03](https://user-images.githubusercontent.com/42735894/232214981-002e4c99-ffc3-4ea2-9f99-3a3e3f16c43e.PNG){: width="100%" height="100%"}{: .align-center}

![04](https://user-images.githubusercontent.com/42735894/232214989-5d24fcd2-91c5-4ca6-b81b-98a3e1e8fd6e.PNG){: width="100%" height="100%"}{: .align-center}

<br><br>

# ğŸ”” SSH í‚¤ìŒ ì¸ì¦
---

<br>

## (a) Rocky Linux 

<br>

<big> **â–  ê° ì‚¬ìš©ìë³„ë¡œ Key-Pairë¥¼ ìƒì„±í•˜ì—¬ SSH Server Hostì—ì„œ ì¼ë°˜ ì‚¬ìš©ìì™€ ë¡œê·¸ì¸í•˜ê³  ë‹¤ìŒê³¼ ê°™ì´ ì‘ì—…í•©ë‹ˆë‹¤.** </big>

```bash
[test@node01 ~]$ ssh-keygen
Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa):
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /root/.ssh/id_rsa
Your public key has been saved in /root/.ssh/id_rsa.pub
The key fingerprint is:
SHA256:ozKozFUZ7RfRyBRSVBOppIRT/EgZt5zHFz7RvTFl5eo root@localhost.localdomain
The key's randomart image is:
+---[RSA 3072]----+
|      ++BB=+oo. B|
|     o.=++=oo o*.|
|     .+.==.o +  =|
|      +o oo . .o |
|     o .S.    .  |
|   ..  ...   .   |
|  ..o .       E  |
|o..  o           |
|.o               |
+----[SHA256]-----+


[test@node01 ~]$ ls -al ~/.ssh
total 16
-rw-------. 1 root root 2610 Apr 15 20:43 id_rsa
-rw-r--r--. 1 root root  580 Apr 15 20:43 id_rsa.pub

[test@node01 ~]$ mv ~/.ssh/id_rsa.pub ~/.ssh/authorized_keys
```

<br>

<big> **â–  ì„œë²„ì— ì‘ì„±ëœ ê°œì¸ í‚¤ë¥¼ í´ë¼ì´ì–¸íŠ¸ë¡œ ì „ì†¡í•œ í›„ í‚¤ ìŒ ì¸ì¦í™•ì¸ìœ¼ë¡œ ë¡œê·¸ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.** </big>

```bash
# ê°œì¸ í‚¤ë¥¼ ë¡œì»¬ ssh ë””ë ‰í† ë¦¬ë¡œ ì „ì†¡
[test@node02 ~]$ scp test@node01.test.srv:/home/test/.ssh/id_rsa ~/.ssh/
test@node01.test.srv's password:
id_rsa                                                                        100% 2610     2.3MB/s   00:00

[test@node02 ~]$ ssh test@node01.test.srv
Last login: Sat Apr 15 20:47:30 2023
[test@localhost ~]$
```

<br>

<big> **â–  ssh-copy-id** </big>

+ ssh-copy-idì€ ì›ê²© ì„œë²„ì— ê³µê°œ í‚¤ë¥¼ ë³µì‚¬í•˜ê³  ì„¤ì •í•˜ëŠ” ëª…ë ¹ìœ¼ë¡œ ì´ ëª…ë ¹ì„ ì‚¬ìš©í•˜ë©´ ì›ê²© ì„œë²„ì— sshë¡œ ì ‘ì†í•  ë•Œ ì•”í˜¸ë¥¼ ì…ë ¥í•˜ì§€ ì•Šì•„ë„ ë©ë‹ˆë‹¤.

+ ì´ ëª…ë ¹ì€ ë¡œì»¬ ì»´í“¨í„°ì˜ ê³µê°œ í‚¤ë¥¼ ì›ê²© ì„œë²„ì˜ authorized_keys íŒŒì¼ì— ì¶”ê°€í•©ë‹ˆë‹¤.

```bash
# ssh-copy-id -i <ê³µê°œ í‚¤ íŒŒì¼> <ì‚¬ìš©ìëª…>@<ì„œë²„ ì£¼ì†Œ>
[test@node02 ~]$ ssh-copy-id -i ~/.ssh/id_rsa.pub node01.test.srv
/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: "/home/test/.ssh/id_rsa.pub"
The authenticity of host 'node01.test.srv (192.168.219.101)' can't be established.
ED25519 key fingerprint is SHA256:e6/oF5YcPGhSRPOa3So9QhoWYnHjUT78+zrewjVLWj0.
This key is not known by any other names
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys
test@node01.test.srv's password:

Number of key(s) added: 1

Now try logging into the machine, with:   "ssh 'node01.test.srv'"
and check to make sure that only the key(s) you wanted were added.

[test@node02 ~]$ ssh node01.test.srv
Last login: Sat Apr 15 21:02:06 2023 from 192.168.219.102
```

<br>

## (b) Windows í´ë¼ì´ì–¸íŠ¸ì—ì„œ SSH í‚¤ ìŒ ì¸ì¦

<br>

<big> **â–  ìœˆë„ìš°ì¦ˆ í´ë¼ì´ì–¸íŠ¸ì—ì„œ SSH ì„œë²„ì— ë¡œê·¸ì¸í•˜ëŠ” ì˜ˆì œë¡œ, ê·¸ ì „ì— Windows Clientì— ê°œì¸ í‚¤ë¥¼ ì „ì†¡í•œë‹¤.** </big>

<br>

<big> **â–  /etc/ssh/sshd_configì—ì„œ PubkeyAuthentication ì„¤ì •** </big>

```bash
$ cat /etc/ssh/sshd_config | grep Pubkey
PubkeyAuthentication yes
```

<br>

<big> **â–  [Puttygen.exe]ë¥¼ ì‹¤í–‰í•œ í›„ ë‹¤ìŒ ì°½ì—ì„œ [Load] ë²„íŠ¼ì„ í´ë¦­** </big>

![1](https://user-images.githubusercontent.com/42735894/232234483-0447c50f-cf28-4c31-bacb-98cef490db27.PNG){: width="100%" height="100%"}{: .align-center}

<br>

<big> **â–  [Save private key] ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì›í•˜ëŠ” íŒŒì¼ ì´ë¦„ìœ¼ë¡œ ì›í•˜ëŠ” í´ë”ì— ì €ì¥** </big>

![2](https://user-images.githubusercontent.com/42735894/232234484-eb47789a-bf86-4dc2-81c1-c4a3b764fd08.PNG){: width="100%" height="100%"}{: .align-center}

<br>

<big> **â–  ì„œë²„ì— SSH í‚¤ ë“±ë¡ - Puttygen.exeì—ì„œ Public Key for pasting ... ë¶€ë¶„ì„ ë³µì‚¬í•´ì„œ ".ssh/authorized_keys" íŒŒì¼ì— ì €ì¥** </big> 

![3](https://user-images.githubusercontent.com/42735894/232234522-c1df0dd9-9ead-40c1-a825-dcca21211231.PNG){: width="70%" height="70%"}{: .align-center}

```bash
$ vi .ssh/authorized_keys

$ cat .ssh/authorized_keys
ssh-rsa AAAAB3NzaC1yc2EAAAAD....
```

<br>

<big> **â–  Connection > Data > Login-detailsì—ì„œ SSH í‚¤ë¥¼ ì„¤ì •í•œ ê³„ì •ì„ ì…ë ¥** </big> 

![4](https://user-images.githubusercontent.com/42735894/232234665-700d2e56-b4b8-49f3-a03b-ed1c4850dbcb.PNG){: width="70%" height="70%"}{: .align-center}

<br>

<big> **â–  Connection > SSH > Authì—ì„œ Private key file for authenticationì˜ Browse ë²„íŠ¼ì„ í´ë¦­ í›„ Private keyë¥¼ ì„ íƒ** </big> 

![5](https://user-images.githubusercontent.com/42735894/232234798-fef0059d-1fe2-4b96-8b57-6ad2f57aa8fe.PNG){: width="100%" height="100%"}{: .align-center}

<br>

<big> **â–  Sessionìœ¼ë¡œ ëŒì•„ì™€ì„œ (ì˜µì…˜ì„ Saveë¥¼ í•˜ì‹­ì‡¼) ì ‘ì†** </big> 

![6](https://user-images.githubusercontent.com/42735894/232234830-5f78e7a3-af08-4332-a0e5-ba2db589586b.PNG){: width="70%" height="70%"}{: .align-center}

<br>

<big> **â–  ì•”í˜¸ ì—†ì´ SSH í‚¤ë¡œ ì ‘ì†ì´ ë˜ëŠ”ì§€ í™•ì¸** </big> 

![7](https://user-images.githubusercontent.com/42735894/232234932-30424381-7d81-4d37-b5cc-c49d874a08b8.PNG){: width="70%" height="70%"}{: .align-center}

<br>