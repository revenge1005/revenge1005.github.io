---
title:  "[Retry, k8s] 10. ì„œë¹„ìŠ¤ API" 

categories:
  - KUBERNETES
tags:
  - [kubernetes]

toc: true
toc_sticky: true

date: 2023-10-05
last_modified_at: 2023-10-05
---
# [Retry, k8s] 10. ì„œë¹„ìŠ¤ API
---

<style>
table {
    font-size: 12pt;
}
table th:first-of-type {
    width: 5%;
}
table th:nth-of-type(2) {
    width: 15%;
}
table th:nth-of-type(3) {
    width: 50%;
}
table th:nth-of-type(4) {
    width: 30%;
}
</style>

<br>

## ğŸ”” ì„œë¹„ìŠ¤ API ê°œìš”

> í´ëŸ¬ìŠ¤í„°ìƒì˜ ì»¨í…Œì´ë„ˆì— ëŒ€í•œ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì œê³µí•˜ê±°ë‚˜ ë ˆì´ë¸”ê³¼ ì¼ì¹˜í•˜ëŠ” ì»¨í…Œì´ë„ˆì˜ ë””ìŠ¤ì»¤ë²„ë¦¬ì— ì‚¬ìš©ë˜ëŠ” ë¦¬ì†ŒìŠ¤

<br>

### ğŸ“œ ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„° ë„¤íŠ¸ì›Œí¬ì™€ ì„œë¹„ìŠ¤

> ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” CNI í”ŒëŸ¬ê·¸ì¸ì„ ì‚¬ìš©í•˜ì—¬ íŒŒë“œ ê°„ ë„¤íŠ¸ì›Œí‚¹ì„ êµ¬í˜„í•˜ê³ , ì„œë¹„ìŠ¤ì™€ ì¸ê·¸ë ˆìŠ¤ ë¦¬ì†ŒìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ íŒŒë“œì™€ ì™¸ë¶€ì˜ í†µì‹ ì„ ì¶”ìƒí™”í•œë‹¤.


#### (1) ì»¨í…Œì´ë„ˆ ê°„ì˜ í†µì‹ 

+ íŒŒë“œëŠ” í•˜ë‚˜ ì´ìƒì˜ ì»¨í…Œì´ë„ˆë¡œ êµ¬ì„±ëœ ë…¼ë¦¬ì  ë‹¨ìœ„ë¡œ, ê°™ì€ íŒŒë“œ ë‚´ì˜ ì»¨í…Œì´ë„ˆëŠ” ë™ì¼í•œ IP ì£¼ì†Œì™€ í¬íŠ¸ë¥¼ ê³µìœ í•˜ê³  localhostë¥¼ í†µí•´ í†µì‹ í•  ìˆ˜ ìˆë‹¤.


#### (2) íŒŒë“œ ê°„ì˜ í†µì‹  (CNI)

+ CNI í”ŒëŸ¬ê·¸ì¸ì€ ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ì„ì— ì˜í•´ í˜¸ì¶œë˜ì–´ íŒŒë“œê°€ ìƒì„±/ì‚­ì œë  ë•Œ ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì¶”ê°€/ì œê±°í•˜ê³ , ë¼ìš°íŒ… ê·œì¹™ê³¼ IP ì£¼ì†Œ í• ë‹¹, ë„¤íŠ¸ì›Œí¬ ì •ì±…ì„ ì ìš©í•˜ëŠ” ì—­í• ì„ í•œë‹¤.

+ ëª¨ë“  íŒŒë“œëŠ” ê³ ìœ í•œ IP ì£¼ì†Œë¥¼ ê°€ì§€ë©°, ë‹¤ë¥¸ íŒŒë“œì™€ NAT ì—†ì´ í†µì‹ í•  ìˆ˜ ìˆë‹¤.

+ ëª¨ë“  ë…¸ë“œëŠ” ëª¨ë“  íŒŒë“œì™€ NAT ì—†ì´ í†µì‹ í•  ìˆ˜ ìˆë‹¤.


#### (3) íŒŒë“œì™€ ì„œë¹„ìŠ¤ ê°„ í†µì‹  (ì„œë¹„ìŠ¤, kube-proxy)

+ ì„œë¹„ìŠ¤ ë¦¬ì†ŒìŠ¤ëŠ” ì¼ì •í•œ IP ì£¼ì†Œì™€ í¬íŠ¸ë¥¼ ê°€ì§€ê³ , ë™ì¼í•œ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” íŒŒë“œë“¤ì˜ ì§‘í•©ì„ ì¶”ìƒí™”í•œ ê°œë…

+ ì„œë¹„ìŠ¤ ë¦¬ì†ŒìŠ¤ëŠ” íŒŒë“œì˜ IP ì£¼ì†Œê°€ ë³€ê²½ë˜ë”ë¼ë„ ë™ì¼í•œ IP ì£¼ì†Œì™€ í¬íŠ¸ë¥¼ ìœ ì§€í•˜ê¸° ë•Œë¬¸ì— í´ë¼ì´ì–¸íŠ¸ê°€ íŒŒë“œì˜ ìœ„ì¹˜ë¥¼ ì‹ ê²½ì“°ì§€ ì•Šê³  í†µì‹ í•  ìˆ˜ ìˆë‹¤.

+ kube-proxyëŠ” ê° ë…¸ë“œì—ì„œ ì‹¤í–‰ë˜ëŠ” êµ¬ì„±ìš”ì†Œë¡œ, ì„œë¹„ìŠ¤ IP ì£¼ì†Œì™€ í¬íŠ¸ì— ëŒ€í•œ ìš”ì²­ì„ íŒŒë“œì˜ IP ì£¼ì†Œì™€ í¬íŠ¸ë¡œ í”„ë¡ì‹œí•˜ëŠ” ì—­í• ì„ ìˆ˜í–‰í•œë‹¤.


#### (4) ì™¸ë¶€ì™€ ì„œë¹„ìŠ¤ ê°„ í†µì‹  (ì¸ê·¸ë ˆìŠ¤)

+ ì¸ê·¸ë ˆìŠ¤ ë¦¬ì†ŒìŠ¤ëŠ” ì™¸ë¶€ì—ì„œ í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì˜ ì„œë¹„ìŠ¤ë¡œ ì ‘ê·¼í•˜ê¸° ìœ„í•œ ê·œì¹™ë“¤ì„ ì •ì˜í•œ ê°œë…

+ ì¸ê·¸ë ˆìŠ¤ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ì¸ê·¸ë ˆìŠ¤ ë¦¬ì†ŒìŠ¤ì— ì •ì˜ëœ ê·œì¹™ë“¤ì„ ì‹¤ì œë¡œ êµ¬í˜„í•˜ëŠ” êµ¬ì„±ìš”ì†Œë¡œ, ë¡œë“œë°¸ëŸ°ì„œë‚˜ ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ ì—­í• ì„ ìˆ˜í–‰í•œë‹¤.

+ ì¸ê·¸ë ˆìŠ¤ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ íŒŒë“œì— ì ‘ê·¼í•˜ê¸° ìœ„í•´ì„œëŠ” CNI í”ŒëŸ¬ê·¸ì¸ê³¼ í˜¸í™˜ë˜ì–´ì•¼ í•œë‹¤.

<br>

### ğŸ“œ íŒŒë“œì— íŠ¸ë˜í”½ ë¡œë“œë°¸ëŸ°ì‹±

> ì„œë¹„ìŠ¤ëŠ” ìˆ˜ì‹ í•œ íŠ¸ë˜í”½ì„ ì—¬ëŸ¬ íŒŒë“œì— ë¡œë“œë°¸ëŸ°ì‹±í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤. 

![12121](https://user-images.githubusercontent.com/42735894/228496371-1c04044c-aa5b-4f0e-a8d4-7f792d90a55d.png){: width="70%" height="70%"}{: .align-center}

```bash
cat <<EOF > sample-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: sample-deployment
spec:
  replicas: 3
  selector:
    matchLabels:
      app: sample-app
  template:
    metadata:
      labels:
        app: sample-app
    spec:
      containers:
      - name: nginx-containers
        image: amsy810/echo-nginx:v2.0
EOF
```


```bash
$ kubectl get pod
NAME                                 READY   STATUS    RESTARTS   AGE
sample-deployment-79448fcf48-2kc5g   1/1     Running   0          111s
sample-deployment-79448fcf48-54g6x   1/1     Running   0          111s
sample-deployment-79448fcf48-6lzsb   1/1     Running   0          111s


# íŠ¹ì • JSON Path ê°’ë§Œ ì¶œë ¥
$ kubectl get pod sample-deployment-79448fcf48-2kc5g -o jsonpath='{.metadata.labels}'
{"app":"sample-app","pod-template-hash":"79448fcf48"}


# ì§€ì •í•œ ë ˆì´ë¸”ì„ ê°€ì§„ íŒŒë“œ ì •ë³´ ì¤‘ íŠ¹ì • JSON Pathë¥¼ ì»´ëŸ¼ìœ¼ë¡œ ì¶œë ¥
$ kubectl get pod -l app=sample-app -o custom-columns="NAME:{metadata.name},IP:{status.podIP}"
NAME                                 IP
sample-deployment-79448fcf48-2kc5g   10.38.0.3
sample-deployment-79448fcf48-54g6x   10.38.0.2
sample-deployment-79448fcf48-6lzsb   10.32.0.3
```


```bash
cat <<EOF > sample-clusterip.yaml
apiVersion: v1
kind: Service
metadata:
  name: sample-clusterip
spec:
  type: ClusterIP
  ports:
  - name: "http-port"
    protocol: "TCP"
    port: 8080
    targetPort: 80
  selector:
    app: sample-app
EOF
```


```bash
root@k8s-master:~/test# kubectl apply -f sample-clusterip.yaml
service/sample-clusterip created


$ kubectl get service sample-clusterip
NAME               TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)    AGE
sample-clusterip   ClusterIP   10.96.249.28   <none>        8080/TCP   21s


$ kubectl describe service sample-clusterip
Name:              sample-clusterip
Namespace:         default
Labels:            <none>
Annotations:       <none>
Selector:          app=sample-app
Type:              ClusterIP
IP Family Policy:  SingleStack
IP Families:       IPv4
IP:                10.96.249.28
IPs:               10.96.249.28
Port:              http-port  8080/TCP
TargetPort:        80/TCP
Endpoints:         10.32.0.3:80,10.38.0.2:80,10.38.0.3:80
Session Affinity:  None
Events:            <none>
```


```bash
# ì¼ì‹œì ìœ¼ë¡œ íŒŒë“œë¥¼ ì‹œì‘í•˜ì—¬ ì„œë¹„ìŠ¤ ì—”ë“œí¬ì¸íŠ¸ë¡œ ìš”ì²­

$ kubectl run --image=amsy810/tools:v2.0 --restart=Never --rm -i testpod --command -- curl -s http://10.96.249.28:8080
Host=10.96.249.28  Path=/  From=sample-deployment-79448fcf48-2kc5g  ClientIP=10.32.0.1  XFF=
pod "testpod" deleted

$ kubectl run --image=amsy810/tools:v2.0 --restart=Never --rm -i testpod --command -- curl -s http://10.96.249.28:8080
Host=10.96.249.28  Path=/  From=sample-deployment-79448fcf48-54g6x  ClientIP=10.32.0.1  XFF=
pod "testpod" deleted


$ kubectl run --image=amsy810/tools:v2.0 --restart=Never --rm -i testpod --command -- curl -s http://10.96.249.28:8080
Host=10.96.249.28  Path=/  From=sample-deployment-79448fcf48-6lzsb  ClientIP=10.32.0.1  XFF=
pod "testpod" deleted
```

<br>

### ğŸ“œ ì—¬ëŸ¬ í¬íŠ¸ í• ë‹¹

> í•˜ë‚˜ì˜ ì„œë¹„ìŠ¤ì— ì—¬ëŸ¬ í¬íŠ¸ë¥¼ í• ë‹¹í•  ìˆ˜ë„ ìˆë‹¤, ì˜ˆë¥¼ ë“¤ì–´ ClusterIPì˜ 8080/TCP í¬íŠ¸ë¡œì˜ ìš”ì²­ì€ íŒŒë“œ 80/TCPë¡œ ë¡œë“œë°¸ëŸ°ì‹±í•˜ê³ , ClusterIPì˜ 8443/TCP í¬íŠ¸ë¡œì˜ ìš”ì²­ì€ íŒŒë“œ 443/TCPë¡œ ë¡œë“œë°¸ëŸ°ì‹±í•œë‹¤.

![2131312](https://user-images.githubusercontent.com/42735894/228497177-613c035f-3b0f-4246-8a0e-306342a06e68.png){: width="70%" height="70%"}{: .align-center}

```bash
cat <<EOF > sample-clusterip-multi.yaml
apiVersion: v1
kind: Service
metadata:
  name: sample-clusterip-multi
spec:
  type: ClusterIP
  ports:
  - name: "http-port"
    protocol: "TCP"
    port: 8080
    targetPort: 80
  - name: "https-port"
    protocol: "TCP"
    port: 8443
    targetPort: 443
  selector:
    app: sample-app
EOF 
```

<br>

### ğŸ“œ ì´ë¦„ì„ ì‚¬ìš©í•œ í¬íŠ¸ ì°¸ì¡°

> íŒŒë“œì˜ í¬íŠ¸ ì •ì˜ì— ì´ë¦„ì„ ì§€ì •í•´ ë†“ìœ¼ë©´ ì´ë¦„ì„ ì‚¬ìš©í•˜ì—¬ ì°¸ì¡°í•  ìˆ˜ìˆë‹¤. 

```bash
cat <<EOF > sample-named-port-pods.yaml
apiVersion: v1
kind: Pod
metadata:
  name: sample-named-port-pod-80
  labels:
    app: sample-app
spec:
  containers:
  - name: nginx-container
    image: amsy810/echo-nginx:v2.0
    ports:
    - name: http 
      containerPort: 80
---
apiVersion: v1
kind: Pod
metadata:
  name: sample-named-port-pod-81
  labels:
    app: sample-app
spec:
  containers:
  - name: nginx-container
    image: amsy810/echo-nginx:v2.0
    env:
    - name: NGINX_PORT
      value: "81"
    ports:
    - name: http 
      containerPort: 81
EOF
```

```bash
cat <<EOF > sample-named-port-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: sample-named-port-service
spec:
  type: ClusterIP
  ports:
  - name: "http-port"
    protocol: "TCP"
    port: 8080
    targetPort: http
  selector:
    app: sample-app
EOF
```

```bash
# ì„œë¹„ìŠ¤ ëª©ì ì§€ ì—”ë“œí¬ì¸ë“œ í™•ì¸
$ kubectl describe service sample-named-port-service
Name:              sample-named-port-service
Namespace:         default
Labels:            <none>
Annotations:       <none>
Selector:          app=sample-app
Type:              ClusterIP
IP Family Policy:  SingleStack
IP Families:       IPv4
IP:                10.106.179.157
IPs:               10.106.179.157
Port:              http-port  8080/TCP
TargetPort:        http/TCP
Endpoints:         10.38.0.2:80,10.32.0.3:81
Session Affinity:  None
Events:            <none>


# íŒŒë“œ IP ì£¼ì†Œ í™•ì¸
$ kubectl get pod -o wide
NAME                       READY   STATUS    RESTARTS   AGE   IP          NODE         NOMINATED NODE   READINESS GATES
sample-named-port-pod-80   1/1     Running   0          88s   10.38.0.2   k8s-node01   <none>           <none>
sample-named-port-pod-81   1/1     Running   0          88s   10.32.0.3   k8s-node02   <none>           <none>


$ curl 10.106.179.157:8080
Host=10.106.179.157  Path=/  From=sample-named-port-pod-81  ClientIP=10.40.0.0  XFF=


$ curl 10.106.179.157:8080
Host=10.106.179.157  Path=/  From=sample-named-port-pod-80  ClientIP=10.40.0.0  XFF=
```

<br>

### ğŸ“œ í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ DNSì™€ ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬

> ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬ ê¸°ëŠ¥ì„ ì„œë¹„ìŠ¤ê°€ ì œê³µí•˜ê³  ìˆë‹¤.

+ ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬ë€ ì„œë¹„ìŠ¤ì— ì†í•´ ìˆëŠ” íŒŒë“œë¥¼ ë³´ì—¬ì£¼ê±°ë‚˜ ì„œë¹„ìŠ¤ëª…ì—ì„œ ì—”ë“œí¬ì¸íŠ¸ ì •ë³´ë¥¼ ë°˜í™˜í•˜ëŠ” ê²ƒì„ ë§í•œë‹¤.

+ ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬ ë°©ë²•ì€ í¬ê²Œ ì„¸ ê°€ì§€ê°€ ìˆìœ¼ë©°, ê·¸ ì¤‘ DNSë¥¼ ì‚¬ìš©í•œ ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬ëŠ” í´ëŸ¬ìŠ¤í„°ì•ˆì— ìˆëŠ” DNS ì„œë²„(í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ DNS)ì— ìë™ìœ¼ë¡œ ë“±ë¡ë˜ëŠ” ì„œë¹„ìŠ¤ ì—”ë“œí¬ì¸íŠ¸ ì •ë³´ë¥¼ ì‚¬ìš©í•œë‹¤.


#### (1) í™˜ê²½ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•œ ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬

+ íŒŒë“œ ë‚´ë¶€ì—ì„œëŠ” í™˜ê²½ ë³€ìˆ˜ì—ì„œë„ ê°™ì€ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì„œë¹„ìŠ¤ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.("-"ì´ í¬í•¨ëœ ì„œë¹„ìŠ¤ëª…ì€ "_"ë¡œ ë³€ê²½ëœ í›„ ëŒ€ë¬¸ìë¡œ ë³€í™˜ë¨)

+ ê·¸ëŸ¬ë‚˜ íŒŒë“œê°€ ìƒì„±ëœ ì„œë¹„ìŠ¤ ìƒì„±ì´ë‚˜ ì‚­ì œì— ë”°ë¼ ë³€ê²½ëœ í™˜ê²½ ë³€ìˆ˜ê°€ ë¨¼ì € ê¸°ë™í•œ íŒŒë“œ í™˜ê²½ì—ëŠ” ìë™ìœ¼ë¡œ ë‹¤ì‹œ ë“±ë¡ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ì˜ˆê¸°ì¹˜ ëª»í•œ ì¥ì• ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ë¨¼ì € ìƒì„±í•œ íŒŒë“œë¥¼ ë‹¤ì‹œ ìƒì„±í•˜ì.

```bash
# í™˜ê²½ ë³€ìˆ˜ì— ë“±ë¡ëœ ì„œë¹„ìŠ¤ ì •ë³´ í™•ì¸
$ kubectl exec -it sample-deployment-79448fcf48-2bgkv -- env | grep -i kubernetes
KUBERNETES_PORT=tcp://10.96.0.1:443
KUBERNETES_PORT_443_TCP_ADDR=10.96.0.1
KUBERNETES_SERVICE_HOST=10.96.0.1
KUBERNETES_SERVICE_PORT_HTTPS=443
KUBERNETES_PORT_443_TCP_PORT=443
KUBERNETES_SERVICE_PORT=443
KUBERNETES_PORT_443_TCP=tcp://10.96.0.1:443
KUBERNETES_PORT_443_TCP_PROTO=tcp
```

+ ì•„ë˜ ì˜ˆì œì™€ ê°™ì´ íŒŒë“œì˜ spec.enableServiceLinksë¥¼ false(ê¸°ë³¸ê°’ true)ë¡œ ì„¤ì •í•˜ë©´ í™˜ê²½ ë³€ìˆ˜ ì¶”ê°€ë¥¼ ë¹„í™œì„±í™”í•  ìˆ˜ ìˆë‹¤.

```bash
apiVersion: apps/v1
kind: Deployment
metadata:
  name: sample-deployment-servicelinks
spec:
  replicas: 3
  selector:
    matchLabels:
      app: sample-app
  template:
    metadata:
      labels:
        app: sample-app
    spec:
      enableServiceLinks: false
      containers:
      - name: nginx-container
        image: amsy810/echo-nginx:v2.0
```


#### (2) DNS A ë ˆì½”ë“œë¥¼ ì‚¬ìš©í•œ ì„œë²„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬

+ ë‹¤ë¥¸ íŒŒë“œì—ì„œ ì„œë¹„ìŠ¤ë¡œ í• ë‹¹ëœ ì—”ë“œí¬ì¸íŠ¸ì— ì ‘ì†í•˜ë ¤ë©´ IP ì£¼ì†Œë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²• ì™¸ì—ë„ ìë™ ë“±ë¡ëœ DNS ë ˆì½”ë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

+ í• ë‹¹ëœ IP ì£¼ì†ŒëŠ” ì„œë¹„ìŠ¤ë¥¼ ìƒì„±í•  ë•Œë§ˆë‹¤ ë³€ê²½ë˜ê¸°ì— IP ì£¼ì†Œë¥¼ ì†¡ì‹  ì¸¡ ì»¨í…Œì´ë„ˆì— ëª…ì‹œì ìœ¼ë¡œ ì„¤ì •í•˜ë©´ ë³€ê²½ë  ë•Œë§ˆë‹¤ ë³€ê²½í•´ì•¼ í•˜ê¸° ë–„ë¬¸ì— ì»¨í…Œì´ë„ˆë¥¼ ë³€ê²½ ë¶ˆê°€ëŠ¥(immutable) ìƒíƒœë¡œ ìœ ì§€í•  ìˆ˜ ì—†ë‹¤.

+ ê·¸ëŸ° ì ì—ì„œ DNSëª…ì„ ì‚¬ìš©í•˜ë©´, ì„œë¹„ìŠ¤ ì¬ìƒì„±ì— ë”°ë¥¸ IP ì£¼ì†Œ ë³€ê²½ë„ ì‹ ê²½ ì“¸ í•„ìš”ê°€ ì—†ì–´ì§„ë‹¤.

```bash
$ kubectl get all
NAME                                     READY   STATUS    RESTARTS   AGE
pod/sample-deployment-79448fcf48-2bgkv   1/1     Running   0          17m
pod/sample-deployment-79448fcf48-bxj9t   1/1     Running   0          17m
pod/sample-deployment-79448fcf48-qzwgv   1/1     Running   0          17m

NAME                       TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)    AGE
service/sample-clusterip   ClusterIP   10.103.230.182   <none>        8080/TCP   78s

NAME                                READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/sample-deployment   3/3     3            3           17m

NAME                                           DESIRED   CURRENT   READY   AGE
replicaset.apps/sample-deployment-79448fcf48   3         3         3       17m


# ì¼ì‹œì ì„ íŒŒë“œë¥¼ ê¸°ë™í•˜ì—¬ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ sample-clusterip:8080ìœ¼ë¡œ HTTP ìš”ì²­
$ kubectl run --image=amsy810/tools:v2.0 --restart=Never --rm -i testpod --command -- curl -s http://sample-clusterip:8080
Host=sample-clusterip  Path=/  From=sample-deployment-79448fcf48-2bgkv  ClientIP=10.32.0.1  XFF=
pod "testpod" deleted

$ kubectl run --image=amsy810/tools:v2.0 --restart=Never --rm -i testpod --command -- curl -s http://sample-clusterip:8080
Host=sample-clusterip  Path=/  From=sample-deployment-79448fcf48-bxj9t  ClientIP=10.32.0.1  XFF=
pod "testpod" deleted
```


+ ì´ëŠ” sample-clusteripì˜ ì´ë¦„ í•´ì„ì´ ìˆ˜í–‰ë˜ê³  í•´ë‹¹ ì£¼ì†Œë¡œ ìš”ì²­ì´ ë°œì†¡ë˜ë„ë¡ ë˜ì–´ ìˆê¸° ë•Œë¬¸ì´ë©°, ì‹¤ì œë¡œ ë“±ë¡ëœ ì •ì‹ FQDNëŠ” "ì„œë¹„ìŠ¤ëª….ë„¤ì„ìŠ¤í˜ì´ìŠ¤ëª….svc.cluster.local"ë¡œ ë˜ì–´ ìˆë‹¤.


```bash
# ì¼ì‹œì ìœ¼ë¡œ íŒŒë“œë¥¼ ê¸°ë™í•˜ì—¬ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ sample-clusterip.default.svc.cluster.localì˜ ì´ë¦„ í•´ì„ í™•ì¸
$ kubectl run --image=amsy810/tools:v2.0 --restart=Never --rm -i testpod --command -- dig sample-clusterip.default.svc.cluster.local

(ìƒëµ)

;sample-clusterip.default.svc.cluster.local. IN A

;; ANSWER SECTION:
sample-clusterip.default.svc.cluster.local. 30 IN A 10.103.230.182


$ kubectl run --image=amsy810/tools:v2.0 --restart=Never --rm -i testpod --command -- dig -x  10.103.230.182

(ìƒëµ)

;182.230.103.10.in-addr.arpa.   IN      PTR

;; ANSWER SECTION:
182.230.103.10.in-addr.arpa. 30 IN      PTR     sample-clusterip.default.svc.cluster.local.
```


#### (3) DNS SRV ë ˆì½”ë“œë¥¼ ì‚¬ìš©í•œ ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬

+ SRV ë ˆì½”ë“œëŠ” í¬íŠ¸ëª…ê³¼ í”„ë¡œí† ì½œì„ ì‚¬ìš©í•˜ì—¬ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ëŠ” í¬íŠ¸ ë²ˆí˜¸ë¥¼ í¬í•¨í•œ ì—”ë“œí¬ì¸íŠ¸ë¥¼ DNSë¡œ í•´ì„í•˜ëŠ” êµ¬ì¡°ë‹¤.

+ ë ˆì½”ë“œ í˜•ì‹ì€ ë‹¤ìŒê³¼ ê°™ë‹¤. (ì„œë¹„ìŠ¤ì˜ í¬íŠ¸ëª…ê³¼ í”„ë¡œí† ì½œì—ëŠ” ì ‘ë‘ì‚¬ì— "_"ê°€ í¬í•¨ë˜ë¯€ë¡œ ì£¼ì˜)

  + **"_ì„œë¹„ìŠ¤ì˜ í¬íŠ¸ëª…._í”„ë¡œí† ì½œ.ì„œë¹„ìŠ¤ëª….ë„¤ì„ìŠ¤í˜ì´ìŠ¤ëª….svc.cluster.local**

```bash
cat <<EOF > sample-clusterip.yaml
apiVersion: v1
kind: Service
metadata:
  name: sample-clusterip
spec:
  type: ClusterIP
  ports:
  - name: "http-port"
    protocol: "TCP"
    port: 8080
    targetPort: 80
  selector:
    app: sample-app
EOF
```

```bash
# ì¼ì‹œì ìœ¼ë¡œ íŒŒë“œë¥¼ ê¸°ë™í•˜ì—¬ SRV ë ˆì½”ë“œê°€ ë‹¤ë¥¸ íŒŒë“œì—ì„œ í•´ì„ì´ ê°€ëŠ¥í•œì§€ í™•ì¸
kubectl run --image=amsy810/tools:v2.0 --restart=Never --rm -i testpod --command -- dig _http-port.tcp.sample-clusterip.default.svc.cluster.local SRV

(ìƒëµ)

;; QUESTION SECTION:
;_http-port.tcp.sample-clusterip.default.svc.cluster.local. IN SRV

;; ANSWER SECTION:
_http-port.tcp.sample-clusterip.default.svc.cluster.local. 30 IN SRV 0 100 8080 sample-clusterip.default.svc.cluster.local.

;; ADDITIONAL SECTION:
sample-clusterip.default.svc.cluster.local. 30 IN A 10.103.230.182
```

<br>

### ğŸ“œ í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ DNSì™€ í´ëŸ¬ìŠ¤í„° ì™¸ë¶€ DNS

+ í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ DNSì—ëŠ” ì„œë¹„ìŠ¤ ì—”ë“œí¬ì¸íŠ¸ì— ëŒ€í•œ ë ˆì½”ë“œê°€ ì €ì¥ë˜ì–´ ìˆê³ , í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ DNSì— ì§ˆì˜í•˜ì—¬ ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬ì—ì„œ ì‚¬ìš©ëœë‹¤.

+ ë¬¼ë¡  í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ DNSì—ëŠ” ë‚´ë¶€ìš© ë ˆì½”ë“œë§Œ ë“±ë¡ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ì´ì™¸ì˜ ë ˆì½”ë“œëŠ” ì™¸ë¶€ DNSì— ì¬ê·€ ì§ˆì˜ë¥¼ í•´ì•¼ í•œë‹¤.


![1](https://user-images.githubusercontent.com/42735894/228762036-e6aa045a-e761-4ddd-87d3-3f695dac0124.png){: width="70%" height="70%"}{: .align-center}

<br>

### ğŸ“œ ë…¸ë“œ ë¡œì»¬ DNS ìºì‹œ

+ í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ DNSì— ì´ë¦„ í•´ì„ì„ ë³´ëƒˆì§€ë§Œ, ëŒ€ê·œëª¨ í´ëŸ¬ìŠ¤í„°ì—ì„œ ì„±ëŠ¥ í–¥ìƒì„ ìœ„í•´ ê° ë…¸ë“œì˜ ë¡œì»¬ DNS ìºì‹œ ì„œë²„ë¥¼ í¬í•¨í•˜ëŠ” êµ¬ì¡°ê°€ ìˆë‹¤.

+ ì´ ê¸°ëŠ¥ì„ í™œì„±í™”í•œ í™˜ê²½ì—ì„œ íŒŒë“œì˜ ì§ˆì˜ ëŒ€ìƒì€ ê°™ì€ ë…¸ë“œì— ë¡œì»¬ DNS ìºì‹œ ì„œë²„ê°€ ëœë‹¤.


![2](https://user-images.githubusercontent.com/42735894/228762050-a5ecbdff-95d3-4485-ad3f-fb447bb97ce5.png){: width="70%" height="70%"}{: .align-center}

<br>