---
title:  "[ì‹œìŠ¤í…œ ê´€ë¦¬] 04. ë¡œê·¸ ê´€ë¦¬ - ë¡œê·¸ ë¡œí…Œì´ì…˜" 

categories:
  - SYS_MGMT
tags:
  - [sys_mgmt, linux]

toc: true
toc_sticky: true

date: 2023-07-07
last_modified_at: 2023-07-07
---
<br>

# ğŸ”” ë¡œê·¸ ë¡œí…Œì´ì…˜ - logrotate
---

<style>
table {
    font-size: 12pt;
}
table th:first-of-type {
    width: 5%;
}
table th:nth-of-type(2) {
    width: 20%;
}
table th:nth-of-type(3) {
    width: 50%;
}
table th:nth-of-type(4) {
    width: 30%;
} 
big { 
    font-size: 25px 
}
small { 
    font-size: 18px 
}
</style>

> ë¡œê·¸ ì •ë³´ê°€ ê³„ì† ìŒ“ì´ë©´ íŒŒì¼ ìš©ëŸ‰ë¬¸ì œë¡œ ì‹œìŠ¤í…œì— ë¬¸ì œê°€ ìƒê¸¸ìˆ˜ê°€ ìˆìœ¼ë¯€ë¡œ ì‚¬ì „ì— ì €ì¥ ê¸°ê°„ ë° ì €ì¥ ë°©ë²• ì„¤ì •í•˜ì—¬ ì›í• í•œ ì„œë²„ ê´€ë¦¬, ìš´ì˜ì„ í•˜ê¸° ìœ„í•´ ì„¤ì •í•˜ëŠ” ê¸°ëŠ¥ì´ logrotateì´ë‹¤.

<br>

<big> **â–  logrotate ì„¤ì¹˜** </big> <br>

```bash
# CentOS (RHEL ê³„ì—´)
yum -y install logrotate
```

```bash
# Ubuntu (Debian ê³„ì—´)
apt -y install logrotate
```

<br>

<big> **â–  logrotate íŒŒì¼ êµ¬ì¡°** </big> <br>

| ì¢…ë¥˜ | ë‚´ìš© |
| :-----: | :------- |
| /usr/sbin/logrotate | logrotate ë°ëª¬ ìœ„ì¹˜ ë° ë°ëª¬ í”„ë¡œê·¸ë¨ |
| /etc/logrotate.conf | logrotate ë°ëª¬ ì„¤ì • íŒŒì¼ |
| /etc/logrotate.d | logrotateë¥¼ ì ìš©í•  í”„ë¡œì„¸ìŠ¤/ë°ëª¬ ì„¤ì • íŒŒì¼ |
| /var/lib/logrotate.status | logrotate í•œ ì‘ì—… ë‚´ì—­ì„ ë³´ê´€í•œ íŒŒì¼ | 
| /etc/cron.daily/logrotate | logrotateëŠ” ì£¼ê¸°ì ìœ¼ë¡œ ì‹¤í–‰ë˜ì–´ì•¼ í•œë‹¤, cronì— ì˜í•´ ì¼ ë‹¨ìœ„ë¡œ ì‹¤í–‰ì´ë¨ |

<br>

<big> **â–  logrotate ì„¤ì • í•­ëª©** </big> <br>

| ì¢…ë¥˜ | ë‚´ìš© |
| :-----: | :------- |
| compress | ë¡œí…Œì´ì…˜ëœ ë¡œê·¸ë¥¼ ì••ì¶• |
| nocompress | ë¡œí…Œì´ì…˜ëœ ë¡œê·¸ë¥¼ ì••ì¶•ì•ˆí•¨ |
| create [í¼ë¯¸ì…˜] [ì‚¬ìš©ìëª…] [ê·¸ë£¹ëª…] | ë¡œí…Œì´ì…˜í•œ ë‹¤ìŒì— ìƒˆë¡œìš´ ë¹ˆ ë¡œê·¸ íŒŒì¼ì„ ìƒì„± (íŒŒì¼ì˜ í¼ë¯¸ì…˜, ì‚¬ìš©ìëª…, ê·¸ë£¹ëª… ì§€ì •í•  ìˆ˜ ìˆìŒ) |
| nocreate | ìƒˆë¡œìš´ ë¹ˆ ë¡œê·¸ íŒŒì¼ì„ ìƒì„±í•˜ì§€ ì•ŠëŠ”ë‹¤. |
| daily | ë§¤ì¼ ë¡œê·¸íŒŒì¼ì„ ë¡œí…Œì´ì…˜ ì§„í–‰ (ì •í™•í•œ ì¼ì‹œëŠ” cronì— ì˜ì¡´) |
| weekly | ë§¤ì£¼ ë¡œê·¸íŒŒì¼ì„ ë¡œí…Œì´ì…˜ ì§„í–‰ (ì •í™•í•œ ì¼ì‹œëŠ” cronì— ì˜ì¡´) |
| monthly | ë§¤ì›” ë¡œê·¸íŒŒì¼ì„ ë¡œí…Œì´ì…˜ ì§„í–‰ (ì •í™•í•œ ì¼ì‹œëŠ” cronì— ì˜ì¡´) |
| ifempty | ë¡œê·¸ íŒŒì¼ì´ ë¹„ì–´ ìˆë”ë¼ë„ ë¡œí…Œì´ì…˜ ì§„í–‰ |
| notifempty | ë¡œê·¸ íŒŒì¼ì´ ë¹„ì–´ìˆëŠ” ê²½ìš° ë¡œí…Œì´ì…˜í•˜ì§€ ì•ŠìŒ |
| missingok | ë¡œê·¸ íŒŒì¼ì´ ì¡´ì¬í•˜ì§€ ì•Šë”ë¼ë„ ì˜¤ë¥˜ë¥¼ ë‚´ë³´ë‚´ì§€ ì•ŠëŠ”ë‹¤. |
| nomissingok | ë¡œê·¸ íŒŒì¼ì´ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´ ì˜¤ë¥˜ë¥¼ ë‚´ë³´ë‚¸ë‹¤. |
| dateext | ë¡œê·¸ íŒŒì¼ëª…ì— ë‚ ì§œ í™•ì¥ìë¥¼ ì¶”ê°€ |
| olddir ë””ë ‰í„°ë¦¬ëª… | ì§€ì •ëœ ë””ë ‰í„°ë¦¬ ë‚´ì— ë¡œí…Œì´ì…˜ëœ ë¡œê·¸ë¥¼ ì €ì¥ |
| noolddir | ë¡œí…Œì´ì…˜ ëŒ€ìƒì¸ ë¡œê·¸ì™€ ë™ì¼í•œ ë””ë ‰í„°ë¦¬ì— ë¡œí…Œì´ì…˜ëœ ë¡œê·¸ë¥¼ ì €ì¥ | 
| rotate n | ì§€ì •ëœ íšŸìˆ˜ë§Œí¼ë§Œ ë¡œí…Œì´ì…˜ ì§„í–‰ |
| size n | ë¡œê·¸ íŒŒì¼ì´ ì €ì¥í•œ íŒŒì¼ í¬ê¸° ì´ìƒì´ë©´ ë¡œí…Œì´ì…˜ ì§„í–‰ |
| sharedscripts | ë³µìˆ˜ë¡œ ì§€ì •í•œ ë¡œê·¸ íŒŒì¼ì— ëŒ€í•´ postrotate ë˜ëŠ” prerotateë¡œ ê¸°ìˆ ëœ ëª…ë ¹ì„ 1íšŒë§Œ ì‹¤í–‰ |
| postrotate - endscript | postrotateì™€ endscript ì‚¬ì´ì— ê¸°ìˆ ëœ ëª…ë ¹ì„ ë¡œê·¸ ë¡œí…Œì´ì…˜í•œ ë‹¤ìŒì— ì‹¤í–‰ |
| prerotate - endscript | prerotateì™€ endscript ì‚¬ì´ì— ê¸°ìˆ ëœ ëª…ë ¹ì„ ë¡œê·¸ ë¡œí…Œì´ì…˜ ì „ì— ì‹¤í–‰ |
| include /etc/logrotate.d | í•´ë‹¹ ë””ë ‰í„°ë¦¬ì— ìˆëŠ” ê°œë³„ ë°ëª¬/í”„ë¡œì„¸ìŠ¤ ì„¤ì • íŒŒì¼ì„ í¬í•¨ |

<br>

<big> **â–  logrotate ì‚¬ìš© ì˜ˆì‹œ** </big> <br>

<br>

<small> **â–¶ logrotate - httpd ì„¤ì •** </small> <br>

```bash
$ cat <<EOF > /etc/logrotate.d/httpd
/var/log/httpd/*log {
    missingok
    notifempty
    sharedscripts
    postrotate
        /bin/systemctl reload httpd > /dev/null 2> /dev/null || true
    endscript
}
EOF
```

<br>

<small> **â–¶ logrotate - nginx ì„¤ì •** </small> <br>

```bash
$ vim /etc/logrotate.d/nginx
/var/log/nginx/*log {
    daily
    missingok
    rotate 52
    compress
    delaycompress
    notifempty
    create 640 nginx adm
    sharedscripts
    postrotate
        [ -f /var/run/nginx.pid ] && kill -USR1 `cat /var/run/nginx.pid`
    endscript
}
```

<br>

<small> **â–¶ logrotate í…ŒìŠ¤íŠ¸** </small> <br>

| ì˜µì…˜ | ë‚´ìš© |
| :-----: | :------- |
| -d | ë””ë²„ê·¸ ì‹¤í–‰ |
| -v | ìƒì„¸ í‘œì‹œ |
| -f | ê°•ì œë¡œ ì‹¤í–‰ |
| -m | ë©”ì¼ ì†¡ì‹ ì„ ìœ„í•œ ì§€ì •, (ex: -m=/bin/mail) |
| -s | ìƒíƒœ íŒŒì¼ì˜ ê²½ë¡œ ì§€ì •, (ex: -s=/var/lib/logrotate.status) |


> logrotateì˜ ì‹¤í–‰ ê²°ê³¼ê°€ ì •ìƒì ì´ë©´ ì•„ë˜ì™€ ê°™ì€ ìƒì„¸ ì •ë³´ê°€ ì¶œë ¥ë˜ê³ , "log does not need rotating"ê°€ ì¶œë ¥ë˜ì—ˆìœ¼ë¯€ë¡œ ë¡œê·¸ ë¡œí…Œì´ì…˜ì´ í•„ìš” ì—†ë‹¤ê³  íŒë‹¨í•œ ê²ƒì´ë‹¤.


```bash
$ logrotate -dv /etc/logrotate.d/nginx
reading config file /etc/logrotate.d/nginx
Reading state from file: /var/lib/logrotate/logrotate.status
Allocating hash table for state file, size 64 entries

Handling 1 logs

rotating pattern: /var/log/nginx/*log  after 1 days (52 rotations)
empty log files are not rotated, old logs are removed
considering log /var/log/nginx/access.log
Creating new state
  Now: 2023-07-28 21:57
  Last rotated at 2023-07-28 21:00
  log does not need rotating (log has been already rotated)
considering log /var/log/nginx/error.log
Creating new state
  Now: 2023-07-28 21:57
  Last rotated at 2023-07-28 21:00
  log does not need rotating (log has been already rotated)
not running postrotate script, since no logs were rotated
```


> ìœ„ì™€ ê°™ì´ **ë¡œê·¸ ë¡œí…Œì´ì…˜ì´ í•„ìš” ì—†ë‹¤ê³  ë‚˜íƒ€ë‚˜ëŠ” ê²½ìš°ëŠ” ì˜¤ë¥˜ê°€ ìˆê±°ë‚˜ ë¡œê·¸ íŒŒì¼ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ìš°ë¥¼ ì œì™¸í•˜ë©´ ë¡œê·¸ ë¡œí…Œì´ì…˜ì„ ë§ˆì§€ë§‰ìœ¼ë¡œ ì‹¤í–‰í•œ í›„ì— ì•„ì§ 1ì¼ ì´ìƒ ê²½ê³¼í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì¸ ê²½ìš°ê°€ ë§ë‹¤.** ì´ëŸ° ê²½ìš°ì—ëŠ” ë¡œê·¸ ë¡œí…Œì´ì…˜ ì„¤ì • íŒŒì¼ì˜ ë‚´ìš©ì— ì˜¤ë¥˜ê°€ ì—†ëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆë„ë¡ **logrotate ìƒíƒœ íŒŒì¼(/var/lib/logrotate.status)ì˜ ìµœì¢… ë¡œê·¸ ë¡œí…Œì´ì…˜ ì‹¤í–‰ ì¼ìë¥¼ ë°”ê¾¼ ë‹¤ìŒ í™•ì¸í•´ ë³´ëŠ”ê²Œ ì¢‹ë‹¤.**


```bash
# ë³€ê²½ ì „
$ cat /var/lib/logrotate/logrotate.status
~(ìƒëµ)~
"/var/log/nginx/access.log" 2023-7-28-22:0:0
~(ìƒëµ)~


# ë³€ê²½ í›„ -> ì¼ìë¥¼ í•˜ë£¨ ì „ìœ¼ë¡œ ìˆ˜ì •í•˜ê³  ì €ì¥
$ cat /var/lib/logrotate/logrotate.status
~(ìƒëµ)~
"/var/log/nginx/access.log" 2023-7-27-22:0:0
~(ìƒëµ)~
```

> ì•„ë˜ì™€ ê°™ì´ ë¡œê·¸ ë¡œí…Œì´ì…˜ì´ í•„ìš”í•˜ë‹¤ê³  íŒë‹¨í•˜ì—¬ "log need rotating"ì´ ì¶œë ¥ëœë‹¤.

```bash
$ logrotate -dv /etc/logrotate.d/nginx
reading config file /etc/logrotate.d/nginx
Reading state from file: /var/lib/logrotate/logrotate.status
Allocating hash table for state file, size 64 entries

Handling 1 logs

rotating pattern: /var/log/nginx/*log  after 1 days (52 rotations)
empty log files are not rotated, old logs are removed
considering log /var/log/nginx/access.log
  Now: 2023-07-28 22:47
  Last rotated at 2023-07-27 22:00
  log needs rotating              # <- (í•´ë‹¹ ë¶€ë¶„)
considering log /var/log/nginx/error.log
  Now: 2023-07-28 22:47
  Last rotated at 2023-07-28 22:00
  log does not need rotating (log has been already rotated)
rotating log /var/log/nginx/access.log, log->rotateCount is 52
dateext suffix '-20230728'
glob pattern '-[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]'
set default create context to system_u:object_r:httpd_log_t:s0
previous log /var/log/nginx/access.log.1 does not exist
~(ìƒëµ)~ 
```

> ì„¤ì •ì´ ì˜¤ë¥˜(ë‹¨ìˆœíˆ 'aaaa'ë¥¼ /etc/logrotate.d/nginx ì˜µì…˜ì— ì¶”ê°€)ê°€ ìˆë‹¤ë©´ ì•„ë˜ì™€ ê°™ì´ ì˜¤ë¥˜ë¥¼ ì¶œë ¥í•œë‹¤.

```bash
$ logrotate -dv /etc/logrotate.d/nginx
WARNING: logrotate in debug mode does nothing except printing debug messages!  Consider using verbose mode (-v) instead if this is not what you want.

reading config file /etc/logrotate.d/nginx
error: /etc/logrotate.d/nginx:2 unknown option 'aaaa' -- ignoring line      # <- (í•´ë‹¹ ë¶€ë¶„)
Reading state from file: /var/lib/logrotate/logrotate.status
Allocating hash table for state file, size 64 entries

Handling 1 logs

rotating pattern: /var/log/nginx/*log  after 1 days (52 rotations)
empty log files are not rotated, old logs are removed
considering log /var/log/nginx/access.log
  Now: 2023-07-28 22:51
  Last rotated at 2023-07-28 22:00
  log does not need rotating (log has been already rotated)
considering log /var/log/nginx/error.log
  Now: 2023-07-28 22:51
  Last rotated at 2023-07-28 22:00
  log does not need rotating (log has been already rotated)
not running postrotate script, since no logs were rotated
```

<br>

<big> **â–  ë¡œê·¸ ë¡œí…Œì´ì…˜ì´ ì‹¤í–‰ë˜ëŠ” ì‹œê°„** </big> <br>

> logrotateë¥¼ ì„¤ì¹˜í•˜ëŠ” ì‹œì ì— **"/etc/cron.daily/logrotate"ë¼ëŠ” Shell ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ë„ ì„¤ì¹˜ëœë‹¤.** ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” ë‹¨ìˆœíˆ logrotateë¥¼ ì‹¤í–‰í•  ë¿ ì‹¤íŒ¨í•˜ë©´ logger ëª…ë ¹ì„ ì´ìš©í•˜ì—¬ í˜„ì¬ ìƒí™©ì„ syslogë¡œ ì „ë‹¬í•œë‹¤.

```bash
$ cat /etc/cron.daily/logrotate
#!/bin/sh

/usr/sbin/logrotate /etc/logrotate.conf
EXITVALUE=$?
if [ $EXITVALUE != 0 ]; then
    /usr/bin/logger -t logrotate "ALERT exited abnormally with [$EXITVALUE]"
fi
exit $EXITVALUE
```

> logrotateê°€ ì‹¤í–‰ë˜ëŠ” ì‹œê°„ì€ "/etc/anacrontab"ì— ë‹¤ìŒê³¼ ê°™ì´ ê¸°ìˆ ë˜ì–´ ìˆë‹¤.

```bash
$ cat /etc/anacrontab
# /etc/anacrontab: configuration file for anacron

# See anacron(8) and anacrontab(5) for details.

SHELL=/bin/sh
PATH=/sbin:/bin:/usr/sbin:/usr/bin
MAILTO=root
# the maximal random delay added to the base delay of the jobs
RANDOM_DELAY=45
# the jobs will be started during the following hours only
START_HOURS_RANGE=3-22

#period in days   delay in minutes   job-identifier   command
1       5       cron.daily              nice run-parts /etc/cron.daily
7       25      cron.weekly             nice run-parts /etc/cron.weekly
@monthly 45     cron.monthly            nice run-parts /etc/cron.monthly
```

| êµ¬ë¶„ | í•´ì„¤ |
| :-----: | :------- |
| RANDOM_DELAY=45 | 0~45ë¶„ ì‚¬ì´ì—ì„œ ë¬´ì‘ìœ„ë¡œ ì‹¤í–‰ ì§€ì—° ì‹œê°„ì„ ê²°ì •í•œë‹¤ëŠ” ì˜ë¯¸, ì´ ê°’ì„ 0ìœ¼ë¡œ ì„¤ì •í•˜ë©´ ë¬´ì‘ìœ„ ì§€ì—°ì´ ì—†ì–´ì§„ë‹¤. |
| START_HOURS_RANGE=3-22 | ì‹œì‘ ì‹œê°ì˜ ë²ˆìœ„ëŠ” 3~22ì‹œ ì‚¬ì´ë¡œ ê²°ì •í•œë‹¤ëŠ” ì˜ë¯¸ |
| 1     5   cron.daily | cron.dailyëŠ” 1ì¼ 1íšŒ ì‹¤í–‰í•œë‹¤. ë‹¨, 5ë¶„ì€ ë°˜ë“œì‹œ ì§€ì—°ì‹œí‚¨ë‹¤. |

<br>

<big> **â–  logrotate ë™ì‘ì—ì„œì˜ cronê³¼ anacron ì°¨ì´** </big> <br>

> logrotateì˜ ì‹¤í–‰ ì‹œê°„ì€ CentOS 5ê¹Œì§€ëŠ” /etc/crontabì— ê¸°ìˆ  ë˜ì—ˆìœ¼ë‚˜ CentOS 6 ì´í›„ ë¶€í„°ëŠ” /etc/anacrontab ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆë‹¤. cronì€ ì‹œìŠ¤í…œì´ ì¼œì ¸ ìˆëŠ” ë™ì•ˆ ì£¼ê¸°ì ì¸ ì‘ì—…ì„ ì‹¤í–‰í•˜ëŠ” ë°©ì‹ì´ê³ , anacronì€ ì‹œìŠ¤í…œì´ ì •ì§€í•˜ë”ë¼ë„ ì¬ë¶€íŒ… ì‹œì ì—ì„œ ì˜ˆì•½ëœ ì‘ì—…ì„ ì‹¤í–‰í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤. <br><br> ë§¤ì¼ 4ì‹œ 2ë¶„ì— ì‘ì—…ì„ ì‹¤í–‰í•œë‹¤ ê°€ì •í–ˆì„ ë•Œ, CentOS 5ì—ì„œëŠ” ì„œë²„ê°€ 4ì‹œ 2ë¶„ì— ë©ˆì·„ë‹¤ 5ì‹œì— ë³µêµ¬ë˜ì–´ë„ ë§¤ì¼ ì‹¤í–‰í•  ì‘ì—…ì´ ì‹¤í–‰ë˜ì§€ ì•Šì§€ë§Œ CentOS 6ì—ì„œëŠ” ì„œë²„ê°€ ì •ì§€í–ˆë”ë¼ë„ ì„œë²„ê°€ ë³µêµ¬ëœ ì‹œì ì¸ 5ì‹œì—ì„œ 1ë¶„ì´ ì§€ë‚œ 5ì‹œ 1ë¶„ì— anacronì„ ê°€ë™í•˜ì—¬ 5ë¶„ ì§€ì—°ì‹œí‚¨ í›„ ë§¤ì¼ í•´ì•¼ í•  ì‘ì—…ì„ ì‹¤í–‰í•œë‹¤. ì¦‰, ì„œë²„ ì •ì§€ ì‹œê°„ì´ ê²½ë¯¸í•˜ê²Œ ìˆë”ë¼ë„ ë§¤ì¼ ì‘ì—…ì€ 3~22ì‹œ ì‚¬ì´ë©´ ë†“ì¹˜ì§€ ì•Šê³  ì‹¤í–‰í•œë‹¤.

<br>

<small> **â–¶ ë°˜ë“œì‹œ ì •í•´ì§„ ì‹œê°„ì— ì„œë²„ì—ì„œ ì‹¤í–‰ë˜ê¸°ë¥¼ ì›í•˜ëŠ” ê²½ìš°** </small> <br>

```bash
$ cat /etc/anacrontab
...
RANDOM_DELAY=0

START_HOURS_RANGE=3-22

#period in days   delay in minutes   job-identifier   command
1       5       cron.daily              nice run-parts /etc/cron.daily
```

+ ì •ê°ì— ì‘ì—…ì„ ì‹¤í–‰í•˜ê³ ì í•˜ëŠ” ê²½ìš°ì— "RANDOM_DELAY=0" ì„¤ì •í•˜ë©´ ë¬´ì‘ìœ„ ì§€ì—°ì´ ë°œìƒí•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ìœ„ì—ì„œ ë³¸ ì„¤ì •ì— ë”°ë¼ 3ì‹œ 6ë¶„ì— ì‹¤í–‰ëœë‹¤.

+ ë¶„ì„ ë¯¸ì„¸í•˜ê²Œ ì¡°ì •í•˜ë ¤ë©´ "1       5       cron.daily"ì˜ ì§€ì—° ì‹œê°„ì¸ 5ë¶„ì„ ë³€ê²½í•˜ë©´ ë˜ë©°, cronì´ ì‘ì—…ì„ ë§¤ì‹œ 1ë¶„ì— ì‹œì‘í•˜ë¯€ë¡œ ì„¤ì •ì„ 0ìœ¼ë¡œ ë°”ê¿”ë„ 1ë¶„ì´ ëœë‹¤. (ì„¤ì •í•œ ì‹œê°„ + 1ë¶„)

+ anacronì€ ì„œë²„ê°€ ì •ì§€í•´ ìˆë˜ ê²½ìš° ë³µêµ¬í•œ ë‹¤ìŒ ë°”ë¡œ ì‹¤í–‰í•˜ë ¤ê³  í•˜ëŠ”ë°, ì´ê²ƒë„ ì‘ë™í•˜ì§€ ì•Šê²Œ í•˜ë ¤ë©´ "cronie-noanacron(yum -y install cronie-noanacron)"ì„ ì‚¬ìš©í•˜ëŠ” í¸ì´ ì¢‹ë‹¤.

