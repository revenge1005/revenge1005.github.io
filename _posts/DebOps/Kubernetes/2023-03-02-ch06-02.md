---
title:  "[Retry, k8s] 27. í´ëŸ¬ìŠ¤í„° & ë©”íƒ€ë°ì´í„° API - ë„¤ì„ìŠ¤í˜ì´ìŠ¤" 

categories:
  - KUBERNETES
tags:
  - [kubernetes]

toc: true
toc_sticky: true

date: 2023-03-01
last_modified_at: 2023-03-01
---
<br>

# ğŸ”” ë„¤ì„ìŠ¤í˜ì´ìŠ¤
---

<style>
table {
    font-size: 12pt;
}
table th:first-of-type {
    width: 5%;
}
table th:nth-of-type(2) {
    width: 15%;
}
table th:nth-of-type(3) {
    width: 50%;
}
table th:nth-of-type(4) {
    width: 30%;
}
</style>

> **k8sì—ëŠ” ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¼ëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì—ì„œ ë¦¬ì†ŒìŠ¤ë“¤ì„ ë…¼ë¦¬ì ìœ¼ë¡œ êµ¬ë¶„í•˜ê³  ê´€ë¦¬í•˜ëŠ” ì˜¤ë¸Œì íŠ¸**

+ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ë©´ ë‹¤ì–‘í•œ ìš©ë„ë‚˜ ì‚¬ìš©ìë³„ë¡œ ë¦¬ì†ŒìŠ¤ë¥¼ ê·¸ë£¹í™”í•˜ê³  ì ‘ê·¼ ì œì–´í•  ìˆ˜ ìˆëŠ”ë°, ì˜ˆë¥¼ ë“¤ì–´ ê°œë°œ, í…ŒìŠ¤íŠ¸, ìš´ì˜ í™˜ê²½ì— ë”°ë¼ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

+ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ëŠ” YAML íŒŒì¼ì´ë‚˜ ì»¤ë§¨ë“œë¡œ ìƒì„±í•  ìˆ˜ ìˆìœ¼ë©°, **ë¦¬ì†ŒìŠ¤ì˜ metadata.namespace í•„ë“œì— ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì´ë¦„ì„ ëª…ì‹œí•˜ë©´ í•´ë‹¹ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ì†í•˜ê²Œ ëœë‹¤.**

+ **ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ì‚­ì œí•˜ë©´ í•´ë‹¹ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ì¡´ì¬í•˜ëŠ” ëª¨ë“  ë¦¬ì†ŒìŠ¤ë„ í•¨ê»˜ ì‚­ì œ**ë˜ë¯€ë¡œ ì£¼ì˜í•´ì•¼ í•œë‹¤.

+ ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì—ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ default, kube-public, kube-systemì˜ ì„¸ ê°€ì§€ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ê°€ ì¡´ì¬í•œë‹¤.

    |ì¢…ë¥˜|ê°œìš”|
    |---|---|
    |default|ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ëª…ì‹œí•˜ì§€ ì•Šì€ ë¦¬ì†ŒìŠ¤ê°€ ì†í•˜ëŠ” ë„¤ì„ìŠ¤í˜ì´ìŠ¤|
    |kube-system|ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„° êµ¬ì„±ì— í•„ìˆ˜ì ì¸ ì»´í¬ë„ŒíŠ¸ë“¤ê³¼ ì„¤ì •ê°’ì´ ìˆëŠ” ë„¤ì„ìŠ¤í˜ì´ìŠ¤|
    |kube-public|ëª¨ë“  ì‚¬ìš©ìê°€ ì½ì„ ìˆ˜ ìˆëŠ” ê³µê°œì ì¸ ì •ë³´ê°€ ìˆëŠ” ë„¤ì„ìŠ¤í˜ì´ìŠ¤|
    |kube-node-lease|ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì—ì„œ ê° ë…¸ë“œì™€ ì—°ê´€ëœ Lease ì˜¤ë¸Œì íŠ¸ë¥¼ ê°€ì§€ê³  ìˆëŠ” ë„¤ì„ìŠ¤í˜ì´ìŠ¤, Lease ì˜¤ë¸Œì íŠ¸ëŠ” kubeletì´ í•˜íŠ¸ë¹„íŠ¸ë¥¼ ë³´ë‚´ì„œ ì»¨íŠ¸ë¡¤ í”Œë ˆì¸ì´ ë…¸ë“œ ì¥ì• ë¥¼ ê°ì§€í•œë‹¤.|

<br>


## (1) ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ìƒì„±

```bash
# ë§¤ë‹ˆí˜ìŠ¤íŠ¸ë¡œ ìƒì„±
$ cat <<EOF > sample-namespace.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: sample-namespace
EOF


# CLIë¡œ ì§ì ‘ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ìƒì„±
$ kubectl create namespace sample-namespace
```

<br>


## (2) ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ì§€ì •í•œ ë¦¬ì†ŒìŠ¤ íšë“

```bash
# ceph-csi-cephfs ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì˜ ëª¨ë“  ì˜¤ë¸Œì íŠ¸ë¥¼ ëª©ë¡
$ kubectl get all -n ceph-csi-cephfs
NAME                                               READY   STATUS    RESTARTS   AGE
pod/ceph-csi-cephfs-nodeplugin-27pcx               3/3     Running   0          4h25m
pod/ceph-csi-cephfs-nodeplugin-xt7mr               3/3     Running   0          4h25m
pod/ceph-csi-cephfs-provisioner-687456b556-66tlw   5/5     Running   0          4h25m
pod/ceph-csi-cephfs-provisioner-687456b556-lxk6x   5/5     Running   0          4h25m
pod/ceph-csi-cephfs-provisioner-687456b556-z6ld8   0/5     Pending   0          4h25m

NAME                                               TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE
service/ceph-csi-cephfs-nodeplugin-http-metrics    ClusterIP   10.96.242.246   <none>        8080/TCP   4h25m
service/ceph-csi-cephfs-provisioner-http-metrics   ClusterIP   10.99.179.136   <none>        8080/TCP   4h25m

NAME                                        DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE
daemonset.apps/ceph-csi-cephfs-nodeplugin   2         2         2       2            2           <none>          4h25m

NAME                                          READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/ceph-csi-cephfs-provisioner   2/3     3            2           4h25m

NAME                                                     DESIRED   CURRENT   READY   AGE
replicaset.apps/ceph-csi-cephfs-provisioner-687456b556   3         3         2       4h25m


# ëª¨ë“  ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì˜ ëª¨ë“  ì˜¤ë¸Œì íŠ¸ ëª©ë¡ - kubectl get all -A
$ kubectl get all --all-namespaces
NAMESPACE         NAME                                               READY   STATUS    RESTARTS        AGE
ceph-csi-cephfs   pod/ceph-csi-cephfs-nodeplugin-27pcx               3/3     Running   0               4h26m
ceph-csi-cephfs   pod/ceph-csi-cephfs-nodeplugin-xt7mr               3/3     Running   0               4h26m
ceph-csi-cephfs   pod/ceph-csi-cephfs-provisioner-687456b556-66tlw   5/5     Running   0               4h26m
ceph-csi-cephfs   pod/ceph-csi-cephfs-provisioner-687456b556-lxk6x   5/5     Running   0               4h26m
ceph-csi-cephfs   pod/ceph-csi-cephfs-provisioner-687456b556-z6ld8   0/5     Pending   0               4h26m
default           pod/sample-readonly-volumemount                    1/1     Running   0               104m
default           pod/sample-statefulset-with-pvc-0                  1/1     Running   0               4h19m
default           pod/sample-statefulset-with-pvc-1                  1/1     Running   0               4h19m
default           pod/sample-subpath                                 3/3     Running   0               82m
kube-system       pod/coredns-787d4945fb-29vhx                       1/1     Running   0               5h18m
kube-system       pod/coredns-787d4945fb-2ds5w                       1/1     Running   0               5h18m
kube-system       pod/etcd-k8s-master                                1/1     Running   0               5h18m
kube-system       pod/kube-apiserver-k8s-master                      1/1     Running   0               5h18m
kube-system       pod/kube-controller-manager-k8s-master             1/1     Running   0               5h18m
kube-system       pod/kube-proxy-5bszd                               1/1     Running   0               5h18m
kube-system       pod/kube-proxy-nv9rn                               1/1     Running   0               5h18m
kube-system       pod/kube-proxy-q7pl6                               1/1     Running   0               5h18m
kube-system       pod/kube-scheduler-k8s-master                      1/1     Running   0               5h18m
kube-system       pod/weave-net-5xmsr                                2/2     Running   1 (5h18m ago)   5h18m
kube-system       pod/weave-net-ll75p                                2/2     Running   0               5h18m
kube-system       pod/weave-net-wk7wl                                2/2     Running   0               5h18m

NAMESPACE         NAME                                               TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                  AGE
ceph-csi-cephfs   service/ceph-csi-cephfs-nodeplugin-http-metrics    ClusterIP   10.96.242.246   <none>        8080/TCP                 4h26m
ceph-csi-cephfs   service/ceph-csi-cephfs-provisioner-http-metrics   ClusterIP   10.99.179.136   <none>        8080/TCP                 4h26m
default           service/kubernetes                                 ClusterIP   10.96.0.1       <none>        443/TCP                  5h18m
kube-system       service/kube-dns                                   ClusterIP   10.96.0.10      <none>        53/UDP,53/TCP,9153/TCP   5h18m

NAMESPACE         NAME                                        DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR            AGE
ceph-csi-cephfs   daemonset.apps/ceph-csi-cephfs-nodeplugin   2         2         2       2            2           <none>                   4h26m
kube-system       daemonset.apps/kube-proxy                   3         3         3       3            3           kubernetes.io/os=linux   5h18m
kube-system       daemonset.apps/weave-net                    3         3         3       3            3           <none>                   5h18m

NAMESPACE         NAME                                          READY   UP-TO-DATE   AVAILABLE   AGE
ceph-csi-cephfs   deployment.apps/ceph-csi-cephfs-provisioner   2/3     3            2           4h26m
kube-system       deployment.apps/coredns                       2/2     2            2           5h18m

NAMESPACE         NAME                                                     DESIRED   CURRENT   READY   AGE
ceph-csi-cephfs   replicaset.apps/ceph-csi-cephfs-provisioner-687456b556   3         3         2       4h26m
kube-system       replicaset.apps/coredns-787d4945fb                       2         2         2       5h18m

NAMESPACE   NAME                                           READY   AGE
default     statefulset.apps/sample-statefulset-with-pvc   2/2     4h19m
```

<br>


## (3) í´ëŸ¬ìŠ¤í„°ë¥¼ ê³ ìœ í•˜ê²Œ ì‹ë³„í•˜ëŠ” ë°©ë²•

> ì—¬ëŸ¬ k8s í´ëŸ¬ìŠ¤í„°ê°€ ì¡´ì¬í•˜ëŠ” ê²½ìš°, k8s ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ í´ëŸ¬ìŠ¤í„°ë¥¼ ê³ ìœ í•˜ê²Œ ì‹ë³„í•˜ëŠ” ë°©ë²•ìœ¼ë¡œ kube-system ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì˜ UIDë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì´ ìˆë‹¤.

+ kube-system ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì—ëŠ” ì¤‘ìš”í•œ ì‹œìŠ¤í…œ êµ¬ì„± ìš”ì†Œê°€ ê¸°ë™í•˜ê³  ìˆì–´ í´ëŸ¬ìŠ¤í„°ì—ì„œ ì§€ìš°ëŠ” ì¼ì´ ê±°ì˜ ì—†ê¸° ë•Œë¬¸ì— ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë¦¬ì†ŒìŠ¤ì˜ UIDë¥¼ ì‚¬ìš©í•˜ì—¬ ëŒ€ì²´í•  ìˆ˜ ìˆë‹¤.

```bash
# kube-system ë„¤ì„ìŠ¤í˜ì´ìŠ¤ UID í™•ì¸
$ kubectl get namespaces kube-system -o jsonpath="{.metadata.uid}"
9494acf6-6028-4a92-a802-f74028d3ccf7
```
