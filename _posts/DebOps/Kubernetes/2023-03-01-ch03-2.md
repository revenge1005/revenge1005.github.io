---
title:  "[Retry, k8s] 02. ì›Œí¬ë¡œë“œ API - íŒŒë“œ(Pod)" 

categories:
  - KUBERNETES
tags:
  - [kubernetes]

toc: true
toc_sticky: true

date: 2023-03-01
last_modified_at: 2023-03-01
---
# [Retry, k8s] 02. ì›Œí¬ë¡œë“œ API - íŒŒë“œ(Pod)
---

<style>
table {
    font-size: 12pt;
}
table th:first-of-type {
    width: 5%;
}
table th:nth-of-type(2) {
    width: 15%;
}
table th:nth-of-type(3) {
    width: 50%;
}
table th:nth-of-type(4) {
    width: 30%;
}
</style>

<br>

## ğŸ”” íŒŒë“œ(Pod)

> ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ **ë°°í¬í•  ìˆ˜ ìˆëŠ” ê°€ì¥ ì‘ì€ ë‹¨ìœ„ë¡œ íŒŒë“œëŠ” í•œ ê°œ ì´ìƒì˜ ì»¨í…Œì´ë„ˆì™€ ìŠ¤í† ë¦¬ì§€, ë„¤íŠ¸ì›Œí¬ ì†ì„±ìœ¼ë¡œ êµ¬ì„±**ë˜ë©°, ê°™ì€ íŒŒë“œì— í¬í•¨ëœ ì»¨í…Œì´ë„ˆë¼ë¦¬ëŠ” ë„¤íŠ¸ì›Œí¬ì ìœ¼ë¡œ ê²©ë¦¬ë˜ì–´ ìˆì§€ ì•Šê³  IP ì£¼ì†Œë¥¼ ê³µìœ í•œë‹¤. **(ì¦‰, ì»¨í…Œì´ë„ˆê°€ ë‘ ê°œ ë“¤ì–´ ìˆëŠ” íŒŒë“œë¥¼ ìƒì„±í•œ ê²½ìš°, ë‘ ì»¨í…Œì´ë„ˆëŠ” ê°™ì€ IP ì£¼ì†Œë¥¼ ê°€ì§„ë‹¤ ë”°ë¼ì„œ íŒŒë“œ ë‚´ë¶€ì˜ ì»¨í…Œì´ë„ˆëŠ” ì„œë¡œ localhostë¡œ í†µì‹ í•  ìˆ˜ ìˆë‹¤.)**

<br>

### ğŸ“œ íŒŒë“œ ìƒì„±

```bash
cat <<EOF > sample-pod.yaml
apiVersion: v1
kind: Pod
metadata:
  name: sample-pod
spec:
  containers:
    - name: nginx-container
      image: nginx:1.16
EOF
```

```bash
# íŒŒë“œ ìƒì„±
$ kubectl apply -f sample-pod.yaml
pod/sample-pod created

# íŒŒë“œ ëª©ë¡ í‘œì‹œ
$ kubectl get pods
NAME         READY   STATUS    RESTARTS   AGE
sample-pod   1/1     Running   0          14s

# íŒŒë“œ ìƒì„¸ ì •ë³´ í‘œì‹œ
$ kubectl get pods -o wide
NAME         READY   STATUS    RESTARTS   AGE   IP          NODE         NOMINATED NODE   READINESS GATES
sample-pod   1/1     Running   0          30s   10.44.0.1   k8s-node01   <none>           <none>
```

<br>

### ğŸ“œ ë‘ ê°œì˜ ì»¨í…Œì´ë„ˆë¥¼ í¬í•¨í•œ íŒŒë“œ ìƒì„±

#### ã€ë‘ ê°œì˜ ì»¨í…Œì´ë„ˆë¥¼ ê°€ì§„ íŒŒë“œ ì˜ˆì œã€‘

```bash
cat <<EOF > sample-2pod.yaml
apiVersion: v1
kind: Pod
metadata:
  name: sample-2pod
spec:
  containers:
    - name: nginx-container
      image: nginx:1.16
    - name: redis-container
      image: redis:3.2
EOF
```

```bash
# ë‘ ê°œì˜ ì»¨í…Œì´ë„ˆë¥¼ í¬í•¨í•œ íŒŒë“œ ìƒì„±
$ kubectl apply -f sample-2pod.yaml
pod/sample-2pod created

# ë‘ ê°œì˜ ì»¨í…Œì´ë„ˆë¥¼ í¬í•¨í•œ íŒŒë“œ í™•ì¸
$ kubectl get pods
NAME          READY   STATUS    RESTARTS   AGE
sample-2pod   2/2     Running   0          14s
```

#### ã€ê°™ì€ í¬í‹€ë¥¼ ì‚¬ìš©í•˜ëŠ” ë‘ ê°œì˜ ì»¨í…Œì´ë„ˆë¥¼ ê°€ì§„ íŒŒë“œ ì˜ˆì œã€‘

```bash
cat<<EOF > sample-2pod-fail.yaml
apiVersion: v1
kind: Pod
metadata:
  name: sample-2pod-fail
spec:
  containers:
    - name: nginx-container-112
      image: nginx:1.16
    - name: nginx-container-113
      image: nginx:1.17
EOF
```

```bash
# í¬íŠ¸ ì¶©ëŒì´ ìˆëŠ” íŒŒë“œ ìƒì„±
$ kubectl apply -f sample-2pod-fail.yaml
pod/sample-2pod-fail created

# íŒŒë“œ ìƒíƒœê°€ ì—ëŸ¬ì„ì„ í™•ì¸
$ kubectl get pods
NAME               READY   STATUS    RESTARTS   AGE
sample-2pod-fail   1/2     Error     0          14s

# íŒŒë“œ ë¡œê·¸ í™•ì¸
$ kubectl logs sample-2pod-fail -c nginx-container-113
2023/03/14 10:01:49 [emerg] 1#1: bind() to 0.0.0.0:80 failed (98: Address already in use)
nginx: [emerg] bind() to 0.0.0.0:80 failed (98: Address already in use)
```

<br>

### ğŸ“œ ì»¨í…Œì´ë„ˆì— ì ‘ê·¼ & ëª…ë ¹ì–´ ì‹¤í–‰

#### ã€ì»¨í…Œì´ë„ˆ ì ‘ê·¼ã€‘

```bash
# ì»¨í…Œì´ë„ˆì—ì„œ /bin/bash ì‹¤í–‰
$ kubectl exec -it sample-pod -- /bin/bash
root@sample-pod:/#

# í™•ì¸ ì‘ì—…ì— í•„ìš”í•œ íŒ¨í‚¤ì§€ ì„¤ì¹˜
root@sample-pod:/# apt update && apt -y install iproute2 procps

# ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ IP ì£¼ì†Œ í™•ì¸
root@sample-pod:/# ip addr
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
21: eth0@if22: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1376 qdisc noqueue state UP group default
    link/ether ee:8b:41:e9:e3:f2 brd ff:ff:ff:ff:ff:ff link-netnsid 0
    inet 10.44.0.1/12 brd 10.47.255.255 scope global eth0
       valid_lft forever preferred_lft forever

# ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ ë°”ì¸ë“œ(listen)í•˜ëŠ” í¬íŠ¸ í™•ì¸
root@sample-pod:/# root@sample-pod:/# ss -napt
State             Recv-Q          Send-Q             Local Address:Port             Peer Address:Port
LISTEN            0               511                0.0.0.0:80                     0.0.0.0:*             users:(("nginx",pid=1,fd=6))
TIME-WAIT         0               0                  10.44.0.1:45618                151.101.110.132:80
TIME-WAIT         0               0                  10.44.0.1:35726                151.101.66.132:80

# ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ í”„ë¡œì„¸ìŠ¤ í™•ì¸
root@sample-pod:/# ps aux
USER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root           1  0.0  0.1  10628  5492 ?        Ss   09:52   0:00 nginx: master process nginx -g daemon off;
nginx          6  0.0  0.0  11132  2676 ?        S    09:52   0:00 nginx: worker process
root           7  0.0  0.1   3872  3276 pts/0    Ss   10:07   0:00 /bin/bash
root         462  0.0  0.0   7644  2756 pts/0    R+   10:11   0:00 ps aux
```

#### ã€ì»¨í…Œì´ë„ˆì—ì„œ ëª…ë ¹ ì‹¤í–‰ã€‘

```bash
# ì»¨í…Œì´ë„ˆì—ì„œ ls ëª…ë ¹ ì‹¤í–‰
$ kubectl exec -it sample-pod -- /bin/ls
bin   dev  home  lib64  mnt  proc  run   srv  tmp  var
boot  etc  lib   media  opt  root  sbin  sys  usr

# ë‹¤ìˆ˜ì˜ ì»¨í…Œì´ë„ˆë¥¼ í¬í•¨í•œ íŒŒë“œì˜ ê²½ìš°, íŠ¹ì • ì»¨í…Œì´ë„ˆ ì§€ì •
$ kubectl exec -it sample-2pod -c nginx-container -- /bin/ls
bin   dev  home  lib64  mnt  proc  run   srv  tmp  var
boot  etc  lib   media  opt  root  sbin  sys  usr

# ì˜µì…˜ì„ í¬í•¨í•œ ëª…ë ¹ì–´ ì‹¤í–‰
$ kubectl exec -it sample-pod -- /bin/ls --all --classify
./   .dockerenv*  boot/  etc/   lib/    media/  opt/   root/  sbin/  sys/  usr/
../  bin/         dev/   home/  lib64/  mnt/    proc/  run/   srv/   tmp/  var/

# íŒŒì´í”„ ë“± íŠ¹ì • ë¬¸ìì—´ì„ í¬í•¨í•œ ê²½ìš°
$ kubectl exec -it sample-pod -- /bin/bash -c "ls -a --classify | grep lib"
lib/
lib64/
```

<br>

### ğŸ“œ í˜¸ìŠ¤íŠ¸ì˜ ë„¤íŠ¸ì›Œí¬ êµ¬ì„±ì„ ì‚¬ìš©í•œ íŒŒë“œ ê¸°ë™

> hostNetworkë¥¼ ì‚¬ìš©í•œ íŒŒë“œëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ ë…¸ë“œì˜ IP ì£¼ì†Œë¥¼ ì‚¬ìš©í•˜ëŠ” ê´€ê³„ë¡œ í¬íŠ¸ë²ˆí˜¸ ì¶©ëŒì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ê¸°ë³¸ì ìœ¼ë¡œ ì‚¬ìš©ë˜ì§€ëŠ” ì•ŠëŠ”ë‹¤.

```bash
cat << EOF > sample-hostnetwork.yaml
apiVersion: v1
kind: Pod
metadata:
  name: sample-hostnetwork
spec:
  hostNetwork: true
  containers:
    - name: nginx-container
      image: nginx:1.16
EOF
```

```bash
# íŒŒë“œì˜ IP ì£¼ì†Œ í™•ì¸
$ kubectl get pod sample-hostnetwork -o wide
NAME                 READY   STATUS    RESTARTS   AGE   IP                NODE         NOMINATED NODE   READINESS GATES
sample-hostnetwork   1/1     Running   0          9s    192.168.219.101   k8s-node01   <none>           <none>

# íŒŒë“œê°€ ê¸°ë™ ì¤‘ì¸ ë…¸ë“œì˜ IP ì£¼ì†Œ í™•ì¸
$ kubectl get node -o wide
NAME           STATUS   ROLES           AGE   VERSION   INTERNAL-IP       EXTERNAL-IP   OS-IMAGE             KERNEL-VERSION      CONTAINER-RUNTIME
k8s-master01   Ready    control-plane   25h   v1.26.2   192.168.219.10    <none>        Ubuntu 22.04.2 LTS   5.15.0-67-generic   docker://23.0.1
k8s-node01     Ready    <none>          25h   v1.26.2   192.168.219.101   <none>        Ubuntu 22.04.2 LTS   5.15.0-67-generic   docker://23.0.1
k8s-node02     Ready    <none>          25h   v1.26.2   192.168.219.102   <none>        Ubuntu 22.04.2 LTS   5.15.0-67-generic   docker://23.0.1

# íŒŒë“œì˜ í˜¸ìŠ¤íŠ¸ëª… í™•ì¸
$ kubectl exec -it sample-hostnetwork -- hostname
k8s-node01

# íŒŒë“œì˜ DNS ì„¤ì • í™•ì¸
$ kubectl exec -it sample-hostnetwork -- cat /etc/resolv.conf
nameserver 168.126.63.1
nameserver 8.8.8.8
```

<br>

### ğŸ“œ íŒŒë“œ DNS ì„¤ì •

#### ã€ClusterFirst(ê¸°ë³¸ê°’)ã€‘ : í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ DNSì— ì§ˆì˜í•˜ì—¬ í•´ì„ë˜ì§€ ì•Šìœ¼ë©´ ì—…ìŠ¤íŠ¸ë¦¼ì— ì§ˆì˜í•¨

```bash
cat <<EOF > sample-dnspolicy-clusterfirst.yaml
apiVersion: v1
kind: Pod
metadata:
  name: sample-dnspolicy-clusterfirst
spec:
  dnsPolicy: ClusterFirst
  containers:
    - name: nginx-container
      image: nginx:1.16
EOF
```

```bash
# ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì˜ DNS ì„¤ì • íŒŒì¼ /etc/resolv.confë¥¼ í‘œì‹œ
$ kubectl exec -it sample-dnspolicy-clusterfirst -- cat /etc/resolv.conf
nameserver 10.96.0.10
search default.svc.cluster.local svc.cluster.local cluster.local
options ndots:5

# í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì˜ DNS Serviceì— í• ë‹¹ëœ IP ì£¼ì†Œë¥¼ í™•ì¸
root@k8s-master01:~/kube_test# kubectl get services -n kube-system
NAME       TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)                  AGE
kube-dns   ClusterIP   10.96.0.10   <none>        53/UDP,53/TCP,9153/TCP   25h

```

#### ã€Noneã€‘ : íŒŒë“œ ì •ì˜ ë‚´ì—ì„œ ì •ì ìœ¼ë¡œ ì„¤ì •

```bash
cat <<EOF > sample-dnspolicy-none.yaml
apiVersion: v1
kind: Pod
metadata:
  name: sample-dnspolicy-none
spec:
  dnsPolicy: None
  dnsConfig:
    nameservers:
    - 8.8.8.8
    - 8.8.4.4
    searches:
    - example.com
    options:
    - name: ndots
      value: "5"
  containers:
    - name: nginx-container
      image: nginx:1.16
EOF
```

```bash
# ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì˜ DNS ì„¤ì • íŒŒì¼ /etc/resolv.confë¥¼ í‘œì‹œ
$ kubectl exec -it sample-dnspolicy-none -- cat /etc/resolv.conf
nameserver 8.8.8.8
nameserver 8.8.4.4
search example.com
options ndots:5
```

#### ã€Defaultã€‘ : íŒŒë“œê°€ ê¸°ë™í•˜ëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ ë…¸ë“œì˜ /etc/resolv.confë¥¼ ìƒì†ë°›ëŠ”ë‹¤.

```bash
cat <<EOF > sample-dnspolicy-default.yaml
apiVersion: v1
kind: Pod
metadata:
  name: sample-dnspolicy-default
spec:
  dnsPolicy: Default
  containers:
    - name: nginx-container
      image: nginx:1.16
EOF
```

```bash
# ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì˜ DNS ì„¤ì • íŒŒì¼ /etc/resolv.confë¥¼ í‘œì‹œ
$ kubectl exec -it sample-dnspolicy-default -- cat /etc/resolv.conf
nameserver 168.126.63.1
nameserver 8.8.8.8
```

#### ã€ClusterFirstWithHostNetã€‘ : ClusterFirstì˜ ë™ì‘ê³¼ ê°™ë‹¤(hostNetwork ì‚¬ìš© ì‹œ ì„¤ì •)

```bash
cat <<EOF > sample-dnspolicy-clusterfirstwithhostnet.yaml
apiVersion: v1
kind: Pod
metadata:
  name: sample-dnspolicy-clusterfirstwithhostnet
spec:
  dnsPolicy: ClusterFirstWithHostNet
  hostNetwork: true
  containers:
    - name: nginx-container
      image: nginx:1.16
EOF
```

```bash
# ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì˜ DNS ì„¤ì • íŒŒì¼ /etc/resolv.confë¥¼ í‘œì‹œ
$ kubectl exec -it sample-dnspolicy-clusterfirstwithhostnet -- cat /etc/resolv.conf
nameserver 10.96.0.10
search default.svc.cluster.local svc.cluster.local cluster.local
options ndots:5
```

<br>

### ğŸ“œ ì •ì  í˜¸ìŠ¤íŠ¸ëª… í•´ì„ ì„¤ì •(/etc/hosts)

```bash
cat <<EOF > sample-hostaliases.yaml
apiVersion: v1
kind: Pod
metadata:
  name: sample-hostaliases
spec:
  containers:
    - name: nginx-container
      image: nginx:1.16
  hostAliases:
    - ip: 8.8.8.8
      hostnames:
        - google-dns
        - google-public-dns
EOF
```

```bash
$ kubectl exec -it sample-hostaliases -- cat /etc/hosts
# Kubernetes-managed hosts file.
127.0.0.1       localhost
::1     localhost ip6-localhost ip6-loopback
fe00::0 ip6-localnet
fe00::0 ip6-mcastprefix
fe00::1 ip6-allnodes
fe00::2 ip6-allrouters
10.36.0.1       sample-hostaliases

# Entries added by HostAliases.
8.8.8.8 google-dns      google-public-dns
```

<br>

### ğŸ“œ ì‘ì—… ë””ë ‰í„°ë¦¬ ì„¤ì •

```bash
cat <<EOF > sample-workingdir.yaml
apiVersion: v1
kind: Pod
metadata:
  name: sample-workingdir
spec:
  containers:
    - name: nginx-container
      image: nginx:1.16
      workingDir: /tmp
EOF
```

```bash
$ kubectl exec -it sample-pod -- pwd
/

$ kubectl exec -it sample-workingdir -- pwd
/tmp
```

<br>