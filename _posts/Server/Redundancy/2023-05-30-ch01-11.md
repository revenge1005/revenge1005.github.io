---
title:  "[Redundancy] 11. 네트워크 다중화"

categories:
  - REDUNDANCY
tags:
  - [linux, redundancy]

toc: true
toc_sticky: true

date: 2023-05-30
last_modified_at: 2022-05-30
---
<br>

# 10-1. 장애 포인트
---

<style>
table {
    font-size: 12pt;
}
table th:first-of-type {
    width: 5%;
}
table th:nth-of-type(2) {
    width: 15%;
}
table th:nth-of-type(3) {
    width: 50%;
}
table th:nth-of-type(4) {
    width: 30%;
}
big {
    font-size: 18pt;
}
small { 
    font-size: 18px 
}
</style>

> (1)~(3)은 서버와 스위치 간 접속에 장애가 발생하는 것으로 해당 게시글에서는 **『링크 장애』**, 스위치 끼리 연결하는 스위치 간 접속에도 (1), (3) 고장은 **『스위치 간 접속 장애』**, 네트워크 스위치의 고장은 **『스위치 장애』**라고 하기로 한다.

| 구분 | 장애 포인트 |
| :---: | :--- |
| (1) | LAN 케이블 |
| (2) | NIC |
| (3) | 네트워크 스위치 포트 |
| (4) | 네트워크 스위치 |

<br>

# 10-2. 링크 다중화
---

> 링크 장애를 회피하기 위해서는 서버와 스위치의 접속을 다중화해야 한다. 즉, 서버의 NIC를 여러개 준비하고 LAN 케이블도 같은 수만큼 연결한다. **그러나, 단순히 여러 NIC를 사용하면 각 NIC에 다른 IP 주소를 할당해야 하며, 이로 인해 통신할 때 마다 어떤 NIC를 사용할지를 결정하며, 그에 따라 송신 주소를 전환해야 한다. 이는 매운 불편한 일이며, 이를 해결하기 위한 구조로 리눅스에는 『Bonding 드라이브』가 마련되어 있다.**

<br>

<big> **■ Bonding 드라이버** </big> <br>

- Bonding 드라이버는 여러 물리적인 NIC를 하나의 논리적인 NIC로 다룰 수 있도록 합니다.

- 이 "논리 NIC"는 주소 할당 및 다양한 기능(IP 엘리어스, VLAN, 브릿지 기능 등)의 대상 NIC로서 사용이 가능합니다. 

- Bonding 드라이버가 여러 개 존재하는 물리 NIC 중에서 통신에 사용할 것을 섵내하는 방법은 다음과 같다.

    | 모드 | 동작 |
    | :---: | :--- |
    | balance-rr | 송신할 패킷마다 사용할 물리 NIC를 전환(라운드로빈) |
    | active-backup | 첫 번째 물리 NIC가 사용가능한 동안에는 그 NIC만 사용, 해당 NIC가 고장나면 다른 NIC를 사용 |
    | balance-xor | 송신처와 목적지 MAC 주소를 XOR해서 사용할 물리 NIC를 결정 |
    | broadcast | 송신 패킷을 복사해서 모든 물리 NIC에 대해 동일한 패킷을 전송 |
    | 802.3ad | IEEE 802.3ad 프로토콜을 사용해서 스위치와의 사이에서 동적으로 aggregation을 작성 |
    | balance-tlb | 물리 NIC 중에 가장 부하가 낮은 물리 NIC를 선택해서 송신, 수신은 특정 물리 NIC를 사용해 수신함 |
    | balance-alb | 송수신 모두 부하가 낮은 물리 NIC를 사용 |

- Bonding 드라이버의 물리 NIC의 고장을 검출하는 방법은 『MII(Media Independent Interface) 감시』와 『ARP(Address Resolutin Protocol) 감시』를 선택할 수 있다.

    | 감시 종류 | 설명 |
    | :---: | :--- |
    | MII 감시 | MII 감시는 물리 NIC가 링크 다운되면 고장 난 것으로 간주하는 것으로 저비용에 단시간에 고장여부를 체크할 수 있지만, 반면 NIC가 링크 업임에도 통신할 수 없는 상황에는 대응할 수 없다. |
    | ARP 감시 | ARP 감시는 ARP 요청을 지정된 머신에 대해 송신해서 응답이 오는지 시험해서 판정하는 것으로 실제 통신해서 확인하므로 고장을 간과할 가능성은 낮은 반면, 확실하게 응답을 보내는 대상에 대해 ARP 요청을 송신하지 않으면 잘못된 진단으로 이어지게 된다. 잘못된 진단을 할 가능성을 낮추기 위해 Bonding 드라이버에서는 ARP를 보내는 장비로 여러 대(최대 16)의 주소를 등록할 수 있다. |

<br>

<big> **■ Bonding 드라이버 설정** </big> <br>

