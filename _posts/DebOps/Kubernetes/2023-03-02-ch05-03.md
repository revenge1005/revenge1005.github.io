---
title:  "[Retry, k8s] 22. ì»¨í”¼ê·¸ & ìŠ¤í† ë¦¬ì§€ API - ì»¨í”¼ê·¸ë§µ" 

categories:
  - KUBERNETES
tags:
  - [kubernetes]

toc: true
toc_sticky: true

date: 2023-10-15
last_modified_at: 2023-10-15

---
<br>
# ğŸ”” ì»¨í”¼ê·¸ë§µ
---

<style>
table {
    font-size: 12pt;
}
table th:first-of-type {
    width: 5%;
}
table th:nth-of-type(2) {
    width: 15%;
}
table th:nth-of-type(3) {
    width: 50%;
}
table th:nth-of-type(4) {
    width: 30%;
}
</style>

> ì¿ ë²„ë„¤í‹°ìŠ¤ ì»¨í”¼ê·¸ë§µì€ **ì»¨í…Œì´ë„ˆì™€ ë¶„ë¦¬í•´ì„œ í‚¤-ê°’ ìŒìœ¼ë¡œ í™˜ê²½ì„¤ì • ê°’ì„ ì €ì¥í•˜ëŠ”ë° ì‚¬ìš©í•˜ëŠ” API ì˜¤ë¸Œì íŠ¸**

+ í‚¤-ë°¸ë¥˜ í˜•ì‹ ì™¸ì—ë„ nginx.conf, httpd.conf ê°™ì€ ì„¤ì • íŒŒì¼ ìì²´ë„ ì €ì¥í•  ìˆ˜ ìˆë‹¤.

+ ì»¨í”¼ê·¸ë§µì„ ì‚¬ìš©í•˜ë©´ ë™ì¼í•œ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ì— ë‹¤ë¥¸ ì„¤ì • ê°’ì„ ì´ì‹í•´ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

+ ì»¨í”¼ê·¸ë§µì€ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë³„ë¡œ ì¡´ì¬í•˜ë©°, íŒŒë“œëŠ” í™˜ê²½ ë³€ìˆ˜, ì»¤ë§¨ë“œ-ë¼ì¸ ì¸ìˆ˜ ë˜ëŠ” êµ¬ì„± íŒŒì¼ë¡œ ì»¨í”¼ê·¸ë§µì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

+ ì»¨í”¼ê·¸ë§µì€ ê¸°ë°€ì´ ì•„ë‹Œ ë°ì´í„°ë¥¼ ì €ì¥í•˜ë„ë¡ ì„¤ê³„ë˜ì—ˆìœ¼ë¯€ë¡œ, ì €ì¥í•˜ë ¤ëŠ” ë°ì´í„°ê°€ ê¸°ë°€ì¸ ê²½ìš° ì‹œí¬ë¦¿ì´ë‚˜ ë‹¤ë¥¸ ë„êµ¬ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.


<br>

## (1) ì»¨í”¼ê·¸ë§µ ìƒì„±

+ ì»¨í”¼ê·¸ë§µ ë¦¬ì†ŒìŠ¤ëŠ” í•˜ë‚˜ì˜ ì»¨í”¼ê·¸ë§µ ì•ˆì— ì—¬ëŸ¬ í‚¤-ë°¸ë¥˜ ê°’ì´ ì €ì¥ëœë‹¤.

+ í•˜ë‚˜ì˜ ì»¨í”¼ê·¸ë§µë§ˆë‹¤ ì €ì¥í•  ìˆ˜ ìˆëŠ” ì‚¬ì´ì¦ˆëŠ” ì´ 1MBì´ë‹¤.

<br>
  
### ğŸ“œ kubectlë¡œ íŒŒì¼ì—ì„œ ê°’ì„ ì°¸ì¡°í•˜ì—¬ ìƒì„±(--from-file)

```bash
# íŒŒì¼ë¡œ ì»¨í”¼ê·¸ë§µ ìƒì„±
$  kubectl create configmap --save-config sample-configmap --from-file=./nginx.conf
configmap/sample-configmap created


# ì»¨í”¼ê·¸ë§µì— ë“±ë¡ëœ ë°ì´í„° í™•ì¸
$ kubectl get configmap sample-configmap -o json | jq .data
{
  "nginx.conf": "user  nginx;\nworker_processes  1;\n\nerror_log  /var/log/nginx/error.log warn;\n\npid        /var/run/nginx.pid;\n\n\nevents {\n    worker_connections  1024;\n}\n\n\nhttp {\n    include       /etc/nginx/mime.types;\n    \n    default_type  application/octet-stream;\n\n    log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n                      '$status $body_bytes_sent \"$http_referer\" '\n                      '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n    access_log  /var/log/nginx/access.log  main;\n\n    sendfile        on;\n    #tcp_nopush     on;\n\n    keepalive_timeout  65;\n\n    #gzip  on;\n    \n    include /etc/nginx/conf.d/*.conf\n}\n"
}


# ì»¨í”¼ê·¸ë§µì— ë“±ë¡ëœ ë°ì´í„° í™•ì¸
$ kubectl describe configmap sample-configmap
Name:         sample-configmap
Namespace:    default
Labels:       <none>
Annotations:  <none>

Data
====
nginx.conf:
----
user  nginx;
worker_processes  1;

error_log  /var/log/nginx/error.log warn;

pid        /var/run/nginx.pid;


events {
    worker_connections  1024;
}


http {
    include       /etc/nginx/mime.types;

    default_type  application/octet-stream;

    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';

    access_log  /var/log/nginx/access.log  main;

    sendfile        on;
    #tcp_nopush     on;

    keepalive_timeout  65;

    #gzip  on;

    include /etc/nginx/conf.d/*.conf
}


BinaryData
====

Events:  <none>
```


+ ì»¨í”¼ê·¸ë§µ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ëŠ” dataê°€ ì•„ë‹Œ binaryData í•„ë“œë¥¼ ì‚¬ìš©í•˜ì—¬ UTF-8 ì´ì™¸ì˜ ë°ì´í„°ë¥¼ í¬í•¨í•˜ëŠ” ë°”ì´ë„ˆë¦¬ ë°ì´í„°ë¥¼ ì €ì¥í•  ìˆ˜ ìˆë‹¤.

+ ì¿ ë²„ë„¤í‹°ìŠ¤ì— ì§ì ‘ ë“±ë¡í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ íŒŒì¼ë¡œ ì €ì¥í•˜ë ¤ë©´ "--dry-run=client -o yaml ì˜µì…˜"ì„ ì‚¬ìš©í•œë‹¤.

```bash
$ kubectl create configmap sample-configmap-binary \
--from-file image.jpg \
--from-literal=index.html="Hello, Kubernetes" \
--dry-run=client -o yaml \
> sample-configmap-binary.yaml
```

```bash
$ cat sample-configmap-binary.yaml
apiVersion: v1
binaryData:
  image.jpg: iVBORw0KGgoAAAANSUhEUgAAAxcAAAGXCAYA ~(ìƒëµ)~
data:
  index.html: Hello, Kubernetes
kind: ConfigMap
metadata:
  creationTimestamp: null
  name: sample-configmap-binary
```

```bash
cat <<EOF > sample-configmap-binary-webserver.yaml
apiVersion: v1
kind: Pod
metadata:
  name: sample-configmap-binary-webserver
spec:
  containers:
  - name: nginx-container
    image: nginx:1.16
    volumeMounts:
    - name: config-volume
      mountPath: /usr/share/nginx/html
  volumes:
  - name: config-volume
    configMap:
      name: sample-configmap-binary
EOF


$ kubectl exec -it sample-configmap-binary-webserver -- ls -la /usr/share/nginx/html
total 12
drwxrwxrwx 3 root root 4096 Apr  8 11:05 .
drwxr-xr-x 3 root root 4096 Apr 23  2020 ..
drwxr-xr-x 2 root root 4096 Apr  8 11:05 ..2023_04_08_11_05_18.1453186303
lrwxrwxrwx 1 root root   32 Apr  8 11:05 ..data -> ..2023_04_08_11_05_18.1453186303
lrwxrwxrwx 1 root root   16 Apr  8 11:05 image.jpg -> ..data/image.jpg
lrwxrwxrwx 1 root root   17 Apr  8 11:05 index.html -> ..data/index.html
```

<br>
  
### ğŸ“œ kubectlë¡œ ì§ì ‘ ê°’ì„ ì „ë‹¬í•˜ì—¬ ìƒì„±(--from-literal)

```bash
# ì¸ìˆ˜ì— ì§ì ‘ ê°’ì„ ì „ë‹¬í•˜ì—¬ ì»¨í”¼ê·¸ë§µ ìƒì„±
$ kubectl create configmap --save-config web-config \
--from-literal=connection.max=100 --from-literal=connection.min=10
```

<br>
  
### ğŸ“œ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ë¡œ ìƒì„± (-f)

```bash
cat <<EOF > sample-configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: sample-configmap
data:
  thread: "16"
  connection.max: "100"
  connection.min: "10"
  sample.properties: | 
    property.1=value-1
    property.2=value-2
    property.3=value-3
  nginx.conf: |
    user nginx;
    worker_processes auto;
    error_log /var/log/nginx/error.log;
    pid /run/nginx.pid;
  test.sh: |
    #!/bin/bash
    echo "Hello, Kubernetes"
    sleep infinity
EOF
```

<br>

---

<br>


## (2) ì»¨í”¼ê·¸ë§µ ì‚¬ìš©

1. í™˜ê²½ ë³€ìˆ˜ë¡œ ì „ë‹¬

    - ì»¨í”¼ê·¸ë§µì˜ íŠ¹ì • í‚¤ë§Œ

    - ì»¨í”¼ê·¸ë§µì˜ ì „ì²´ í‚¤

2. ë³¼ë¥¨ìœ¼ë¡œ ë§ˆìš´íŠ¸

    - ì»¨í”¼ê·¸ë§µì˜ íŠ¹ì • í‚¤ë§Œ

    - ì»¨í”¼ê·¸ë§µì˜ ì „ì²´ í‚¤

<br>
  
### ğŸ“œ í™˜ê²½ ë³€ìˆ˜ë¡œ ì „ë‹¬

```bash
# ì»¨í”¼ê·¸ë§µì˜ í•œ ê°œ í‚¤ë¥¼ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì „ë‹¬í•˜ëŠ” íŒŒë“œ
$ cat <<EOF > sample-configmap-single-env.yaml
apiVersion: v1
kind: Pod
metadata:
  name: sample-configmap-single-env
spec:
  containers:
  - name: configmap-container
    image: nginx:1.16
    env:
    - name: CONNECTION_MAX
      valueFrom:
        configMapKeyRef:
          name: sample-configmap
          key: connection.max
EOF


# íŒŒë“œì˜ CONNECTION_MAX í™˜ê²½ ë³€ìˆ˜ ë‚´ìš© í™•ì¸
$ kubectl exec -it sample-configmap-single-env -- env | grep CONNECTION_MAX
CONNECTION_MAX=100
```


```bash
# ì»¨í”¼ê·¸ë§µì˜ ì „ì²´ í‚¤ë¥¼ í™˜ê²½ ë³€ìˆ˜ë¡œ ì „ë‹¬í•˜ëŠ” íŒŒë“œ ì˜ˆì œ
$ cat <<EOF > sample-configmap-multi-env.yaml
apiVersion: v1
kind: Pod
metadata:
  name: sample-configmap-multi-env
spec:
  containers:
  - name: configmap-container
    image: nginx:1.16
    envFrom:
    - configMapRef:
        name: sample-configmap
EOF


# íŒŒë“œì˜ í™˜ê²½ ë³€ìˆ˜ ë‚´ìš© í™•ì¸
$ kubectl exec -it sample-configmap-multi-env -- env
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
HOSTNAME=sample-configmap-multi-env
TERM=xterm
nginx.conf=user nginx;
worker_processes auto;
error_log /var/log/nginx/error.log;
pid /run/nginx.pid;

sample.properties=property.1=value-1
property.2=value-2
property.3=value-3

test.sh=#!/bin/bash
echo "Hello, Kubernetes"
sleep infinity

thread=16
connection.max=100
connection.min=10
KUBERNETES_PORT_443_TCP=tcp://10.96.0.1:443
KUBERNETES_PORT_443_TCP_PROTO=tcp
KUBERNETES_PORT_443_TCP_PORT=443
KUBERNETES_PORT_443_TCP_ADDR=10.96.0.1
KUBERNETES_SERVICE_HOST=10.96.0.1
KUBERNETES_SERVICE_PORT=443
KUBERNETES_SERVICE_PORT_HTTPS=443
KUBERNETES_PORT=tcp://10.96.0.1:443
NGINX_VERSION=1.16.1
NJS_VERSION=0.3.8
PKG_RELEASE=1~buster
HOME=/root
```

<br>
  
### ğŸ“œ ë³¼ë¥¨ìœ¼ë¡œ ë§ˆìš´íŠ¸

```bash
# ì»¨í”¼ê·¸ë§µì˜ í•œ ê°œ í‚¤ë¥¼ ë³¼ë¥¨ ë§ˆìš´íŠ¸í•˜ëŠ” íŒŒë“œ ì˜ˆì œ
$ cat <<EOF > sample-configmap-single-volume.yaml
apiVersion: v1
kind: Pod
metadata:
  name: sample-configmap-single-volume
spec:
  containers:
  - name: configmap-container
    image: nginx:1.16
    volumeMounts:
    - name: config-volume
      mountPath: /config
  volumes:
  - name: config-volume
    configMap:
      name: sample-configmap
      items:
      - key: nginx.conf
        path: nginx-sample.conf
EOF

# íŒŒì¼ë¡œ ì €ì¥ëœ ì»¨í”¼ê·¸ë§µ í™•ì¸
$ kubectl exec -it sample-configmap-single-volume -- cat /config/nginx-sample.conf
user nginx;
worker_processes auto;
error_log /var/log/nginx/error.log;
pid /run/nginx.pid;
```


```bash
# ì»¨í”¼ê·¸ë§µì˜ ì „ì²´ í‚¤ë¥¼ ë³¼ë¥¨ ë§ˆìš´íŠ¸í•˜ëŠ” íŒŒë“œ ì˜ˆì œ
$ cat <<EOF > sample-configmap-multi-volume.yaml
apiVersion: v1
kind: Pod
metadata:
  name: sample-configmap-multi-volume
spec:
  containers:
  - name: configmap-container
    image: nginx:1.16
    volumeMounts:
    - name: config-volume
      mountPath: /config
  volumes:
  - name: config-volume
    configMap:
      name: sample-configmap
EOF

# íŒŒë“œì— ë§ˆìš´íŠ¸ëœ /config ì•„ë˜ íŒŒì¼ í™•ì¸
$ kubectl exec -it sample-configmap-multi-volume -- ls /config
connection.max  connection.min  nginx.conf  sample.properties  test.sh  thread
```

<br>

---

<br>


## (3) ì‹œí¬ë¦¿ê³¼ ì»¨í”¼ê·¸ë§µì˜ ê³µí†µ ì£¼ì œ

<br>
  
### ğŸ“œ ì‹œí¬ë¦¿ê³¼ ì»¨í”¼ê·¸ë§µì˜ ì‚¬ìš© êµ¬ë¶„

> ì‹œí¬ë¦¿ê³¼ ì»¨í”¼ê·¸ë§µì€ ë¹„ìŠ·í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆì§€ë§Œ, ê°€ì¥ í° ì°¨ì´ëŠ” ì‹œí¬ë¦¿ì€ ê¸°ë°€ ì •ë³´ë¥¼ ì·¨ê¸‰í•˜ê¸° ìœ„í•œ ë¦¬ì†ŒìŠ¤ë¼ëŠ” ì ì— ìˆë‹¤.

+ ì‹œí¬ë¦¿ ë°ì´í„°ëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ ë§ˆìŠ¤í„°ì˜ etcdë¼ëŠ” ë¶„ì‚° KVS(Key-Value Store)ì— ì €ì¥ëœë‹¤.

+ ì‹¤ì œ ì‹œí¬ë¦¿ì„ ì‚¬ìš©í•˜ëŠ” íŒŒë“œê°€ ìˆëŠ” ê²½ìš°ì—ë§Œ etcdì—ì„œ ì¿ ë²„ë„¤í‹°ìŠ¤ ë…¸ë“œì— ë°ì´í„°ë¥¼ ë³´ë‚¸ë‹¤.

+ ì´ë•Œ ì¿ ë²„ë„¤í‹°ìŠ¤ ë…¸ë“œìƒì— ì˜êµ¬ì ìœ¼ë¡œ ë°ì´í„°ê°€ ë‚¨ì§€ ì•Šë„ë¡ ì‹œí¬ë¦¿ ë°ì´í„° tmpfs ì˜ì—­(ë©”ëª¨ë¦¬ìƒì— êµ¬ì¶•ëœ ì„ì‹œ íŒŒì¼ ì‹œìŠ¤í…œ)ì— ì €ì¥ë˜ê²Œ ë˜ì–´ ìˆë‹¤.

+ ì¿ ë²„ë„¤í‹°ìŠ¤ ë²„ì „ê³¼ í™˜ê²½ì— ë”°ë¼ì„œëŠ” etcdì— ì €ì¥ëœ ì‹œí¬ë¦¿ì´ ì•”í˜¸í™”ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ, etcdì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì„ ì œí•œí•´ì•¼ í•©ë‹ˆë‹¤.


![22313](https://user-images.githubusercontent.com/42735894/230722421-bce2dd8d-25e3-4729-9fc8-d7783397f7ad.png){: width="90%" height="90%"}{: .align-center}

<br>
  
### ğŸ“œ ì»¨í”¼ê·¸ë§µê³¼ ì‹œí¬ë¦¿ì˜ ë°ì´í„° ë§ˆìš´íŠ¸ ì‹œ í¼ë¯¸ì…˜ ë³€ê²½

> ì»¨í”¼ê·¸ë§µì— ì €ì¥ëœ ìŠ¤í¬ë¦½íŠ¸ë¥¼ íŒŒë“œì—ì„œ ì‹¤í–‰í•˜ëŠ” ê²½ìš° ì»¨í”¼ê·¸ë§µ ë°ì´í„°ì—ì„œ ë³¼ë¥¨ì„ ìƒì„±í•  ë•Œ ì‹¤í–‰ ê¶Œí•œì„ ë¶€ì—¬í•  ìˆ˜ ìˆë‹¤.

+ ì‹œí¬ë¦¿ë„ ì €ì¥ëœ ê¸°ë°€ ë°ì´í„°ë¥¼ íŒŒë“œì— ë§ˆìš´íŠ¸í•˜ëŠ” ê²½ìš° ì‹œí¬ë¦¿ ë°ì´í„°ì—ì„œ ë³¼ë¥¨ì„ ìƒì„±í•  ë•Œ í¼ë¯¸ì…˜ì„ ë¶€ì—¬í•  ìˆ˜ ìˆë‹¤.

+ ì»¨í”¼ê·¸ë§µê³¼ ì‹œí¬ë¦¿ ëª¨ë‘ ê¸°ë³¸ê°’ 0644ë¡œ ë§ˆìš´íŠ¸ëœë‹¤. (í¼ë¯¸ì…˜ì€ 8ì§„ìˆ˜ í‘œê¸°ì—ì„œ 10ì§„ìˆ˜ í‘œê¸°ë¡œ ë³€í™˜í•œ í˜•íƒœë¥¼ ì‚¬ìš©í•˜ì—¬ ê¸°ìˆ í•´ì•¼ í•œë‹¤.)

  - ì˜ˆì‹œ) 256 -> 0400 -> r-- --- --- | 493 -> 0755 -> rwx- r-x r-x | 420 -> 0644 -> rw- r-- r--


```bash
# ì˜ˆì œì—ì„œëŠ” ì»¨í”¼ê·¸ë§µ ë‚´ë¶€ì˜ test.shë¥¼ 0755ë¡œ ë§ˆìš´íŠ¸í•˜ê³  ì´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ê·¸ëŒ€ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤.
$ cat <<EOF > sample-configmap-scripts.yaml
apiVersion: v1
kind: Pod
metadata:
  name: sample-configmap-scripts
spec:
  containers:
  - name: configmap-container
    image: nginx:1.16
    command: ["/config/test.sh"]
    volumeMounts:
    - name: config-volume
      mountPath: /config
  volumes:
  - name: config-volume
    configMap:
      name: sample-configmap
      items:
      - key: test.sh
        path: test.sh
        mode: 493
EOF

# ì‘ë™ í™•ì¸
$ kubectl logs sample-configmap-scripts
Hello, Kubernetes
```


```bash
# ì‹œí¬ë¦¿ ë‚´ë¶€ì˜ ëª¨ë“  ë°ì´í„°ë¥¼ 0400ìœ¼ë¡œ ë§ˆìš´íŠ¸í•œë‹¤.
$ cat <<EOF > sample-configmap-secure.yaml
apiVersion: v1
kind: Pod
metadata:
  name: sample-secret-secure
spec:
  containers:
  - name: secret-container
    image: nginx:1.16
    volumeMounts:
    - name: config-volume
      mountPath: /config
  volumes:
  - name: config-volume
    secret:
      secretName: sample-db-auth
      defaultMode: 256
EOF


# ì‹¤ì œë¡œ íŒŒì¼ì„ í™•ì¸í•´ë³´ë©´ ê¸°ë³¸ê°’ 0644ì— 0400ìœ¼ë¡œ ë³€ê²½ë˜ì–´ ë§ˆìš´íŠ¸ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
$ kubectl exec -it sample-secret-secure -- ls -l /config
total 0
lrwxrwxrwx 1 root root 15 Apr  8 13:20 password -> ..data/password
lrwxrwxrwx 1 root root 15 Apr  8 13:20 username -> ..data/username

$ kubectl exec -it sample-secret-secure -- ls -l /config/..data/
total 8
-r-------- 1 root root 12 Apr  8 13:20 password
-r-------- 1 root root  5 Apr  8 13:20 username
```

<br>
  
### ğŸ“œ ë™ì  ì»¨í”¼ê·¸ë§µ ì—…ë°ì´íŠ¸

> ë³¼ë¥¨ ë§ˆìš´íŠ¸ë¥¼ ì‚¬ìš©í•œ ì»¨í”¼ê·¸ë§µì—ì„œëŠ” ì¼ì • ì‹œê°„ë§ˆë‹¤ kube-apiserverë¡œ ë³€ê²½ì„ í™•ì¸í•˜ê³  ë³€ê²½ì´ ìˆì„ ê²½ìš°ì—ëŠ” íŒŒì¼ì„ êµì²´í•œë‹¤.

+ ì—…ë°ì´íŠ¸ ê°„ê²©ì€ 60ì´ˆë¡œ ì„¤ì •ë˜ì–´ ìˆê³ , ì´ ê°„ê²©ì„ ì¡°ì •í•  ê²½ìš°ì—ëŠ” kubeletì˜ --sync-frequency ì˜µì…˜ì„ ì„¤ì •í•œë‹¤.

+ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•œ ì»¨í”¼ê·¸ë§µì€ ê¸°ë™í•  ë•Œ í™˜ê²½ ë³€ìˆ˜ê°€ ì •í•´ì§€ê¸° ë•Œë¬¸ì— ë™ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ í•  ìˆ˜ ì—†ë‹¤.

![23131313123](https://user-images.githubusercontent.com/42735894/230723988-02713dc6-8f5e-4f8a-b94b-6a9def2b1507.png){: width="90%" height="90%"}{: .align-center}

```bash
# ì»¨í”¼ê·¸ë§µì´ ë§ˆìš´íŠ¸ë˜ì–´ ìˆëŠ” ë””ë ‰í„°ë¦¬ í™•ì¸
$ kubectl exec -it sample-configmap-multi-volume -- ls -al /config
total 12
drwxrwxrwx 3 root root 4096 Apr  8 11:47 .
drwxr-xr-x 1 root root 4096 Apr  8 11:47 ..
drwxr-xr-x 2 root root 4096 Apr  8 11:47 ..2023_04_08_11_47_17.2283803633
lrwxrwxrwx 1 root root   32 Apr  8 11:47 ..data -> ..2023_04_08_11_47_17.2283803633
lrwxrwxrwx 1 root root   21 Apr  8 11:47 connection.max -> ..data/connection.max
lrwxrwxrwx 1 root root   21 Apr  8 11:47 connection.min -> ..data/connection.min
lrwxrwxrwx 1 root root   17 Apr  8 11:47 nginx.conf -> ..data/nginx.conf
lrwxrwxrwx 1 root root   24 Apr  8 11:47 sample.properties -> ..data/sample.properties
lrwxrwxrwx 1 root root   14 Apr  8 11:47 test.sh -> ..data/test.sh
lrwxrwxrwx 1 root root   13 Apr  8 11:47 thread -> ..data/thread


# íŒŒë“œì˜ /config/thread íŒŒì¼ ë‚´ìš© í™•ì¸
$ kubectl exec -it sample-configmap-multi-volume -- cat /config/thread
16


# ì»¨í”¼ê·¸ ë§µ ë³€ê²½ ì „ì˜ ê²½ê³¼ ì‹œê°„(AGE) í™•ì¸
$ kubectl get pod sample-configmap-multi-volume
NAME                            READY   STATUS    RESTARTS   AGE
sample-configmap-multi-volume   1/1     Running   0          109m
```


+ ì´ë²ˆ ì˜ˆì œì—ì„œëŠ” ì»¨í”¼ê·¸ë§µ ë‚´ìš©ì„ threadë§Œìœ¼ë¡œ kubectl apply í–ˆê¸° ë•Œë¬¸ì— ê·¸ ì™¸ì˜ íŒŒì¼(nginx.conf ë“±)ì´ ì‚­ì œëœ ì ì—ë„ ì£¼ì˜í•˜ì.

+ ë‹¨, ì²˜ìŒì— ì»¨í”¼ê·¸ë§µì„ ìƒì„±í•  ë•Œ "kubectl apply" ë‚˜ "kubectl craete --save-config"ë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒì„±í•˜ì§€ ì•Šì„ ê²½ìš° ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ë³‘í•©ì²˜ë¦¬ê°€ ë¶ˆì™„ì „í•˜ì—¬ ê²°ê³¼ê°€ ë‹¬ë¼ì§„ë‹¤.


```bash
# ì»¨í”¼ê·¸ë§µ ì—…ë°ì´íŠ¸
$ cat <<EOF | kubectl apply -f -
apiVersion: v1
kind: ConfigMap
metadata:
  name: sample-configmap
data:
  thread: "32"
EOF
```


```bash
# ì»¨í”¼ê·¸ë§µì´ ë§ˆìš´íŠ¸ë˜ì–´ ìˆëŠ” ë””ë ‰í„°ë¦¬ í™•ì¸
$ kubectl exec -it sample-configmap-multi-volume -- ls -al /config
total 12
drwxrwxrwx 3 root root 4096 Apr  8 13:38 .
drwxr-xr-x 1 root root 4096 Apr  8 11:47 ..
drwxr-xr-x 2 root root 4096 Apr  8 13:38 ..2023_04_08_13_38_03.285047011
lrwxrwxrwx 1 root root   31 Apr  8 13:38 ..data -> ..2023_04_08_13_38_03.285047011
lrwxrwxrwx 1 root root   13 Apr  8 11:47 thread -> ..data/thread


# 16ì—ì„œ 32ë¡œ ë³€ê²½ëœ ë‚´ìš© í™•ì¸
$ kubectl exec -it sample-configmap-multi-volume -- cat /config/thread
32


# ë™ì  íŒŒì¼ì´ ë³€ê²½ëœ í›„ì˜ ê²°ê³¼ ì‹œê°„(AGE) í™•ì¸
$ kubectl get pod sample-configmap-multi-volume
NAME                            READY   STATUS    RESTARTS   AGE
sample-configmap-multi-volume   1/1     Running   0          113m
```

<br>
  
### ğŸ“œ ì‹œí¬ë¦¿ì´ë‚˜ ì»¨í”¼ê·¸ë§µì˜ ë°ì´í„° ë³€ê²½ ê±°ë¶€

> ì‹œí¬ë¦¿ì´ë‚˜ ì»¨í”¼ê·¸ë§µì˜ "immutable" ì„¤ì •ì„ ë³€ê²½í•˜ë©´ ë°ì´í„°ê°€ ë³€ê²½ë˜ëŠ” ê²ƒì„ ë°©ì§€í•˜ê³  ì˜ˆìƒì¹˜ ëª»í•œ ì‹œìŠ¤í…œ ë³€ê²½ë„ ë°©ì§€í•  ìˆ˜ ìˆë‹¤.

+ ë³€ê²½ì´ ê±°ë¶€ëœ ì‹œí¬ë¦¿ì´ë‚˜ ì»¨í”¼ê·¸ë§µì˜ ë°ì´í„°ë¥¼ ë³€ê²½í•˜ëŠ” ê²½ìš°ì—ëŠ” ë¦¬ì†ŒìŠ¤ë¥¼ ì‚­ì œí•˜ê³  ë‚˜ì„œ ë‹¤ì‹œ ìƒì„±í•´ì•¼ í•œë‹¤.

+ ë˜ ë³¼ë¥¨ìœ¼ë¡œ ë§ˆìš´íŠ¸í•˜ê³  ìˆëŠ” ê²½ìš°ëŠ” íŒŒë“œ ì¬ìƒì„±ë„ í•„ìš”í•˜ë‹¤.

+ ì¥ì ìœ¼ë¡œëŠ” ë¦¬ì†ŒìŠ¤ ë³€ê²½ì„ ê°ì‹œí•  í•„ìš”ê°€ ì—†ì–´ì§€ë¯€ë¡œ ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ ì‹œìŠ¤í…œì  ì„±ëŠ¥ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ë„ ìˆë‹¤ëŠ” ê²ƒì„ ë“¤ ìˆ˜ ìˆë‹¤.

```bash
# ë³€ê²½í•  ìˆ˜ ì—†ëŠ” ì‹œí¬ë¦¿ ìƒì„±
$ cat <<EOF > sample-secret-immutable.yaml
apiVersion: v1
kind: Secret
metadata:
  name: sample-secret-immutable
type: Opaque
data:
  username: cm9vdA==
  password: cm9vdHBhc3N3b3Jk
immutable: true
EOF


# usernameì„ rootì—ì„œ hogeë¡œ ë³€ê²½ ì‹œë„
$  kubectl patch secret sample-secret-immutable -p '{"data": {"username": "aG9nZQ=="}}'
The Secret "sample-secret-immutable" is invalid: data: Forbidden: field is immutable when `immutable` is set
```

<br>
